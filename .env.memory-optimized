# Memory-Optimized Development Environment Configuration
# Source this file to apply memory optimizations: source .env.memory-optimized
#
# Reduces memory usage by:
# - Limiting Node.js heap size to 2GB (vs unlimited)
# - Disabling source maps for faster builds
# - Setting esbuild workers to CPU count - 1
# - Optimizing Vite dev server

# Node.js Heap Size Limits
# Maximum old space size (in MB) - Default system allocates all available memory
# With 16GB RAM, this prevents Node from consuming > 2GB
NODE_OPTIONS="--max-old-space-size=2048 --max-semi-space-size=1024"

# Vite Dev Server Optimization
# Disable HTTPS to reduce overhead (HTTP is fine for local dev)
VITE_USE_HTTPS=false

# Source Maps - Disabled in optimized mode for faster bundling
# Only enable for debugging specific issues
VITE_SOURCEMAP=false

# Vite Worker Threads
# Reduce parallelism to prevent memory spikes
VITE_WORKERS=2

# Increase Node process timeout slightly to account for slower builds
NODE_TIMEOUT=60000

# Supabase-specific optimizations
# Disable unused features if you don't need them (edit as needed)
SUPABASE_DISABLE_ANALYTICS=true

# Docker Memory Optimization
# Used when starting Supabase via npm run db:local:start
# The docker-compose.override.yml file applies these limits automatically
DOCKER_MEMORY_LIMIT_POSTGRES=2g
DOCKER_MEMORY_LIMIT_KONG=512m
DOCKER_MEMORY_LIMIT_STUDIO=512m
DOCKER_MEMORY_LIMIT_OTHER=256m

echo "âœ“ Memory optimization environment loaded"
echo "  - Node.js: 2GB max heap"
echo "  - Vite: Disabled source maps"
echo "  - Docker: Memory limits applied via docker-compose.override.yml"
