WARN: no SMS provider is enabled. Disabling phone login
WARNING: You are running different service versions locally than your linked project:
supabase/storage-api:v1.33.5 => v1.33.0
supabase/gotrue:v2.183.0 => v2.185.0
Run supabase link to update them.
 api Skipped - Image is already present locally 
 auth Skipped - Image is already present locally 
 realtime Skipped - Image is already present locally 
 edgeRuntime Skipped - Image is already present locally 
 studio Skipped - Image is already present locally 
 pgmeta Skipped - Image is already present locally 
 db Skipped - Image is already present locally 
 gateway Skipped - Image is already present locally 
Starting database...
Initialising schema...
Seeding globals from roles.sql...
Skipping migration 20260123051958_remote_schema.sql.skip... (file name must match pattern "<timestamp>_name.sql")
Skipping migration 20260124184930_restrict_product_features_admin_only.sql.skip... (file name must match pattern "<timestamp>_name.sql")
Skipping migration PATTERNS.md... (file name must match pattern "<timestamp>_name.sql")
Applying migration 20251018152315_cloud_schema_fresh.sql...
Applying migration 20251018203500_update_rls_for_shared_team_access.sql...
NOTICE (00000): policy "authenticated_select_contactnotes" for relation "contactNotes" does not exist, skipping
NOTICE (00000): policy "authenticated_insert_contactnotes" for relation "contactNotes" does not exist, skipping
NOTICE (00000): policy "authenticated_update_contactnotes" for relation "contactNotes" does not exist, skipping
NOTICE (00000): policy "authenticated_delete_contactnotes" for relation "contactNotes" does not exist, skipping
NOTICE (00000): policy "authenticated_select_opportunitynotes" for relation "opportunityNotes" does not exist, skipping
NOTICE (00000): policy "authenticated_insert_opportunitynotes" for relation "opportunityNotes" does not exist, skipping
NOTICE (00000): policy "authenticated_update_opportunitynotes" for relation "opportunityNotes" does not exist, skipping
NOTICE (00000): policy "authenticated_delete_opportunitynotes" for relation "opportunityNotes" does not exist, skipping
Applying migration 20251018204500_add_helper_function_and_audit_trail.sql...
NOTICE (42701): column "updated_by" of relation "products" already exists, skipping
NOTICE (00000): trigger "set_updated_by_contacts" for relation "contacts" does not exist, skipping
NOTICE (00000): trigger "set_updated_by_organizations" for relation "organizations" does not exist, skipping
NOTICE (00000): trigger "set_updated_by_opportunities" for relation "opportunities" does not exist, skipping
NOTICE (00000): trigger "set_updated_by_contactnotes" for relation "contactNotes" does not exist, skipping
NOTICE (00000): trigger "set_updated_by_opportunitynotes" for relation "opportunityNotes" does not exist, skipping
NOTICE (00000): trigger "set_updated_by_products" for relation "products" does not exist, skipping
Applying migration 20251018210000_add_created_by_audit_field.sql...
NOTICE (42701): column "created_by" of relation "contacts" already exists, skipping
NOTICE (42701): column "created_by" of relation "organizations" already exists, skipping
NOTICE (42701): column "created_by" of relation "opportunities" already exists, skipping
NOTICE (42701): column "created_by" of relation "products" already exists, skipping
Applying migration 20251018211500_restore_auth_triggers_and_backfill.sql...
NOTICE (00000): trigger "on_auth_user_created" for relation "auth.users" does not exist, skipping
NOTICE (00000): trigger "on_auth_user_updated" for relation "auth.users" does not exist, skipping
NOTICE (00000): No backfill needed - all users have sales records
Applying migration 20251018232818_remove_deprecated_organization_fields.sql...
Applying migration 20251019000000_remove_partner_organization_type.sql...
Applying migration 20251020001702_add_organizations_summary_rls_policies.sql...
Applying migration 20251020002305_fix_contacts_summary_security_invoker.sql...
Applying migration 20251022172248_add_account_manager_unique_constraint.sql...
Applying migration 20251024125242_add_opportunities_summary_view.sql...
Applying migration 20251027225853_remove_csv_line_number_column.sql...
NOTICE (00000): constraint "organizations_csv_line_number_key" of relation "organizations" does not exist, skipping
NOTICE (00000): column "csv_line_number" of relation "organizations" does not exist, skipping
Applying migration 20251028040008_remove_product_pricing_and_uom.sql...
Applying migration 20251028042131_add_product_distributor_field.sql...
Applying migration 20251028044618_change_product_category_to_text.sql...
Applying migration 20251028213020_create_opportunity_contacts_junction_table.sql...
Applying migration 20251028213032_add_soft_delete_cascade_functions.sql...
Applying migration 20251029022906_add_opportunity_foreign_key_constraints.sql...
Applying migration 20251029022918_add_activity_contact_validation.sql...
Applying migration 20251029022924_add_opportunity_optimistic_locking.sql...
NOTICE (00000): trigger "check_concurrent_opportunity_update" for relation "opportunities" does not exist, skipping
Applying migration 20251029024045_fix_rls_policies_company_isolation.sql...
Applying migration 20251029051540_create_opportunity_products_table.sql...
Applying migration 20251029051621_update_sync_rpc_remove_pricing.sql...
Applying migration 20251029051954_add_products_to_opportunities_view.sql...
Applying migration 20251029070224_grant_authenticated_permissions.sql...
Applying migration 20251030025007_create_distinct_product_categories_view.sql...
Applying migration 20251030130720_fix_sync_opportunity_schema_mismatch.sql...
Applying migration 20251030131117_fix_rpc_array_parsing.sql...
Applying migration 20251030132011_add_rpc_backend_validation.sql...
Applying migration 20251030145417_fix_sync_opportunity_id_handling.sql...
Applying migration 20251030201606_fix_sync_rpc_response_format.sql...
Applying migration 20251031132404_remove_unused_tables.sql...
NOTICE (00000): SAFETY CHECK PASSED: All tables verified empty or non-existent.
NOTICE (00000): DROP VERIFICATION PASSED: All tables successfully removed.
NOTICE (00000): 
NOTICE (00000): ================================================================
NOTICE (00000): CLEANUP COMPLETE
NOTICE (00000): ================================================================
NOTICE (00000): Tables removed: 6
NOTICE (00000):   - product_pricing_models
NOTICE (00000):   - product_pricing_tiers
NOTICE (00000):   - contact_preferred_principals
NOTICE (00000):   - product_distributor_authorizations
NOTICE (00000):   - product_category_hierarchy
NOTICE (00000):   - product_features
NOTICE (00000): 
NOTICE (00000): Current table count: 18
NOTICE (00000): Expected: 24 base tables (down from 30)
NOTICE (00000): 
NOTICE (00000): Next steps:
NOTICE (00000): 1. Regenerate TypeScript types: npx supabase gen types typescript --local
NOTICE (00000): 2. Verify no TypeScript errors: npm run type-check
NOTICE (00000): 3. Test application: npm run dev
NOTICE (00000): ================================================================
Applying migration 20251031223406_complete_partner_type_removal.sql...
Applying migration 20251101172947_enforce_opportunity_customer_requirement.sql...
Applying migration 20251101231344_optimize_activity_log_rpc.sql...
Applying migration 20251102183932_remove_financial_tracking.sql...
NOTICE (00000): column "amount" of relation "opportunities" does not exist, skipping
Applying migration 20251102212250_fix_founding_interaction_trigger.sql...
Applying migration 20251103214809_remove_territory_fields.sql...
Applying migration 20251103215645_remove_phase3_features.sql...
NOTICE (00000): column "commission_rate" of relation "opportunity_participants" does not exist, skipping
NOTICE (00000): table "contact_preferred_principals" does not exist, skipping
Applying migration 20251103220516_remove_product_pricing_tables.sql...
NOTICE (00000): table "product_pricing_tiers" does not exist, skipping
NOTICE (00000): table "product_pricing_models" does not exist, skipping
NOTICE (00000): table "product_distributor_authorizations" does not exist, skipping
Applying migration 20251103220531_remove_product_food_specific_fields.sql...
Applying migration 20251103220544_remove_deprecated_contact_organizations.sql...
NOTICE (00000): table "product_features" does not exist, skipping
NOTICE (00000): table "product_category_hierarchy" does not exist, skipping
Applying migration 20251103220652_fix_products_search_trigger_removed_fields.sql...
Applying migration 20251103232837_create_audit_trail_system.sql...
Applying migration 20251103233745_add_campaign_and_related_opportunity_fields.sql...
Applying migration 20251104004610_create_booth_visitor_opportunity.sql...
Applying migration 20251104024615_fix_booth_visitor_product_column.sql...
Applying migration 20251104044122_add_products_summary_view.sql...
Applying migration 20251104125744_update_opportunities_summary_with_principal_name.sql...
Applying migration 20251104155935_add_opportunity_notes_field.sql...
Applying migration 20251104174935_add_campaign_choices_view.sql...
Applying migration 20251105001240_add_notifications_table.sql...
Applying migration 20251105005940_add_overdue_notification_tracking.sql...
Applying migration 20251105010132_setup_overdue_task_cron.sql...
Applying migration 20251106042002_fix_activity_log_deleted_at.sql...
Applying migration 20251106185819_add_stage_changed_at_to_opportunities.sql...
NOTICE (00000): trigger "trigger_update_opportunity_stage_changed_at" for relation "opportunities" does not exist, skipping
Applying migration 20251106190107_create_dashboard_principal_summary_view.sql...
Applying migration 20251108051117_add_soft_delete_columns.sql...
Applying migration 20251108051154_fix_opportunity_products_soft_delete.sql...
Applying migration 20251108051302_fix_notifications_soft_delete.sql...
Applying migration 20251108172640_document_rls_security_model.sql...
Applying migration 20251108213039_fix_rls_policies_role_based_access.sql...
Applying migration 20251108213216_cleanup_duplicate_rls_policies.sql...
Applying migration 20251110110402_dashboard_quick_actions_view_update.sql...
Applying migration 20251110111229_complete_task_with_followup_rpc.sql...
Applying migration 20251110125720_fix_complete_task_with_followup_created_by.sql...
Applying migration 20251110142650_add_organization_deletion_protection.sql...
Applying migration 20251110142654_add_organization_hierarchy_rollups.sql...
Applying migration 20251111121526_add_role_based_permissions.sql...
NOTICE (00000): policy "select_tasks" for relation "tasks" does not exist, skipping
NOTICE (00000): policy "insert_tasks" for relation "tasks" does not exist, skipping
NOTICE (00000): policy "update_tasks" for relation "tasks" does not exist, skipping
NOTICE (00000): policy "delete_tasks" for relation "tasks" does not exist, skipping
NOTICE (00000): policy "select_contacts" for relation "contacts" does not exist, skipping
NOTICE (00000): policy "insert_contacts" for relation "contacts" does not exist, skipping
NOTICE (00000): policy "update_contacts" for relation "contacts" does not exist, skipping
NOTICE (00000): policy "delete_contacts" for relation "contacts" does not exist, skipping
NOTICE (00000): policy "select_organizations" for relation "organizations" does not exist, skipping
NOTICE (00000): policy "insert_organizations" for relation "organizations" does not exist, skipping
NOTICE (00000): policy "update_organizations" for relation "organizations" does not exist, skipping
NOTICE (00000): policy "delete_organizations" for relation "organizations" does not exist, skipping
NOTICE (00000): policy "select_products" for relation "products" does not exist, skipping
NOTICE (00000): policy "insert_products" for relation "products" does not exist, skipping
NOTICE (00000): policy "update_products" for relation "products" does not exist, skipping
NOTICE (00000): policy "delete_products" for relation "products" does not exist, skipping
NOTICE (00000): policy "select_opportunities" for relation "opportunities" does not exist, skipping
NOTICE (00000): policy "insert_opportunities" for relation "opportunities" does not exist, skipping
NOTICE (00000): policy "update_opportunities" for relation "opportunities" does not exist, skipping
NOTICE (00000): policy "delete_opportunities" for relation "opportunities" does not exist, skipping
NOTICE (00000): policy "select_contactnotes" for relation "contactNotes" does not exist, skipping
NOTICE (00000): policy "insert_contactnotes" for relation "contactNotes" does not exist, skipping
NOTICE (00000): policy "update_contactnotes" for relation "contactNotes" does not exist, skipping
NOTICE (00000): policy "delete_contactnotes" for relation "contactNotes" does not exist, skipping
NOTICE (00000): policy "select_opportunitynotes" for relation "opportunityNotes" does not exist, skipping
NOTICE (00000): policy "insert_opportunitynotes" for relation "opportunityNotes" does not exist, skipping
NOTICE (00000): policy "update_opportunitynotes" for relation "opportunityNotes" does not exist, skipping
NOTICE (00000): policy "delete_opportunitynotes" for relation "opportunityNotes" does not exist, skipping
NOTICE (00000): policy "select_sales" for relation "sales" does not exist, skipping
NOTICE (00000): policy "insert_sales" for relation "sales" does not exist, skipping
NOTICE (00000): policy "update_sales" for relation "sales" does not exist, skipping
NOTICE (00000): policy "delete_sales" for relation "sales" does not exist, skipping
NOTICE (00000): ========================================
NOTICE (00000): Role-Based Permission System Installed
NOTICE (00000): ========================================
NOTICE (00000): Total users: 0
NOTICE (00000):   - Admins: 0
NOTICE (00000):   - Managers: 0
NOTICE (00000):   - Reps: 0
NOTICE (00000): ========================================
NOTICE (00000): Helper functions created:
NOTICE (00000):   - auth.user_role()
NOTICE (00000):   - public.is_admin()
NOTICE (00000):   - public.is_manager_or_admin()
NOTICE (00000):   - public.current_sales_id()
NOTICE (00000): ========================================
NOTICE (00000): RLS Policies updated for:
NOTICE (00000):   - tasks (personal ownership)
NOTICE (00000):   - contacts (shared, admin-only delete)
NOTICE (00000):   - organizations (shared, admin-only delete)
NOTICE (00000):   - products (shared, admin-only delete)
NOTICE (00000):   - opportunities (ownership-based)
NOTICE (00000):   - contactNotes (ownership-based)
NOTICE (00000):   - opportunityNotes (ownership-based)
NOTICE (00000):   - sales (role management)
NOTICE (00000): ========================================
Applying migration 20251111183436_add_note_to_interaction_type_enum.sql...
Applying migration 20251111185058_import_grand_rapids_campaign.sql...
Applying migration 20251112063019_add_weekly_activity_count_and_assigned_reps_to_dashboard.sql...
Applying migration 20251113235406_principal_opportunities_view.sql...
Applying migration 20251114001720_priority_tasks_view.sql...
Applying migration 20251114060720_fix_view_permissions.sql...
Applying migration 20251116005423_add_id_to_dashboard_views.sql...
Applying migration 20251116030314_add_sales_id_to_dashboard_views.sql...
Applying migration 20251116124147_fix_permissive_rls_policies.sql...
Applying migration 20251116210019_fix_sales_schema_consistency.sql...
NOTICE (00000): [OK] 1:1 mapping verified: 0 auth.users = 0 sales records
Applying migration 20251117010529_add_missing_tasks_update_policy.sql...
Applying migration 20251117011028_fix_tasks_select_policy.sql...
NOTICE (00000): policy "select_tasks" for relation "tasks" does not exist, skipping
Applying migration 20251117020743_seed_opportunities_for_tasks.sql...
Applying migration 20251117032253_fix_referential_integrity.sql...
NOTICE (00000): constraint "activities_organization_id_fkey" of relation "activities" does not exist, skipping
Applying migration 20251117105523_add_organization_cycle_protection.sql...
Applying migration 20251117112343_organization_hierarchy_phase1_cleanup.sql...
NOTICE (00000): Created US Foods Corporate parent (ID: 10334)
NOTICE (00000): Linked US Foods branches: 0 organizations updated
NOTICE (00000): Created Sysco Corporation parent (ID: 10335)
NOTICE (00000): Linked Sysco branches: 0 organizations updated
NOTICE (00000): Created Gordon Food Service parent (ID: 10336)
NOTICE (00000): Linked Gordon FS branches: 0 organizations updated
NOTICE (00000): Created Performance Food Group parent (ID: 10337)
NOTICE (00000): Fixed PFG organization types: 0 updated to distributor
NOTICE (00000): Linked PFG branches: 0 organizations updated
NOTICE (00000): Created PFS Corporate parent (ID: 10338)
NOTICE (00000): Linked PFS branches: 0 organizations updated
NOTICE (00000): Created Trinity Health System parent (ID: 10339)
NOTICE (00000): Linked THS facilities: 2 organizations updated
NOTICE (00000): 
NOTICE (00000): ========================================
NOTICE (00000): PHASE 1 CLEANUP SUMMARY
NOTICE (00000): ========================================
NOTICE (00000): Trinity Health System -> 2 branches
NOTICE (00000): US Foods Corporate -> 0 branches
NOTICE (00000): Sysco Corporation -> 0 branches
NOTICE (00000): Gordon Food Service -> 0 branches
NOTICE (00000): Performance Food Group -> 0 branches
NOTICE (00000): PFS Corporate -> 0 branches
NOTICE (00000): 
NOTICE (00000): Total organizations with parents: 2
NOTICE (00000): Total parent organizations: 1
NOTICE (00000): ========================================
Applying migration 20251117120623_phase2b_chain_parents_and_duplicates.sql...
NOTICE (00000): === SECTION 1: Creating Parent Organizations ===
NOTICE (00000): Created Dave & Buster's parent: ID 10340
NOTICE (00000):   -> Linked 2 children (IDs 287, 288)
NOTICE (00000): Created Notre Dame Dining parent: ID 10341
NOTICE (00000):   -> Linked 1 child (ID 10206)
NOTICE (00000): SECTION 1 COMPLETE: 2 parents created, 3 children linked
NOTICE (00000): 
NOTICE (00000): === SECTION 2: Updating Official Names ===
NOTICE (00000): Updated ID 441: "Girl in the goat" -> "Girl & The Goat"
NOTICE (00000): Updated ID 20: "AL PEAKE & SONS INC." -> "Al Peake & Sons & Daughter Too Foodservice"
NOTICE (00000): SECTION 2 COMPLETE: 2 names updated to official Google names
NOTICE (00000): 
NOTICE (00000): === SECTION 3: Marking Duplicates for Consolidation ===
NOTICE (00000): Marked ID 5 as duplicate of ID 10005 (7 Monks Taproom)
NOTICE (00000): Marked ID 1338 as duplicate of ID 10206 (Notre Dame Dining)
NOTICE (00000): Marked ID 1533 as duplicate of ID 20 (Al Peake & Sons)
NOTICE (00000): Marked ID 21 as duplicate of ID 20 (Al Peake & Sons - with typo)
NOTICE (00000): SECTION 3 COMPLETE: 4 duplicates marked (3 groups)
NOTICE (00000): 
NOTICE (00000): === SECTION 4: Flagging Organizations for Research ===
NOTICE (00000): Flagged ID 442 for research (possibly Little Goat Diner)
NOTICE (00000): Flagged ID 443 for research (possibly Duck Duck Goat)
NOTICE (00000): Flagged ID 855 for address verification (Portillo's)
NOTICE (00000): Flagged ID 856 for address verification (Portillo's Hot Dogs)
NOTICE (00000): SECTION 4 COMPLETE: 4 organizations flagged for research
NOTICE (00000): 
NOTICE (00000): === VALIDATION SUMMARY ===
NOTICE (00000): New parents created: 1 (expected: 2)
NOTICE (00000): Children linked to new parents: 1 (expected: 3)
NOTICE (00000): Official names updated: 0 (expected: 2)
NOTICE (00000): Duplicates marked for consolidation: 0 (expected: 4)
NOTICE (00000): Organizations flagged for research: 0 (expected: 4)
NOTICE (00000): 
NOTICE (00000): === PHASE 2B MIGRATION COMPLETE ===
NOTICE (00000): Next steps:
NOTICE (00000):   1. Review marked duplicates and manually consolidate
NOTICE (00000):   2. Research flagged organizations (Girl & The Goat variants, Portillo's)
NOTICE (00000):   3. Optional Phase 2C: Create "Stephanie Izard Restaurants" parent if IDs 442, 443 confirmed
Applying migration 20251117121913_phase2c_correct_misnamed_restaurants.sql...
NOTICE (00000): === SECTION 1: Correcting Misnamed Restaurants ===
NOTICE (00000): Updated ID 442: "Girl in the goat1" -> "Ever Restaurant"
NOTICE (00000): Updated ID 443: "Girl in the goat2" -> "Galit"
NOTICE (00000): Updated ID 855: "Portillo's" -> "Swift & Sons"
NOTICE (00000): SECTION 1 COMPLETE: 3 restaurant names corrected
NOTICE (00000): 
NOTICE (00000): === SECTION 2: Deleting Unverifiable Entry ===
NOTICE (00000): Deleted ID 856 (no address, unverifiable placeholder)
NOTICE (00000): SECTION 2 COMPLETE: 1 placeholder entry deleted
NOTICE (00000): 
NOTICE (00000): === VALIDATION SUMMARY ===
NOTICE (00000): Restaurant names corrected: 0 (expected: 3)
NOTICE (00000): ID 856 still exists (expected: 0): 0
NOTICE (00000): 
NOTICE (00000): === PHASE 2C MIGRATION COMPLETE ===
NOTICE (00000): Next steps:
NOTICE (00000):   1. Verify corrected names in UI
NOTICE (00000):   2. Review Phase 2C completion report for full findings
Applying migration 20251117123500_phase2d_consolidate_duplicates.sql...
NOTICE (00000): GROUP 1: Skipped - IDs 5 or 10005 not found in database
NOTICE (00000): GROUP 2: Skipped - IDs 1338 or 10206 not found in database
NOTICE (00000): GROUP 3: Skipped - ID 20 not found in database
Applying migration 20251117130422_diagnostic_sysco_parents.sql...
NOTICE (00000): 
NOTICE (00000): ========================================
NOTICE (00000): SYSCO PARENT DIAGNOSTIC
NOTICE (00000): ========================================
NOTICE (00000): 
NOTICE (00000): Step 1: Checking for Phase 1 parent organizations...
NOTICE (00000): 
NOTICE (00000): Phase 1 parents found: 6 of 6 expected
NOTICE (00000): 
NOTICE (00000): Phase 1 Parents in Database:
NOTICE (00000):   - Gordon Food Service (ID: 10336, Type: distributor, Branches: 0)
NOTICE (00000):   - Performance Food Group (ID: 10337, Type: distributor, Branches: 0)
NOTICE (00000):   - PFS Corporate (ID: 10338, Type: distributor, Branches: 0)
NOTICE (00000):   - Sysco Corporation (ID: 10335, Type: distributor, Branches: 0)
NOTICE (00000):   - Trinity Health System (ID: 10339, Type: customer, Branches: 2)
NOTICE (00000):   - US Foods Corporate (ID: 10334, Type: distributor, Branches: 0)
NOTICE (00000): 
NOTICE (00000): Step 2: Checking Sysco Corporation parent...
NOTICE (00000): 
NOTICE (00000): [OK] Sysco Corporation parent EXISTS (ID: 10335)
NOTICE (00000): 
NOTICE (00000): Step 3: Counting Sysco branch organizations...
NOTICE (00000): 
NOTICE (00000): Total Sysco branches: 0
NOTICE (00000): Branches with parent_organization_id set: 0
NOTICE (00000): 
NOTICE (00000): Sample Sysco Branches (first 10):
NOTICE (00000): 
NOTICE (00000): ========================================
NOTICE (00000): ANALYSIS
NOTICE (00000): ========================================
NOTICE (00000): 
NOTICE (00000): [WARN] ISSUE: Parent exists but NO branches are linked
NOTICE (00000):    - Migration UPDATE statement failed or did not match any rows
NOTICE (00000):    - Pattern used: name ILIKE 'Sysco%' OR name ILIKE 'SYSCO%'
NOTICE (00000): 
NOTICE (00000): [FIX] RECOMMENDED FIX:
NOTICE (00000):    - Create migration to UPDATE organizations SET parent_organization_id = 10335
NOTICE (00000):    - WHERE clause: name ILIKE 'Sysco%' OR name ILIKE 'SYSCO%'
NOTICE (00000): 
NOTICE (00000): ========================================
NOTICE (00000): DIAGNOSTIC COMPLETE
NOTICE (00000): ========================================
NOTICE (00000): 
NOTICE (00000): This migration made NO schema changes.
NOTICE (00000): Safe to rollback or delete after reviewing output.
NOTICE (00000): 
Applying migration 20251117130839_fix_phase1_invalid_parent_ids.sql...
NOTICE (00000): 
NOTICE (00000): ========================================
NOTICE (00000): FIXING PHASE 1 INVALID PARENT IDS
NOTICE (00000): ========================================
NOTICE (00000): 
NOTICE (00000): [1/6] US Foods Corporate (ID 10334): Fixed 0 branches
NOTICE (00000): [2/6] Sysco Corporation (ID 10335): Fixed 0 branches
NOTICE (00000): [3/6] Gordon Food Service (ID 10336): Fixed 0 branches
NOTICE (00000): [4/6] Performance Food Group (ID 10337): Fixed 0 branches
NOTICE (00000): [5/6] PFS Corporate (ID 10338): Fixed 0 branches
NOTICE (00000): [6/6] Trinity Health System (ID 10339): Fixed 0 branches
NOTICE (00000): 
NOTICE (00000): ========================================
NOTICE (00000): VALIDATION
NOTICE (00000): ========================================
NOTICE (00000): 
NOTICE (00000): [OK] Trinity Health System (ID 10339): 2 valid branches
NOTICE (00000): 
NOTICE (00000): ========================================
NOTICE (00000): FIX COMPLETE
NOTICE (00000): ========================================
NOTICE (00000): 
Applying migration 20251117131650_verify_sysco_parent_actual_values.sql...
NOTICE (00000): 
NOTICE (00000): ========================================
NOTICE (00000): SYSCO PARENT_ORGANIZATION_ID RAW VALUES
NOTICE (00000): ========================================
NOTICE (00000): 
NOTICE (00000): Correct Sysco Corporation parent ID: 10335
NOTICE (00000): 
NOTICE (00000): Sysco Branches (showing RAW parent_organization_id values):
NOTICE (00000): 
NOTICE (00000): 
NOTICE (00000): ========================================
NOTICE (00000): SUMMARY
NOTICE (00000): ========================================
NOTICE (00000): Branches with NULL parent: 0
NOTICE (00000): Branches with CORRECT parent (10335 ): 0
NOTICE (00000): Branches with WRONG parent: 0
NOTICE (00000): 
NOTICE (00000): [OK] All Sysco branches correctly linked
NOTICE (00000): ========================================
NOTICE (00000): 
Applying migration 20251117153658_test_parent_organization_api_access.sql...
Applying migration 20251117154601_check_organizations_summary_view.sql...
NOTICE (00000): 
NOTICE (00000): ========================================
NOTICE (00000): ORGANIZATIONS_SUMMARY VIEW ANALYSIS
NOTICE (00000): ========================================
NOTICE (00000): 
NOTICE (00000): View columns check:
NOTICE (00000):   - parent_organization_id: EXISTS
NOTICE (00000):   - parent_organization_name: EXISTS
NOTICE (00000): 
NOTICE (00000): All columns in organizations_summary:
NOTICE (00000):    1 | id                             | bigint
NOTICE (00000):    2 | name                           | text
NOTICE (00000):    3 | organization_type              | USER-DEFINED
NOTICE (00000):    4 | parent_organization_id         | bigint
NOTICE (00000):    5 | parent_organization_name       | text
NOTICE (00000):    6 | priority                       | character varying
NOTICE (00000):    7 | sales_id                       | bigint
NOTICE (00000):    8 | created_at                     | timestamp with time zone
NOTICE (00000):    9 | deleted_at                     | timestamp with time zone
NOTICE (00000):   10 | child_branch_count             | bigint
NOTICE (00000):   11 | total_contacts_across_branches | bigint
NOTICE (00000):   12 | total_opportunities_across_bra | bigint
NOTICE (00000):   13 | nb_contacts                    | bigint
NOTICE (00000):   14 | nb_opportunities               | bigint
NOTICE (00000): 
NOTICE (00000): First 100 chars of view definition:
NOTICE (00000):  SELECT o.id,
    o.name,
    o.organization_type,
    o.parent_organization_id,
    parent.name AS 
NOTICE (00000): 
NOTICE (00000): âœ… Parent columns exist in the view as expected.
NOTICE (00000): The issue may be in the data provider or frontend code.
NOTICE (00000): 
NOTICE (00000): ========================================
NOTICE (00000): 
Applying migration 20251117154738_fix_organizations_summary_add_parent_fields.sql...
NOTICE (00000): SUCCESS: Parent fields have been added to organizations_summary view
NOTICE (00000):   - parent_organization_id: EXISTS
NOTICE (00000):   - parent_organization_name: EXISTS
Applying migration 20251117160306_remove_organization_branch_functionality.sql...
NOTICE (00000): trigger "prevent_organization_cycles" for relation "organizations" does not exist, skipping
NOTICE (00000): trigger "prevent_parent_deletion" for relation "organizations" does not exist, skipping
NOTICE (00000): function check_organization_hierarchy_cycle() does not exist, skipping
NOTICE (00000): function check_organization_cycle() does not exist, skipping
NOTICE (00000): function prevent_parent_organization_deletion() does not exist, skipping
NOTICE (00000): view "organization_hierarchy_phase1_cleanup" does not exist, skipping
NOTICE (00000): SUCCESS: parent_organization_id column removed
NOTICE (00000): SUCCESS: Branch fields removed from organizations_summary
Applying migration 20251117174732_restore_parent_remove_branch_features.sql...
NOTICE (00000): trigger "check_organization_cycle" for relation "organizations" does not exist, skipping
NOTICE (00000): SUCCESS: parent_organization_id column restored
NOTICE (00000): SUCCESS: child_branch_count removed from view
Applying migration 20251117180837_restore_full_branch_parent_functionality.sql...
NOTICE (00000): trigger "prevent_parent_deletion" for relation "organizations" does not exist, skipping
NOTICE (00000): SUCCESS: Full branch and parent functionality restored
NOTICE (00000):   - child_branch_count field: ADDED
NOTICE (00000):   - total_contacts_across_branches field: ADDED
NOTICE (00000):   - total_opportunities_across_branches field: ADDED
NOTICE (00000):   - Cycle prevention: ENABLED
NOTICE (00000):   - Parent deletion protection: ENABLED
Applying migration 20251117200302_fix_distributor_parent_relationships.sql...
NOTICE (00000): Linked 1 Sysco branches to parent (ID: 10335)
NOTICE (00000): Linked 1 Gordon Food Service branches to parent (ID: 10336)
NOTICE (00000): Linked 1 Performance Food Group branches to parent (ID: 10337)
NOTICE (00000): Parent-Branch Relationships Fixed:
NOTICE (00000):   Parent organizations: 3
NOTICE (00000):   Total branches linked: 0
WARNING (01000):   Orphaned distributor branches remaining: 1
Applying migration 20251118050755_add_principal_pipeline_summary_view.sql...
NOTICE (42710): enum label "note" already exists, skipping
NOTICE (00000): view "principal_pipeline_summary" does not exist, skipping
Applying migration 20251118165501_fix_principal_pipeline_summary_id_column.sql...
Applying migration 20251122232133_cleanup_duplicate_organizations.sql...
NOTICE (00000): ========================================
NOTICE (00000): STARTING DUPLICATE ORGANIZATION CLEANUP
NOTICE (00000): ========================================
NOTICE (00000): 
NOTICE (00000): ========================================
NOTICE (00000): DUPLICATE CLEANUP COMPLETE
NOTICE (00000): Duplicate groups processed: 0
NOTICE (00000): Duplicate records merged: 0
NOTICE (00000): ========================================
NOTICE (00000): No duplicates found - database is clean!
NOTICE (00000): Verification passed: No duplicates remain
Applying migration 20251122232134_add_unique_organization_name_constraint.sql...
NOTICE (00000): No duplicate organization names found. Proceeding with constraint creation.
Applying migration 20251123190738_restore_activities_rls_policies.sql...
NOTICE (00000): policy "authenticated_select_activities" for relation "activities" does not exist, skipping
NOTICE (00000): policy "authenticated_insert_activities" for relation "activities" does not exist, skipping
NOTICE (00000): policy "authenticated_update_activities" for relation "activities" does not exist, skipping
NOTICE (00000): policy "authenticated_delete_activities" for relation "activities" does not exist, skipping
NOTICE (00000): policy "authenticated_select_tasks" for relation "tasks" does not exist, skipping
NOTICE (00000): policy "authenticated_insert_tasks" for relation "tasks" does not exist, skipping
NOTICE (00000): policy "authenticated_update_tasks" for relation "tasks" does not exist, skipping
NOTICE (00000): policy "authenticated_delete_tasks" for relation "tasks" does not exist, skipping
NOTICE (00000): policy "authenticated_select_tags" for relation "tags" does not exist, skipping
NOTICE (00000): policy "authenticated_insert_tags" for relation "tags" does not exist, skipping
NOTICE (00000): policy "authenticated_update_tags" for relation "tags" does not exist, skipping
NOTICE (00000): policy "authenticated_delete_tags" for relation "tags" does not exist, skipping
NOTICE (00000): policy "authenticated_select_interaction_participants" for relation "interaction_participants" does not exist, skipping
NOTICE (00000): policy "authenticated_insert_interaction_participants" for relation "interaction_participants" does not exist, skipping
NOTICE (00000): policy "authenticated_update_interaction_participants" for relation "interaction_participants" does not exist, skipping
NOTICE (00000): policy "authenticated_delete_interaction_participants" for relation "interaction_participants" does not exist, skipping
NOTICE (00000): policy "authenticated_select_opportunity_participants" for relation "opportunity_participants" does not exist, skipping
NOTICE (00000): policy "authenticated_insert_opportunity_participants" for relation "opportunity_participants" does not exist, skipping
NOTICE (00000): policy "authenticated_update_opportunity_participants" for relation "opportunity_participants" does not exist, skipping
NOTICE (00000): policy "authenticated_delete_opportunity_participants" for relation "opportunity_participants" does not exist, skipping
Applying migration 20251123214721_add_contact_duplicates_view.sql...
Applying migration 20251123215857_fix_merge_function_table_names.sql...
Applying migration 20251124005758_add_note_to_interaction_type.sql...
NOTICE (42710): enum label "note" already exists, skipping
Applying migration 20251124225546_add_organization_notes.sql...
Applying migration 20251126015956_add_contacts_summary_counts.sql...
NOTICE (42P07): relation "idx_tasks_contact_id" already exists, skipping
Applying migration 20251126041953_fix_opportunities_update_policy.sql...
NOTICE (00000): policy "update_opportunities" for relation "opportunities" does not exist, skipping
Applying migration 20251127054700_fix_critical_rls_security_tasks.sql...
NOTICE (00000): policy "select_tasks" for relation "tasks" does not exist, skipping
NOTICE (00000): policy "update_tasks" for relation "tasks" does not exist, skipping
NOTICE (00000): trigger "trigger_set_task_created_by" for relation "tasks" does not exist, skipping
Applying migration 20251127055705_enhance_rls_security_activities_and_indexes.sql...
NOTICE (42701): column "deleted_at" of relation "tasks" already exists, skipping
Applying migration 20251128063810_remove_contact_duplicate_artifacts.sql...
NOTICE (00000): function merge_duplicate_contacts(uuid,uuid[]) does not exist, skipping
Applying migration 20251128070000_migrate_awaiting_response_stage.sql...
NOTICE (00000): Migration: Found 0 opportunities with awaiting_response stage
NOTICE (00000): Migration complete: No opportunities with awaiting_response stage remain
Applying migration 20251129030358_contact_organization_id_not_null.sql...
NOTICE (00000): No orphan contacts found - all contacts have organization_id
NOTICE (00000): Foreign key constraint contacts_organization_id_fkey already exists
NOTICE (42P07): relation "idx_contacts_organization_id" already exists, skipping
Applying migration 20251129030715_add_is_manager_helper.sql...
NOTICE (00000): ========================================
NOTICE (00000): RBAC Helper Functions Complete
NOTICE (00000): ========================================
NOTICE (00000): Available functions:
NOTICE (00000):   - user_role()          - Returns user role enum
NOTICE (00000):   - is_admin()           - True if admin
NOTICE (00000):   - is_manager()         - True if manager (NEW)
NOTICE (00000):   - is_rep()             - True if rep (NEW)
NOTICE (00000):   - is_manager_or_admin()- True if manager OR admin
NOTICE (00000):   - current_sales_id()   - Returns sales record ID
NOTICE (00000): ========================================
Applying migration 20251129031410_activity_contact_cascade_trigger.sql...
Applying migration 20251129031937_add_win_loss_reason_fields.sql...
Applying migration 20251129040323_add_sample_status_enum.sql...
NOTICE (42710): enum label "note" already exists, skipping
Applying migration 20251129044504_add_organization_id_to_tasks.sql...
Applying migration 20251129044526_align_task_type_enum.sql...
Applying migration 20251129050428_add_distributor_principal_authorizations.sql...
Applying migration 20251129050526_setup_daily_digest_cron.sql...
Applying migration 20251129051554_add_check_authorization_view.sql...
Applying migration 20251129051625_add_product_distributor_authorizations.sql...
Applying migration 20251129120417_fix_public_role_rls_policies.sql...
Applying migration 20251129170506_harden_participant_tables_rls_security.sql...
NOTICE (42P07): relation "idx_opportunities_owner_id" already exists, skipping
NOTICE (42P07): relation "idx_activities_created_by" already exists, skipping
NOTICE (00000): trigger "trigger_set_opportunity_participant_created_by" for relation "opportunity_participants" does not exist, skipping
NOTICE (00000): trigger "trigger_set_interaction_participant_created_by" for relation "interaction_participants" does not exist, skipping
NOTICE (00000): policy "select_opportunity_participants" for relation "opportunity_participants" does not exist, skipping
NOTICE (00000): policy "insert_opportunity_participants" for relation "opportunity_participants" does not exist, skipping
NOTICE (00000): policy "update_opportunity_participants" for relation "opportunity_participants" does not exist, skipping
NOTICE (00000): policy "delete_opportunity_participants" for relation "opportunity_participants" does not exist, skipping
NOTICE (00000): policy "select_interaction_participants" for relation "interaction_participants" does not exist, skipping
NOTICE (00000): policy "insert_interaction_participants" for relation "interaction_participants" does not exist, skipping
NOTICE (00000): policy "update_interaction_participants" for relation "interaction_participants" does not exist, skipping
NOTICE (00000): policy "delete_interaction_participants" for relation "interaction_participants" does not exist, skipping
Applying migration 20251129173209_remove_awaiting_response_enum_value.sql...
NOTICE (00000): view "dashboard_pipeline_summary" does not exist, skipping
Applying migration 20251129180000_add_digest_query_functions.sql...
Applying migration 20251129180728_add_soft_delete_rls_filtering.sql...
Applying migration 20251129181451_add_missing_update_policies.sql...
NOTICE (00000): policy "update_contacts" for relation "contacts" does not exist, skipping
NOTICE (00000): policy "update_organizations" for relation "organizations" does not exist, skipping
Applying migration 20251129190000_add_tasks_due_today_function.sql...
Applying migration 20251129225719_replace_segments_with_playbook_categories.sql...
NOTICE (00000): constraint "organizations_segment_id_fkey" of relation "organizations" does not exist, skipping
Applying migration 20251129230248_p1_security_and_performance_fixes.sql...
