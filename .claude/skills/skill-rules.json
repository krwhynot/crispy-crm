{
  "version": "1.0",
  "description": "Skill activation triggers for Crispy-CRM",
  "agents": {
    "sienna-ux": {
      "description": "UI/UX Auditor agent - audits components for accessibility, design system compliance, and UX violations",
      "requiredSkills": ["ui-ux-design-principles", "enforcing-principles"],
      "promptTriggers": {
        "keywords": [
          "sienna",
          "sienna-ux",
          "ui audit",
          "ux audit",
          "accessibility audit",
          "design audit",
          "component audit",
          "review component",
          "audit component"
        ],
        "intentPatterns": [
          "(use|invoke|ask|have).*?sienna",
          "(audit|review|check|analyze).*?(component|ui|ux|accessibility|design)",
          "sienna.*?(audit|review|check)"
        ]
      }
    }
  },
  "skills": {
    "verification-before-completion": {
      "type": "guardrail",
      "enforcement": "block",
      "priority": "critical",
      "description": "Evidence-based completion claims - BLOCKS claiming tests pass, builds succeed, features work, or tasks done without running verification commands first. Requires npm run build, npx tsc --noEmit before completion claims.",
      "promptTriggers": {
        "keywords": [
          "done",
          "complete",
          "completed",
          "finished",
          "fixed",
          "passes",
          "passing",
          "works",
          "working",
          "ready",
          "ship it",
          "good to go",
          "all good",
          "verified",
          "commit",
          "PR",
          "pull request",
          "push",
          "merge",
          "deploy",
          "implement",
          "create",
          "build",
          "add feature",
          "new component",
          "new handler"
        ],
        "intentPatterns": [
          "(tests?|build|types?).*?(pass|passes|passing|succeed|succeeds|work|works)",
          "(feature|task|bug|fix).*?(complete|done|finished|ready|works)",
          "(ready|good).*?(to|for).*?(commit|push|PR|merge|deploy|review)",
          "(should|probably|seems to).*?(work|pass|be fixed)",
          "(i'm|we're).*?(done|finished|complete)",
          "(it|this|that).*?(works|passes|is fixed|is ready)",
          "ship.*?it",
          "all.*?(good|done|set|ready)",
          "(create|make|open).*?(commit|PR|pull request)",
          "(push|merge|deploy).*?(changes|code|branch)",
          "(implement|create|build|add).*?(feature|component|handler|schema|form)",
          "(new|add).*?(component|hook|handler|schema|validation)"
        ]
      },
      "verificationCommands": {
        "build": "npm run build",
        "types": "npx tsc --noEmit",
        "tests": "npm test",
        "e2e": "npx playwright test"
      },
      "blockPatterns": {
        "description": "Completion claims that should BLOCK without verification evidence",
        "patterns": [
          "tests? pass",
          "build (succeeds|passes|works)",
          "types? (are |is )?(correct|good|fixed)",
          "feature (is )?(complete|done|ready)",
          "bug (is )?(fixed|resolved)",
          "ready (to|for) (commit|push|PR|merge|deploy)",
          "should (work|pass|be fixed)",
          "looks (good|correct|right)",
          "all (good|done|set|ready)",
          "ship it",
          "good to go"
        ]
      }
    },
    "enforcing-principles": {
      "type": "guardrail",
      "enforcement": "hybrid",
      "priority": "critical",
      "description": "Engineering Constitution enforcement - BLOCKS anti-patterns (retry logic, circuit breakers, TypeScript escape hatches), SUGGESTS best practices (fail-fast, Zod validation, form defaults from schema). Includes Zod security (strictObject, string limits, coercion), form performance (onSubmit/onBlur mode, useWatch), and TypeScript strictness.",
      "promptTriggers": {
        "keywords": [
          "implement",
          "feature",
          "error handling",
          "validation",
          "form",
          "defaults",
          "zod",
          "schema",
          "migration",
          "database",
          "retry",
          "circuit breaker",
          "resilience",
          "fallback",
          "data provider",
          "unified provider",
          "react admin",
          "interface",
          "type",
          "strictObject",
          "strict object",
          "string limit",
          "max length",
          "coerce",
          "coercion",
          "allowlist",
          "enum",
          "useWatch",
          "watch",
          "onSubmit",
          "onBlur",
          "onChange",
          "validation mode",
          "form mode",
          "mass assignment",
          "DoS",
          "OWASP",
          "as any",
          "ts-ignore",
          "ts-nocheck",
          "type safety",
          "any type",
          "typescript strict"
        ],
        "intentPatterns": [
          "(implement|create|build|add).*?(feature|form|validation|migration)",
          "(handle|add|implement).*?(error|resilience|retry|fallback)",
          "(create|add|modify).*?(schema|validation|zod)",
          "(set|define|add).*?(default|form)",
          "how.*?(validate|handle error|create form)",
          "(database|db|migration).*?(change|update|create)",
          "(add|set|use).*?(string|length).*?(limit|max)",
          "(use|create).*?strict.*?object",
          "(form|input).*?(coerce|coercion|number|date)",
          "(watch|useWatch).*?(form|value|field)",
          "(validation|form).*?mode"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "src/atomic-crm/**/*.tsx",
          "src/atomic-crm/**/*.ts",
          "src/atomic-crm/providers/**/*.ts",
          "src/atomic-crm/validation/**/*.ts",
          "supabase/migrations/**/*.sql"
        ],
        "contentPatterns": [
          "CircuitBreaker",
          "maxRetries",
          "MAX_RETRIES",
          "exponential.*backoff",
          "retry.*logic",
          "class.*CircuitBreaker",
          "graceful.*fallback",
          "catch.*return.*cached",
          "defaultValue=",
          "defaultValues:\\s*\\{",
          "validate=\\{",
          "\\.safeParse\\(",
          "z\\.object\\(",
          "import.*from.*react-admin",
          "z\\.strictObject\\(",
          "z\\.coerce\\.",
          "\\.max\\(\\d+\\)",
          "z\\.enum\\(",
          "useWatch\\(",
          "mode:\\s*['\"]onChange['\"]",
          "watch\\(\\)",
          "as any",
          "@ts-ignore",
          "@ts-nocheck",
          "as unknown as"
        ]
      },
      "blockPatterns": {
        "description": "Anti-patterns that should BLOCK and require skill review",
        "patterns": [
          "class\\s+CircuitBreaker",
          "for\\s*\\(.*MAX_RETRIES",
          "exponential.*backoff",
          "Math\\.pow\\(2,.*\\).*\\*.*1000",
          "catch.*\\{[^}]*return.*cached",
          "state:\\s*['\"]OPEN['\"]\\s*\\|\\s*['\"]CLOSED['\"]"
        ]
      },
      "warnPatterns": {
        "description": "Patterns that trigger a warning but don't block - require justification",
        "patterns": [
          "as\\s+any",
          "@ts-ignore",
          "@ts-nocheck",
          "as\\s+unknown\\s+as",
          "\\!\\s*$",
          ": any[,;\\)\\s]"
        ],
        "allowedContexts": [
          "test files",
          "type definition files (.d.ts)",
          "third-party library wrappers"
        ]
      }
    },
    "skill-developer": {
      "type": "domain",
      "enforcement": "suggest",
      "priority": "high",
      "description": "Meta-skill for creating and managing Claude Code skills",
      "promptTriggers": {
        "keywords": [
          "skill system",
          "create skill",
          "add skill",
          "skill triggers",
          "skill rules",
          "skill development"
        ],
        "intentPatterns": [
          "(how do|how does|explain).*?skill",
          "(create|add|modify|build).*?skill",
          "skill.*?(work|trigger|activate|system)"
        ]
      }
    },
    "ui-ux-design-principles": {
      "type": "guardrail",
      "enforcement": "suggest",
      "priority": "high",
      "description": "UI/UX design principles, UX laws (Jakob's, Hick's, Fitts's), accessibility, color theory, cognitive load, touch targets. NEW: Form accessibility (aria-invalid, role='alert', aria-describedby, focus management).",
      "promptTriggers": {
        "keywords": [
          "design",
          "UX",
          "UI",
          "user experience",
          "usability",
          "accessibility",
          "a11y",
          "color",
          "contrast",
          "touch target",
          "44px",
          "cognitive load",
          "Hick's Law",
          "Fitts's Law",
          "Jakob's Law",
          "Miller's Law",
          "decision matrix",
          "audit",
          "component",
          "button",
          "form",
          "layout",
          "responsive",
          "mobile",
          "tablet",
          "desktop",
          "WCAG",
          "ARIA",
          "semantic",
          "spacing",
          "typography",
          "elevation",
          "feedback",
          "loading state",
          "toast",
          "aria-invalid",
          "aria-describedby",
          "role alert",
          "screen reader",
          "form error",
          "validation error",
          "error message",
          "focus management",
          "label",
          "htmlFor"
        ],
        "intentPatterns": [
          "(create|build|design|implement).*?(component|ui|interface|button|form|layout)",
          "(audit|review|evaluate|assess).*?(ui|ux|design|usability|accessibility)",
          "(improve|fix|optimize).*?(accessibility|usability|ux|ui)",
          "(check|verify|ensure).*?(contrast|touch|target|accessible)",
          "(style|styling|css|tailwind).*",
          "how.*?(look|appear|design|accessible)",
          "(tablet|ipad|mobile|responsive).*?(design|layout|view)",
          "what.*?(color|spacing|size|font)",
          "(form|input|field).*?(accessibility|accessible|aria|screen reader)",
          "(error|validation).*?(message|display|announce|accessible)",
          "(focus|keyboard).*?(management|navigation|trap)"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "src/components/**/*.tsx",
          "src/pages/**/*.tsx",
          "src/layouts/**/*.tsx",
          "src/atomic-crm/**/*.tsx"
        ],
        "contentPatterns": ["className=", "tailwind", "bg-", "text-", "aria-", "role="]
      }
    },
    "data-integrity-guards": {
      "type": "domain",
      "enforcement": "suggest",
      "priority": "high",
      "description": "Defense-in-depth validation pattern - validates data at EVERY layer: API boundary (Zod with strictObject, .max() limits, coercion), form state (schema defaults, useWatch), database (RLS/soft-delete), and logging. Makes bugs structurally impossible.",
      "promptTriggers": {
        "keywords": [
          "validation",
          "data flow",
          "integrity",
          "security",
          "guards",
          "layers",
          "defense in depth",
          "multi-layer",
          "Zod",
          "RLS",
          "form defaults",
          "soft delete",
          "audit",
          "data corruption",
          "sanitize",
          "boundary",
          "checkpoint",
          "strictObject",
          "string limit",
          "max length",
          "coerce",
          "coercion",
          "mass assignment",
          "DoS",
          "OWASP",
          "allowlist",
          "denylist"
        ],
        "intentPatterns": [
          "(validate|check|verify).*?(data|input|form|request)",
          "(add|implement|create).*?(validation|guard|check)",
          "(data|input).*?(flow|path|journey)",
          "(where|how).*?(validate|check|verify)",
          "(prevent|stop|catch).*?(invalid|bad|corrupt).*?data",
          "(ensure|guarantee|enforce).*?(integrity|valid|correct)",
          "defense.*?in.*?depth",
          "(multiple|multi).*?layer.*?(validation|check)",
          "(zod|schema).*?(validate|boundary|api)",
          "(rls|row level security).*?(policy|check)",
          "(soft|hard).*?delete",
          "(prevent|avoid).*?(mass assignment|DoS|injection)",
          "(add|use).*?(strict|length limit|coercion)"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "src/atomic-crm/providers/**/*.ts",
          "src/atomic-crm/validation/**/*.ts",
          "src/atomic-crm/**/*Create.tsx",
          "src/atomic-crm/**/*Edit.tsx",
          "src/atomic-crm/**/*Form.tsx",
          "supabase/functions/**/*.ts",
          "supabase/migrations/**/*.sql"
        ],
        "contentPatterns": [
          "z\\.object\\(",
          "\\.safeParse\\(",
          "\\.parse\\(",
          "superRefine",
          "ValidationService",
          "validateContactForm",
          "validateOrganization",
          "partial\\(\\)\\.parse",
          "defaultValues",
          "CREATE POLICY",
          "ROW LEVEL SECURITY",
          "deleted_at",
          "logger\\.error"
        ]
      }
    },
    "technical-feedback": {
      "type": "domain",
      "enforcement": "suggest",
      "priority": "high",
      "description": "Bidirectional code review protocol - receiving feedback (verify before implementing, push back on principle violations) and giving feedback (prioritize project principles, actionable critique). Embeds Crispy CRM principles (fail-fast, Zod boundary, design system).",
      "requiredSkills": ["enforcing-principles"],
      "promptTriggers": {
        "keywords": [
          "code review",
          "review feedback",
          "PR comments",
          "review suggestions",
          "feedback",
          "suggestions",
          "changes requested",
          "fix this",
          "implement this",
          "make these changes",
          "address comments",
          "apply feedback",
          "receiving review",
          "giving review",
          "review my code",
          "check this code",
          "pushback",
          "disagree with",
          "wrong suggestion",
          "PR approval",
          "merge request",
          "GitHub comments",
          "requested changes",
          "LGTM",
          "approve PR",
          "reject PR",
          "nitpick",
          "Copilot suggested",
          "Copilot says",
          "Zen said",
          "Zen recommended",
          "AI suggested",
          "AI recommended",
          "external model",
          "GPT said",
          "this is wrong",
          "bad approach",
          "should instead",
          "why did you",
          "reconsider",
          "doesn't look right",
          "I disagree",
          "that's incorrect",
          "not the right way",
          "eslint error",
          "lint warning",
          "lint error",
          "type error",
          "TypeScript error",
          "TS error",
          "test failed",
          "test failure",
          "assertion error",
          "expect received",
          "failing test",
          "build error",
          "compile error"
        ],
        "intentPatterns": [
          "(receive|got|have).*?(feedback|review|comments|suggestions)",
          "(implement|apply|address|fix).*?(feedback|review|comments|suggestions)",
          "(review|check|evaluate).*?(code|changes|PR|pull request)",
          "(give|provide|write).*?(feedback|review|comments)",
          "(push back|disagree|reject).*?(suggestion|feedback|review)",
          "(this|that).*?(suggestion|feedback).*?(wrong|incorrect|violates)",
          "(code|PR).*?review.*?(feedback|comments)",
          "(address|fix|implement).*?(PR|pull request).*?comments",
          "(copilot|zen|gpt|ai|model).*?(said|suggested|recommended|thinks)",
          "(approve|reject|merge).*?(PR|pull request|MR|merge request)",
          "(requested|asking for).*?changes",
          "(this|that|it).*?(is|seems|looks).*?(wrong|incorrect|off|bad)",
          "(why|how come).*?(did you|would you|are you).*?(do|use|implement)",
          "(should|could|would).*?(instead|rather|better)",
          "(reconsider|rethink|redo).*?(approach|implementation|design)",
          "(eslint|lint|tsc|typescript).*?(error|warning|issue)",
          "(test|spec|assertion).*?(fail|error|broke)",
          "(fix|address|resolve).*?(lint|type|test|build).*?(error|warning|failure)",
          "failing.*?(test|build|lint|type check)"
        ]
      }
    },
    "root-cause-tracing": {
      "type": "guardrail",
      "enforcement": "block",
      "priority": "critical",
      "description": "Systematic backward tracing through call chains to find where bugs originate. BLOCKS symptom-fixing edits without root cause investigation. Integrates with mcp__zen__debug for hypothesis-driven investigation. Includes find-polluter.sh for test pollution bisection.",
      "promptTriggers": {
        "keywords": [
          "debug",
          "debugging",
          "trace",
          "tracing",
          "root cause",
          "call stack",
          "stack trace",
          "where does this come from",
          "why is this failing",
          "track down",
          "find the source",
          "investigate",
          "error",
          "exception",
          "bug",
          "issue",
          "problem",
          "test pollution",
          "flaky test",
          "test isolation",
          "which test",
          "bisect",
          "bisection",
          "polluter",
          "null pointer",
          "undefined",
          "NaN",
          "type error",
          "runtime error",
          "fails intermittently",
          "sometimes fails",
          "trace back",
          "work backward",
          "where is this set",
          "who calls this",
          "what calls this"
        ],
        "intentPatterns": [
          "(debug|trace|investigate|find).*?(error|bug|issue|problem|cause)",
          "(why|where|how).*?(is|does|did).*?(this|it).*?(fail|error|break|null|undefined)",
          "(track|trace|find).*?(down|back|source|origin)",
          "(root|original|underlying).*?cause",
          "(call|execution).*?(stack|chain|trace)",
          "(where|what|who).*?(calls?|sets?|creates?|passes?).*?this",
          "(test|spec).*?(pollution|polluter|isolation|flaky|intermittent)",
          "(bisect|binary search).*?(test|failure)",
          "(fix|patch).*?(symptom|where it appears)",
          "the error (is|appears) (in|at).*?(but|however)",
          "(null|undefined|NaN).*?(where|why|how)",
          "(investigate|look into|dig into).*?(failure|crash|error)"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "src/**/*.tsx",
          "src/**/*.ts",
          "tests/**/*.ts",
          "tests/**/*.spec.ts",
          "src/**/*.test.ts"
        ],
        "contentPatterns": [
          "throw new Error",
          "console\\.error",
          "catch\\s*\\(",
          "\\?\\.\\s*\\w+",
          "\\|\\|\\s*\\{\\}",
          "\\|\\|\\s*\\[\\]",
          "\\|\\|\\s*''",
          "\\?\\?\\s*",
          "if\\s*\\(\\s*!",
          "\\.catch\\(",
          "try\\s*\\{"
        ]
      },
      "blockPatterns": {
        "description": "Anti-patterns that indicate symptom-fixing without root cause investigation. NOTE: Optional chaining (?.) is valid TypeScript - only block when combined with suspicious fallbacks.",
        "patterns": [
          "catch\\s*\\([^)]*\\)\\s*\\{[^}]*\\?\\.",
          "\\|\\|\\s*\\{\\}",
          "\\|\\|\\s*\\[\\]",
          "\\|\\|\\s*''",
          "\\?\\?\\s*\\{\\}",
          "\\?\\?\\s*\\[\\]",
          "catch\\s*\\([^)]*\\)\\s*\\{[^}]*console",
          "catch\\s*\\([^)]*\\)\\s*\\{\\s*\\}",
          "catch\\s*\\{\\s*\\}",
          "if\\s*\\(!\\w+\\)\\s*return\\s*;?\\s*$"
        ]
      },
      "integrations": {
        "zenDebug": {
          "tool": "mcp__zen__debug",
          "purpose": "Structured hypothesis-driven investigation",
          "requiredFields": ["step", "hypothesis", "confidence", "relevant_files"]
        }
      }
    },
    "fail-fast-debugging": {
      "type": "guardrail",
      "enforcement": "contextual",
      "priority": "critical",
      "description": "Systematic debugging discipline - ENFORCES root cause investigation BEFORE fixes. Integrates with Zen MCP (mcp__zen__debug), TodoWrite, and verification-before-completion. 2-attempt rule for architecture escalation. Aligns with fail-fast engineering principle.",
      "promptTriggers": {
        "keywords": [
          "bug",
          "error",
          "failing",
          "broken",
          "fix",
          "not working",
          "crash",
          "issue",
          "debug",
          "investigate",
          "diagnose",
          "trace",
          "root cause",
          "why is",
          "undefined",
          "null",
          "500 error",
          "RLS",
          "timeout",
          "infinite loop",
          "exception",
          "stack trace",
          "doesn't work",
          "stopped working",
          "fails",
          "throws",
          "unexpected",
          "wrong value",
          "incorrect",
          "type error",
          "runtime error",
          "network error",
          "query error"
        ],
        "intentPatterns": [
          "(fix|debug|investigate|diagnose|trace).*?(bug|error|issue|problem|failure)",
          "(why|how come|what's wrong).*?(is|does|did).*?(fail|error|break|crash|not work)",
          "(not|isn't|doesn't|won't).*?(work|working|loading|rendering|showing)",
          "(getting|seeing|have|got).*?(error|exception|bug|issue)",
          "(something|it).*?(broke|broken|wrong|incorrect)",
          "(null|undefined|NaN).*?(error|exception|value)",
          "(stack|error).*?trace",
          "(root|underlying|real).*?cause",
          "(investigate|look into|dig into|find).*?(why|what|cause)",
          "quick.*?fix",
          "just.*?try",
          "maybe.*?(this|that).*?will",
          "let me.*?(add|try|change)"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "src/atomic-crm/providers/**/*.ts",
          "src/atomic-crm/validation/**/*.ts",
          "supabase/migrations/**/*.sql",
          "supabase/functions/**/*.ts"
        ],
        "contentPatterns": [
          "throw new Error",
          "console\\.error",
          "\\.catch\\(",
          "try\\s*\\{",
          "Error\\(",
          "reject\\(",
          "fail\\("
        ]
      },
      "contextualEnforcement": {
        "block": {
          "pathPatterns": [
            "src/atomic-crm/providers/**/*.ts",
            "src/atomic-crm/validation/**/*.ts",
            "supabase/migrations/**/*.sql"
          ],
          "reason": "Data layer, validation, and database changes are critical - require investigation first"
        },
        "suggest": {
          "pathPatterns": ["src/components/**/*.tsx", "src/**/__tests__/**/*.ts", "tests/**/*.ts"],
          "reason": "UI and test files are less critical - investigation recommended but not enforced"
        }
      },
      "antiPatterns": {
        "description": "Patterns that indicate skipping investigation - trigger warning",
        "patterns": [
          "let me just",
          "quick fix",
          "try this",
          "maybe this",
          "should fix",
          "might work",
          "worth a try"
        ]
      },
      "integrations": {
        "zenDebug": {
          "tool": "mcp__zen__debug",
          "purpose": "Structure investigation thinking",
          "requiredBefore": "any fix attempt"
        },
        "todoWrite": {
          "tool": "TodoWrite",
          "purpose": "Track investigation steps",
          "requiredBefore": "any fix attempt"
        },
        "verification": {
          "skill": "verification-before-completion",
          "purpose": "Verify fix after implementation"
        }
      },
      "escalation": {
        "attempts": 2,
        "action": "question architecture",
        "tool": "mcp__zen__thinkdeep"
      }
    },
    "stuck-process-detection": {
      "type": "guardrail",
      "enforcement": "block",
      "priority": "critical",
      "description": "Prevents infinite polling loops when monitoring background shells. Enforces timeout limits, max poll attempts (5), and foreground preference. BLOCKS after 5 consecutive empty BashOutput calls. Integrates with KillShell for stuck process recovery.",
      "promptTriggers": {
        "keywords": [
          "run_in_background",
          "background",
          "BashOutput",
          "wait for",
          "waiting for",
          "check output",
          "poll",
          "polling",
          "monitoring",
          "long-running",
          "tests running",
          "build running",
          "server starting",
          "still running",
          "wait a bit",
          "wait longer",
          "check again",
          "no content",
          "empty output",
          "no output yet"
        ],
        "intentPatterns": [
          "(run|execute|start).*?(in background|background)",
          "(wait|waiting).*?(for|on).*?(output|process|test|build)",
          "(check|poll|monitor).*?(output|status|progress)",
          "(let me|i'll).*?(wait|check).*?(again|longer|bit)",
          "(no|empty|nothing).*?(output|content|result)",
          "still.*?(running|waiting|polling)",
          "process.*?(running|started|launched)",
          "background.*?(task|process|shell|command)"
        ]
      },
      "hooks": {
        "PreToolUse": {
          "matcher": "BashOutput",
          "script": "bash-output-poll-guard.sh",
          "purpose": "Detect and block infinite polling loops"
        },
        "PostToolUse": {
          "matcher": "BashOutput",
          "script": "bash-output-success-reset.sh",
          "purpose": "Reset counter when output is received"
        }
      },
      "thresholds": {
        "warningAfter": 3,
        "blockAfter": 5,
        "resetIntervalSeconds": 30
      }
    },
    "supabase-crm": {
      "type": "domain",
      "enforcement": "suggest",
      "priority": "high",
      "description": "Supabase backend patterns, RLS policies, Edge Functions, query optimization, and migration best practices",
      "promptTriggers": {
        "keywords": [
          "supabase",
          "database",
          "query",
          "RLS",
          "edge function",
          "backend",
          "api",
          "service layer",
          "migration",
          "migrate",
          "schema",
          "CREATE VIEW",
          "ALTER TABLE",
          "GRANT",
          "RLS policy",
          "database view",
          "sql migration",
          "row level security",
          "permissions",
          "postgres",
          "postgresql"
        ],
        "intentPatterns": [
          "(create|build|write).*?(query|function|api|migration|schema|view|table|policy)",
          "(database|backend|supabase).*",
          "how.*?(query|fetch|insert|update|delete)",
          "(create|write|refactor|update).*?(migration|schema|view|table)",
          "(add|modify|update|fix).*?(table|view|policy|permission)",
          "migration.*?(file|pattern|template|best practice)",
          "(deploy|push|apply).*?(migration|schema)",
          "(grant|revoke).*?(select|insert|update|delete)"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "src/services/**/*.ts",
          "src/lib/supabase/**/*.ts",
          "supabase/functions/**/*.ts",
          "supabase/migrations/**/*.sql"
        ],
        "contentPatterns": [
          "import.*supabase",
          "\\.from\\(",
          "\\.select\\(",
          "createClient",
          "RLS",
          "CREATE (TABLE|VIEW|FUNCTION|POLICY|INDEX)",
          "ALTER (TABLE|VIEW)",
          "GRANT (SELECT|INSERT|UPDATE|DELETE)",
          "ROW LEVEL SECURITY",
          "ENABLE ROW LEVEL SECURITY",
          "-- ====="
        ]
      }
    },
    "supabase-cli": {
      "type": "guardrail",
      "enforcement": "block",
      "priority": "critical",
      "description": "BLOCKS invalid Supabase CLI commands (supabase db execute doesn't exist!) and incorrect Docker flags (-it in non-TTY). Auto-detects project container names from config.toml. Covers migrations, Edge Functions, type generation, local development.",
      "promptTriggers": {
        "keywords": [
          "supabase",
          "npx supabase",
          "supabase start",
          "supabase stop",
          "supabase status",
          "supabase link",
          "supabase init",
          "supabase login",
          "db push",
          "db pull",
          "db reset",
          "db diff",
          "migration new",
          "migration up",
          "migration list",
          "gen types",
          "functions deploy",
          "functions serve",
          "functions new",
          "edge function",
          "edge functions",
          "secrets set",
          "storage ls",
          "storage cp",
          "inspect db",
          "local development",
          "local stack",
          "supabase docker",
          "supabase container",
          "run sql",
          "execute sql",
          "psql",
          "supabase_db",
          "config.toml"
        ],
        "intentPatterns": [
          "(run|execute|use).*?supabase.*?(cli|command)",
          "supabase.*?(start|stop|status|init|link|login)",
          "(push|pull|reset|diff).*?(database|db|migration)",
          "(create|new|add).*?(migration|edge function|function)",
          "(deploy|serve|test).*?(function|edge function)",
          "(generate|gen).*?types?",
          "(run|execute).*?sql.*?(supabase|local|docker)",
          "(docker|container).*?supabase",
          "supabase.*?docker",
          "how.*?(supabase|migration|edge function)",
          "what.*?supabase.*?command",
          "(local|dev).*?(stack|environment|database)",
          "config\\.toml"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "supabase/config.toml",
          "supabase/migrations/**/*.sql",
          "supabase/functions/**/*.ts",
          "supabase/seed.sql"
        ],
        "contentPatterns": [
          "supabase",
          "CREATE TABLE",
          "CREATE VIEW",
          "ALTER TABLE",
          "Deno\\.serve"
        ]
      },
      "blockPatterns": {
        "description": "Commands that DON'T exist or will fail - BLOCK and require skill review",
        "patterns": [
          "supabase\\s+db\\s+execute",
          "supabase\\s+run\\s+",
          "supabase\\s+sql\\s+",
          "supabase\\s+query\\s+",
          "docker\\s+exec\\s+-it\\s+supabase",
          "docker\\s+exec\\s+-ti\\s+supabase",
          "npx\\s+supabase\\s+db\\s+execute"
        ]
      },
      "autoDetect": {
        "containerName": {
          "source": "supabase/config.toml",
          "pattern": "^id\\s*=\\s*[\"']?([^\"'\\s]+)[\"']?",
          "template": "supabase_db_{project_id}"
        }
      },
      "hooks": {
        "PreToolUse": {
          "matcher": "Bash",
          "script": ".claude/hooks/supabase-cli-guard.ts",
          "purpose": "Block invalid supabase/docker commands before execution"
        }
      }
    },
    "deep-audit": {
      "type": "domain",
      "enforcement": "suggest",
      "priority": "high",
      "description": "Comprehensive full-stack codebase audit for Crispy CRM. Phased approach: Phase 1 (Critical: security, data integrity, runtime errors), Phase 2 (Improvements: code quality, UI/UX, performance), Phase 3 (Polish: tests, docs, DX). Generates markdown report and auto-creates todos.",
      "requiredSkills": ["enforcing-principles", "ui-ux-design-principles"],
      "promptTriggers": {
        "keywords": [
          "audit",
          "deep audit",
          "codebase audit",
          "code audit",
          "quality check",
          "quality audit",
          "codebase review",
          "full review",
          "comprehensive review",
          "security audit",
          "security review",
          "after refactoring",
          "refactoring complete",
          "feature complete",
          "new feature done",
          "ready for review",
          "pre-release",
          "before release",
          "health check",
          "codebase health"
        ],
        "intentPatterns": [
          "(audit|review|check).*?(codebase|code|project|feature|security|quality)",
          "(deep|full|comprehensive|thorough).*?(audit|review|check|analysis)",
          "(run|do|perform|start).*?audit",
          "(feature|refactoring|changes?).*?(complete|done|finished).*?(review|audit|check)",
          "(before|pre).*?(release|deploy|ship).*?(audit|review|check)",
          "(check|review|audit).*?(everything|all|full)",
          "how.*?(healthy|quality|secure).*?(codebase|code|project)",
          "(security|data|ui|ux|performance).*?audit"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "src/atomic-crm/**/*.tsx",
          "src/atomic-crm/**/*.ts",
          "src/atomic-crm/providers/**/*.ts",
          "src/atomic-crm/validation/**/*.ts",
          "supabase/migrations/**/*.sql",
          "supabase/functions/**/*.ts"
        ]
      },
      "outputConfig": {
        "reportPath": "docs/audits/",
        "reportFormat": "YYYY-MM-DD-audit.md",
        "autoCreateTodos": true,
        "todoScope": "all"
      }
    },
    "discovery-first": {
      "type": "guardrail",
      "enforcement": "suggest",
      "priority": "high",
      "description": "Use pre-computed discovery files at .claude/state/ for codebase inventory questions instead of scanning source files. Saves 90%+ tokens.",
      "promptTriggers": {
        "keywords": [
          "component",
          "components",
          "hook",
          "hooks",
          "schema",
          "schemas",
          "form",
          "forms",
          "type",
          "types",
          "inventory",
          "what exists",
          "list all",
          "how many",
          "which components",
          "what hooks",
          "what schemas",
          "what forms",
          "what types",
          "codebase structure",
          "component hierarchy",
          "call graph",
          "who calls",
          "what calls",
          "dependencies"
        ],
        "intentPatterns": [
          "(what|which|list|show|find).*?(component|hook|schema|form|type)s?",
          "how many.*?(component|hook|schema|form|type)s?",
          "(find|search|locate).*?(component|hook|schema|form|type)s?",
          "(what|which).*?(exist|available|defined)",
          "(list|show|display).*?all.*?(component|hook|schema|form|type)s?",
          "(codebase|code|project).*?(structure|hierarchy|overview)",
          "(who|what).*?calls?.*?(function|hook|component)",
          "(component|hook).*?(use|depend|import)",
          "inventory.*?(component|hook|schema|form|type)"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          ".claude/state/**/*.json"
        ],
        "contentPatterns": [
          "component-inventory",
          "hooks-inventory",
          "schemas-inventory",
          "forms-inventory",
          "types-inventory",
          "call-graph-inventory"
        ]
      }
    },
    "troubleshooting": {
      "type": "domain",
      "enforcement": "contextual",
      "priority": "high",
      "description": "Diagnose and resolve build failures, performance issues, and deployment problems using the RAPID framework. Parallel specialist to fail-fast-debugging (bugs) and root-cause-tracing (code investigation). Covers TypeScript/build errors, performance bottlenecks, Edge Functions, environment configs.",
      "promptTriggers": {
        "keywords": [
          "build error",
          "build failure",
          "build failed",
          "compile error",
          "compilation error",
          "TypeScript error",
          "TS error",
          "tsc error",
          "webpack",
          "vite",
          "bundle",
          "bundler",
          "dependency",
          "dependencies",
          "npm error",
          "npm install",
          "package",
          "performance",
          "slow",
          "latency",
          "bottleneck",
          "memory leak",
          "memory",
          "N+1",
          "query slow",
          "deployment",
          "deploy",
          "production",
          "staging",
          "Edge Function",
          "edge function",
          "environment",
          "env var",
          "service not starting",
          "not starting",
          "timeout",
          "CORS",
          "401",
          "403",
          "500 error",
          "module not found",
          "cannot find module",
          "peer dependency",
          "version mismatch",
          "bundle size",
          "chunk"
        ],
        "intentPatterns": [
          "(build|compile|bundle).*?(fail|error|broken|issue)",
          "(npm|yarn|pnpm).*?(error|fail|issue|problem)",
          "(TypeScript|tsc|TS).*?(error|fail|issue)",
          "(slow|performance|latency|bottleneck).*?(query|api|render|load)",
          "(deploy|deployment|production|staging).*?(fail|error|issue|problem)",
          "(Edge Function|edge function|supabase function).*?(fail|error|timeout)",
          "(environment|env|config).*?(missing|wrong|issue|mismatch)",
          "(memory|heap).*?(leak|grow|issue)",
          "(bundle|chunk).*?(size|large|too big)",
          "why.*?(build|deploy|performance).*?(fail|slow|broken)",
          "(service|app|function).*?(not starting|crash|timeout)",
          "(module|dependency|package).*?(not found|missing|conflict)"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "package.json",
          "package-lock.json",
          "tsconfig.json",
          "vite.config.ts",
          "webpack.config.js",
          "supabase/functions/**/*.ts",
          ".env*"
        ],
        "contentPatterns": [
          "\"dependencies\"",
          "\"devDependencies\"",
          "\"scripts\"",
          "compilerOptions",
          "Deno\\.serve",
          "EdgeFunction",
          "SUPABASE_URL",
          "SUPABASE_ANON_KEY"
        ]
      },
      "contextualEnforcement": {
        "block": {
          "pathPatterns": [
            "supabase/functions/**/*.ts",
            "package.json",
            "package-lock.json",
            "tsconfig.json",
            "vite.config.ts"
          ],
          "reason": "Build/deploy config changes are high-risk - require systematic diagnosis first"
        },
        "suggest": {
          "pathPatterns": ["src/**/*.ts", "src/**/*.tsx"],
          "reason": "Code changes for performance fixes are lower risk"
        }
      },
      "requiredSkills": ["verification-before-completion"],
      "handoffSkills": {
        "codeBugs": "fail-fast-debugging",
        "callChainTracing": "root-cause-tracing",
        "codeChanges": "enforcing-principles"
      }
    },
    "comprehensive-tracing": {
      "type": "guardrail",
      "enforcement": "suggest",
      "priority": "high",
      "description": "Enforces thorough end-to-end code analysis with complete flow tracing. Activates automatically when crispy MCP tools are used. Ensures all entry points are found, architectural reasoning is provided, and consumption locations are shown.",
      "promptTriggers": {
        "keywords": [
          "analyze",
          "workflow",
          "how does",
          "trace",
          "deep dive",
          "explain",
          "search_code",
          "go_to_definition",
          "find_references",
          "data flow",
          "entry points",
          "who calls",
          "what calls",
          "where is this used",
          "complete analysis",
          "full analysis",
          "thorough analysis"
        ],
        "intentPatterns": [
          "(understand|explain|analyze).*?how.*?works",
          "(find|trace|show).*?all.*?(entry|path|flow)",
          "(trace|follow).*?(data|call|execution).*?flow",
          "(who|what|where).*?(calls|uses|consumes|triggers)",
          "(complete|full|thorough|comprehensive).*?(analysis|trace|review)",
          "search.*?code.*?for",
          "find.*?(definition|references)",
          "go.*?to.*?definition"
        ]
      },
      "toolTriggers": [
        "mcp__crispy-code-intel__search_code",
        "mcp__crispy-code-intel__go_to_definition",
        "mcp__crispy-code-intel__find_references"
      ],
      "requiredOutputs": {
        "multiPathDiscovery": "Find ALL entry points, not just the first one",
        "endToEndTracing": "Trace complete flow: Component → Hook → Provider → Service → DB",
        "architecturalReasoning": "Explain WHY patterns were chosen, not just WHAT",
        "consumptionTracking": "Show WHERE things are used, not just defined",
        "fileLineReferences": "Include file:line citations for all claims"
      },
      "qualityChecklist": [
        "Found ALL entry points (not just first one)",
        "Traced complete data flow for each path",
        "Explained WHY patterns were chosen",
        "Showed consumption locations, not just definitions",
        "Included file:line references throughout",
        "Offered continuation/deeper dive"
      ]
    },
    "crispy-data-provider": {
      "type": "domain",
      "enforcement": "suggest",
      "priority": "high",
      "description": "Data Provider architecture rules - Strangler Fig migration (new resources in handlers/, shrink unifiedDataProvider.ts), View/Table duality (read from views, write to tables), validation at Handler boundary (Zod, not forms), Service layer encapsulation, soft deletes, explicit handler composition.",
      "requiredSkills": ["enforcing-principles", "data-integrity-guards"],
      "promptTriggers": {
        "keywords": [
          "data provider",
          "data handler",
          "unifiedDataProvider",
          "unified provider",
          "composedDataProvider",
          "composed provider",
          "create handler",
          "add handler",
          "new resource",
          "add resource",
          "CRUD",
          "getList",
          "getOne",
          "create",
          "update",
          "delete",
          "React Admin handler",
          "react-admin handler",
          "Supabase query",
          "supabase handler",
          "strangler fig",
          "migration pattern",
          "view table",
          "view duality",
          "read from view",
          "write to table",
          "computed fields",
          "strip fields",
          "service layer",
          "soft delete",
          "handler composition",
          "withValidation",
          "withErrorLogging",
          "withLifecycleCallbacks",
          "lifecycle callbacks",
          "HttpError",
          "data provider error",
          "service",
          "business logic",
          "workflow",
          "orchestrate",
          "multi-step",
          "zod",
          "schema",
          "validation",
          "parse",
          "safeParse",
          "rpc",
          "postgres function",
          "raw query",
          "supabase.rpc",
          "call function",
          "database function"
        ],
        "intentPatterns": [
          "(create|add|implement|build).*?(data provider|handler|resource)",
          "(modify|update|change|fix).*?(data provider|unifiedDataProvider|handler)",
          "(add|create|implement).*?(CRUD|getList|getOne|create|update|delete)",
          "(migrate|move|extract).*?(resource|handler|provider)",
          "(read|query|fetch).*?(from|view|table)",
          "(write|insert|update).*?(to|table)",
          "(strip|remove|clean).*?(computed|view).*?field",
          "(compose|wrap|decorate).*?handler",
          "(service|business).*?layer",
          "(soft|hard).*?delete",
          "how.*?(data provider|handler|resource).*?(work|implement|create)",
          "(strangler|migration).*?(fig|pattern)",
          "(view|table).*?(duality|separation|pattern)",
          "(put|place|add).*?(logic|workflow|sync).*?(handler|provider|service)",
          "(where|how).*?(business logic|workflow|orchestrat)",
          "(call|invoke|use).*?(rpc|postgres function|database function)",
          "(validate|parse|check).*?(schema|zod|input)",
          "(sync|coordinate|multi-step).*?(operation|workflow|action)"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "src/atomic-crm/providers/**/*.ts",
          "src/atomic-crm/providers/supabase/**/*.ts",
          "src/providers/**/*.ts",
          "src/services/**/*.ts"
        ],
        "contentPatterns": [
          "unifiedDataProvider",
          "composedDataProvider",
          "getList.*?params",
          "getOne.*?params",
          "create.*?params",
          "update.*?params",
          "\\.from\\(['\"]\\w+_summary['\"]\\)",
          "withValidation",
          "withErrorLogging",
          "withLifecycleCallbacks",
          "HttpError",
          "deleted_at.*?new Date",
          "stripComputedFields",
          "TransformService",
          "\\.rpc\\(",
          "z\\.object\\(",
          "\\.safeParse\\(",
          "\\.parse\\(",
          "supabase\\.rpc",
          "ZodError"
        ]
      },
      "antiPatterns": {
        "description": "Patterns that violate data provider architecture - trigger warning",
        "patterns": [
          "unifiedDataProvider.*?=.*?\\{",
          "\\.from\\(['\"]\\w+_summary['\"]\\)\\.insert",
          "\\.from\\(['\"]\\w+_summary['\"]\\)\\.update",
          "\\.delete\\(\\)",
          "createAutoHandler",
          "magicCRUD",
          "supabase\\.rpc.*?\\w+Handler",
          "\\.rpc\\(['\"]\\w+['\"]\\)(?!.*Service)"
        ]
      },
      "architectureWarnings": {
        "rpcDuplication": {
          "description": "RPC calls should be wrapped in Services to avoid duplication",
          "pattern": "\\.rpc\\(",
          "recommendation": "Check if this RPC is already wrapped in a Service before calling directly"
        },
        "validationInHandler": {
          "description": "Validation should use withValidation wrapper, not inline",
          "pattern": "z\\.object\\(.*?\\)\\.parse\\(",
          "recommendation": "Use withValidation(handler, schema) wrapper for consistent error handling"
        },
        "businessLogicInProvider": {
          "description": "Multi-step operations should be in Service layer",
          "pattern": "await.*?await.*?await",
          "recommendation": "Consider extracting to a Service class for testability and reuse"
        }
      },
      "codeReviewChecklist": [
        "New logic in handlers/ (not unifiedDataProvider.ts)?",
        "Writes target Base Table (not View)?",
        "Zod validation at Handler boundary?",
        "Business logic in Service layer?",
        "Errors mapped to React Admin format?",
        "Soft delete used (not hard delete)?",
        "Handler composition is explicit?"
      ]
    },
    "testing-patterns": {
      "type": "domain",
      "enforcement": "contextual",
      "priority": "high",
      "description": "TDD and unit testing guidance for Crispy CRM. Covers Vitest patterns, React Admin component testing with renderWithAdminContext, Zod schema validation testing, Supabase mocking, and E2E with Playwright. Integrates with verification-before-completion.",
      "requiredSkills": ["verification-before-completion"],
      "contextualEnforcement": {
        "block": {
          "pathPatterns": [
            "src/atomic-crm/**/*.tsx",
            "src/atomic-crm/**/*.ts"
          ],
          "excludePatterns": [
            "**/*.test.ts",
            "**/*.test.tsx",
            "**/*.spec.ts",
            "**/__tests__/**"
          ],
          "reason": "Production code in atomic-crm requires test coverage - TDD enforcement"
        },
        "suggest": {
          "pathPatterns": [
            "src/**/__tests__/**/*.ts",
            "src/**/__tests__/**/*.tsx",
            "src/**/*.test.ts",
            "src/**/*.test.tsx",
            "src/**/*.spec.ts",
            "tests/**/*.ts"
          ],
          "reason": "Test files - guidance available but not enforced"
        }
      },
      "promptTriggers": {
        "keywords": [
          "test",
          "tests",
          "testing",
          "TDD",
          "test-driven",
          "unit test",
          "integration test",
          "e2e",
          "end-to-end",
          "vitest",
          "playwright",
          "jest",
          "coverage",
          "mock",
          "mocking",
          "stub",
          "spy",
          "assertion",
          "expect",
          "describe",
          "it",
          "beforeEach",
          "afterEach",
          "test failure",
          "test failing",
          "test passes",
          "red-green-refactor",
          "pgTAP",
          "database test",
          "component test",
          "render test",
          "snapshot",
          "test file",
          "spec file",
          "__tests__",
          ".test.ts",
          ".test.tsx",
          ".spec.ts"
        ],
        "intentPatterns": [
          "(write|create|add|implement).*?test",
          "(test|testing).*?(component|hook|schema|validation|form|feature)",
          "(run|execute|debug).*?test",
          "(fix|debug|investigate).*?(test|spec).*?(fail|error|broken)",
          "(mock|stub|spy).*?(supabase|api|service|provider)",
          "(setup|configure).*?(test|vitest|playwright|jest)",
          "TDD.*?(workflow|cycle|approach)",
          "(red|green|refactor).*?(cycle|phase)",
          "(coverage|cover).*?(code|test|report)",
          "how.*?(test|mock|assert)",
          "(renderWithAdminContext|render.*?admin)",
          "(e2e|end-to-end|playwright).*?(test|scenario|journey)",
          "(pgTAP|database).*?test",
          "why.*?test.*?(fail|broken|error)",
          "(implement|create|build).*?(without|skip|later).*?test",
          "test.*?later",
          "skip.*?test"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "src/**/__tests__/**/*.ts",
          "src/**/__tests__/**/*.tsx",
          "src/**/*.test.ts",
          "src/**/*.test.tsx",
          "src/**/*.spec.ts",
          "tests/**/*.ts",
          "tests/**/*.spec.ts",
          "supabase/tests/**/*.sql"
        ],
        "contentPatterns": [
          "describe\\(",
          "it\\(",
          "test\\(",
          "expect\\(",
          "vi\\.mock",
          "vi\\.fn",
          "vi\\.spyOn",
          "renderWithAdminContext",
          "@testing-library",
          "@playwright",
          "SELECT plan\\(",
          "SELECT ok\\(",
          "beforeEach",
          "afterEach"
        ]
      },
      "testCommands": {
        "unit": "just test",
        "watch": "just test:watch",
        "coverage": "just test:coverage",
        "e2e": "npx playwright test",
        "database": "npx supabase test db"
      }
    },
    "writing-plans": {
      "type": "domain",
      "enforcement": "suggest",
      "priority": "high",
      "description": "Plan authoring skill with quality gates and AI estimation. Creates implementation plans that zero-context agents can execute. Integrates with mcp__zen__consensus for effort/risk estimation.",
      "requiredSkills": ["enforcing-principles", "verification-before-completion"],
      "promptTriggers": {
        "keywords": [
          "write-plan",
          "write plan",
          "implementation plan",
          "design plan",
          "feature plan",
          "create plan",
          "plan for",
          "planning",
          "break down",
          "task breakdown"
        ],
        "intentPatterns": [
          "(write|create|draft|design).*?plan",
          "plan.*?(for|to).*?(implement|build|add|create)",
          "(break|split).*?(down|into).*?tasks?",
          "how.*?(would|should).*?(implement|build|approach)"
        ]
      }
    },
    "executing-plans": {
      "type": "domain",
      "enforcement": "suggest",
      "priority": "high",
      "description": "Plan execution skill with intelligent agent routing, subagent parallelization, checkpoint/rollback, and TodoWrite tracking. Routes tasks to specialized agents (test-fixer, form-builder, etc.) based on keywords.",
      "requiredSkills": ["verification-before-completion", "enforcing-principles"],
      "promptTriggers": {
        "keywords": [
          "execute-plan",
          "execute plan",
          "run plan",
          "implement plan",
          "start plan",
          "begin plan",
          "parallel execution",
          "subagent",
          "task swarm",
          "agent routing"
        ],
        "intentPatterns": [
          "(execute|run|start|begin|implement).*?plan",
          "plan.*?(execute|run|start|begin|implement)",
          "(dispatch|launch|spawn).*?(agent|task|subagent)",
          "parallel.*?(execution|implementation|tasks?)"
        ]
      }
    },
    "audit-rls-soft-delete": {
      "type": "audit",
      "enforcement": "suggest",
      "priority": "high",
      "description": "Audit RLS policies for soft-delete filtering. Use when checking security policies, debugging 'deleted records visible' issues, or reviewing migrations.",
      "promptTriggers": {
        "keywords": [
          "rls audit",
          "policy audit",
          "soft delete audit",
          "deleted records visible",
          "security audit rls",
          "check rls",
          "audit policies"
        ],
        "intentPatterns": [
          "(audit|check|review).*?(rls|policy|policies)",
          "(deleted|soft.?delete).*?(visible|showing|appearing)",
          "rls.*?(soft.?delete|deleted_at)"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "supabase/migrations/**/*.sql"
        ],
        "contentPatterns": [
          "CREATE POLICY.*SELECT",
          "deleted_at"
        ]
      }
    },
    "audit-summary-views": {
      "type": "audit",
      "enforcement": "suggest",
      "priority": "high",
      "description": "Audit *_summary views for required columns and consistency. Use when creating views, debugging 'column not found' errors, or reviewing schema.",
      "promptTriggers": {
        "keywords": [
          "view audit",
          "summary view",
          "column not found",
          "missing column",
          "schema audit views",
          "view columns",
          "sync view"
        ],
        "intentPatterns": [
          "(audit|check|review).*?(view|views|summary)",
          "(column|field).*?(not found|missing)",
          "(view|summary).*?(out of sync|missing|columns)"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "supabase/migrations/**/*.sql"
        ],
        "contentPatterns": [
          "CREATE.*VIEW.*_summary",
          "information_schema.columns"
        ]
      }
    },
    "validate-props": {
      "type": "domain",
      "enforcement": "suggest",
      "priority": "medium",
      "description": "Enforce Zod props validation for UI components. Use when creating forms, SlideOvers, or high-churn components.",
      "promptTriggers": {
        "keywords": [
          "props validation",
          "component props",
          "SlideOver props",
          "form props",
          "validate props",
          "props schema",
          "ui-props"
        ],
        "intentPatterns": [
          "(validate|check|define).*?props",
          "(component|form|slideover).*?props.*?(type|schema|validation)",
          "props.*?(zod|schema|validation)"
        ]
      },
      "fileTriggers": {
        "pathPatterns": [
          "src/atomic-crm/**/*SlideOver*.tsx",
          "src/atomic-crm/validation/ui-props.ts"
        ],
        "contentPatterns": [
          "slideOverPropsSchema",
          "z\\.infer.*Props"
        ]
      }
    }
  },
  "keywordOwnership": {
    "_comment": "Defines primary skill when multiple skills share keywords. Format: keyword -> primary skill",
    "schema": {
      "primary": "discovery-first",
      "context": {
        "migration": "supabase-crm",
        "zod": "enforcing-principles",
        "data provider": "crispy-data-provider"
      }
    },
    "validation": {
      "primary": "enforcing-principles",
      "context": {
        "data": "data-integrity-guards",
        "props": "validate-props"
      }
    },
    "edge function": {
      "primary": "supabase-crm",
      "context": {
        "cli": "supabase-cli",
        "deploy": "troubleshooting"
      }
    },
    "trace": {
      "primary": "root-cause-tracing",
      "context": {
        "comprehensive": "comprehensive-tracing"
      }
    }
  }
}
