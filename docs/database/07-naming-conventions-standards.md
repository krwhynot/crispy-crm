# Naming Conventions & Standards

## Overview
This document establishes the naming conventions, coding standards, and architectural patterns used throughout the Atomic CRM database schema. Consistency in naming improves maintainability, reduces confusion, and supports team collaboration.

## Table Naming Conventions

### Primary Tables - Plural Nouns
**Pattern**: `snake_case` plural nouns representing business entities
**Examples**:
- âœ… `companies` - Business organizations
- âœ… `contacts` - Individual people
- âœ… `deals` - Sales opportunities
- âœ… `sales` - Sales team members
- âœ… `tasks` - Action items
- âœ… `tags` - Categorization labels

### Junction/Note Tables - CamelCase with Descriptive Suffix
**Pattern**: `entityNotes` for related documentation
**Examples**:
- âœ… `contactNotes` - Notes related to contacts
- âœ… `dealNotes` - Notes related to deals

**Rationale**:
- Maintains relationship clarity
- Follows historical naming from migration files
- Distinguishes from primary entities

### Views - Descriptive Suffix
**Pattern**: `{table_name}_summary` for aggregated data
**Examples**:
- âœ… `companies_summary` - Companies with aggregated counts
- âœ… `contacts_summary` - Contacts with company names and task counts
- âœ… `init_state` - System initialization status

---

## Column Naming Conventions

### Primary Keys
**Pattern**: `id` - Simple, universal primary key naming
```sql
-- Standard primary key pattern
id bigint generated by default as identity not null
```

### Foreign Keys
**Pattern**: `{referenced_table}_id` - Clear reference indication
**Examples**:
- âœ… `company_id` â†’ references `companies.id`
- âœ… `contact_id` â†’ references `contacts.id`
- âœ… `sales_id` â†’ references `sales.id`
- âœ… `deal_id` â†’ references `deals.id`
- âœ… `user_id` â†’ references `auth.users.id`

### Timestamp Columns
**Pattern**: `{action}_at` or `{action}_date` with clear semantic meaning
**Examples**:
- âœ… `created_at` - Record creation timestamp
- âœ… `updated_at` - Last modification timestamp
- âœ… `archived_at` - Soft deletion timestamp
- âœ… `due_date` - Task deadline
- âœ… `done_date` - Task completion timestamp
- âœ… `expected_closing_date` - Deal closure projection

**Data Type Standard**: `timestamp with time zone` for UTC consistency

### Boolean Columns
**Pattern**: `has_{feature}` or `is_{state}` for clear true/false semantics
**Examples**:
- âœ… `has_newsletter` - Newsletter subscription status
- âœ… `administrator` - Admin privileges flag
- âœ… `disabled` - Account status flag

### Array Columns
**Pattern**: Plural noun indicating multiple values
**Examples**:
- âœ… `tags` - Array of tag IDs (`bigint[]`)
- âœ… `contact_ids` - Array of contact references (`bigint[]`)
- âœ… `attachments` - Array of file metadata (`jsonb[]`)

### JSONB Columns
**Pattern**: `{field}_jsonb` suffix for structured data migration
**Examples**:
- âœ… `email_jsonb` - Multiple emails with types
- âœ… `phone_jsonb` - Multiple phone numbers with types

**Migration Context**:
- Added `_jsonb` suffix to distinguish from legacy text columns
- Enables gradual migration from flat structure to flexible format
- Maintains backward compatibility during transition

### Text Content Columns
**Pattern**: Descriptive nouns without suffixes
**Examples**:
- âœ… `name` - Entity name/title
- âœ… `text` - Note content
- âœ… `description` - Detailed description
- âœ… `background` - Contact background information
- âœ… `address` - Physical address

---

## Index Naming Conventions

### Primary Key Indexes
**Pattern**: `{table_name}_pkey` (PostgreSQL default)
**Examples**:
- âœ… `companies_pkey`
- âœ… `contacts_pkey`
- âœ… `deals_pkey`

### Unique Constraint Indexes
**Pattern**: `uq__{table_name}__{column_name}`
**Examples**:
- âœ… `uq__sales__user_id` - Unique user_id in sales table

### Foreign Key Indexes (Recommended)
**Pattern**: `idx_{table_name}_{column_name}`
**Examples**:
- ğŸ“ `idx_companies_sales_id` - Company sales rep index
- ğŸ“ `idx_contacts_company_id` - Contact company index
- ğŸ“ `idx_deals_sales_id` - Deal sales rep index

### Composite Indexes
**Pattern**: `idx_{table_name}_{col1}_{col2}[_{col3}]`
**Examples**:
- ğŸ“ `idx_deals_stage_sales_id` - Deal pipeline queries
- ğŸ“ `idx_contacts_company_sales` - Contact organization queries

### Specialized Indexes
**Pattern**: `idx_{table_name}_{column_name}_{type}`
**Examples**:
- ğŸ“ `idx_contacts_email_jsonb_gin` - JSONB search index
- ğŸ“ `idx_contacts_tags_gin` - Array search index
- ğŸ“ `idx_contacts_name_fts` - Full-text search index

---

## Constraint Naming Conventions

### Primary Key Constraints
**Pattern**: `{table_name}_pkey` (PostgreSQL default)

### Foreign Key Constraints
**Pattern**: `{table_name}_{column_name}_fkey`
**Examples**:
- âœ… `companies_sales_id_fkey`
- âœ… `contacts_company_id_fkey`
- âœ… `deals_company_id_fkey`

### Check Constraints
**Pattern**: `valid_{table_name}_{field_description}`
**Examples**:
- âœ… `valid_tag_colors` - Constrains tag.color to valid values

### Unique Constraints
**Pattern**: `unique_{table_name}_{field_description}`
**Examples**:
- ğŸ“ `unique_sales_user_id` - One sales record per auth user

---

## Function and Trigger Naming

### Function Names
**Pattern**: `handle_{action}_{entity}()` for event handlers
**Examples**:
- âœ… `handle_new_user()` - Process new auth user
- âœ… `handle_update_user()` - Sync user profile changes

### Trigger Names
**Pattern**: `on_{table}_{event}_{description}`
**Examples**:
- âœ… `on_auth_user_created` - Trigger on auth.users INSERT
- âœ… `on_auth_user_updated` - Trigger on auth.users UPDATE

---

## RLS Policy Naming

### Basic CRUD Policies
**Pattern**: `"Enable {operation} for {role} only"`
**Examples**:
- âœ… `"Enable insert for authenticated users only"`
- âœ… `"Enable read access for authenticated users"`
- âœ… `"Enable update for authenticated users only"`

### Specific Business Logic Policies
**Pattern**: `"{Entity} {Operation} Policy"`
**Examples**:
- âœ… `"Company Delete Policy"`
- âœ… `"Contact Notes Update policy"`
- âœ… `"Task Delete Policy"`

---

## Storage and File Naming

### Storage Buckets
**Pattern**: Plural noun describing content type
**Examples**:
- âœ… `attachments` - File attachments for notes

### Storage Policies
**Pattern**: `"{Bucket} {random_id}_{operation_index}"`
**Examples**:
- âœ… `"Attachments 1mt4rzk_0"` - SELECT policy
- âœ… `"Attachments 1mt4rzk_1"` - INSERT policy

---

## Migration File Naming

### Migration Files
**Pattern**: `YYYYMMDD_HHMMSS_{description}.sql`
**Examples**:
- âœ… `20240730075029_init_db.sql` - Initial database setup
- âœ… `20250109152531_email_jsonb.sql` - Email JSONB migration
- âœ… `20241221120000_migrate_tag_colors.sql` - Color system migration

### Description Guidelines
- Use `snake_case` for multi-word descriptions
- Be descriptive but concise
- Include operation type: `init_`, `add_`, `remove_`, `migrate_`
- Group related changes: `email_jsonb`, `phone_jsonb`

---

## TypeScript Integration Standards

### Type Definitions
**Pattern**: PascalCase matching database entity purpose
**Examples**:
- âœ… `Company` - Company entity type
- âœ… `Contact` - Contact entity type
- âœ… `Deal` - Deal entity type
- âœ… `Sale` - Sales person entity type

### Interface Naming
**Pattern**: Descriptive interfaces with clear purpose
**Examples**:
- âœ… `EmailAndType` - Email with type classification
- âœ… `PhoneNumberAndType` - Phone with type classification
- âœ… `DealStage` - Deal stage configuration
- âœ… `NoteStatus` - Note status with color

### Array Type Patterns
**Pattern**: `{Type}[]` for arrays, specific interfaces for complex structures
**Examples**:
- âœ… `Identifier[]` - Array of entity IDs
- âœ… `EmailAndType[]` - Array of email objects
- âœ… `AttachmentNote[]` - Array of file attachments

---

## Data Validation Standards

### Enum Values
**Pattern**: `kebab-case` for user-facing values, `snake_case` for internal
**Examples**:
- âœ… `"proposal-sent"` - Deal stage (user-facing)
- âœ… `"in-negociation"` - Deal stage (user-facing)
- âœ… `"in-contract"` - Note status (user-facing)

### Color Standards
**Pattern**: Semantic color names (post-migration)
**Examples**:
- âœ… `warm`, `green`, `teal`, `blue`, `purple`, `yellow`, `gray`, `pink`
- âŒ `#eddcd2`, `#fff1e6` (legacy hex values)

---

## Exception Cases and Historical Context

### CamelCase Table Names
**Tables**: `contactNotes`, `dealNotes`
**Reason**: Historical from initial schema design
**Status**: Maintained for consistency with existing migrations
**Future**: New tables should use `snake_case`

### Mixed Naming in Views
**Pattern**: Some views use `snake_case`, others descriptive names
**Examples**:
- âœ… `companies_summary` - Follows table_suffix pattern
- âœ… `contacts_summary` - Follows table_suffix pattern
- âœ… `init_state` - Descriptive system view

### JSONB Migration Suffixes
**Context**: Added `_jsonb` suffix during data structure migration
**Purpose**: Distinguish from legacy single-value columns
**Examples**:
- `email` â†’ `email_jsonb` (flexible multi-value structure)
- `phone_*` columns â†’ `phone_jsonb` (consolidated structure)

---

## Best Practices for New Development

### Adding New Tables
1. Use plural `snake_case` nouns
2. Include standard audit columns (`created_at`, `updated_at`)
3. Follow established foreign key patterns
4. Plan index strategy from design phase

### Adding New Columns
1. Use descriptive, unambiguous names
2. Follow type-specific patterns (timestamps, booleans, etc.)
3. Consider nullable vs. not null carefully
4. Document business meaning clearly

### Creating New Indexes
1. Include table name in index name
2. Order columns by selectivity (most selective first)
3. Consider partial indexes for filtered queries
4. Document expected query patterns

### Writing Migrations
1. Use descriptive file names with operation context
2. Include rollback plans for major changes
3. Test on sample data before production
4. Document breaking changes thoroughly

### RLS Policy Creation
1. Follow established naming patterns
2. Use consistent role targeting
3. Document business logic rationale
4. Test policy effectiveness thoroughly

## Consistency Checklist

When adding new database objects:
- [ ] Table name follows plural `snake_case` convention
- [ ] Column names use appropriate type patterns
- [ ] Foreign keys follow `{table}_id` pattern
- [ ] Indexes include table name prefix
- [ ] Constraints have descriptive names
- [ ] RLS policies follow established patterns
- [ ] Migration file includes timestamp and description
- [ ] TypeScript types mirror database structure
- [ ] Documentation updated with business context