# Naming Conventions & Standards

## Overview
This document establishes the naming conventions, coding standards, and architectural patterns used throughout the Atomic CRM database schema. Consistency in naming improves maintainability, reduces confusion, and supports team collaboration.

## Table Naming Conventions

### Primary Tables - Plural Nouns
**Pattern**: `snake_case` plural nouns representing business entities
**Examples**:
- ✅ `companies` - Business organizations
- ✅ `contacts` - Individual people
- ✅ `deals` - Sales opportunities
- ✅ `sales` - Sales team members
- ✅ `tasks` - Action items
- ✅ `tags` - Categorization labels

### Junction/Note Tables - CamelCase with Descriptive Suffix
**Pattern**: `entityNotes` for related documentation
**Examples**:
- ✅ `contactNotes` - Notes related to contacts
- ✅ `dealNotes` - Notes related to deals

**Rationale**:
- Maintains relationship clarity
- Follows historical naming from migration files
- Distinguishes from primary entities

### Views - Descriptive Suffix
**Pattern**: `{table_name}_summary` for aggregated data
**Examples**:
- ✅ `companies_summary` - Companies with aggregated counts
- ✅ `contacts_summary` - Contacts with company names and task counts
- ✅ `init_state` - System initialization status

---

## Column Naming Conventions

### Primary Keys
**Pattern**: `id` - Simple, universal primary key naming
```sql
-- Standard primary key pattern
id bigint generated by default as identity not null
```

### Foreign Keys
**Pattern**: `{referenced_table}_id` - Clear reference indication
**Examples**:
- ✅ `company_id` → references `companies.id`
- ✅ `contact_id` → references `contacts.id`
- ✅ `sales_id` → references `sales.id`
- ✅ `deal_id` → references `deals.id`
- ✅ `user_id` → references `auth.users.id`

### Timestamp Columns
**Pattern**: `{action}_at` or `{action}_date` with clear semantic meaning
**Examples**:
- ✅ `created_at` - Record creation timestamp
- ✅ `updated_at` - Last modification timestamp
- ✅ `archived_at` - Soft deletion timestamp
- ✅ `due_date` - Task deadline
- ✅ `done_date` - Task completion timestamp
- ✅ `expected_closing_date` - Deal closure projection

**Data Type Standard**: `timestamp with time zone` for UTC consistency

### Boolean Columns
**Pattern**: `has_{feature}` or `is_{state}` for clear true/false semantics
**Examples**:
- ✅ `has_newsletter` - Newsletter subscription status
- ✅ `administrator` - Admin privileges flag
- ✅ `disabled` - Account status flag

### Array Columns
**Pattern**: Plural noun indicating multiple values
**Examples**:
- ✅ `tags` - Array of tag IDs (`bigint[]`)
- ✅ `contact_ids` - Array of contact references (`bigint[]`)
- ✅ `attachments` - Array of file metadata (`jsonb[]`)

### JSONB Columns
**Pattern**: `{field}_jsonb` suffix for structured data migration
**Examples**:
- ✅ `email_jsonb` - Multiple emails with types
- ✅ `phone_jsonb` - Multiple phone numbers with types

**Migration Context**:
- Added `_jsonb` suffix to distinguish from legacy text columns
- Enables gradual migration from flat structure to flexible format
- Maintains backward compatibility during transition

### Text Content Columns
**Pattern**: Descriptive nouns without suffixes
**Examples**:
- ✅ `name` - Entity name/title
- ✅ `text` - Note content
- ✅ `description` - Detailed description
- ✅ `background` - Contact background information
- ✅ `address` - Physical address

---

## Index Naming Conventions

### Primary Key Indexes
**Pattern**: `{table_name}_pkey` (PostgreSQL default)
**Examples**:
- ✅ `companies_pkey`
- ✅ `contacts_pkey`
- ✅ `deals_pkey`

### Unique Constraint Indexes
**Pattern**: `uq__{table_name}__{column_name}`
**Examples**:
- ✅ `uq__sales__user_id` - Unique user_id in sales table

### Foreign Key Indexes (Recommended)
**Pattern**: `idx_{table_name}_{column_name}`
**Examples**:
- 📝 `idx_companies_sales_id` - Company sales rep index
- 📝 `idx_contacts_company_id` - Contact company index
- 📝 `idx_deals_sales_id` - Deal sales rep index

### Composite Indexes
**Pattern**: `idx_{table_name}_{col1}_{col2}[_{col3}]`
**Examples**:
- 📝 `idx_deals_stage_sales_id` - Deal pipeline queries
- 📝 `idx_contacts_company_sales` - Contact organization queries

### Specialized Indexes
**Pattern**: `idx_{table_name}_{column_name}_{type}`
**Examples**:
- 📝 `idx_contacts_email_jsonb_gin` - JSONB search index
- 📝 `idx_contacts_tags_gin` - Array search index
- 📝 `idx_contacts_name_fts` - Full-text search index

---

## Constraint Naming Conventions

### Primary Key Constraints
**Pattern**: `{table_name}_pkey` (PostgreSQL default)

### Foreign Key Constraints
**Pattern**: `{table_name}_{column_name}_fkey`
**Examples**:
- ✅ `companies_sales_id_fkey`
- ✅ `contacts_company_id_fkey`
- ✅ `deals_company_id_fkey`

### Check Constraints
**Pattern**: `valid_{table_name}_{field_description}`
**Examples**:
- ✅ `valid_tag_colors` - Constrains tag.color to valid values

### Unique Constraints
**Pattern**: `unique_{table_name}_{field_description}`
**Examples**:
- 📝 `unique_sales_user_id` - One sales record per auth user

---

## Function and Trigger Naming

### Function Names
**Pattern**: `handle_{action}_{entity}()` for event handlers
**Examples**:
- ✅ `handle_new_user()` - Process new auth user
- ✅ `handle_update_user()` - Sync user profile changes

### Trigger Names
**Pattern**: `on_{table}_{event}_{description}`
**Examples**:
- ✅ `on_auth_user_created` - Trigger on auth.users INSERT
- ✅ `on_auth_user_updated` - Trigger on auth.users UPDATE

---

## RLS Policy Naming

### Basic CRUD Policies
**Pattern**: `"Enable {operation} for {role} only"`
**Examples**:
- ✅ `"Enable insert for authenticated users only"`
- ✅ `"Enable read access for authenticated users"`
- ✅ `"Enable update for authenticated users only"`

### Specific Business Logic Policies
**Pattern**: `"{Entity} {Operation} Policy"`
**Examples**:
- ✅ `"Company Delete Policy"`
- ✅ `"Contact Notes Update policy"`
- ✅ `"Task Delete Policy"`

---

## Storage and File Naming

### Storage Buckets
**Pattern**: Plural noun describing content type
**Examples**:
- ✅ `attachments` - File attachments for notes

### Storage Policies
**Pattern**: `"{Bucket} {random_id}_{operation_index}"`
**Examples**:
- ✅ `"Attachments 1mt4rzk_0"` - SELECT policy
- ✅ `"Attachments 1mt4rzk_1"` - INSERT policy

---

## Migration File Naming

### Migration Files
**Pattern**: `YYYYMMDD_HHMMSS_{description}.sql`
**Examples**:
- ✅ `20240730075029_init_db.sql` - Initial database setup
- ✅ `20250109152531_email_jsonb.sql` - Email JSONB migration
- ✅ `20241221120000_migrate_tag_colors.sql` - Color system migration

### Description Guidelines
- Use `snake_case` for multi-word descriptions
- Be descriptive but concise
- Include operation type: `init_`, `add_`, `remove_`, `migrate_`
- Group related changes: `email_jsonb`, `phone_jsonb`

---

## TypeScript Integration Standards

### Type Definitions
**Pattern**: PascalCase matching database entity purpose
**Examples**:
- ✅ `Company` - Company entity type
- ✅ `Contact` - Contact entity type
- ✅ `Deal` - Deal entity type
- ✅ `Sale` - Sales person entity type

### Interface Naming
**Pattern**: Descriptive interfaces with clear purpose
**Examples**:
- ✅ `EmailAndType` - Email with type classification
- ✅ `PhoneNumberAndType` - Phone with type classification
- ✅ `DealStage` - Deal stage configuration
- ✅ `NoteStatus` - Note status with color

### Array Type Patterns
**Pattern**: `{Type}[]` for arrays, specific interfaces for complex structures
**Examples**:
- ✅ `Identifier[]` - Array of entity IDs
- ✅ `EmailAndType[]` - Array of email objects
- ✅ `AttachmentNote[]` - Array of file attachments

---

## Data Validation Standards

### Enum Values
**Pattern**: `kebab-case` for user-facing values, `snake_case` for internal
**Examples**:
- ✅ `"proposal-sent"` - Deal stage (user-facing)
- ✅ `"in-negociation"` - Deal stage (user-facing)
- ✅ `"in-contract"` - Note status (user-facing)

### Color Standards
**Pattern**: Semantic color names (post-migration)
**Examples**:
- ✅ `warm`, `green`, `teal`, `blue`, `purple`, `yellow`, `gray`, `pink`
- ❌ `#eddcd2`, `#fff1e6` (legacy hex values)

---

## Exception Cases and Historical Context

### CamelCase Table Names
**Tables**: `contactNotes`, `dealNotes`
**Reason**: Historical from initial schema design
**Status**: Maintained for consistency with existing migrations
**Future**: New tables should use `snake_case`

### Mixed Naming in Views
**Pattern**: Some views use `snake_case`, others descriptive names
**Examples**:
- ✅ `companies_summary` - Follows table_suffix pattern
- ✅ `contacts_summary` - Follows table_suffix pattern
- ✅ `init_state` - Descriptive system view

### JSONB Migration Suffixes
**Context**: Added `_jsonb` suffix during data structure migration
**Purpose**: Distinguish from legacy single-value columns
**Examples**:
- `email` → `email_jsonb` (flexible multi-value structure)
- `phone_*` columns → `phone_jsonb` (consolidated structure)

---

## Best Practices for New Development

### Adding New Tables
1. Use plural `snake_case` nouns
2. Include standard audit columns (`created_at`, `updated_at`)
3. Follow established foreign key patterns
4. Plan index strategy from design phase

### Adding New Columns
1. Use descriptive, unambiguous names
2. Follow type-specific patterns (timestamps, booleans, etc.)
3. Consider nullable vs. not null carefully
4. Document business meaning clearly

### Creating New Indexes
1. Include table name in index name
2. Order columns by selectivity (most selective first)
3. Consider partial indexes for filtered queries
4. Document expected query patterns

### Writing Migrations
1. Use descriptive file names with operation context
2. Include rollback plans for major changes
3. Test on sample data before production
4. Document breaking changes thoroughly

### RLS Policy Creation
1. Follow established naming patterns
2. Use consistent role targeting
3. Document business logic rationale
4. Test policy effectiveness thoroughly

## Consistency Checklist

When adding new database objects:
- [ ] Table name follows plural `snake_case` convention
- [ ] Column names use appropriate type patterns
- [ ] Foreign keys follow `{table}_id` pattern
- [ ] Indexes include table name prefix
- [ ] Constraints have descriptive names
- [ ] RLS policies follow established patterns
- [ ] Migration file includes timestamp and description
- [ ] TypeScript types mirror database structure
- [ ] Documentation updated with business context