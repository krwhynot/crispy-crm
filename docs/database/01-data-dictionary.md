# Data Dictionary (Schema Glossary)

## Overview
This document provides a comprehensive data dictionary for the Atomic CRM database, documenting all tables, columns, data types, relationships, and business meanings.

## Core Tables

### `companies`
**Purpose**: Central repository for organization records and company information.

| Column | Type | Nullable | Default | Description | Example Value |
|--------|------|----------|---------|-------------|---------------|
| `id` | `bigint` | No | `generated by default as identity` | Unique company identifier | `1` |
| `created_at` | `timestamp with time zone` | No | `now()` | Record creation timestamp | `2024-01-15 14:30:00+00` |
| `name` | `text` | No | - | Company legal or trade name | `Acme Corporation` |
| `sector` | `text` | Yes | `null` | Industry sector or vertical | `Technology` |
| `size` | `smallint` | Yes | `null` | Employee count bracket (1,10,50,250,500) | `50` |
| `linkedin_url` | `text` | Yes | `null` | LinkedIn company page URL | `https://linkedin.com/company/acme` |
| `website` | `text` | Yes | `null` | Primary company website | `https://acme.com` |
| `phone_number` | `text` | Yes | `null` | Main company phone number | `+1-555-0123` |
| `address` | `text` | Yes | `null` | Physical street address | `123 Main St, Suite 100` |
| `zipcode` | `text` | Yes | `null` | Postal code | `12345` |
| `city` | `text` | Yes | `null` | City name | `New York` |
| `stateAbbr` | `text` | Yes | `null` | State/province abbreviation | `NY` |
| `country` | `text` | Yes | `null` | Country name | `United States` |
| `description` | `text` | Yes | `null` | Company description or notes | `Leading tech startup...` |
| `revenue` | `text` | Yes | `null` | Annual revenue range | `$1M - $10M` |
| `tax_identifier` | `text` | Yes | `null` | Tax ID or EIN | `12-3456789` |
| `sales_id` | `bigint` | Yes | `null` | Assigned sales representative (FK) | `5` |
| `context_links` | `json` | Yes | `null` | Related URLs or references | `["url1", "url2"]` |
| `logo` | `jsonb` | Yes | `null` | Company logo file metadata | `{"src": "path/to/logo.png"}` |

**Relationships**:
- `sales_id` → `sales.id` (Many companies to one sales rep)

---

### `contacts`
**Purpose**: Individual person records with flexible contact information stored as JSONB.

| Column | Type | Nullable | Default | Description | Example Value |
|--------|------|----------|---------|-------------|---------------|
| `id` | `bigint` | No | `generated by default as identity` | Unique contact identifier | `1` |
| `first_name` | `text` | Yes | `null` | Given name | `John` |
| `last_name` | `text` | Yes | `null` | Family name | `Smith` |
| `gender` | `text` | Yes | `null` | Gender identity | `Male` |
| `title` | `text` | Yes | `null` | Job title or position | `Software Engineer` |
| `email_jsonb` | `jsonb` | Yes | `null` | Array of email objects with type | `[{"email": "john@acme.com", "type": "Work"}]` |
| `phone_jsonb` | `jsonb` | Yes | `null` | Array of phone objects with type | `[{"number": "+1-555-0123", "type": "Work"}]` |
| `background` | `text` | Yes | `null` | Professional background notes | `10 years experience in...` |
| `avatar` | `jsonb` | Yes | `null` | Profile picture metadata | `{"src": "path/to/avatar.jpg"}` |
| `first_seen` | `timestamp with time zone` | Yes | `null` | Date of first interaction | `2024-01-15 09:00:00+00` |
| `last_seen` | `timestamp with time zone` | Yes | `null` | Date of last interaction | `2024-03-20 16:30:00+00` |
| `has_newsletter` | `boolean` | Yes | `null` | Newsletter subscription status | `true` |
| `status` | `text` | Yes | `null` | Lead/contact status | `Lead` |
| `tags` | `bigint[]` | Yes | `null` | Array of tag IDs | `[1, 3, 5]` |
| `company_id` | `bigint` | Yes | `null` | Associated company (FK) | `1` |
| `sales_id` | `bigint` | Yes | `null` | Assigned sales representative (FK) | `5` |
| `linkedin_url` | `text` | Yes | `null` | LinkedIn profile URL | `https://linkedin.com/in/johnsmith` |

**Relationships**:
- `company_id` → `companies.id` (Many contacts to one company)
- `sales_id` → `sales.id` (Many contacts to one sales rep)
- `tags` → `tags.id[]` (Many-to-many via array)

---

### `deals`
**Purpose**: Sales opportunities and pipeline management with stage tracking.

| Column | Type | Nullable | Default | Description | Example Value |
|--------|------|----------|---------|-------------|---------------|
| `id` | `bigint` | No | `generated by default as identity` | Unique deal identifier | `1` |
| `name` | `text` | No | - | Deal title or description | `Enterprise Software License` |
| `company_id` | `bigint` | Yes | `null` | Associated company (FK) | `1` |
| `contact_ids` | `bigint[]` | Yes | `null` | Array of involved contact IDs | `[1, 2, 3]` |
| `category` | `text` | Yes | `null` | Deal type or category | `New Business` |
| `stage` | `text` | No | - | Current pipeline stage | `Proposal` |
| `description` | `text` | Yes | `null` | Detailed deal description | `Multi-year software licensing deal...` |
| `amount` | `bigint` | Yes | `null` | Deal value in cents | `50000000` (=$500k) |
| `created_at` | `timestamp with time zone` | No | `now()` | Deal creation date | `2024-01-15 10:00:00+00` |
| `updated_at` | `timestamp with time zone` | No | `now()` | Last modification date | `2024-03-20 14:30:00+00` |
| `archived_at` | `timestamp with time zone` | Yes | `null` | Archive/deletion timestamp | `null` |
| `expected_closing_date` | `timestamp with time zone` | Yes | `null` | Projected close date | `2024-04-30 23:59:59+00` |
| `sales_id` | `bigint` | Yes | `null` | Assigned sales representative (FK) | `5` |
| `index` | `smallint` | Yes | `null` | Sort order within stage | `1` |

**Relationships**:
- `company_id` → `companies.id` (Many deals to one company)
- `contact_ids` → `contacts.id[]` (Many-to-many via array)
- `sales_id` → `sales.id` (Many deals to one sales rep)

---

### `sales`
**Purpose**: Sales team members and user accounts with authentication integration.

| Column | Type | Nullable | Default | Description | Example Value |
|--------|------|----------|---------|-------------|---------------|
| `id` | `bigint` | No | `generated by default as identity` | Unique sales person identifier | `1` |
| `first_name` | `text` | No | - | Given name | `Jane` |
| `last_name` | `text` | No | - | Family name | `Doe` |
| `email` | `text` | No | - | Email address (synced from auth) | `jane.doe@company.com` |
| `administrator` | `boolean` | No | - | Admin privileges flag | `false` |
| `user_id` | `uuid` | No | - | Supabase Auth user ID (FK) | `uuid-string` |
| `avatar` | `jsonb` | Yes | `null` | Profile picture metadata | `{"src": "path/to/avatar.jpg"}` |
| `disabled` | `boolean` | No | `FALSE` | Account disabled status | `false` |

**Relationships**:
- `user_id` → `auth.users.id` (One-to-one with Supabase Auth)

---

### `contactNotes`
**Purpose**: Communication history and notes related to specific contacts.

| Column | Type | Nullable | Default | Description | Example Value |
|--------|------|----------|---------|-------------|---------------|
| `id` | `bigint` | No | `generated by default as identity` | Unique note identifier | `1` |
| `contact_id` | `bigint` | No | - | Related contact (FK) | `1` |
| `text` | `text` | Yes | `null` | Note content | `Called about pricing inquiry...` |
| `date` | `timestamp with time zone` | Yes | `now()` | Note creation date | `2024-03-20 15:30:00+00` |
| `sales_id` | `bigint` | Yes | `null` | Note author (FK) | `5` |
| `status` | `text` | Yes | `null` | Note type or status | `Follow-up Required` |
| `attachments` | `jsonb[]` | Yes | `null` | Array of file attachments | `[{"src": "file.pdf"}]` |

**Relationships**:
- `contact_id` → `contacts.id` (Many notes to one contact, CASCADE delete)
- `sales_id` → `sales.id` (Many notes to one sales rep)

---

### `dealNotes`
**Purpose**: Communication history and notes related to specific deals.

| Column | Type | Nullable | Default | Description | Example Value |
|--------|------|----------|---------|-------------|---------------|
| `id` | `bigint` | No | `generated by default as identity` | Unique note identifier | `1` |
| `deal_id` | `bigint` | No | - | Related deal (FK) | `1` |
| `type` | `text` | Yes | `null` | Note type or category | `Meeting` |
| `text` | `text` | Yes | `null` | Note content | `Discussed contract terms...` |
| `date` | `timestamp with time zone` | Yes | `now()` | Note creation date | `2024-03-20 16:00:00+00` |
| `sales_id` | `bigint` | Yes | `null` | Note author (FK) | `5` |
| `attachments` | `jsonb[]` | Yes | `null` | Array of file attachments | `[{"src": "proposal.pdf"}]` |

**Relationships**:
- `deal_id` → `deals.id` (Many notes to one deal, CASCADE delete)
- `sales_id` → `sales.id` (Many notes to one sales rep)

---

### `tasks`
**Purpose**: Activity tracking and reminders associated with contacts.

| Column | Type | Nullable | Default | Description | Example Value |
|--------|------|----------|---------|-------------|---------------|
| `id` | `bigint` | No | `generated by default as identity` | Unique task identifier | `1` |
| `contact_id` | `bigint` | No | - | Related contact (FK) | `1` |
| `type` | `text` | Yes | `null` | Task type or category | `Call` |
| `text` | `text` | Yes | `null` | Task description | `Follow up on pricing discussion` |
| `due_date` | `timestamp with time zone` | No | - | Task deadline | `2024-03-25 17:00:00+00` |
| `done_date` | `timestamp with time zone` | Yes | `null` | Completion timestamp | `null` (if incomplete) |
| `sales_id` | `bigint` | Yes | `null` | Assigned sales rep (FK) | `5` |

**Relationships**:
- `contact_id` → `contacts.id` (Many tasks to one contact, CASCADE delete)
- `sales_id` → `sales.id` (Many tasks to one sales rep)

---

### `tags`
**Purpose**: Flexible categorization system with semantic color coding.

| Column | Type | Nullable | Default | Description | Example Value |
|--------|------|----------|---------|-------------|---------------|
| `id` | `bigint` | No | `generated by default as identity` | Unique tag identifier | `1` |
| `name` | `text` | No | - | Tag display name | `Hot Lead` |
| `color` | `text` | No | - | Semantic color identifier | `warm` |

**Valid Colors**: `warm`, `green`, `teal`, `blue`, `purple`, `yellow`, `gray`, `pink`

**Relationships**:
- Used in `contacts.tags[]` (Many-to-many via array)

## Primary Keys and Unique Constraints

| Table | Primary Key | Unique Constraints |
|-------|-------------|-------------------|
| `companies` | `id` | - |
| `contacts` | `id` | - |
| `deals` | `id` | - |
| `sales` | `id` | `user_id` |
| `contactNotes` | `id` | - |
| `dealNotes` | `id` | - |
| `tasks` | `id` | - |
| `tags` | `id` | - |

## Storage Buckets

### `attachments`
- **Purpose**: File storage for note attachments
- **Public Access**: Yes
- **Allowed Users**: Authenticated users can SELECT, INSERT, DELETE

## Views

### `companies_summary`
Aggregated company data with relationship counts:
```sql
SELECT c.*,
       COUNT(DISTINCT d.id) as nb_deals,
       COUNT(DISTINCT co.id) as nb_contacts
FROM companies c
LEFT JOIN deals d ON c.id = d.company_id
LEFT JOIN contacts co ON c.id = co.company_id
GROUP BY c.id;
```

### `contacts_summary`
Enhanced contact data with company name and task counts:
```sql
SELECT co.*,
       c.name as company_name,
       COUNT(DISTINCT t.id) as nb_tasks,
       jsonb_path_query_array(co.email_jsonb, '$[*].email')::text as email_fts,
       jsonb_path_query_array(co.phone_jsonb, '$[*].number')::text as phone_fts
FROM contacts co
LEFT JOIN tasks t ON co.id = t.contact_id
LEFT JOIN companies c ON co.company_id = c.id
GROUP BY co.id, c.name;
```

### `init_state`
System initialization check:
```sql
SELECT COUNT(id) as is_initialized
FROM sales
LIMIT 1;
```

## Data Types and Storage Considerations

### JSONB Usage
- **Email Storage**: `[{"email": "user@domain.com", "type": "Work|Home|Other"}]`
- **Phone Storage**: `[{"number": "+1-555-0123", "type": "Work|Home|Other"}]`
- **File Metadata**: `{"src": "path/to/file", "title": "filename", "type": "mime/type"}`

### Array Types
- **Contact Tags**: `bigint[]` for many-to-many relationships
- **Deal Contacts**: `bigint[]` for multiple contacts per deal
- **Attachments**: `jsonb[]` for multiple file references

### Timestamp Handling
- All timestamps use `timestamp with time zone` for UTC storage
- Default values use `now()` for automatic timestamping
- Nullable timestamps for optional dates (archival, completion)