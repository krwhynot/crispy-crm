{
  "lastAudit": "2026-01-11",
  "lastMode": "full",
  "scope": "src/",
  "findings": {
    "critical": [
      {
        "id": "WF-C1-001",
        "check": "WF-C1",
        "type": "silent-status-default",
        "location": "src/atomic-crm/reports/tabs/OverviewTab.tsx:255",
        "description": "Hardcoded stage comparison that could mask silent defaults",
        "firstSeen": "2026-01-11"
      },
      {
        "id": "WF-C2-001",
        "check": "WF-C2",
        "type": "required-field-fallback",
        "location": "src/atomic-crm/providers/supabase/callbacks/contactsCallbacks.ts:109",
        "description": "Contact first_name uses empty string fallback",
        "firstSeen": "2026-01-11",
        "e2eResult": "MITIGATED",
        "e2eNote": "Form validation catches empty names before reaching callback - defense-in-depth code, not exploitable via UI",
        "severity": "low"
      },
      {
        "id": "WF-C2-002",
        "check": "WF-C2",
        "type": "required-field-fallback",
        "location": "src/atomic-crm/providers/supabase/callbacks/contactsCallbacks.ts:110",
        "description": "Contact last_name uses empty string fallback",
        "firstSeen": "2026-01-11",
        "e2eResult": "MITIGATED",
        "e2eNote": "Form validation catches empty names before reaching callback - defense-in-depth code, not exploitable via UI",
        "severity": "low"
      },
      {
        "id": "WF-C2-003",
        "check": "WF-C2",
        "type": "required-field-fallback",
        "location": "src/atomic-crm/providers/supabase/services/TransformService.ts:182",
        "description": "Name concatenation with empty string fallback",
        "firstSeen": "2026-01-11"
      },
      {
        "id": "WF-C2-004",
        "check": "WF-C2",
        "type": "required-field-fallback",
        "location": "src/atomic-crm/utils/saleOptionRenderer.ts:9",
        "description": "Display logic using empty string fallback for names",
        "firstSeen": "2026-01-11"
      },
      {
        "id": "WF-C2-005",
        "check": "WF-C2",
        "type": "required-field-fallback",
        "location": "src/atomic-crm/opportunities/kanban/QuickAddOpportunity.tsx:68",
        "description": "Organization name fallback in opportunity creation",
        "firstSeen": "2026-01-11"
      },
      {
        "id": "WF-C2-006",
        "check": "WF-C2",
        "type": "required-field-fallback",
        "location": "src/atomic-crm/opportunities/WorkflowManagementSection.tsx:34",
        "description": "Next action workflow field fallback",
        "firstSeen": "2026-01-11"
      },
      {
        "id": "WF-C2-007",
        "check": "WF-C2",
        "type": "required-field-fallback",
        "location": "src/atomic-crm/opportunities/WorkflowManagementSection.tsx:35",
        "description": "Next action date workflow field fallback",
        "firstSeen": "2026-01-11"
      },
      {
        "id": "WF-C2-008",
        "check": "WF-C2",
        "type": "required-field-fallback",
        "location": "src/atomic-crm/opportunities/WorkflowManagementSection.tsx:36",
        "description": "Decision criteria workflow field fallback",
        "firstSeen": "2026-01-11"
      }
    ],
    "high": [
      {
        "id": "WF-H2-001",
        "check": "WF-H2",
        "type": "missing-activity-logging",
        "location": "src/atomic-crm/opportunities/kanban/QuickAddOpportunity.tsx:60",
        "description": "Opportunity creation does not log activity",
        "firstSeen": "2026-01-11",
        "verified": true,
        "confidence": "92%"
      },
      {
        "id": "WF-H2-002",
        "check": "WF-H2",
        "type": "missing-activity-logging",
        "location": "src/atomic-crm/opportunities/components/ArchiveActions.tsx:23",
        "description": "Archive operation leaves no audit trail",
        "firstSeen": "2026-01-11",
        "verified": true,
        "confidence": "92%"
      },
      {
        "id": "WF-H2-003",
        "check": "WF-H2",
        "type": "missing-activity-logging",
        "location": "src/atomic-crm/opportunities/kanban/OpportunityCardActions.tsx:127",
        "description": "Delete operation leaves no audit trail",
        "firstSeen": "2026-01-11",
        "verified": true,
        "confidence": "92%"
      },
      {
        "id": "WF-H2-004",
        "check": "WF-H2",
        "type": "missing-activity-logging",
        "location": "src/atomic-crm/contacts/ContactCreate.tsx",
        "description": "Contact creation not logged - no audit trail",
        "firstSeen": "2026-01-11",
        "verified": true,
        "confidence": "95%"
      },
      {
        "id": "WF-H2-005",
        "check": "WF-H2",
        "type": "missing-activity-logging",
        "location": "src/atomic-crm/contacts/LinkOpportunityModal.tsx:51",
        "description": "Contact-opportunity linking not logged",
        "firstSeen": "2026-01-11",
        "verified": true,
        "confidence": "95%"
      },
      {
        "id": "WF-H2-006",
        "check": "WF-H2",
        "type": "missing-activity-logging",
        "location": "src/atomic-crm/contacts/UnlinkConfirmDialog.tsx:34",
        "description": "Contact-opportunity unlinking not logged",
        "firstSeen": "2026-01-11",
        "verified": true,
        "confidence": "95%"
      },
      {
        "id": "WF-H2-007",
        "check": "WF-H2",
        "type": "missing-activity-logging",
        "location": "src/atomic-crm/providers/supabase/callbacks/contactsCallbacks.ts:135",
        "description": "Contact soft delete not logged - no record of who archived",
        "firstSeen": "2026-01-11",
        "verified": true,
        "confidence": "95%"
      },
      {
        "id": "WF-H2-008",
        "check": "WF-H2",
        "type": "missing-activity-logging",
        "location": "src/atomic-crm/contacts/QuickCreateContactPopover.tsx:59",
        "description": "Quick create contact not logged",
        "firstSeen": "2026-01-11",
        "verified": true,
        "confidence": "95%"
      },
      {
        "id": "WF-H2-009",
        "check": "WF-H2",
        "type": "missing-service-layer",
        "location": "src/atomic-crm/contacts/",
        "description": "No ContactsService exists - violates PROVIDER_RULES.md Rule #4",
        "firstSeen": "2026-01-11",
        "verified": true,
        "confidence": "95%"
      },
      {
        "id": "WF-H2-010",
        "check": "WF-H2",
        "type": "missing-activity-logging",
        "location": "src/atomic-crm/opportunities/OpportunityCreateWizard.tsx:203",
        "description": "Create wizard does not log activity",
        "firstSeen": "2026-01-11",
        "verified": true,
        "confidence": "92%"
      }
    ],
    "medium": []
  },
  "activityLoggingAudit": {
    "AUDIT_CORRECTION": "Original 45% coverage claim was INCORRECT - verified via codebase review",
    "actualCoverage": "0%",
    "explanation": "No afterUpdate/afterCreate callbacks exist that auto-log activities. Activities are ONLY created manually by users via QuickLogActivityDialog.",
    "opportunities": {
      "coverage": "0%",
      "mutationPoints": 11,
      "logged": 0,
      "gaps": [
        "QuickAddOpportunity",
        "OpportunityCreateWizard",
        "ArchiveActions",
        "Delete",
        "WorkflowFields",
        "SlideOverUpdates",
        "ProductsSync",
        "StageChanges",
        "ALL_MUTATIONS"
      ]
    },
    "contacts": {
      "coverage": "0%",
      "mutationPoints": 9,
      "logged": 0,
      "gaps": [
        "ContactCreate",
        "QuickCreate",
        "Updates",
        "LinkOpportunity",
        "UnlinkOpportunity",
        "SoftDelete",
        "TagChanges",
        "ALL_MUTATIONS"
      ]
    },
    "codeVerification": {
      "opportunitiesCallbacks": "NO afterCreate, NO afterUpdate - only beforeSave/beforeDelete",
      "OpportunitiesService": "NO activity logging in createWithProducts, updateWithProducts, archiveOpportunity",
      "ActivitiesService": "ONLY has getActivityLog for READING, not creating activities",
      "verified": "2026-01-11"
    }
  },
  "dbFindings": {
    "orphanedOpportunities": 0,
    "invalidStages": 0,
    "unlinkedContacts": 0,
    "missingCloseReasons": 0,
    "activitiesWithoutType": 0,
    "stateTransitionAnomalies": 0,
    "opportunitiesWithoutActivities": 372,
    "missingAccountManager": 369,
    "missingOwner": 369,
    "overdueCloseDate": 369,
    "defaultPriority": 372,
    "orphanedActivities": 125,
    "emptyNotes": 372
  },
  "counts": {
    "critical": 8,
    "criticalMitigated": 2,
    "high": 12,
    "medium": 38,
    "e2eDiscovered": 3
  },
  "verification": {
    "allCriticalVerified": true,
    "activityLoggingAuditComplete": true,
    "activityLoggingAuditCORRECTED": true,
    "confidence": "95%",
    "verificationDate": "2026-01-11",
    "e2eTestingComplete": false,
    "e2eTestsRun": 5,
    "e2eFindings": "Major audit correction: 45% coverage was WRONG, actual coverage is 0%. 3 new UI bugs discovered."
  },
  "e2eVerification": {
    "status": "completed",
    "testsCompleted": 3,
    "testsTotal": 20,
    "completionDate": "2026-01-11",
    "results": {
      "test1_WF-C2-001-002": {
        "expected": "BUG",
        "actual": "FALSE_POSITIVE",
        "reason": "Validation WORKS - shows 'Either name or first_name/last_name must be provided'",
        "reclassified": "critical -> false_positive",
        "verifiedBy": "Claude Chrome E2E"
      },
      "test2_WF-C2-005": {
        "expected": "BUG",
        "actual": "WORSE_THAN_EXPECTED",
        "reason": "Quick Add form COMPLETELY MISSING principal_organization_id field - form is non-functional",
        "reclassified": "high -> critical",
        "zodError": "Invalid input: expected string/number, received undefined at path principal_organization_id",
        "verifiedBy": "Claude Chrome E2E"
      },
      "test10_db_constraints": {
        "expected": "PASS",
        "actual": "CRITICAL_BLIND_SPOT",
        "reason": "INSERT without principal_organization_id SUCCEEDED - NO database constraint exists",
        "reclassified": "assumed_pass -> critical",
        "newFinding": "WF-E2E-004",
        "verifiedBy": "Claude Chrome E2E + SQL verification"
      }
    },
    "summary": {
      "falsePositives": 1,
      "confirmedBugs": 2,
      "worseThanExpected": 1,
      "blindSpotsFound": 1
    },
    "legacyDataIssues": {
      "contactsWithEmptyNames": 185,
      "activitiesOnlyEngagementType": 125,
      "note": "Legacy data quality issues audit couldn't detect"
    }
  },
  "architecturalDiscovery": {
    "finding": "Activity logging is APPLICATION-LAYER ONLY",
    "details": [
      "No database triggers create activity records",
      "All activity logging happens in React Admin withLifecycleCallbacks",
      "SQL-direct operations bypass logging entirely",
      "The 45% coverage claim applies to UI operations only"
    ],
    "implication": "Direct database access (API bypass, SQL scripts) leaves no audit trail",
    "recommendation": "Consider adding database-level audit triggers for compliance"
  },
  "e2eDiscoveredBugs": [
    {
      "id": "WF-E2E-001",
      "severity": "high",
      "type": "missing-form-field",
      "location": "src/atomic-crm/opportunities/kanban/QuickAddOpportunity.tsx",
      "description": "Quick Add Opportunity modal missing required principal_organization_id field - users cannot create opportunities via Kanban columns",
      "impact": "UX blocker - Quick Add feature is non-functional",
      "discoveredVia": "E2E Test 4",
      "firstSeen": "2026-01-11"
    },
    {
      "id": "WF-E2E-002",
      "severity": "critical",
      "type": "ui-broken",
      "location": "Kanban board drag-and-drop",
      "description": "Dragging opportunity cards between Kanban columns gets stuck in highlighted state and doesn't complete the move",
      "impact": "CRITICAL UX blocker - Users cannot change opportunity stages via primary pipeline UI",
      "discoveredVia": "E2E Test 5 (Claude Chrome)",
      "firstSeen": "2026-01-11"
    },
    {
      "id": "WF-E2E-003",
      "severity": "high",
      "type": "ui-broken",
      "location": "Opportunity Edit function",
      "description": "Clicking 'Edit' on opportunity context menu results in error: 'Opportunities edit Error - Something went wrong loading opportunities'",
      "impact": "Users cannot edit opportunity details via edit menu",
      "discoveredVia": "E2E Test 5 (Claude Chrome)",
      "firstSeen": "2026-01-11"
    }
  ],
  "notes": {
    "totalOpportunities": 372,
    "closedWon": 0,
    "closedLost": 0,
    "schemaValidation": {
      "principalOrganizationIdNotNull": true,
      "customerOrganizationIdNotNull": true,
      "contactOrganizationIdNotNull": true
    },
    "regression": "58 new findings detected after verification - includes 10 activity logging gaps"
  }
}
