{
  "lastAudit": "2026-01-18",
  "lastAuditTime": "06:15",
  "mode": "full",
  "duration_minutes": 15,
  "totals": {
    "critical": 16,
    "high": 83,
    "medium": 138
  },
  "by_category": {
    "security": { "critical": 0, "high": 3, "medium": 24 },
    "data-integrity": { "critical": 0, "high": 1, "medium": 2 },
    "error-handling": { "critical": 0, "high": 12, "medium": 18 },
    "db-hardening": { "critical": 3, "high": 34, "medium": 16 },
    "stale-state": { "critical": 0, "high": 5, "medium": 9 },
    "workflow-gaps": { "critical": 0, "high": 3, "medium": 5 },
    "architecture": { "critical": 1, "high": 3, "medium": 4 },
    "typescript": { "critical": 0, "high": 2, "medium": 26 },
    "accessibility": { "critical": 0, "high": 3, "medium": 8 },
    "performance": { "critical": 6, "high": 5, "medium": 8 },
    "code-quality": { "critical": 6, "high": 12, "medium": 18 }
  },
  "critical_findings": [
    {
      "source_audit": "performance",
      "id": "PERF-001",
      "severity": "critical",
      "check": "Large Pagination",
      "location": "src/atomic-crm/reports/hooks/useReportData.ts:111",
      "description": "perPage: 1000 in centralized report hook - affects all reports",
      "firstSeen": "2026-01-18",
      "status": "open"
    },
    {
      "source_audit": "performance",
      "id": "PERF-002",
      "severity": "critical",
      "check": "Large Pagination",
      "location": "src/atomic-crm/reports/CampaignActivity/useCampaignActivityData.ts:46",
      "description": "perPage: 1000 for opportunities fetch in campaign activity report",
      "firstSeen": "2026-01-15",
      "status": "open"
    },
    {
      "source_audit": "performance",
      "id": "PERF-003",
      "severity": "critical",
      "check": "Large Pagination",
      "location": "src/atomic-crm/reports/CampaignActivity/useCampaignActivityData.ts:54",
      "description": "perPage: 1000 for activities fetch in campaign activity report",
      "firstSeen": "2026-01-18",
      "status": "open"
    },
    {
      "source_audit": "performance",
      "id": "PERF-004",
      "severity": "critical",
      "check": "Large Pagination",
      "location": "src/atomic-crm/opportunities/hooks/useSimilarOpportunityCheck.ts:125",
      "description": "perPage: 1000 for opportunity similarity check - fetches all opportunities",
      "firstSeen": "2026-01-18",
      "status": "open"
    },
    {
      "source_audit": "performance",
      "id": "PERF-005",
      "severity": "critical",
      "check": "Large Pagination",
      "location": "src/atomic-crm/opportunities/OpportunityArchivedList.tsx:25",
      "description": "perPage: 1000 for archived opportunities list",
      "firstSeen": "2026-01-18",
      "status": "open"
    },
    {
      "source_audit": "performance",
      "id": "PERF-006",
      "severity": "critical",
      "check": "Large Pagination",
      "location": "src/atomic-crm/dashboard/v3/hooks/useKPIMetrics.ts:145",
      "description": "perPage: 500 for stale opportunities fetch",
      "firstSeen": "2026-01-18",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-001",
      "severity": "critical",
      "check": "Large Files",
      "location": "src/components/ui/sidebar.tsx:673",
      "description": "UI component file exceeds 500 lines (673 lines)",
      "firstSeen": "2026-01-17",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-002",
      "severity": "critical",
      "check": "Large Files",
      "location": "src/atomic-crm/activities/QuickLogActivityDialog.tsx:609",
      "description": "Dialog component exceeds 500 lines (609 lines)",
      "firstSeen": "2026-01-17",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-003",
      "severity": "critical",
      "check": "Large Files",
      "location": "src/atomic-crm/reports/OpportunitiesByPrincipalReport.tsx:603",
      "description": "Report component exceeds 500 lines (603 lines)",
      "firstSeen": "2026-01-17",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-004",
      "severity": "critical",
      "check": "Deprecated Code",
      "location": "src/hooks/saved-queries.tsx",
      "description": "5 @deprecated exports awaiting ra-core migration",
      "firstSeen": "2026-01-18",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-005",
      "severity": "critical",
      "check": "Deprecated Code",
      "location": "src/hooks/simple-form-iterator-context.tsx",
      "description": "6 @deprecated exports awaiting ra-core migration",
      "firstSeen": "2026-01-18",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-006",
      "severity": "critical",
      "check": "Deprecated Code",
      "location": "src/hooks/useSupportCreateSuggestion.tsx",
      "description": "7 @deprecated exports awaiting ra-core migration",
      "firstSeen": "2026-01-18",
      "status": "open"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-001",
      "severity": "critical",
      "check": "Missing FK Index",
      "location": "tutorial_progress.user_id",
      "description": "No index on foreign key column",
      "firstSeen": "2026-01-15",
      "status": "open"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-002",
      "severity": "critical",
      "check": "Missing FK Index",
      "location": "tutorial_progress.step_key",
      "description": "No index on foreign key column",
      "firstSeen": "2026-01-15",
      "status": "open"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-003",
      "severity": "critical",
      "check": "Missing Soft Delete",
      "location": "tutorial_progress table",
      "description": "Table missing deleted_at column",
      "firstSeen": "2026-01-15",
      "status": "open"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-001",
      "severity": "critical",
      "check": "Direct Supabase Import",
      "location": "src/atomic-crm/dashboard/v3/hooks/useCurrentSale.ts:3",
      "description": "Direct supabase import for auth.getUser() - bypasses data provider",
      "firstSeen": "2026-01-18",
      "status": "open"
    }
  ],
  "fixed_findings": [
    {
      "source_audit": "security",
      "id": "SEC-001",
      "severity": "critical",
      "check": "Hardcoded Secrets",
      "location": ".env.cloud",
      "description": "Supabase credentials in git-tracked file - FIXED",
      "firstSeen": "2026-01-15",
      "fixedDate": "2026-01-17",
      "status": "fixed"
    },
    {
      "source_audit": "typescript",
      "id": "TS-001",
      "severity": "critical",
      "check": "Double-cast pattern",
      "location": "src/lib/genericMemo.ts:14",
      "description": "Uses `as unknown as T` double-cast pattern - FIXED",
      "firstSeen": "2026-01-11",
      "fixedDate": "2026-01-15",
      "status": "fixed"
    },
    {
      "source_audit": "performance",
      "id": "PERF-OLD-001",
      "severity": "critical",
      "check": "Large Pagination",
      "location": "src/atomic-crm/reports/OpportunitiesByPrincipalReport.tsx:35",
      "description": "perPage: 1000 - FIXED: now uses useReportData hook",
      "firstSeen": "2026-01-15",
      "fixedDate": "2026-01-18",
      "status": "fixed"
    },
    {
      "source_audit": "performance",
      "id": "PERF-OLD-003",
      "severity": "critical",
      "check": "Large Pagination",
      "location": "src/atomic-crm/reports/WeeklyActivitySummary.tsx:45",
      "description": "Multiple perPage: 1000 queries - FIXED: now uses useReportData hook",
      "firstSeen": "2026-01-15",
      "fixedDate": "2026-01-18",
      "status": "fixed"
    },
    {
      "source_audit": "performance",
      "id": "PERF-OLD-004",
      "severity": "critical",
      "check": "Large Pagination",
      "location": "src/atomic-crm/sales/UserDisableReassignDialog.tsx",
      "description": "4 queries with perPage: 1000 - FIXED: changed to perPage: 100",
      "firstSeen": "2026-01-15",
      "fixedDate": "2026-01-18",
      "status": "fixed"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-OLD-001",
      "severity": "critical",
      "check": "Direct Supabase Import",
      "location": "src/atomic-crm/dashboard/v3/components/QuickLogForm.tsx:5",
      "description": "Direct import of supabase client - FIXED: now uses dataProvider",
      "firstSeen": "2026-01-12",
      "fixedDate": "2026-01-15",
      "status": "fixed"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-002",
      "severity": "critical",
      "check": "Direct Supabase Import",
      "location": "src/atomic-crm/dashboard/v3/hooks/useCurrentSale.ts:3",
      "description": "Direct import of supabase client for auth.getUser()",
      "firstSeen": "2026-01-12",
      "status": "exception",
      "exception_reason": "Auth state is outside data provider scope. Well-documented. See useCurrentSale.ts lines 104-108.",
      "exception_approved_date": "2026-01-15"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-OLD-003",
      "severity": "critical",
      "check": "Missing Handlers Re-export",
      "location": "src/atomic-crm/providers/supabase/handlers/index.ts",
      "description": "Handlers not re-exported - FIXED: index.ts now exports all 24 handlers",
      "firstSeen": "2026-01-15",
      "fixedDate": "2026-01-15",
      "status": "fixed"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-OLD-002",
      "severity": "critical",
      "check": "Missing Refetch",
      "location": "src/atomic-crm/organizations/ActivitiesTab.tsx:17",
      "description": "staleTime now configured",
      "firstSeen": "2026-01-15",
      "fixedDate": "2026-01-17",
      "status": "fixed"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-OLD-003",
      "severity": "critical",
      "check": "Inconsistent Query Keys",
      "location": "TaskList.tsx:151 vs Task.tsx:115",
      "description": "Query keys now use taskKeys factory consistently",
      "firstSeen": "2026-01-15",
      "fixedDate": "2026-01-17",
      "status": "fixed"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-OLD-004",
      "severity": "critical",
      "check": "Missing Junction Invalidation",
      "location": "src/atomic-crm/contacts/LinkOpportunityModal.tsx:77",
      "description": "Junction invalidation now handled by handler callbacks",
      "firstSeen": "2026-01-15",
      "fixedDate": "2026-01-17",
      "status": "fixed"
    }
  ],
  "strangler_fig_status": {
    "unifiedDataProvider_lines": 0,
    "composedDataProvider_lines": 255,
    "handler_count": 24,
    "status": "COMPLETED"
  },
  "excellence_areas": [
    "Strangler Fig: 100% COMPLETE - 24 composed handlers",
    "RLS Coverage: 100% on all 35 tables",
    "Fail-Fast: 90% compliant",
    "Form Validation: Constitution compliant - onSubmit/onBlur modes",
    "Data Integrity: 100% - Soft delete enforced",
    "TypeScript: 94% type safety in production",
    "Error Typing: 100% catch blocks use error: unknown",
    "useWatch() Adoption: 92 occurrences - proper form optimization",
    "React.memo: Applied to critical kanban components"
  ],
  "trend": {
    "direction": "MONITORING",
    "note": "Total increased due to expanded audit scope. 3 performance criticals FIXED. 4 new criticals from deprecated code tracking. Core functionality stable.",
    "previous_critical": 10,
    "current_critical": 16,
    "critical_fixed": 5,
    "critical_new": 11,
    "previous_total": 211,
    "current_total": 237,
    "note_on_increase": "Increase from: (1) new performance findings at different locations, (2) expanded deprecated code tracking, (3) architecture audit found new direct import"
  }
}
