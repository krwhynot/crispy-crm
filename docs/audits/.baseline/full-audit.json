{
  "lastAudit": "2026-01-23",
  "lastAuditTime": "12:37",
  "mode": "full",
  "duration_minutes": 12,
  "totals": {
    "critical": 20,
    "high": 67,
    "medium": 93
  },
  "by_category": {
    "security": { "critical": 1, "high": 4, "medium": 2 },
    "data-integrity": { "critical": 6, "high": 8, "medium": 12 },
    "error-handling": { "critical": 1, "high": 3, "medium": 5 },
    "db-hardening": { "critical": 0, "high": 9, "medium": 10 },
    "stale-state": { "critical": 5, "high": 6, "medium": 8 },
    "workflow-gaps": { "critical": 2, "high": 5, "medium": 8 },
    "architecture": { "critical": 2, "high": 8, "medium": 4 },
    "typescript": { "critical": 3, "high": 15, "medium": 28 },
    "accessibility": { "critical": 0, "high": 1, "medium": 4 },
    "performance": { "critical": 0, "high": 1, "medium": 4 },
    "code-quality": { "critical": 0, "high": 4, "medium": 8 }
  },
  "critical_findings": [
    {
      "source_audit": "security",
      "id": "SEC-001",
      "severity": "critical",
      "check": "Direct Supabase Import",
      "location": "useCurrentSale.ts:3",
      "description": "Auth context bypasses provider pattern - violates PROVIDER_RULES",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-001",
      "severity": "critical",
      "check": "Hard DELETE in RPC",
      "location": "20251029051621_update_sync_rpc_remove_pricing.sql:88",
      "description": "sync_opportunity_with_products() uses DELETE instead of soft-delete",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-002",
      "severity": "critical",
      "check": "Hard DELETE Cascade",
      "location": "20251018152315_cloud_schema_fresh.sql:714",
      "description": "delete_contact_cascade() hard-deletes junction tables",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-003",
      "severity": "critical",
      "check": "RLS Missing Soft-Delete Filter",
      "location": "Multiple RLS policies",
      "description": "40+ RLS policies missing deleted_at IS NULL filter",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-004",
      "severity": "critical",
      "check": "Merge Function Status",
      "location": "20251123215857_fix_merge_function_table_names.sql",
      "description": "merge_duplicate_contacts() soft-delete status unverified",
      "firstSeen": "2026-01-23",
      "status": "verify"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-005",
      "severity": "critical",
      "check": "Cascade Hard Delete",
      "location": "20251231120000_add_sync_opportunity_contacts_rpc.sql:18",
      "description": "delete_contact_cascade() performs hard DELETE on junction",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-006",
      "severity": "critical",
      "check": "Strangler Fig Migration",
      "location": "composedDataProvider.ts",
      "description": "Migration COMPLETED - 260 lines, 15 handlers, all resources routed",
      "firstSeen": "2026-01-20",
      "status": "fixed"
    },
    {
      "source_audit": "error-handling",
      "id": "EH-001",
      "severity": "critical",
      "check": "Fire-and-Forget Cleanup",
      "location": "organizationsCallbacks.ts:124-143",
      "description": "Storage cleanup errors silently ignored - GDPR compliance risk",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-001",
      "severity": "critical",
      "check": "Hardcoded Query Keys",
      "location": "22 locations",
      "description": "Cache keys bypass queryKeys factory causing invalidation misses",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-002",
      "severity": "critical",
      "check": "Missing refetchOnWindowFocus",
      "location": "useTaskCount.ts:31",
      "description": "Task count badge stale on tab return - violates <2s KPI",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-003",
      "severity": "critical",
      "check": "Polling Without Stale Gate",
      "location": "NotificationBell.tsx:23",
      "description": "refetchInterval without staleTime causes excessive API calls",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-004",
      "severity": "critical",
      "check": "Cascade Invalidation",
      "location": "Note.tsx:39-41",
      "description": "Deleting 1 note clears all related resource caches",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-005",
      "severity": "critical",
      "check": "Manual Optimistic Updates",
      "location": "useFavorites.ts:78-122",
      "description": "Uses manual rollback instead of React Query onMutate pattern",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WG-001",
      "severity": "critical",
      "check": "Nullable Required FK",
      "location": "opportunities.customer_organization_id",
      "description": "Business-critical FK is nullable - causes orphaned opportunities",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WG-002",
      "severity": "critical",
      "check": "Win/Loss App-Only Validation",
      "location": "opportunities-operations.ts:385-423",
      "description": "Database has no CHECK constraints - app crash allows invalid data",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-001",
      "severity": "critical",
      "check": "Tier 1 RA Import",
      "location": "priority-tabs.tsx:25",
      "description": "Tier 1 UI component imports react-admin type - violates UI_STANDARDS",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-002",
      "severity": "critical",
      "check": "Direct Supabase Auth",
      "location": "useCurrentSale.ts:3",
      "description": "Auth bypass outside provider pattern",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-001",
      "severity": "critical",
      "check": "as any Cast",
      "location": "zodErrorFormatting.ts:36",
      "description": "getFriendlyErrorMessage uses as any bypass",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-002",
      "severity": "critical",
      "check": "as any Cast",
      "location": "zodErrorFormatting.ts:70",
      "description": "formatZodError uses as any bypass",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-003",
      "severity": "critical",
      "check": "as any Cast",
      "location": "zodErrorFormatting.ts:94",
      "description": "Third as any in validation formatting",
      "firstSeen": "2026-01-22",
      "status": "open"
    }
  ],
  "strangler_fig_status": {
    "unifiedDataProvider_lines": 0,
    "composedDataProvider_lines": 260,
    "handler_count": 15,
    "status": "COMPLETED"
  },
  "excellence_areas": [
    "Strangler Fig: 100% COMPLETE - 15 composed handlers",
    "RLS Coverage: 31/31 tables (100%)",
    "Fail-Fast: NO retry logic found",
    "Soft Deletes: RLS enforced on base tables",
    "WCAG 2.1 AA: Accessibility compliant",
    "Code Splitting: React.lazy on routes",
    "Form Accessibility: role=alert, aria-live patterns",
    "Validation: Zod at API boundary with strictObject",
    "Memoization: 41 React.memo components"
  ],
  "trend": {
    "direction": "IMPROVED",
    "note": "Significant reduction in all severity levels; expanded detection in data-integrity and stale-state categories",
    "previous_critical": 28,
    "current_critical": 20,
    "previous_high": 136,
    "current_high": 67,
    "previous_medium": 390,
    "current_medium": 93
  },
  "delta_summary": {
    "fixed": [
      "A11Y-001 through A11Y-005 (color/touch issues reclassified)",
      "PERF-001, PERF-002 (memoization improved)",
      "CQ-001 through CQ-003 (reclassified as HIGH)"
    ],
    "new": [
      "DI-001 through DI-005 (RPC hard-delete detection)",
      "SS-001 through SS-005 (expanded cache analysis)",
      "WG-001 (nullable FK detection)",
      "ARCH-001 (tier 1 violation)"
    ],
    "unchanged": [
      "SEC-001 (Supabase import)",
      "EH-001 (storage cleanup)",
      "WG-002 (app-only validation)",
      "TS-001 through TS-003 (as any casts)"
    ]
  }
}
