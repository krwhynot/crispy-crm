{
  "lastAudit": "2026-01-10",
  "lastAuditTime": "13:08",
  "mode": "full",
  "duration_minutes": 11,
  "totals": {
    "critical": 41,
    "high": 209,
    "medium": 48
  },
  "by_category": {
    "security": { "critical": 0, "high": 3, "medium": 2 },
    "data-integrity": { "critical": 2, "high": 4, "medium": 2 },
    "error-handling": { "critical": 3, "high": 8, "medium": 6 },
    "db-hardening": { "critical": 3, "high": 5, "medium": 6 },
    "stale-state": { "critical": 2, "high": 3, "medium": 5 },
    "workflow-gaps": { "critical": 4, "high": 5, "medium": 3 },
    "architecture": { "critical": 0, "high": 0, "medium": 0 },
    "typescript": { "critical": 22, "high": 168, "medium": 4 },
    "accessibility": { "critical": 0, "high": 0, "medium": 0 },
    "performance": { "critical": 2, "high": 5, "medium": 8 },
    "code-quality": { "critical": 3, "high": 8, "medium": 12 }
  },
  "critical_findings": [
    {
      "source_audit": "data-integrity",
      "id": "DI-CRIT-001",
      "severity": "critical",
      "check": "Hard DELETE on Organizations",
      "location": "supabase/migrations/20251117123500_phase2d_consolidate_duplicates.sql:22,37,53",
      "description": "3 hard DELETE operations on organizations table in data consolidation migration",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-CRIT-002",
      "severity": "critical",
      "check": "Hard DELETE in RPC",
      "location": "supabase/migrations/20251231120000_add_sync_opportunity_contacts_rpc.sql:18",
      "description": "sync_opportunity_with_contacts() function uses hard DELETE",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "error-handling",
      "id": "ERR-001",
      "severity": "critical",
      "check": "Fire-and-Forget Promise",
      "location": "src/atomic-crm/providers/supabase/callbacks/organizationsCallbacks.ts:126",
      "description": "deleteStorageFiles() called without await, silent failure possible",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "error-handling",
      "id": "ERR-002",
      "severity": "critical",
      "check": "Silent Catch Block",
      "location": "src/atomic-crm/organizations/AuthorizationsTab.tsx:120",
      "description": "Empty catch block without error binding",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "error-handling",
      "id": "ERR-003",
      "severity": "critical",
      "check": "Error String Matching",
      "location": "src/atomic-crm/dashboard/v3/hooks/useCurrentSale.ts:146",
      "description": "Fragile error handling using message string matching",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-001",
      "severity": "critical",
      "check": "Missing FK Delete Actions",
      "location": "supabase/migrations/20251018152315_cloud_schema_fresh.sql:2600-2790",
      "description": "7 FK constraints lack explicit ON DELETE actions",
      "firstSeen": "2026-01-09",
      "status": "open"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-002",
      "severity": "critical",
      "check": "Unindexed FK Columns",
      "location": "activities, contacts, interaction_participants, tasks tables",
      "description": "5+ FK columns without indexes",
      "firstSeen": "2026-01-09",
      "status": "open"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-003",
      "severity": "critical",
      "check": "Overly Permissive RLS",
      "location": "tutorial_progress, audit_trail tables",
      "description": "audit_trail visible to all authenticated users",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-001",
      "severity": "critical",
      "check": "Missing Cache Invalidation",
      "location": "src/atomic-crm/contacts/ContactDetailsTab.tsx:53-66",
      "description": "Edit mode doesn't invalidate contact cache",
      "firstSeen": "2026-01-09",
      "status": "open"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-002",
      "severity": "critical",
      "check": "Missing Cache Invalidation",
      "location": "src/atomic-crm/sales/SalesEdit.tsx:43-58",
      "description": "Sales mutation doesn't invalidate list cache",
      "firstSeen": "2026-01-09",
      "status": "open"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WG-001",
      "severity": "critical",
      "check": "Sample Follow-up Not Enforced",
      "location": "src/atomic-crm/validation/activities.ts:176-182",
      "description": "Sample activities don't require follow_up_required=true",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WG-002",
      "severity": "critical",
      "check": "Win/Loss Reason Bypass",
      "location": "src/atomic-crm/validation/opportunities/opportunities-operations.ts:286-325",
      "description": "Stage-only updates bypass win/loss reason validation",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WG-003",
      "severity": "critical",
      "check": "No Stage Audit Trail",
      "location": "src/atomic-crm/providers/supabase/callbacks/opportunitiesCallbacks.ts",
      "description": "Stage changes not logged to activity_log",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WG-004",
      "severity": "critical",
      "check": "Contact Validation Bypass",
      "location": "src/atomic-crm/validation/opportunities/opportunities-operations.ts:279",
      "description": "Full form submissions skip contact requirement check",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-CATCH-001",
      "severity": "critical",
      "check": "Untyped Catch Blocks",
      "location": "22 files across hooks and utils",
      "description": "catch(e) without :unknown type annotation",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "performance",
      "id": "PERF-001",
      "severity": "critical",
      "check": "Sequential Bulk Updates",
      "location": "src/atomic-crm/sales/UserDisableReassignDialog.tsx:239-326",
      "description": "1000+ sequential API calls in reassignment loops",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "performance",
      "id": "PERF-002",
      "severity": "critical",
      "check": "Uncontrolled Concurrency",
      "location": "src/atomic-crm/contacts/useContactImport.tsx:340-348",
      "description": "100+ simultaneous requests without concurrency limits",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-001",
      "severity": "critical",
      "check": "Duplicate Database Types",
      "location": "src/types/database.types.ts, database.generated.ts",
      "description": "5219 lines duplicated across two files",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-002",
      "severity": "critical",
      "check": "Validation Schema Explosion",
      "location": "src/atomic-crm/validation/ (91 schemas)",
      "description": "Repeated patterns not abstracted into composable utilities",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-003",
      "severity": "critical",
      "check": "Hook Overuse",
      "location": "117 files with 442 useCallback/useMemo",
      "description": "Potential over-optimization causing maintenance burden",
      "firstSeen": "2026-01-10",
      "status": "open"
    }
  ],
  "strangler_fig_status": {
    "unifiedDataProvider_lines": 0,
    "composedDataProvider_lines": 255,
    "handler_count": 21,
    "status": "COMPLETED"
  },
  "feature_compliance": {
    "compliant": 7,
    "partial": 0,
    "incomplete": 0
  },
  "db_consistency": {
    "orphaned_opportunities": 0,
    "invalid_stages": 0,
    "unlinked_contacts": 0
  },
  "excellence_areas": [
    "Architecture: 0 issues - 100% compliant with engineering constitution",
    "Accessibility: WCAG 2.1 AA PASS - Perfect aria attributes, focus indicators, touch targets",
    "Strangler Fig: COMPLETED - 21 composed handlers, 0 lines in unified provider",
    "Security: Strong RLS coverage (41 policies), comprehensive Zod validation",
    "Feature Structure: 7/7 features follow standard pattern perfectly"
  ],
  "trend": {
    "direction": "REGRESSION",
    "note": "Issue count increased due to more granular TypeScript and workflow gap detection, not actual regression",
    "previous_total": 114,
    "current_total": 298,
    "delta": 184
  }
}
