{
  "lastAudit": "2026-01-12",
  "lastAuditTime": "18:00",
  "mode": "full",
  "duration_minutes": 14,
  "totals": {
    "critical": 6,
    "high": 40,
    "medium": 74
  },
  "by_category": {
    "security": { "critical": 0, "high": 1, "medium": 5 },
    "data-integrity": { "critical": 1, "high": 3, "medium": 2 },
    "error-handling": { "critical": 1, "high": 4, "medium": 7 },
    "db-hardening": { "critical": 0, "high": 4, "medium": 8 },
    "stale-state": { "critical": 0, "high": 6, "medium": 8 },
    "workflow-gaps": { "critical": 0, "high": 3, "medium": 8 },
    "architecture": { "critical": 0, "high": 2, "medium": 11 },
    "typescript": { "critical": 2, "high": 5, "medium": 10 },
    "accessibility": { "critical": 0, "high": 2, "medium": 0 },
    "performance": { "critical": 0, "high": 4, "medium": 7 },
    "code-quality": { "critical": 2, "high": 6, "medium": 8 }
  },
  "critical_findings": [
    {
      "source_audit": "typescript",
      "id": "TS-001",
      "severity": "critical",
      "check": "z.any() in Zod Schemas",
      "location": "src/atomic-crm/validation/opportunities/opportunities-core.ts, opportunities-operations.ts",
      "description": "z.any() used for products field bypasses type safety at API boundary",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-002",
      "severity": "critical",
      "check": "as unknown Type Assertions",
      "location": "segmentsHandler.ts (4), storageCleanup.ts (4), usePapaParse.tsx (2)",
      "description": "Double-cast pattern (as unknown as T) bypasses type checking",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-001",
      "severity": "critical",
      "check": "DRY Violation - formatFullName",
      "location": "formatters.ts, formatName.ts, contacts/formatters.ts",
      "description": "3 different formatFullName implementations with inconsistent behavior",
      "firstSeen": "2026-01-12",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-002",
      "severity": "critical",
      "check": "Large Files Over 500 Lines",
      "location": "29 files over 500 lines",
      "description": "Test files up to 1301 lines, production up to 670 lines",
      "firstSeen": "2026-01-12",
      "status": "open"
    },
    {
      "source_audit": "error-handling",
      "id": "EH-001",
      "severity": "critical",
      "check": "User-Facing Retry Utility",
      "location": "useNotifyWithRetry.tsx:31",
      "description": "Provides retry button (user-initiated, not automatic) - needs JSDoc clarification",
      "firstSeen": "2026-01-11",
      "status": "open",
      "notes": "Lower priority - user-initiated retry follows fail-fast principle"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-001",
      "severity": "critical",
      "check": "Hard DELETE in merge_duplicate_contacts()",
      "location": "supabase/migrations/20251123214721_add_contact_duplicates_view.sql:101",
      "description": "Uses hard DELETE (converted to soft delete in migration 20260111000001)",
      "firstSeen": "2026-01-11",
      "status": "resolved",
      "resolvedDate": "2026-01-11",
      "notes": "Migration 20260111000001_convert_merge_to_soft_delete.sql already deployed"
    }
  ],
  "high_findings_top_20": [
    {
      "source_audit": "stale-state",
      "id": "SS-001",
      "check": "Missing Cache Invalidation",
      "location": "SampleStatusBadge.tsx:205",
      "description": "useUpdate doesn't invalidate activities cache"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-002",
      "check": "Missing Cache Invalidation",
      "location": "TaskSlideOverDetailsTab.tsx:55",
      "description": "handleSave without taskKeys invalidation"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-003",
      "check": "Missing Cache Invalidation",
      "location": "TaskActionMenu.tsx:79",
      "description": "Postpone/delete without cache invalidation"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-004",
      "check": "Missing Cache Invalidation",
      "location": "TaskList.tsx:275",
      "description": "CompletionCheckbox without cache invalidation"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-005",
      "check": "Missing Cache Invalidation",
      "location": "ProductDetailsTab.tsx:108",
      "description": "handleSave without productKeys invalidation"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-006",
      "check": "Missing Cache Invalidation",
      "location": "ActivityDetailsTab.tsx:62",
      "description": "handleSave without activityKeys invalidation"
    },
    {
      "source_audit": "performance",
      "id": "PERF-001",
      "check": "Large Pagination",
      "location": "OpportunityArchivedList.tsx:25",
      "description": "perPage: 1000 without virtualization"
    },
    {
      "source_audit": "performance",
      "id": "PERF-002",
      "check": "Large Pagination",
      "location": "UserDisableReassignDialog.tsx:275",
      "description": "4 queries with perPage: 1000"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-003",
      "check": "Console Statements",
      "location": "50+ production files",
      "description": "190 console.* calls need structured logging"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-004",
      "check": "Magic Numbers",
      "location": "24 staleTime occurrences",
      "description": "No centralized cache configuration"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-001",
      "check": "Missing Audit Triggers",
      "location": "Multiple tables",
      "description": "Only org/contacts/opportunities have audit triggers"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-002",
      "check": "Missing updated_at Triggers",
      "location": "All tables",
      "description": "No set_updated_at() trigger function"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WF-001",
      "check": "Missing Activity Logging",
      "location": "WorkflowManagementSection.tsx:51",
      "description": "Updates bypass audit trail"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-001",
      "check": "Direct Supabase RPC",
      "location": "QuickLogForm.tsx:182",
      "description": "Bypasses data provider pattern"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-002",
      "check": "Direct Supabase Import",
      "location": "QuickLogForm.tsx:5",
      "description": "Violates Single Source of Truth"
    }
  ],
  "strangler_fig_status": {
    "unifiedDataProvider_lines": 0,
    "composedDataProvider_lines": 255,
    "handler_count": 24,
    "status": "COMPLETED"
  },
  "feature_compliance": {
    "compliant": 6,
    "partial": 3,
    "incomplete": 0
  },
  "db_consistency": {
    "orphaned_opportunities": "Protected by NOT NULL constraint",
    "invalid_stages": 0,
    "unlinked_contacts": "Protected by NOT NULL constraint"
  },
  "excellence_areas": [
    "Strangler Fig: 100% COMPLETE - 24 composed handlers",
    "Architecture: 99.5% compliant - All features follow pattern",
    "Accessibility: WCAG 2.1 AA PASS - 0 hardcoded colors",
    "Security: 97% RLS coverage, no hardcoded secrets",
    "Error Handling: 82% fail-fast compliant",
    "Form Validation: Constitution compliant - onSubmit/onBlur modes",
    "Data Integrity: 100% - Soft delete enforced"
  ],
  "trend": {
    "direction": "IMPROVING",
    "note": "Total issues decreased 233 → 120 (-48%). High issues decreased 63 → 40 (-37%). More granular detection added 2 critical code-quality findings. Workflow gaps remediation completed (6 issues fixed).",
    "previous_total": 233,
    "current_total": 120,
    "critical_delta": 2,
    "high_delta": -23,
    "medium_delta": -92
  }
}
