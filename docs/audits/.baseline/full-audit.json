{
  "lastAudit": "2026-01-11",
  "lastAuditTime": "20:50",
  "mode": "post-fix-verification",
  "duration_minutes": 5,
  "totals": {
    "critical": 15,
    "high": 63,
    "medium": 166
  },
  "by_category": {
    "security": { "critical": 0, "high": 3, "medium": 4 },
    "data-integrity": { "critical": 2, "high": 2, "medium": 5 },
    "error-handling": { "critical": 0, "high": 0, "medium": 2 },
    "db-hardening": { "critical": 3, "high": 8, "medium": 12 },
    "stale-state": { "critical": 0, "high": 5, "medium": 4 },
    "workflow-gaps": { "critical": 0, "high": 4, "medium": 3 },
    "architecture": { "critical": 0, "high": 0, "medium": 1 },
    "typescript": { "critical": 8, "high": 34, "medium": 127 },
    "accessibility": { "critical": 0, "high": 0, "medium": 0 },
    "performance": { "critical": 0, "high": 1, "medium": 3 },
    "code-quality": { "critical": 2, "high": 6, "medium": 5 }
  },
  "critical_findings": [
    {
      "source_audit": "data-integrity",
      "id": "DI-001",
      "severity": "critical",
      "check": "Hard DELETE in Migration",
      "location": "20251202062000_add_sample_activities_cloud.sql:11",
      "description": "Active migration performs hard DELETE on activities",
      "firstSeen": "2026-01-10",
      "status": "open"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-002",
      "severity": "critical",
      "check": "Tags Handler Mismatch",
      "location": "tagsCallbacks.ts:34",
      "description": "Tags has deleted_at but handler says supportsSoftDelete: false",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-003",
      "severity": "critical",
      "check": "Old Merge Hard DELETE",
      "location": "20251123215857_fix_merge_function_table_names.sql:62",
      "description": "Obsolete hard DELETE (superseded by newer migration)",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "error-handling",
      "id": "EH-001",
      "severity": "critical",
      "check": "Graceful Degradation",
      "location": "useKPIMetrics.ts:118-204",
      "description": "Promise.allSettled masks failures with 0 defaults",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-001",
      "severity": "critical",
      "check": "Nullable audit column",
      "location": "segments.created_by",
      "description": "Should be NOT NULL for audit trail",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-002",
      "severity": "critical",
      "check": "Missing audit columns",
      "location": "user_favorites",
      "description": "No updated_at, updated_by columns",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-003",
      "severity": "critical",
      "check": "Missing audit triggers",
      "location": "tutorial_progress, dashboard_snapshots, user_favorites",
      "description": "No audit_trail triggers attached",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-001",
      "severity": "critical",
      "check": "Missing Note Invalidation",
      "location": "Note.tsx:53-64",
      "description": "Note update/delete doesn't invalidate parent caches",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-002",
      "severity": "critical",
      "check": "Identity Cache TTL",
      "location": "authProvider.ts:140-180",
      "description": "15-minute TTL creates role change permission mismatch",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-003",
      "severity": "critical",
      "check": "Task→KPI Invalidation",
      "location": "useMyTasks.ts:169,247,296,362",
      "description": "Task completion doesn't invalidate dashboard KPIs",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WG-001",
      "severity": "critical",
      "check": "Sample Follow-up Gap",
      "location": "QuickLogForm.tsx:165-183",
      "description": "No transactional guarantee for activity+task creation",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-001",
      "severity": "critical",
      "check": "any in Test Files",
      "location": "src/atomic-crm/__tests__/*",
      "description": "259 occurrences of `: any` in test mocks",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-002",
      "severity": "critical",
      "check": "as Type Assertions",
      "location": "Multiple files",
      "description": "348+ as any/as unknown bypassing type safety",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-003",
      "severity": "critical",
      "check": "z.any() Zod Bug",
      "location": "products-base.test.ts",
      "description": "z.record(z.any()) has Zod v4 parsing bugs",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-004",
      "severity": "critical",
      "check": "Missing Return Types",
      "location": "20+ components",
      "description": "Components lack explicit return type annotations",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-005",
      "severity": "critical",
      "check": "Implicit any in Mocks",
      "location": "AuthorizationsTab.test.tsx",
      "description": "Mock params?: any without proper typing",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-006",
      "severity": "critical",
      "check": "Untyped Error Handlers",
      "location": "dataProviderErrors.test.ts",
      "description": "catch(error: any) instead of unknown",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-007",
      "severity": "critical",
      "check": "Provider Mock Types",
      "location": "mock-providers.ts",
      "description": "overrides?: any in mock factories",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-008",
      "severity": "critical",
      "check": "as const Issues",
      "location": "empty-state-content.ts:39",
      "description": "as const without proper inference",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-001",
      "severity": "critical",
      "check": "z.record(z.any()) Bug",
      "location": "products-base.test.ts",
      "description": "Known Zod v4 bug affects validation",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-002",
      "severity": "critical",
      "check": "DRY Violation",
      "location": "6+ validation files",
      "description": "Duplicated error formatting pattern",
      "firstSeen": "2026-01-11",
      "status": "open"
    }
  ],
  "fixed_since_last_audit": [
    "DI-002: Tags Handler Mismatch - Changed supportsSoftDelete: true",
    "SS-001: Missing Note Invalidation - Added parent cache invalidation",
    "SS-002: Identity Cache TTL - Reduced to 5 minutes",
    "SS-003: Task→KPI Invalidation - Added KPI invalidation calls",
    "EH-001: Graceful Degradation - Added errorMessage/hasPartialFailure",
    "WG-001: Sample Follow-up Gap - Created atomic RPC function",
    "SEC-001: RLS Policy Coverage - Verified 100% coverage",
    "SEC-002: Type Assertions - Reclassified to high",
    "SEC-003: z.any() in Validation - Reclassified to high",
    "WG-002: Win/loss reason bypass - Tests confirm working",
    "WG-004: Distributor not required - By design",
    "WG-005: Silent activity failure - Reclassified",
    "ARCH-001: Deprecated archived_at - Reclassified",
    "PERF-001: N+1 queries - Reclassified to high",
    "PERF-002: Dashboard remount - Reclassified",
    "PERF-003: Form watch leak - Reclassified"
  ],
  "strangler_fig_status": {
    "unifiedDataProvider_lines": 0,
    "composedDataProvider_lines": 255,
    "handler_count": 14,
    "status": "COMPLETED"
  },
  "feature_compliance": {
    "compliant": 14,
    "partial": 0,
    "incomplete": 0
  },
  "db_consistency": {
    "orphaned_opportunities": "Protected by NOT NULL constraint",
    "invalid_stages": 0,
    "unlinked_contacts": "Protected by NOT NULL constraint"
  },
  "excellence_areas": [
    "Strangler Fig: 100% COMPLETE - 14 composed handlers",
    "Architecture: 99.5% compliant - All features follow pattern",
    "Accessibility: WCAG 2.1 AA PASS - 0 issues, AAA contrast in dark mode",
    "Semantic Colors: 100% - Zero hardcoded colors found",
    "Security: 100% RLS coverage, no hardcoded secrets",
    "Error Handling: 95% fail-fast compliant",
    "Form Validation: Constitution compliant - onSubmit/onBlur modes"
  ],
  "trend": {
    "direction": "IMPROVING",
    "note": "Critical issues decreased 21 → 15 (-29%). Implementation plan resolved: DI-002 (tags soft delete), SS-001/SS-002/SS-003 (stale state), EH-001 (error exposure), WG-001 (atomic RPC). Remaining 15 critical: 8 TypeScript (test files), 3 DB hardening (migrations needed), 2 data integrity (historical migrations), 2 code quality (DRY, Zod).",
    "previous_total": 250,
    "current_total": 244,
    "critical_delta": -6
  }
}
