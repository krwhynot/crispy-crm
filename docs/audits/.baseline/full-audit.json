{
  "lastAudit": "2026-01-25",
  "lastAuditTime": "15:00",
  "mode": "quick",
  "duration_minutes": 9,
  "totals": {
    "critical": 8,
    "high": 21,
    "medium": 85,
    "total": 114
  },
  "by_layer": {
    "L1_database": {
      "critical": 2,
      "high": 4,
      "medium": 4,
      "status": "CRITICAL",
      "primary_concerns": "USING(true) RLS policies, junction table auth gaps, missing FK indexes"
    },
    "L2_domain": {
      "critical": 2,
      "high": 1,
      "medium": 56,
      "status": "CRITICAL",
      "primary_concerns": "Double-cast patterns in typed-mocks, production handler casts, test any usages"
    },
    "L3_provider": {
      "critical": 0,
      "high": 3,
      "medium": 4,
      "status": "WARN",
      "primary_concerns": "Manual interfaces in types.ts, architecture compliance"
    },
    "L4_ui_foundation": {
      "critical": 0,
      "high": 1,
      "medium": 2,
      "status": "WARN",
      "primary_concerns": "Legacy hex color fallbacks, small touch targets"
    },
    "L5_features": {
      "critical": 4,
      "high": 12,
      "medium": 19,
      "status": "WARN",
      "primary_concerns": "Silent catch blocks, workflow gaps, code quality"
    }
  },
  "by_category": {
    "security": {
      "critical": 1,
      "high": 2,
      "medium": 1,
      "status": "WARN",
      "note": "USING(true) RLS policies on team-access migration, segments open access, strictObject inconsistent"
    },
    "data-integrity": {
      "critical": 0,
      "high": 0,
      "medium": 0,
      "status": "PASS",
      "note": "Strangler Fig COMPLETE, 0 unifiedDataProvider lines, 25 handlers migrated"
    },
    "error-handling": {
      "critical": 3,
      "high": 4,
      "medium": 8,
      "status": "WARN",
      "note": "3 silent catch blocks without logging, fail-fast compliant (no retries), 100% withErrorLogging coverage"
    },
    "db-hardening": {
      "critical": 1,
      "high": 2,
      "medium": 3,
      "status": "WARN",
      "note": "product_distributors USING(true), junction table auth gaps, RLS subquery indexes"
    },
    "stale-state": {
      "critical": 0,
      "high": 1,
      "medium": 1,
      "status": "WARN",
      "note": "refetchOnWindowFocus may cause excessive refetches, missing explicit query invalidation"
    },
    "workflow-gaps": {
      "critical": 0,
      "high": 3,
      "medium": 2,
      "status": "WARN",
      "note": "Stage transitions skip activity logging, close outcome not in activity, bulk dialog no-op possible"
    },
    "architecture": {
      "critical": 0,
      "high": 3,
      "medium": 4,
      "status": "WARN",
      "note": "Manual interfaces violating Single Source of Truth, feature folder bloat, provider properly isolated"
    },
    "typescript": {
      "critical": 2,
      "high": 1,
      "medium": 56,
      "status": "WARN",
      "note": "Production: 0 any, 2 critical double-casts. Test: 12 as any, 45 as unknown as, 20 @ts-expect-error"
    },
    "accessibility": {
      "critical": 0,
      "high": 1,
      "medium": 2,
      "status": "PASS",
      "note": "Form primitives compliant (aria-invalid, aria-describedby, role=alert). Legacy hex colors in migration data."
    },
    "performance": {
      "critical": 0,
      "high": 0,
      "medium": 0,
      "status": "PASS",
      "note": "Excellent: 580+ memoization usages, no N+1 queries, all forms use onSubmit/onBlur, proper pagination"
    },
    "code-quality": {
      "critical": 1,
      "high": 4,
      "medium": 8,
      "status": "WARN",
      "note": "Test as any casts (CQ-001), magic pagination values, logger.ts too large (467 lines)"
    }
  },
  "critical_issues_summary": [
    {
      "rank": 1,
      "layer": "L1",
      "category": "security",
      "issue": "USING(true) RLS policies on 18+ core tables",
      "location": "20251018203500_update_rls_for_shared_team_access.sql",
      "impact": "Any authenticated user has unrestricted access",
      "fix": "Apply migration 20260123144656 security remediations",
      "status": "OPEN"
    },
    {
      "rank": 2,
      "layer": "L1",
      "category": "db-hardening",
      "issue": "product_distributors USING(true) policies",
      "location": "20251215054822_08_create_product_distributors.sql:42-51",
      "impact": "ANY user can CRUD all product-distributor mappings",
      "fix": "Apply 20260124170000_fix_product_distributors_rls_security.sql",
      "status": "OPEN"
    },
    {
      "rank": 3,
      "layer": "L2",
      "category": "typescript",
      "issue": "45 double-casts in typed-mocks.ts",
      "location": "src/tests/utils/typed-mocks.ts:155,192,446,659",
      "impact": "Type system bypassed, tests may pass with invalid data",
      "fix": "Replace with explicit type constructors",
      "status": "OPEN"
    },
    {
      "rank": 4,
      "layer": "L2",
      "category": "typescript",
      "issue": "Production handler double-cast",
      "location": "segmentsHandler.ts:40",
      "impact": "Type safety bypassed in production code",
      "fix": "Use type guards like isSegmentRecord pattern",
      "status": "OPEN"
    },
    {
      "rank": 5,
      "layer": "L5",
      "category": "error-handling",
      "issue": "Silent catch - SampleStatusBadge",
      "location": "src/atomic-crm/components/SampleStatusBadge.tsx:281",
      "impact": "Errors swallowed with no logging or user notification",
      "fix": "Add logger.warn() call",
      "status": "OPEN"
    },
    {
      "rank": 6,
      "layer": "L5",
      "category": "error-handling",
      "issue": "Silent catch - file removal validation",
      "location": "src/components/ra-wrappers/file-input.tsx:135-136",
      "impact": "File validation errors hidden from user",
      "fix": "Add notify() call with error message",
      "status": "OPEN"
    },
    {
      "rank": 7,
      "layer": "L5",
      "category": "error-handling",
      "issue": "Silent catch - date parsing",
      "location": "src/components/ra-wrappers/date-input.tsx:73-74",
      "impact": "parseISO failures hidden, may indicate data quality issues",
      "fix": "Log parsing error with logger.warn()",
      "status": "OPEN"
    },
    {
      "rank": 8,
      "layer": "L5",
      "category": "code-quality",
      "issue": "Test as any casts",
      "location": "OpportunityArchivedList.test.tsx:30,38,56,64,76,84,103,111,130,139,160,168",
      "impact": "12 instances bypass type safety in tests",
      "fix": "Use mockUseGetListReturn<T>() from typed-mocks.ts",
      "status": "OPEN"
    }
  ],
  "positive_findings": [
    "Zero any usage in production TypeScript code",
    "Zero @ts-ignore directives in entire codebase",
    "Strangler Fig migration COMPLETE (25 handlers, 0 unifiedDataProvider lines)",
    "Form accessibility primitives properly implemented (aria-invalid, aria-describedby, role=alert)",
    "100% withErrorLogging coverage on all data handlers",
    "Fail-fast principle followed (no retry loops or circuit breakers)",
    "Strong Zod adoption (118 z.infer usages)",
    "Excellent memoization (580+ React.memo/useMemo/useCallback)",
    "No N+1 query patterns detected",
    "All forms use onSubmit/onBlur (no onChange performance issues)",
    "Performance audit: 0 issues - exceptional codebase health",
    "Data integrity audit: 0 issues - Strangler Fig complete"
  ],
  "strangler_fig_status": {
    "unifiedDataProvider_lines": 0,
    "composedDataProvider_lines": 80,
    "handler_count": 13,
    "status": "COMPLETED"
  },
  "delta_from_previous": {
    "previous_date": "2026-01-25",
    "previous_time": "18:35",
    "previous_critical": 8,
    "previous_high": 198,
    "previous_medium": 134,
    "previous_total": 340,
    "current_critical": 8,
    "current_high": 21,
    "current_medium": 85,
    "current_total": 114,
    "critical_change": 0,
    "high_change": -177,
    "medium_change": -49,
    "total_change": -226,
    "analysis": "High issue reduction (-177) due to methodology refinement: test code :any patterns now correctly classified as Medium instead of High. Performance and Data Integrity audits returned 0 issues, confirming excellent codebase health in those areas."
  },
  "audit_methodology": {
    "type": "Quick 11-Audit Parallel Execution",
    "mode": "quick",
    "batches": 3,
    "batch1_agents": ["security", "data-integrity", "error-handling", "db-hardening"],
    "batch2_agents": ["stale-state", "workflow-gaps", "architecture", "typescript"],
    "batch3_agents": ["accessibility", "performance", "code-quality"],
    "duration_minutes": 9,
    "confidence_average": 92
  }
}
