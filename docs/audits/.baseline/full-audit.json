{
  "lastAudit": "2026-01-15",
  "lastAuditTime": "08:35",
  "mode": "full",
  "duration_minutes": 8,
  "totals": {
    "critical": 5,
    "high": 26,
    "medium": 109
  },
  "by_category": {
    "security": { "critical": 0, "high": 3, "medium": 5 },
    "data-integrity": { "critical": 0, "high": 1, "medium": 2 },
    "error-handling": { "critical": 0, "high": 0, "medium": 3 },
    "db-hardening": { "critical": 0, "high": 3, "medium": 8 },
    "stale-state": { "critical": 0, "high": 2, "medium": 4 },
    "workflow-gaps": { "critical": 0, "high": 1, "medium": 2 },
    "architecture": { "critical": 3, "high": 3, "medium": 7 },
    "typescript": { "critical": 1, "high": 3, "medium": 55 },
    "accessibility": { "critical": 0, "high": 0, "medium": 2 },
    "performance": { "critical": 0, "high": 2, "medium": 6 },
    "code-quality": { "critical": 2, "high": 8, "medium": 15 }
  },
  "critical_findings": [
    {
      "source_audit": "typescript",
      "id": "TS-001",
      "severity": "critical",
      "check": "Double-cast pattern",
      "location": "src/lib/genericMemo.ts:14",
      "description": "Uses `as unknown as T` double-cast pattern which bypasses type safety",
      "firstSeen": "2026-01-11",
      "status": "open"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-001",
      "severity": "critical",
      "check": "Direct Supabase Import",
      "location": "src/atomic-crm/dashboard/v3/components/QuickLogForm.tsx:5",
      "description": "Direct import of supabase client bypasses unifiedDataProvider",
      "firstSeen": "2026-01-12",
      "status": "open"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-002",
      "severity": "critical",
      "check": "Direct Supabase Import",
      "location": "src/atomic-crm/dashboard/v3/hooks/useCurrentSale.ts:3",
      "description": "Direct import of supabase client for auth.getUser()",
      "firstSeen": "2026-01-12",
      "status": "exception",
      "exception_reason": "Auth state is outside data provider scope. Well-documented. See useCurrentSale.ts lines 104-108.",
      "exception_approved_date": "2026-01-15"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-003",
      "severity": "critical",
      "check": "Missing Handlers Directory",
      "location": "src/providers/supabase/handlers/",
      "description": "Composed handler pattern directory not created in providers folder",
      "firstSeen": "2026-01-15",
      "status": "open",
      "notes": "Handlers exist in atomic-crm/providers/supabase but not in top-level providers"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-001",
      "severity": "critical",
      "check": "DRY Violation - formatDate",
      "location": "5 files with different implementations",
      "description": "5 different formatDate implementations with inconsistent formatting patterns",
      "firstSeen": "2026-01-15",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-002",
      "severity": "critical",
      "check": "Console Statements",
      "location": "src/ (220 occurrences)",
      "description": "220 console.log/warn/error statements in production code",
      "firstSeen": "2026-01-12",
      "status": "open"
    }
  ],
  "high_findings_top_20": [
    {
      "source_audit": "security",
      "id": "SEC-001",
      "check": "Zod .passthrough() Usage",
      "location": "src/atomic-crm/validation/*.ts",
      "description": "Zod passthrough() usage bypasses strict validation"
    },
    {
      "source_audit": "security",
      "id": "SEC-002",
      "check": "Missing .max() Limits",
      "location": "src/atomic-crm/validation/",
      "description": "4 string fields missing .max() limits"
    },
    {
      "source_audit": "security",
      "id": "SEC-003",
      "check": "Git-tracked Env Files",
      "location": ".env.example, .env.local.example",
      "description": "Template env files in git (low risk)"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-001",
      "check": "Obsolete Hard DELETE",
      "location": "supabase/migrations/20251123214721_*.sql:101",
      "description": "Obsolete hard DELETE function (superseded by soft delete migration)"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-001",
      "check": "Missing FK Indexes",
      "location": "tutorial_progress table",
      "description": "Missing indexes on user_id and step_key foreign keys"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-002",
      "check": "Missing deleted_at",
      "location": "tutorial_progress table",
      "description": "Table missing soft delete column"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-003",
      "check": "Missing Triggers",
      "location": "All tables",
      "description": "No set_updated_at() trigger function"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-001",
      "check": "Inconsistent Query Keys",
      "location": "TaskList.tsx, TaskSlideOverDetailsTab.tsx",
      "description": "Inconsistent task query key patterns"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-002",
      "check": "Missing Cache Invalidation",
      "location": "SalesCreate.tsx",
      "description": "Missing cache invalidation after sales rep creation"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WF-001",
      "check": "Missing Audit Trail",
      "location": "WorkflowManagementSection.tsx:51",
      "description": "Stage updates bypass audit trail"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-004",
      "check": "Form-Level Validation",
      "location": "src/atomic-crm/organizations/QuickCreatePopover.tsx",
      "description": "Inline Zod schema in form component"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-005",
      "check": "Form-Level Validation",
      "location": "src/atomic-crm/contacts/QuickCreateContactPopover.tsx",
      "description": "Inline Zod schema in form component"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-006",
      "check": "Form-Level Validation",
      "location": "src/atomic-crm/contacts/ContactCompactForm.tsx",
      "description": "Inline email validation schema"
    },
    {
      "source_audit": "typescript",
      "id": "TS-002",
      "check": "Type Assertions",
      "location": "src/atomic-crm/services/opportunities.service.ts",
      "description": "Multiple `as Opportunity` assertions"
    },
    {
      "source_audit": "typescript",
      "id": "TS-003",
      "check": "Type Assertions",
      "location": "src/atomic-crm/validation/contacts/contacts-core.ts",
      "description": "`as Record<string, unknown>` assertions"
    },
    {
      "source_audit": "typescript",
      "id": "TS-004",
      "check": "Type Assertions",
      "location": "src/components/ui/form.tsx",
      "description": "Context creation with empty object cast"
    },
    {
      "source_audit": "performance",
      "id": "PERF-001",
      "check": "Large Pagination",
      "location": "UserDisableReassignDialog.tsx:275-296",
      "description": "4 queries with perPage: 1000"
    },
    {
      "source_audit": "performance",
      "id": "PERF-002",
      "check": "Large Pagination",
      "location": "WeeklyActivitySummary.tsx:53,64",
      "description": "Report fetches 1000 records without virtualization"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-003",
      "check": "Cyclomatic Complexity",
      "location": "src/atomic-crm/filters/useFilterChipBar.ts",
      "description": "13 else-if chains"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-010",
      "check": "Magic Numbers",
      "location": "Multiple files",
      "description": "staleTime magic numbers (13+ occurrences)"
    }
  ],
  "strangler_fig_status": {
    "unifiedDataProvider_lines": 0,
    "composedDataProvider_lines": 255,
    "handler_count": 24,
    "status": "COMPLETED"
  },
  "feature_compliance": {
    "compliant": 6,
    "partial": 2,
    "incomplete": 2
  },
  "db_consistency": {
    "orphaned_opportunities": "Protected by NOT NULL constraint",
    "invalid_stages": 0,
    "unlinked_contacts": "Protected by NOT NULL constraint"
  },
  "excellence_areas": [
    "Strangler Fig: 100% COMPLETE - 24 composed handlers",
    "Accessibility: WCAG 2.1 AA PASS - 0 hardcoded colors in TSX",
    "Security: 100% RLS coverage on all 35 tables",
    "Error Handling: 94% fail-fast compliant, 0 high issues",
    "Form Validation: Constitution compliant - onSubmit/onBlur modes",
    "Data Integrity: 100% - Soft delete enforced",
    "TypeScript: 95% type safety - 0 any in production"
  ],
  "trend": {
    "direction": "IMPROVING",
    "note": "High issues decreased 40→26 (-35%). Error handling now at 0 high. Stale state reduced 6→2. Medium increased due to more granular TypeScript/code-quality detection.",
    "previous_total": 120,
    "current_total": 141,
    "critical_delta": 0,
    "high_delta": -14,
    "medium_delta": 35
  }
}
