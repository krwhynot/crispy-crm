{
  "lastAudit": "2026-01-23",
  "lastAuditTime": "21:29",
  "mode": "full",
  "duration_minutes": 21,
  "totals": {
    "critical": 36,
    "high": 153,
    "medium": 78
  },
  "by_layer": {
    "L1_database": { "critical": 5, "high": 13, "status": "CRITICAL" },
    "L2_domain": { "critical": 1, "high": 81, "status": "CRITICAL" },
    "L3_provider": { "critical": 5, "high": 10, "status": "CRITICAL" },
    "L4_ui_foundation": { "critical": 2, "high": 5, "status": "WARN" },
    "L5_features": { "critical": 14, "high": 45, "status": "CRITICAL" }
  },
  "by_category": {
    "security": { "critical": 2, "high": 8, "medium": 6 },
    "data-integrity": { "critical": 5, "high": 8, "medium": 12 },
    "error-handling": { "critical": 4, "high": 7, "medium": 3 },
    "db-hardening": { "critical": 3, "high": 5, "medium": 4 },
    "stale-state": { "critical": 5, "high": 8, "medium": 6 },
    "workflow-gaps": { "critical": 3, "high": 5, "medium": 4 },
    "architecture": { "critical": 0, "high": 0, "medium": 1 },
    "typescript": { "critical": 1, "high": 81, "medium": 8 },
    "accessibility": { "critical": 2, "high": 5, "medium": 8 },
    "performance": { "critical": 5, "high": 12, "medium": 8 },
    "code-quality": { "critical": 6, "high": 14, "medium": 18 }
  },
  "critical_findings": [
    {
      "source_audit": "performance",
      "id": "PERF-001",
      "severity": "critical",
      "layer": "L5",
      "check": "Build failure - export syntax error",
      "location": "src/components/ra-wrappers/record-field.tsx:80",
      "description": "Export syntax error blocks all production builds",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-CRIT-001",
      "severity": "critical",
      "layer": "L1",
      "check": "Permissive RLS policies",
      "location": "20251215054822_08_create_product_distributors.sql:42-51",
      "description": "product_distributors table has ALL RLS policies using USING (true)",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-002",
      "severity": "critical",
      "layer": "L1",
      "check": "Missing deleted_at in SELECT policies",
      "location": "23 tables in migrations",
      "description": "23 SELECT policies use auth.uid() without deleted_at filter",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "security",
      "id": "SEC-002",
      "severity": "critical",
      "layer": "L1",
      "check": "Junction table authorization gaps",
      "location": "opportunity_contacts, interaction_participants",
      "description": "INSERT policies check parent but not related entity authorization",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "error-handling",
      "id": "EH-001",
      "severity": "critical",
      "layer": "L3",
      "check": "console.error in production",
      "location": "rpcExtension.ts, edgeFunctionsExtension.ts, storageExtension.ts, specializedExtension.ts",
      "description": "Direct console.error instead of logger.error breaks error monitoring",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "stale-state",
      "id": "SS-001",
      "severity": "critical",
      "layer": "L5",
      "check": "Tag mutation cache hole",
      "location": "TagEditModal.tsx",
      "description": "Tag edits dont invalidate cache - users see stale names/colors",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "typescript",
      "id": "TS-001",
      "severity": "critical",
      "layer": "L2",
      "check": "Test infrastructure any usage",
      "location": "299 instances across test files",
      "description": "as any bypasses type checking in test infrastructure",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WG-002",
      "severity": "critical",
      "layer": "L5",
      "check": "Nullable required FK",
      "location": "opportunities.principal_organization_id",
      "description": "principal_organization_id can be NULL despite business requirement",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "accessibility",
      "id": "A11Y-002",
      "severity": "critical",
      "layer": "L4",
      "check": "Small touch targets",
      "location": "OrganizationAside.tsx, ResourceSlideOver.tsx",
      "description": "min-h-[24px] falls below 44px iPad guideline",
      "firstSeen": "2026-01-23",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-001",
      "severity": "critical",
      "layer": "L5",
      "check": "Oversized files",
      "location": "src/atomic-crm/validation/activities.ts (785 lines)",
      "description": "Monolithic file exceeds 500-line limit",
      "firstSeen": "2026-01-23",
      "status": "open"
    }
  ],
  "strangler_fig_status": {
    "unifiedDataProvider_lines": 0,
    "composedDataProvider_lines": 260,
    "handler_count": 13,
    "status": "COMPLETED"
  },
  "excellence_areas": [
    "Architecture: 100% feature module compliance - ZERO violations",
    "Strangler Fig: 100% COMPLETE - 13 composed handlers",
    "RLS Coverage: 22/22 tables (100%)",
    "Fail-Fast: NO retry logic found",
    "Form Validation: onSubmit/onBlur mode enforced",
    "WCAG 2.1 AA: Implementation correct"
  ],
  "trend": {
    "direction": "DETAILED",
    "note": "Full mode audit detected 267 total issues vs 115 in quick mode. More thorough analysis revealed TypeScript (90 issues) and Performance (25 issues) as major areas.",
    "previous_critical": 9,
    "current_critical": 36,
    "previous_high": 87,
    "current_high": 153,
    "previous_medium": 19,
    "current_medium": 78,
    "mode_difference": "Full mode vs Quick mode - deeper analysis"
  }
}
