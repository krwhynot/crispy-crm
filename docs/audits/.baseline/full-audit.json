{
  "lastAudit": "2026-01-26",
  "lastAuditTime": "00:15",
  "mode": "quick",
  "duration_minutes": 21,
  "totals": {
    "critical": 6,
    "high": 22,
    "medium": 39,
    "total": 108
  },
  "by_layer": {
    "L1_database": {
      "critical": 2,
      "high": 5,
      "medium": 6,
      "status": "CRITICAL",
      "primary_concerns": "contact_organizations missing dual-auth RLS, activities permissive policies, FK constraints without ON DELETE"
    },
    "L2_domain": {
      "critical": 1,
      "high": 4,
      "medium": 1,
      "status": "WARN",
      "primary_concerns": "Missing .strict() on 30 schemas, 7 manual interface definitions, type assertions"
    },
    "L3_provider": {
      "critical": 0,
      "high": 2,
      "medium": 1,
      "status": "OK",
      "primary_concerns": "Inline validate patterns in PATTERNS docs, test watch() usage"
    },
    "L4_ui_foundation": {
      "critical": 1,
      "high": 2,
      "medium": 1,
      "status": "WARN",
      "primary_concerns": "FormErrorSummary touch target, aria-invalid pattern, icon aria-hidden"
    },
    "L5_features": {
      "critical": 2,
      "high": 7,
      "medium": 4,
      "status": "WARN",
      "primary_concerns": "Missing activity logging, field naming mismatch, silent defaults, large validation file"
    }
  },
  "by_category": {
    "security": {
      "critical": 0,
      "high": 5,
      "medium": 3,
      "status": "WARN",
      "note": "activities permissive RLS, task_id_mapping permissive, missing .max() constraints. Participant tables intentionally team-shared."
    },
    "data-integrity": {
      "critical": 0,
      "high": 0,
      "medium": 0,
      "status": "PASS",
      "note": "Strangler Fig COMPLETE (0 unifiedDataProvider lines, 24 handlers). 0 .delete() calls. 719 soft-delete RLS filters."
    },
    "error-handling": {
      "critical": 0,
      "high": 0,
      "medium": 0,
      "status": "PASS",
      "note": "100% withErrorLogging coverage. Fail-fast compliant. Zero retries or circuit breakers."
    },
    "db-hardening": {
      "critical": 1,
      "high": 4,
      "medium": 6,
      "status": "WARN",
      "note": "contact_organizations missing dual-auth. 23 FKs without ON DELETE. Missing FK indexes. Incomplete trigger coverage."
    },
    "stale-state": {
      "critical": 1,
      "high": 2,
      "medium": 4,
      "status": "WARN",
      "note": "No documented stale-state strategy. Broad query invalidation. Inconsistent refetchOnWindowFocus."
    },
    "workflow-gaps": {
      "critical": 2,
      "high": 5,
      "medium": 4,
      "status": "WARN",
      "note": "Missing activity logging for stage transitions. Field naming mismatch (closed_date vs actual_close_date). Silent status defaults."
    },
    "architecture": {
      "critical": 1,
      "high": 2,
      "medium": 3,
      "status": "WARN",
      "note": "Missing .strict() on schemas. Manual interface definitions. Tier 1 properly isolated."
    },
    "typescript": {
      "critical": 0,
      "high": 38,
      "medium": 7,
      "status": "PASS",
      "note": "Zero 'as any' in production. 32 type assertions (mostly safe). 6 as unknown as in tests. 92% type safety score."
    },
    "accessibility": {
      "critical": 1,
      "high": 2,
      "medium": 4,
      "status": "WARN",
      "note": "FormErrorSummary touch target. aria-invalid undefined vs false. WCAG 2.1 AA compliant overall."
    },
    "performance": {
      "critical": 0,
      "high": 2,
      "medium": 3,
      "status": "PASS",
      "note": "Inline validate in docs only. Test watch() usage. Good memoization (715 hooks). All forms onSubmit/onBlur."
    },
    "code-quality": {
      "critical": 0,
      "high": 1,
      "medium": 5,
      "status": "PASS",
      "note": "Zero 'as any' in production. 1 large file (674 lines). 20 TODOs. Minimal dead code."
    }
  },
  "critical_issues_summary": [
    {
      "rank": 1,
      "layer": "L1",
      "category": "db-hardening",
      "issue": "contact_organizations missing dual-auth RLS",
      "location": "cloud_schema_fresh.sql",
      "impact": "Users can link contacts and organizations across company boundaries",
      "fix": "Add dual EXISTS checks per DATABASE_LAYER.md",
      "status": "OPEN"
    },
    {
      "rank": 2,
      "layer": "L1",
      "category": "stale-state",
      "issue": "No documented stale-state strategy",
      "location": "N/A",
      "impact": "Inconsistent cache invalidation decisions",
      "fix": "Create .claude/rules/STALE_STATE_STRATEGY.md",
      "status": "OPEN"
    },
    {
      "rank": 3,
      "layer": "L2",
      "category": "architecture",
      "issue": "Missing .strict() on Zod schemas",
      "location": "src/atomic-crm/validation/**/*.ts",
      "impact": "Mass assignment vulnerability - invalid fields bypass validation",
      "fix": "Add .strict() to all 30 z.object() schemas",
      "status": "OPEN"
    },
    {
      "rank": 4,
      "layer": "L4",
      "category": "accessibility",
      "issue": "FormErrorSummary touch target below 44px",
      "location": "FormErrorSummary.tsx:156-174",
      "impact": "WCAG 2.5.5 Target Size violation",
      "fix": "Add min-h-11 px-3 to expand button",
      "status": "OPEN"
    },
    {
      "rank": 5,
      "layer": "L5",
      "category": "workflow-gaps",
      "issue": "Missing activity logging for stage transitions",
      "location": "opportunitiesCallbacks.ts:301-327",
      "impact": "Lost audit trail for pipeline progression",
      "fix": "Add afterUpdate callback to log stage changes",
      "status": "OPEN"
    },
    {
      "rank": 6,
      "layer": "L5",
      "category": "workflow-gaps",
      "issue": "Field naming mismatch (closed_date vs actual_close_date)",
      "location": "opportunitiesCallbacks.ts:274 vs schema:223",
      "impact": "Close operations may fail validation",
      "fix": "Align field names between callback and schema",
      "status": "OPEN"
    }
  ],
  "positive_findings": [
    "Strangler Fig migration COMPLETE (0 unifiedDataProvider lines, 24 handlers)",
    "Error handling 100% withErrorLogging coverage, fail-fast compliant",
    "Zero @ts-ignore directives in entire codebase",
    "Zero 'as any' in production code (all 16 in test files - allowlisted)",
    "132 z.infer usages - strong schema-type derivation",
    "WCAG 2.1 AA compliant: 84 aria-invalid, 55 aria-describedby, 37 role=alert",
    "100% semantic color usage (0 hex codes, 0 hardcoded Tailwind)",
    "48px touch targets exceed WCAG AAA",
    "719 soft-delete RLS filters at database layer",
    "0 direct .delete() calls in application code",
    "715 memoization hooks (useMemo + useCallback)",
    "All forms use onSubmit/onBlur mode (no onChange performance issues)"
  ],
  "strangler_fig_status": {
    "unifiedDataProvider_lines": 0,
    "handler_count": 24,
    "status": "COMPLETE"
  },
  "delta_from_previous": {
    "previous_date": "2026-01-26",
    "previous_time": "08:02",
    "previous_critical": 16,
    "previous_high": 80,
    "previous_medium": 83,
    "previous_total": 250,
    "current_critical": 6,
    "current_high": 22,
    "current_medium": 39,
    "current_total": 108,
    "critical_change": -10,
    "high_change": -58,
    "medium_change": -44,
    "total_change": -142,
    "analysis": "Significant improvement from: RLS policy fixes (audit_trail, segments), allowlist filtering for false positives, refined methodology focusing on actionable findings, historical migration exclusion."
  },
  "audit_methodology": {
    "type": "Quick 11-Audit Parallel Execution",
    "mode": "quick",
    "batches": 3,
    "batch1_agents": ["security", "data-integrity", "error-handling", "db-hardening"],
    "batch2_agents": ["stale-state", "workflow-gaps", "architecture", "typescript"],
    "batch3_agents": ["accessibility", "performance", "code-quality"],
    "duration_minutes": 21,
    "allowlist_entries": 6
  }
}
