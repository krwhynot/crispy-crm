{
  "lastAudit": "2026-01-22",
  "lastAuditTime": "15:46",
  "mode": "full",
  "duration_minutes": 17,
  "totals": {
    "critical": 340,
    "high": 1110,
    "medium": 1675
  },
  "by_category": {
    "security": { "critical": 0, "high": 3, "medium": 8 },
    "data-integrity": { "critical": 3, "high": 5, "medium": 7 },
    "error-handling": { "critical": 12, "high": 18, "medium": 34 },
    "db-hardening": { "critical": 1, "high": 3, "medium": 90 },
    "stale-state": { "critical": 0, "high": 0, "medium": 0 },
    "workflow-gaps": { "critical": 3, "high": 8, "medium": 12 },
    "architecture": { "critical": 8, "high": 12, "medium": 15 },
    "typescript": { "critical": 147, "high": 89, "medium": 234 },
    "accessibility": { "critical": 147, "high": 892, "medium": 1243 },
    "performance": { "critical": 3, "high": 12, "medium": 8 },
    "code-quality": { "critical": 16, "high": 68, "medium": 24 }
  },
  "critical_findings": [
    {
      "source_audit": "db-hardening",
      "id": "DB-001",
      "severity": "critical",
      "check": "RLS Disabled",
      "location": "public.task_id_mapping",
      "description": "Table has no RLS policies - exposes migration data",
      "firstSeen": "2026-01-20",
      "status": "open"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-001",
      "severity": "critical",
      "check": "Hard DELETE",
      "location": "supabase/migrations/20251117121913_phase2c_correct_misnamed_restaurants.sql:71",
      "description": "Hard DELETE of organization without soft delete",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-002",
      "severity": "critical",
      "check": "Hard DELETE",
      "location": "supabase/migrations/20251117123500_phase2d_consolidate_duplicates.sql",
      "description": "Hard DELETE of duplicate organizations",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-003",
      "severity": "critical",
      "check": "Hard DELETE",
      "location": "supabase/migrations/20251116210019_fix_sales_schema_consistency.sql",
      "description": "Hard DELETE of orphaned sales records",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WG-001",
      "severity": "critical",
      "check": "Required Field Fallbacks",
      "location": "opportunities.stage DEFAULT 'new_lead'",
      "description": "Creates opportunities without explicit stage assignment",
      "firstSeen": "2026-01-20",
      "status": "open"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WG-002",
      "severity": "critical",
      "check": "Required Field Fallbacks",
      "location": "product_distributors.status DEFAULT 'active'",
      "description": "Masks missing status data entry",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WG-003",
      "severity": "critical",
      "check": "Nullable Required FKs",
      "location": "opportunities.customer_organization_id",
      "description": "Allows NULL despite being core business requirement",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-001",
      "severity": "critical",
      "check": "Direct Supabase Import",
      "location": "src/atomic-crm/contacts/ContactShow.tsx:4",
      "description": "Direct import of supabase client in feature layer",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-002",
      "severity": "critical",
      "check": "Direct Supabase Import",
      "location": "src/atomic-crm/opportunities/OpportunityShow.tsx:6",
      "description": "Direct import of supabase client in feature layer",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-005",
      "severity": "critical",
      "check": "Deprecated Patterns",
      "location": "src/atomic-crm/contacts/types.ts:12",
      "description": "Usage of deprecated company_id field",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "performance",
      "id": "PERF-001",
      "severity": "critical",
      "check": "watch() Instead of useWatch()",
      "location": "src/atomic-crm/opportunities/OpportunityInputs.tsx:153-155",
      "description": "Using watch() triggers full form re-renders",
      "firstSeen": "2026-01-22",
      "status": "open"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-001",
      "severity": "critical",
      "check": "Large Files",
      "location": "CampaignActivityReport.test.tsx (1330 lines)",
      "description": "Test file exceeds 500 line limit",
      "firstSeen": "2026-01-22",
      "status": "open"
    }
  ],
  "high_findings_top10": [
    {
      "source_audit": "security",
      "id": "SEC-002",
      "severity": "high",
      "check": "Zod Missing .max()",
      "location": "src/atomic-crm/validation/contactSchemas.ts",
      "description": "String fields without .max() constraints allow unbounded input"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-002",
      "severity": "high",
      "check": "Function Search Path",
      "location": "deprecated_tasks_access_notice, set_activity_created_by",
      "description": "3 functions have mutable search_path"
    },
    {
      "source_audit": "db-hardening",
      "id": "DB-003",
      "severity": "high",
      "check": "Unindexed FK",
      "location": "distributor_principal_authorizations.principal_id",
      "description": "Foreign key missing index"
    },
    {
      "source_audit": "data-integrity",
      "id": "DI-004",
      "severity": "high",
      "check": "Hard DELETE in RPC",
      "location": "sync_opportunity_contacts RPC",
      "description": "Fixed in 20260120000001 - verify migration applied"
    },
    {
      "source_audit": "error-handling",
      "id": "ERR-013",
      "severity": "high",
      "check": "Missing Error Propagation",
      "location": "src/atomic-crm/hooks/useActivityTracking.ts:45",
      "description": "Catch block logs error but doesn't inform user"
    },
    {
      "source_audit": "workflow-gaps",
      "id": "WG-006",
      "severity": "high",
      "check": "Missing Activity Logging",
      "location": "src/atomic-crm/opportunities/OpportunityEdit.tsx",
      "description": "Stage transitions do not create activity records"
    },
    {
      "source_audit": "architecture",
      "id": "ARCH-009",
      "severity": "high",
      "check": "Feature Structure",
      "location": "src/atomic-crm/contacts/",
      "description": "Missing ContactInputs.tsx for shared form inputs"
    },
    {
      "source_audit": "performance",
      "id": "PERF-005",
      "severity": "high",
      "check": "Missing React.memo",
      "location": "src/atomic-crm/opportunities/OpportunityInputs.tsx",
      "description": "Component not memoized, re-renders on parent changes"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-017",
      "severity": "high",
      "check": "Direct Supabase Imports",
      "location": "src/atomic-crm/reports/CampaignActivity/useCampaignActivityData.ts",
      "description": "Direct Supabase import outside provider layer"
    },
    {
      "source_audit": "code-quality",
      "id": "CQ-033",
      "severity": "high",
      "check": "Console Statements",
      "location": "68 files with 137 console statements",
      "description": "Production code contains console.log/warn/error"
    }
  ],
  "strangler_fig_status": {
    "unifiedDataProvider_lines": 0,
    "composedDataProvider_lines": 260,
    "handler_count": 13,
    "status": "COMPLETED"
  },
  "excellence_areas": [
    "Strangler Fig: 100% COMPLETE - 13 composed handlers",
    "RLS Coverage: 28/29 tables (96.6%)",
    "Fail-Fast: NO retry logic found",
    "Stale State: ZERO issues - React Admin handles caching",
    "Code Splitting: React.lazy on resource routes",
    "Optimistic Updates: Proper rollback patterns"
  ],
  "audit_coverage_note": "Increased issue counts reflect more comprehensive scanning (TypeScript any, ARIA attributes, error fallbacks) rather than codebase degradation. Core critical issues unchanged from 2026-01-20.",
  "trend": {
    "direction": "EXPANDED_COVERAGE",
    "note": "Issue counts increased due to broader detection (TypeScript: +147 critical any, Accessibility: +147 critical ARIA). Core architecture issues stable.",
    "previous_critical": 11,
    "current_critical": 340,
    "new_detection_categories": ["any usage", "ARIA attributes", "error fallbacks", "large files"]
  }
}
