var e=Object.defineProperty,a=(a,n)=>e(a,"name",{value:n,configurable:!0});import{P as n,j as r,ar as t,c as s,u as i,U as c,at as o,J as l}from"./chunk-ByJg_QQB.js";import{r as u,d}from"./chunk-1NZFT-6z.js";import{v as p,C as h,a as m,w as g}from"../assets/index-BoLku8RR.js";import{F as j,C as k}from"./chunk-BM66RvuK.js";import{u as x}from"./chunk-JxeXaC9i.js";import{u as f,F as C}from"./chunk-mWIjHQDe.js";import{O as b}from"./chunk-CypxJXwf.js";import{A as y,a as w,b as D,c as F,d as v,e as z,f as O,g as S}from"./chunk-D62ZQQIe.js";import"./chunk-DwAffUXc.js";import"./chunk-knA4lag3.js";import"./chunk-Tyyhsnez.js";import"./chunk-Bc6KM1xM.js";import"./chunk-XoqkUGE_.js";import"./chunk-CRKBdUTG.js";import"./chunk-DpghI3EP.js";import"./chunk-D6FmavVW.js";import"./chunk-nUtrHAIa.js";import"./chunk-CMQLDEz_.js";import"./chunk-C_u3nriX.js";import"./chunk-C5fZsuMg.js";import"./chunk-C4sNritB.js";import"./chunk-DsNwAyt-.js";import"./chunk-DhfTvo06.js";import"./chunk-B0BZInrb.js";import"./chunk-CIlS_x6D.js";function N(){const e=n(),[a,r]=u.useState(null),[t,s]=u.useState(!1),i=u.useRef(new Set),c=u.useCallback(async(a,n)=>{if(!a||0===a.trim().length)return null;const t=a.trim().toLowerCase();if(i.current.has(t))return null;s(!0);try{const{data:t}=await e.getList("organizations",{filter:{"name@ilike":a.trim()},pagination:{page:1,perPage:10},sort:{field:"id",order:"ASC"}}),s=t.filter(e=>String(e.id)!==String(n));if(s.length>0){const e={id:s[0].id,name:s[0].name};return r(e),e}return null}catch(c){return null}finally{s(!1)}},[e]),o=u.useCallback(()=>{r(null)},[]),l=u.useCallback(()=>{a&&i.current.add(a.name.toLowerCase()),r(null)},[a]);return{checkForDuplicate:c,duplicateOrg:a,clearDuplicate:o,bypassDuplicate:l,isChecking:t}}function P({open:e,duplicateName:n,onCancel:t,onProceed:s,isLoading:i=!1}){return r.jsx(y,{open:e,onOpenChange:a(e=>!e&&t(),"onOpenChange"),children:r.jsxs(w,{children:[r.jsxs(D,{children:[r.jsx(F,{children:"Potential Duplicate Organization"}),r.jsx(v,{asChild:!0,children:r.jsxs("div",{className:"space-y-2 text-sm text-muted-foreground",children:[r.jsxs("p",{children:["An organization named ",r.jsxs("strong",{children:['"',n,'"']})," already exists in the system."]}),r.jsx("p",{children:"Would you like to proceed anyway, or go back to change the name?"})]})})]}),r.jsxs(z,{children:[r.jsx(O,{onClick:t,children:"Change Name"}),r.jsx(S,{onClick:s,disabled:i,className:"bg-warning text-warning-foreground hover:bg-warning/90",children:i?"Creating...":"Create Anyway"})]})]})})}a(N,"useDuplicateOrgCheck"),a(P,"DuplicateOrgWarningDialog");const _=a(({onDuplicateFound:e,checkForDuplicate:a,isChecking:n})=>{const t=x(),s=u.useRef(null),i=u.useCallback(async n=>{n.preventDefault();const r=t.getValues(),i=r.name?.trim();if(!i)return void t.trigger("name");const c=await a(i);c?e(c.name,r):s.current?.click()},[t,a,e]);return r.jsxs(r.Fragment,{children:[r.jsx("button",{ref:s,type:"submit",style:{display:"none"},"aria-hidden":"true",tabIndex:-1}),r.jsx(g,{label:n?"Checking...":"Create Organization",type:"button",onClick:i,disabled:n,alwaysEnable:!0,"data-tutorial":"org-save-btn"})]})},"DuplicateCheckSaveButton"),A=a(()=>{const e=d(),[n]=t(),g=s(),j=i(),{defaults:k,isLoading:x}=f(),{checkForDuplicate:b,duplicateOrg:y,clearDuplicate:w,bypassDuplicate:D,isChecking:F}=N(),v=u.useRef(null),[z,O]=u.useState(!1),{data:S=[]}=c("segments",{filter:{name:"Unknown"},pagination:{page:1,perPage:1},sort:{field:"name",order:"ASC"}},{enabled:!0}),_=S?.[0]?.id,A=e.state?.record?.parent_organization_id,E=u.useCallback(e=>(e.website&&!e.website.startsWith("http")&&(e.website=`https://${e.website}`),e),[]),R=u.useCallback((e,a)=>{v.current=a},[]),U=u.useCallback(async()=>{if(v.current){O(!0);try{const e=E(v.current);await n("organizations",{data:e},{onSuccess:a(e=>{D(),v.current=null,j("Organization created",{type:"success"}),g("show","organizations",e.id)},"onSuccess"),onError:a(e=>{j(e instanceof Error?e.message:"Failed to create organization",{type:"error"})},"onError")})}finally{O(!1)}}},[n,E,D,j,g]),W=u.useCallback(()=>{w(),v.current=null},[w]);if(x)return r.jsx("div",{className:"bg-muted px-6 py-6",children:r.jsx("div",{className:"max-w-4xl mx-auto create-form-card",children:r.jsx(C,{rows:4})})});const B={...p.partial().parse({}),sales_id:k.sales_id,segment_id:_??null,...A?{parent_organization_id:A}:{}},V=_?`org-create-${_}`:"org-create";return r.jsxs(r.Fragment,{children:[r.jsx(o,{redirect:"show",transform:E,children:r.jsx("div",{className:"bg-muted px-6 py-6",children:r.jsx("div",{className:"max-w-4xl mx-auto create-form-card",children:r.jsx(l,{defaultValues:B,children:r.jsx(h,{children:r.jsx(m,{children:r.jsx(L,{onDuplicateFound:R,checkForDuplicate:b,isChecking:F})})})},V)})})}),r.jsx(P,{open:!!y,duplicateName:y?.name,onCancel:W,onProceed:U,isLoading:z})]})},"OrganizationCreate"),L=a(({onDuplicateFound:e,checkForDuplicate:a,isChecking:n})=>r.jsxs(r.Fragment,{children:[r.jsx(b,{}),r.jsx(j,{children:r.jsxs("div",{className:"flex flex-row gap-2 justify-end",children:[r.jsx(k,{}),r.jsx(_,{onDuplicateFound:e,checkForDuplicate:a,isChecking:n})]})})]}),"OrganizationFormContent");export{A as OrganizationCreate,A as default};
