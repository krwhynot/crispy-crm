var e=Object.defineProperty,t=(t,i)=>e(t,"name",{value:i,configurable:!0});import{P as i,j as s}from"./chunk-ByJg_QQB.js";import{a9 as a,S as r,s as o}from"../assets/index-BoLku8RR.js";import{r as n}from"./chunk-1NZFT-6z.js";import{n as l,s as d,w as c,$ as p}from"./chunk-DwAffUXc.js";import{a6 as u,ag as g,O as m,J as f,b0 as h,b1 as v,aV as x}from"./chunk-Bc6KM1xM.js";import"./chunk-JxeXaC9i.js";import"./chunk-knA4lag3.js";import"./chunk-Tyyhsnez.js";import"./chunk-XoqkUGE_.js";import"./chunk-CRKBdUTG.js";function S(e,t){if(0===t)return{trend:e>0?100:0,direction:e>0?"up":"flat"};const i=(e-t)/t*100;return{trend:Math.round(i),direction:i>0?"up":i<0?"down":"flat"}}function _(e,t){const{trend:i,direction:s}=S(e,t);return{value:e,previousValue:t,trend:i,direction:s}}t(S,"calculateTrend"),t(_,"createMetric");const j={activitiesThisWeek:{value:0,previousValue:0,trend:0,direction:"flat"},dealsMoved:{value:0,previousValue:0,trend:0,direction:"flat"},tasksCompleted:{value:0,previousValue:0,trend:0,direction:"flat"},openOpportunities:{value:0,previousValue:0,trend:0,direction:"flat"}};function b(){const e=i(),{salesId:s,loading:r}=a(),[o,u]=n.useState(j),[g,m]=n.useState(!0),[f,h]=n.useState(null),[v,x]=n.useState(0),S=n.useRef(null);n.useEffect(()=>{t(async()=>{if(!r){if(!s)return null!==S.current&&(u(j),S.current=null),void m(!1);S.current=s;try{m(!0),h(null);const i=l(new Date),a=d(i,{weekStartsOn:1}),r=c(i,{weekStartsOn:1}),o=p(a,1),n=p(r,1),[g,f,v,x,S,j,b,k]=await Promise.allSettled([e.getList("activities",{filter:{created_by:s,"activity_date@gte":a.toISOString(),"activity_date@lte":r.toISOString()},sort:{field:"id",order:"ASC"},pagination:{page:1,perPage:1}}),e.getList("tasks",{filter:{sales_id:s,completed:!0,"completed_at@gte":a.toISOString(),"completed_at@lte":r.toISOString()},sort:{field:"id",order:"ASC"},pagination:{page:1,perPage:1}}),e.getList("opportunities",{filter:{opportunity_owner_id:s,"updated_at@gte":a.toISOString(),"updated_at@lte":r.toISOString(),"stage@not_in":["closed_won","closed_lost"]},sort:{field:"id",order:"ASC"},pagination:{page:1,perPage:1}}),e.getList("opportunities",{filter:{opportunity_owner_id:s,"stage@not_in":["closed_won","closed_lost"]},sort:{field:"id",order:"ASC"},pagination:{page:1,perPage:1}}),e.getList("activities",{filter:{created_by:s,"activity_date@gte":o.toISOString(),"activity_date@lte":n.toISOString()},sort:{field:"id",order:"ASC"},pagination:{page:1,perPage:1}}),e.getList("tasks",{filter:{sales_id:s,completed:!0,"completed_at@gte":o.toISOString(),"completed_at@lte":n.toISOString()},sort:{field:"id",order:"ASC"},pagination:{page:1,perPage:1}}),e.getList("opportunities",{filter:{opportunity_owner_id:s,"updated_at@gte":o.toISOString(),"updated_at@lte":n.toISOString(),"stage@not_in":["closed_won","closed_lost"]},sort:{field:"id",order:"ASC"},pagination:{page:1,perPage:1}}),e.getList("dashboard_snapshots",{filter:{sales_id:s,snapshot_date:n.toISOString().split("T")[0]},sort:{field:"id",order:"DESC"},pagination:{page:1,perPage:1}})]),y=t(e=>"fulfilled"===e.status&&e.value.total||0,"getCount"),O=y(g),w=y(S),N=y(f),C=y(j),M=y(v),P=y(b),I=y(x);let L=I;if("fulfilled"===k.status){const e=k.value.data?.[0];e&&"number"==typeof e.open_opportunities_count&&(L=e.open_opportunities_count)}[g,f,v,x].forEach((e,t)=>{e.status}),u({activitiesThisWeek:_(O,w),tasksCompleted:_(N,C),dealsMoved:_(M,P),openOpportunities:_(I,L)})}catch(i){h(i)}finally{m(!1)}}},"fetchMetrics")()},[e,s,r,v]);return{metrics:o,loading:g,error:f,refetch:t(()=>{x(e=>e+1)},"refetch")}}t(b,"useMyPerformance");const k={activitiesThisWeek:{icon:f,label:"Activities This Week",shortLabel:"Activities"},dealsMoved:{icon:m,label:"Deals Moved",shortLabel:"Deals Moved"},tasksCompleted:{icon:g,label:"Tasks Completed",shortLabel:"Tasks Done"},openOpportunities:{icon:u,label:"Open Opportunities",shortLabel:"Open Opps"}};function y({type:e,metric:t,loading:i}){const a=k[e],n=a.icon;if(i)return s.jsxs("div",{className:"flex items-center gap-3 p-3","aria-busy":"true",children:[s.jsx(r,{className:"h-9 w-9 rounded-lg shrink-0"}),s.jsxs("div",{className:"flex-1 space-y-1.5",children:[s.jsx(r,{className:"h-3 w-16"}),s.jsx(r,{className:"h-5 w-12"})]})]});const l="up"===t.direction?h:"down"===t.direction?v:x,d="up"===t.direction?"text-success":"down"===t.direction?"text-destructive":"text-muted-foreground";return s.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-muted/50 transition-colors",role:"group","aria-label":`${a.label}: ${t.value}`,children:[s.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-lg bg-primary/10 text-primary shrink-0",children:s.jsx(n,{className:"h-4 w-4","aria-hidden":"true"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-xs text-muted-foreground truncate",children:a.shortLabel}),s.jsxs("div",{className:"flex items-center gap-1.5",children:[s.jsx("span",{className:"text-lg font-semibold text-foreground",children:t.value.toLocaleString()}),(t.previousValue>0||t.value>0)&&s.jsxs("span",{className:o("flex items-center text-xs font-medium",d),"aria-label":`${"up"===t.direction?"increased":"down"===t.direction?"decreased":"unchanged"} by ${Math.abs(t.trend)}%`,children:[s.jsx(l,{className:"h-3.5 w-3.5","aria-hidden":"true"}),"flat"!==t.direction&&s.jsxs("span",{className:"ml-0.5",children:[Math.abs(t.trend),"%"]})]})]})]})]})}function O(){const{metrics:e,loading:t}=b();return s.jsxs("div",{className:"p-4","data-tutorial":"dashboard-performance-widget",children:[s.jsx("div",{className:"mb-3",children:s.jsx("h3",{className:"text-base font-semibold",children:"My Performance"})}),s.jsxs("div",{className:"grid grid-cols-2 gap-1",role:"region","aria-label":"Personal performance metrics",children:[s.jsx(y,{type:"activitiesThisWeek",metric:e.activitiesThisWeek,loading:t}),s.jsx(y,{type:"dealsMoved",metric:e.dealsMoved,loading:t}),s.jsx(y,{type:"tasksCompleted",metric:e.tasksCompleted,loading:t}),s.jsx(y,{type:"openOpportunities",metric:e.openOpportunities,loading:t})]}),s.jsx("p",{className:"text-xs text-muted-foreground mt-3 text-center",children:"Compared to last week"})]})}t(y,"MetricCard"),t(O,"MyPerformanceWidget");export{O as MyPerformanceWidget,O as default};
