{"version":3,"file":"chunk-sbYpr125.js","sources":["../../src/atomic-crm/organizations/AuthorizationsTab.tsx"],"sourcesContent":["/**\n * AuthorizationsTab - Displays and manages principal authorizations for distributor organizations\n *\n * This tab shows which principals (food manufacturers) are authorized to sell\n * through this distributor. Part of MFB's three-party business model:\n * Principal → Distributor → Customer/Operator\n *\n * Features:\n * - List of authorized principals with status badges\n * - Add new principal authorization via dialog\n * - Remove authorization with confirmation\n * - Territory restrictions and notes display\n * - Product-level exceptions (expand to see/manage per-product overrides)\n *\n * @see docs/PRD.md Section 4.3 - Distributor Authorization Model\n */\n\nimport { useState } from \"react\";\nimport {\n  Building2,\n  Plus,\n  Trash2,\n  Calendar,\n  MapPin,\n  FileText,\n  ChevronDown,\n  ChevronRight,\n  Package,\n  AlertTriangle,\n  Check,\n  X,\n} from \"lucide-react\";\nimport type { RaRecord } from \"react-admin\";\nimport {\n  useGetList,\n  useCreate,\n  useDelete,\n  useNotify,\n  useRefresh,\n  useGetIdentity,\n} from \"react-admin\";\nimport { format } from \"date-fns\";\nimport { parseDateSafely } from \"@/lib/date-utils\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogCancel,\n  AlertDialogAction,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport type { TabComponentProps } from \"@/components/layouts/ResourceSlideOver\";\n\n// =====================================================\n// Types\n// =====================================================\n\ninterface AuthorizationsTabProps extends Partial<TabComponentProps> {\n  /** For standalone use outside slide-over */\n  distributorId?: string | number;\n}\n\ninterface PrincipalOrganization extends RaRecord {\n  name: string;\n  organization_type: string;\n}\n\ninterface Product extends RaRecord {\n  id: number;\n  name: string;\n  sku: string;\n  principal_id: number;\n  category?: string;\n  status?: string;\n}\n\ninterface AuthorizationWithPrincipal extends RaRecord {\n  id: number;\n  distributor_id: number;\n  principal_id: number;\n  is_authorized: boolean;\n  authorization_date: string | null;\n  expiration_date: string | null;\n  territory_restrictions: string[] | null;\n  notes: string | null;\n  created_at: string;\n  principal?: PrincipalOrganization;\n}\n\ninterface ProductAuthorization extends RaRecord {\n  id: number;\n  product_id: number;\n  distributor_id: number;\n  is_authorized: boolean;\n  authorization_date: string | null;\n  expiration_date: string | null;\n  territory_restrictions: string[] | null;\n  notes: string | null;\n  special_pricing: Record<string, unknown> | null;\n  created_at: string;\n}\n\n// =====================================================\n// Main Component\n// =====================================================\n\nexport function AuthorizationsTab({\n  record,\n  distributorId: propDistributorId,\n  isActiveTab = true,\n}: AuthorizationsTabProps) {\n  // Support both slide-over usage (record prop) and standalone usage (distributorId prop)\n  const distributorId = record?.id ?? propDistributorId;\n\n  const [addDialogOpen, setAddDialogOpen] = useState(false);\n  const [removeAuth, setRemoveAuth] = useState<AuthorizationWithPrincipal | null>(null);\n  const refresh = useRefresh();\n\n  // Fetch authorizations for this distributor (only when tab is active)\n  const {\n    data: authorizations,\n    isPending,\n    error,\n  } = useGetList<AuthorizationWithPrincipal>(\n    \"distributor_principal_authorizations\",\n    {\n      filter: { distributor_id: distributorId, deleted_at: null },\n      sort: { field: \"created_at\", order: \"DESC\" },\n      pagination: { page: 1, perPage: 100 },\n    },\n    { enabled: isActiveTab && !!distributorId }\n  );\n\n  // Fetch principal organizations for the add dialog\n  const { data: principals } = useGetList<PrincipalOrganization>(\n    \"organizations\",\n    {\n      filter: { organization_type: \"principal\", deleted_at: null },\n      sort: { field: \"name\", order: \"ASC\" },\n      pagination: { page: 1, perPage: 200 },\n    },\n    { enabled: isActiveTab && addDialogOpen }\n  );\n\n  // Get list of already authorized principal IDs\n  const authorizedPrincipalIds = new Set(authorizations?.map((a) => a.principal_id) || []);\n\n  // Filter available principals (not already authorized)\n  const availablePrincipals = principals?.filter((p) => !authorizedPrincipalIds.has(Number(p.id)));\n\n  if (!distributorId) {\n    return <div className=\"text-center py-8 text-muted-foreground\">No distributor selected</div>;\n  }\n\n  if (isPending) {\n    return (\n      <div className=\"space-y-4\">\n        {[1, 2, 3].map((i) => (\n          <div key={i} className=\"p-4 border border-border rounded-lg\">\n            <Skeleton className=\"h-4 w-32 mb-2\" />\n            <Skeleton className=\"h-3 w-full mb-1\" />\n            <Skeleton className=\"h-3 w-3/4\" />\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  if (error) {\n    return <div className=\"text-center py-8 text-destructive\">Failed to load authorizations</div>;\n  }\n\n  const authorizationsList = authorizations || [];\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Header with Add button */}\n      <div className=\"flex justify-between items-center\">\n        <p className=\"text-sm text-muted-foreground\">\n          {authorizationsList.length === 0\n            ? \"No authorized principals\"\n            : `${authorizationsList.length} authorized principal${authorizationsList.length !== 1 ? \"s\" : \"\"}`}\n        </p>\n        <Button variant=\"outline\" size=\"sm\" onClick={() => setAddDialogOpen(true)} className=\"h-11\">\n          <Plus className=\"h-4 w-4 mr-1\" />\n          Add Principal\n        </Button>\n      </div>\n\n      {/* Authorizations List */}\n      {authorizationsList.length === 0 ? (\n        <EmptyState onAddClick={() => setAddDialogOpen(true)} />\n      ) : (\n        <div className=\"space-y-3\">\n          {authorizationsList.map((auth) => (\n            <AuthorizationCard\n              key={auth.id}\n              authorization={auth}\n              distributorId={Number(distributorId)}\n              onRemove={() => setRemoveAuth(auth)}\n            />\n          ))}\n        </div>\n      )}\n\n      {/* Add Principal Dialog */}\n      <AddPrincipalDialog\n        open={addDialogOpen}\n        onOpenChange={setAddDialogOpen}\n        distributorId={distributorId}\n        availablePrincipals={availablePrincipals || []}\n        onSuccess={() => {\n          refresh();\n          setAddDialogOpen(false);\n        }}\n      />\n\n      {/* Remove Confirmation Dialog */}\n      <RemoveAuthorizationDialog\n        authorization={removeAuth}\n        onClose={() => setRemoveAuth(null)}\n        onSuccess={() => {\n          refresh();\n          setRemoveAuth(null);\n        }}\n      />\n    </div>\n  );\n}\n\n// =====================================================\n// Empty State\n// =====================================================\n\nfunction EmptyState({ onAddClick }: { onAddClick: () => void }) {\n  return (\n    <div className=\"text-center py-12 border border-dashed border-border rounded-lg\">\n      <Building2 className=\"h-12 w-12 mx-auto text-muted-foreground/50 mb-4\" />\n      <h3 className=\"text-lg font-medium mb-2\">No Authorized Principals</h3>\n      <p className=\"text-sm text-muted-foreground mb-4\">\n        Add principals that are authorized to sell through this distributor.\n      </p>\n      <Button variant=\"outline\" onClick={onAddClick} className=\"h-11\">\n        <Plus className=\"h-4 w-4 mr-1\" />\n        Add First Principal\n      </Button>\n    </div>\n  );\n}\n\n// =====================================================\n// Authorization Card (with expandable product exceptions)\n// =====================================================\n\ninterface AuthorizationCardProps {\n  authorization: AuthorizationWithPrincipal;\n  distributorId: number;\n  onRemove: () => void;\n}\n\nfunction AuthorizationCard({ authorization, distributorId, onRemove }: AuthorizationCardProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  // Fetch the principal name since it's not joined\n  const { data: principal } = useGetList<PrincipalOrganization>(\"organizations\", {\n    filter: { id: authorization.principal_id },\n    pagination: { page: 1, perPage: 1 },\n  });\n\n  // Fetch product-level exceptions for this principal/distributor combo\n  const { data: productAuths, isPending: productAuthsLoading } = useGetList<ProductAuthorization>(\n    \"product_distributor_authorizations\",\n    {\n      filter: { distributor_id: distributorId, deleted_at: null },\n      sort: { field: \"created_at\", order: \"DESC\" },\n      pagination: { page: 1, perPage: 50 },\n    },\n    { enabled: isExpanded }\n  );\n\n  // Fetch products for this principal to show exceptions\n  const { data: principalProducts } = useGetList<Product>(\n    \"products\",\n    {\n      filter: { principal_id: authorization.principal_id, deleted_at: null },\n      sort: { field: \"name\", order: \"ASC\" },\n      pagination: { page: 1, perPage: 100 },\n    },\n    { enabled: isExpanded }\n  );\n\n  const principalName = principal?.[0]?.name || `Principal #${authorization.principal_id}`;\n  const expirationDate = authorization.expiration_date\n    ? parseDateSafely(authorization.expiration_date)\n    : null;\n  const isExpired = expirationDate && expirationDate < new Date();\n  const isActive = authorization.is_authorized && !isExpired;\n\n  // Filter product authorizations for this principal's products\n  const principalProductIds = new Set(principalProducts?.map((p) => Number(p.id)) || []);\n  const relevantProductAuths =\n    productAuths?.filter((pa) => principalProductIds.has(pa.product_id)) || [];\n\n  // Count exceptions (products with different authorization than principal-level)\n  const exceptionCount = relevantProductAuths.length;\n\n  return (\n    <Collapsible open={isExpanded} onOpenChange={setIsExpanded}>\n      <div className=\"border border-border rounded-lg hover:bg-muted/50 transition-colors\">\n        {/* Main Card Content */}\n        <div className=\"flex gap-4 p-4\">\n          {/* Expand/Collapse Trigger */}\n          <CollapsibleTrigger asChild>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"h-11 w-11 p-0 flex-shrink-0 mt-0.5\"\n              aria-label={isExpanded ? \"Collapse product exceptions\" : \"Expand product exceptions\"}\n            >\n              {isExpanded ? (\n                <ChevronDown className=\"h-4 w-4\" />\n              ) : (\n                <ChevronRight className=\"h-4 w-4\" />\n              )}\n            </Button>\n          </CollapsibleTrigger>\n\n          {/* Icon */}\n          <div className=\"flex-shrink-0 mt-1\">\n            <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center\">\n              <Building2 className=\"h-5 w-5 text-primary\" />\n            </div>\n          </div>\n\n          {/* Content */}\n          <div className=\"flex-1 min-w-0\">\n            {/* Header */}\n            <div className=\"flex items-start justify-between mb-1\">\n              <div className=\"flex items-center gap-2 flex-wrap\">\n                <span className=\"font-medium\">{principalName}</span>\n                <Badge variant={isActive ? \"default\" : \"secondary\"}>\n                  {isActive ? \"Active\" : isExpired ? \"Expired\" : \"Inactive\"}\n                </Badge>\n                {exceptionCount > 0 && (\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    <Package className=\"h-3 w-3 mr-1\" />\n                    {exceptionCount} exception{exceptionCount !== 1 ? \"s\" : \"\"}\n                  </Badge>\n                )}\n              </div>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                className=\"h-11 w-11 p-0 text-muted-foreground hover:text-destructive\"\n                onClick={onRemove}\n                title=\"Remove authorization\"\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            </div>\n\n            {/* Details */}\n            <div className=\"flex flex-wrap items-center gap-4 text-sm text-muted-foreground mt-2\">\n              {authorization.authorization_date && (\n                <div className=\"flex items-center gap-1\">\n                  <Calendar className=\"h-3.5 w-3.5\" />\n                  <span>\n                    Since{\" \"}\n                    {format(\n                      parseDateSafely(authorization.authorization_date) ?? new Date(),\n                      \"MMM d, yyyy\"\n                    )}\n                  </span>\n                </div>\n              )}\n              {authorization.expiration_date && expirationDate && (\n                <div className=\"flex items-center gap-1\">\n                  <Calendar className=\"h-3.5 w-3.5\" />\n                  <span className={isExpired ? \"text-destructive\" : \"\"}>\n                    {isExpired ? \"Expired\" : \"Expires\"} {format(expirationDate, \"MMM d, yyyy\")}\n                  </span>\n                </div>\n              )}\n              {authorization.territory_restrictions &&\n                authorization.territory_restrictions.length > 0 && (\n                  <div className=\"flex items-center gap-1\">\n                    <MapPin className=\"h-3.5 w-3.5\" />\n                    <span>{authorization.territory_restrictions.join(\", \")}</span>\n                  </div>\n                )}\n            </div>\n\n            {/* Notes */}\n            {authorization.notes && (\n              <div className=\"flex items-start gap-1 mt-2 text-sm\">\n                <FileText className=\"h-3.5 w-3.5 mt-0.5 text-muted-foreground\" />\n                <span className=\"text-foreground/80\">{authorization.notes}</span>\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Expandable Product Exceptions Section */}\n        <CollapsibleContent>\n          <ProductExceptionsSection\n            authorization={authorization}\n            distributorId={distributorId}\n            products={principalProducts || []}\n            productAuths={relevantProductAuths}\n            isLoading={productAuthsLoading}\n          />\n        </CollapsibleContent>\n      </div>\n    </Collapsible>\n  );\n}\n\n// =====================================================\n// Product Exceptions Section (within expanded card)\n// =====================================================\n\ninterface ProductExceptionsSectionProps {\n  authorization: AuthorizationWithPrincipal;\n  distributorId: number;\n  products: Product[];\n  productAuths: ProductAuthorization[];\n  isLoading: boolean;\n}\n\nfunction ProductExceptionsSection({\n  authorization,\n  distributorId,\n  products,\n  productAuths,\n  isLoading,\n}: ProductExceptionsSectionProps) {\n  const [addExceptionOpen, setAddExceptionOpen] = useState(false);\n  const [removeException, setRemoveException] = useState<ProductAuthorization | null>(null);\n  const refresh = useRefresh();\n\n  // Map product IDs to their authorizations\n  const productAuthMap = new Map(productAuths.map((pa) => [pa.product_id, pa]));\n\n  // Products with explicit exceptions\n  const productsWithExceptions = products.filter((p) => productAuthMap.has(Number(p.id)));\n\n  // Products available to add exceptions (not already overridden)\n  const productsWithoutExceptions = products.filter((p) => !productAuthMap.has(Number(p.id)));\n\n  if (isLoading) {\n    return (\n      <div className=\"border-t border-border p-4 bg-muted/30\">\n        <Skeleton className=\"h-4 w-48 mb-2\" />\n        <Skeleton className=\"h-3 w-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"border-t border-border p-4 bg-muted/30\">\n      <div className=\"flex justify-between items-center mb-3\">\n        <h4 className=\"text-sm font-medium flex items-center gap-2\">\n          <Package className=\"h-4 w-4\" />\n          Product Exceptions\n        </h4>\n        {productsWithoutExceptions.length > 0 && (\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setAddExceptionOpen(true)}\n            className=\"h-11 text-xs\"\n          >\n            <Plus className=\"h-4 w-4 mr-1\" />\n            Add Exception\n          </Button>\n        )}\n      </div>\n\n      {products.length === 0 ? (\n        <p className=\"text-sm text-muted-foreground\">No products found for this principal.</p>\n      ) : productsWithExceptions.length === 0 ? (\n        <p className=\"text-sm text-muted-foreground\">\n          All {products.length} product{products.length !== 1 ? \"s\" : \"\"} inherit the\n          principal-level authorization.\n          {productsWithoutExceptions.length > 0 &&\n            \" Add an exception to override for specific products.\"}\n        </p>\n      ) : (\n        <div className=\"space-y-2\">\n          {productsWithExceptions.map((product) => {\n            const productAuth = productAuthMap.get(Number(product.id))!;\n            const isAuthorized = productAuth.is_authorized;\n            const expirationDate = productAuth.expiration_date\n              ? parseDateSafely(productAuth.expiration_date)\n              : null;\n            const isExceptionExpired = expirationDate && expirationDate < new Date();\n\n            return (\n              <div\n                key={product.id}\n                className=\"flex items-center justify-between p-3 bg-background rounded border border-border\"\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div\n                    className={`w-8 h-8 rounded flex items-center justify-center ${\n                      isAuthorized && !isExceptionExpired\n                        ? \"bg-success/10 text-success\"\n                        : \"bg-destructive/10 text-destructive\"\n                    }`}\n                  >\n                    {isAuthorized && !isExceptionExpired ? (\n                      <Check className=\"h-4 w-4\" />\n                    ) : (\n                      <X className=\"h-4 w-4\" />\n                    )}\n                  </div>\n                  <div>\n                    <span className=\"text-sm font-medium\">{product.name}</span>\n                    <span className=\"text-xs text-muted-foreground ml-2\">({product.sku})</span>\n                    {isExceptionExpired && (\n                      <Badge\n                        variant=\"outline\"\n                        className=\"ml-2 text-xs text-destructive border-destructive\"\n                      >\n                        Expired\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <Badge variant={isAuthorized ? \"default\" : \"destructive\"} className=\"text-xs\">\n                    {isAuthorized ? \"Authorized\" : \"Not Authorized\"}\n                  </Badge>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    className=\"h-11 w-11 p-0 text-muted-foreground hover:text-destructive\"\n                    onClick={() => setRemoveException(productAuth)}\n                    title=\"Remove exception\"\n                  >\n                    <Trash2 className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Add Product Exception Dialog */}\n      <AddProductExceptionDialog\n        open={addExceptionOpen}\n        onOpenChange={setAddExceptionOpen}\n        distributorId={distributorId}\n        availableProducts={productsWithoutExceptions}\n        inheritedAuthorization={authorization.is_authorized}\n        onSuccess={() => {\n          refresh();\n          setAddExceptionOpen(false);\n        }}\n      />\n\n      {/* Remove Product Exception Dialog */}\n      <RemoveProductExceptionDialog\n        productAuth={removeException}\n        products={products}\n        onClose={() => setRemoveException(null)}\n        onSuccess={() => {\n          refresh();\n          setRemoveException(null);\n        }}\n      />\n    </div>\n  );\n}\n\n// =====================================================\n// Add Principal Dialog\n// =====================================================\n\ninterface AddPrincipalDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  distributorId: string | number;\n  availablePrincipals: PrincipalOrganization[];\n  onSuccess: () => void;\n}\n\nfunction AddPrincipalDialog({\n  open,\n  onOpenChange,\n  distributorId,\n  availablePrincipals,\n  onSuccess,\n}: AddPrincipalDialogProps) {\n  const [selectedPrincipalId, setSelectedPrincipalId] = useState<string>(\"\");\n  const [notes, setNotes] = useState(\"\");\n  const [create, { isPending }] = useCreate();\n  const notify = useNotify();\n  const { data: identity } = useGetIdentity();\n\n  const handleSubmit = async () => {\n    if (!selectedPrincipalId) {\n      notify(\"Please select a principal\", { type: \"warning\" });\n      return;\n    }\n\n    try {\n      await create(\n        \"distributor_principal_authorizations\",\n        {\n          data: {\n            distributor_id: Number(distributorId),\n            principal_id: Number(selectedPrincipalId),\n            is_authorized: true,\n            authorization_date: new Date().toISOString().split(\"T\")[0],\n            notes: notes.trim() || null,\n            created_by: identity?.id,\n          },\n        },\n        { returnPromise: true }\n      );\n\n      notify(\"Principal authorization added\", { type: \"success\" });\n      setSelectedPrincipalId(\"\");\n      setNotes(\"\");\n      onSuccess();\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : \"Failed to add authorization\";\n      notify(errorMessage, { type: \"error\" });\n    }\n  };\n\n  const handleClose = () => {\n    setSelectedPrincipalId(\"\");\n    setNotes(\"\");\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Add Authorized Principal</DialogTitle>\n          <DialogDescription>\n            Select a principal to authorize for selling through this distributor.\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 py-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"principal\">Principal</Label>\n            <Select value={selectedPrincipalId} onValueChange={setSelectedPrincipalId}>\n              <SelectTrigger id=\"principal\" className=\"h-11\">\n                <SelectValue placeholder=\"Select a principal...\" />\n              </SelectTrigger>\n              <SelectContent>\n                {availablePrincipals.length === 0 ? (\n                  <SelectItem value=\"\" disabled>\n                    No principals available\n                  </SelectItem>\n                ) : (\n                  availablePrincipals.map((principal) => (\n                    <SelectItem key={principal.id} value={String(principal.id)}>\n                      {principal.name}\n                    </SelectItem>\n                  ))\n                )}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"notes\">Notes (optional)</Label>\n            <Textarea\n              id=\"notes\"\n              placeholder=\"Add any notes about this authorization...\"\n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n              rows={3}\n            />\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={handleClose} className=\"h-11\">\n            Cancel\n          </Button>\n          <Button\n            onClick={handleSubmit}\n            disabled={isPending || !selectedPrincipalId}\n            className=\"h-11\"\n          >\n            {isPending ? \"Adding...\" : \"Add Authorization\"}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// =====================================================\n// Add Product Exception Dialog\n// =====================================================\n\ninterface AddProductExceptionDialogProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  distributorId: number;\n  availableProducts: Product[];\n  inheritedAuthorization: boolean;\n  onSuccess: () => void;\n}\n\nfunction AddProductExceptionDialog({\n  open,\n  onOpenChange,\n  distributorId,\n  availableProducts,\n  inheritedAuthorization,\n  onSuccess,\n}: AddProductExceptionDialogProps) {\n  const [selectedProductId, setSelectedProductId] = useState<string>(\"\");\n  const [isAuthorized, setIsAuthorized] = useState<string>(\"false\"); // Override to NOT authorized by default\n  const [notes, setNotes] = useState(\"\");\n  const [create, { isPending }] = useCreate();\n  const notify = useNotify();\n  const { data: identity } = useGetIdentity();\n\n  const handleSubmit = async () => {\n    if (!selectedProductId) {\n      notify(\"Please select a product\", { type: \"warning\" });\n      return;\n    }\n\n    try {\n      await create(\n        \"product_distributor_authorizations\",\n        {\n          data: {\n            product_id: Number(selectedProductId),\n            distributor_id: distributorId,\n            is_authorized: isAuthorized === \"true\",\n            authorization_date: new Date().toISOString().split(\"T\")[0],\n            notes: notes.trim() || null,\n            created_by: identity?.id,\n          },\n        },\n        { returnPromise: true }\n      );\n\n      notify(\"Product exception added\", { type: \"success\" });\n      setSelectedProductId(\"\");\n      setIsAuthorized(\"false\");\n      setNotes(\"\");\n      onSuccess();\n    } catch (error: unknown) {\n      const errorMessage =\n        error instanceof Error ? error.message : \"Failed to add product exception\";\n      notify(errorMessage, { type: \"error\" });\n    }\n  };\n\n  const handleClose = () => {\n    setSelectedProductId(\"\");\n    setIsAuthorized(\"false\");\n    setNotes(\"\");\n    onOpenChange(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Add Product Exception</DialogTitle>\n          <DialogDescription>\n            Override the principal-level authorization for a specific product. Currently, products\n            inherit:{\" \"}\n            <Badge\n              variant={inheritedAuthorization ? \"default\" : \"destructive\"}\n              className=\"ml-1 text-xs\"\n            >\n              {inheritedAuthorization ? \"Authorized\" : \"Not Authorized\"}\n            </Badge>\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 py-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"product\">Product</Label>\n            <Select value={selectedProductId} onValueChange={setSelectedProductId}>\n              <SelectTrigger id=\"product\" className=\"h-11\">\n                <SelectValue placeholder=\"Select a product...\" />\n              </SelectTrigger>\n              <SelectContent>\n                {availableProducts.length === 0 ? (\n                  <SelectItem value=\"\" disabled>\n                    No products available\n                  </SelectItem>\n                ) : (\n                  availableProducts.map((product) => (\n                    <SelectItem key={product.id} value={String(product.id)}>\n                      {product.name} ({product.sku})\n                    </SelectItem>\n                  ))\n                )}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"authorization-status\">Exception Status</Label>\n            <Select value={isAuthorized} onValueChange={setIsAuthorized}>\n              <SelectTrigger id=\"authorization-status\" className=\"h-11\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"true\">\n                  <span className=\"flex items-center gap-2\">\n                    <Check className=\"h-4 w-4 text-success\" />\n                    Authorized (Override to Allow)\n                  </span>\n                </SelectItem>\n                <SelectItem value=\"false\">\n                  <span className=\"flex items-center gap-2\">\n                    <X className=\"h-4 w-4 text-destructive\" />\n                    Not Authorized (Override to Block)\n                  </span>\n                </SelectItem>\n              </SelectContent>\n            </Select>\n            <p className=\"text-xs text-muted-foreground\">\n              <AlertTriangle className=\"h-3 w-3 inline mr-1\" />\n              This overrides the principal-level setting for this specific product only.\n            </p>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"exception-notes\">Notes (optional)</Label>\n            <Textarea\n              id=\"exception-notes\"\n              placeholder=\"Reason for this exception...\"\n              value={notes}\n              onChange={(e) => setNotes(e.target.value)}\n              rows={2}\n            />\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button variant=\"outline\" onClick={handleClose} className=\"h-11\">\n            Cancel\n          </Button>\n          <Button\n            onClick={handleSubmit}\n            disabled={isPending || !selectedProductId}\n            className=\"h-11\"\n          >\n            {isPending ? \"Adding...\" : \"Add Exception\"}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// =====================================================\n// Remove Authorization Dialog\n// =====================================================\n\ninterface RemoveAuthorizationDialogProps {\n  authorization: AuthorizationWithPrincipal | null;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nfunction RemoveAuthorizationDialog({\n  authorization,\n  onClose,\n  onSuccess,\n}: RemoveAuthorizationDialogProps) {\n  const [deleteOne, { isPending }] = useDelete();\n  const notify = useNotify();\n\n  // Fetch principal name for display\n  const { data: principal } = useGetList<PrincipalOrganization>(\n    \"organizations\",\n    {\n      filter: authorization ? { id: authorization.principal_id } : {},\n      pagination: { page: 1, perPage: 1 },\n    },\n    { enabled: !!authorization }\n  );\n\n  const principalName =\n    principal?.[0]?.name || (authorization ? `Principal #${authorization.principal_id}` : \"\");\n\n  const handleConfirm = async () => {\n    if (!authorization) return;\n\n    try {\n      await deleteOne(\n        \"distributor_principal_authorizations\",\n        { id: authorization.id },\n        {\n          onSuccess: () => {\n            notify(`Removed authorization for ${principalName}`, { type: \"success\" });\n            onSuccess();\n          },\n          onError: (error: unknown) => {\n            const errorMessage =\n              error instanceof Error ? error.message : \"Failed to remove authorization\";\n            notify(errorMessage, { type: \"error\" });\n          },\n        }\n      );\n    } catch {\n      notify(\"Failed to remove authorization. Please try again.\", { type: \"error\" });\n    }\n  };\n\n  return (\n    <AlertDialog open={!!authorization} onOpenChange={onClose}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>Remove Principal Authorization?</AlertDialogTitle>\n          <AlertDialogDescription>\n            Remove authorization for <strong>{principalName}</strong>? This distributor will no\n            longer be able to carry products from this principal.\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel className=\"h-11\">Cancel</AlertDialogCancel>\n          <AlertDialogAction\n            onClick={handleConfirm}\n            disabled={isPending}\n            className=\"h-11 bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n          >\n            {isPending ? \"Removing...\" : \"Remove\"}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n\n// =====================================================\n// Remove Product Exception Dialog\n// =====================================================\n\ninterface RemoveProductExceptionDialogProps {\n  productAuth: ProductAuthorization | null;\n  products: Product[];\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nfunction RemoveProductExceptionDialog({\n  productAuth,\n  products,\n  onClose,\n  onSuccess,\n}: RemoveProductExceptionDialogProps) {\n  const [deleteOne, { isPending }] = useDelete();\n  const notify = useNotify();\n\n  const product = products.find((p) => Number(p.id) === productAuth?.product_id);\n  const productName = product?.name || (productAuth ? `Product #${productAuth.product_id}` : \"\");\n\n  const handleConfirm = async () => {\n    if (!productAuth) return;\n\n    try {\n      await deleteOne(\n        \"product_distributor_authorizations\",\n        { id: productAuth.id },\n        {\n          onSuccess: () => {\n            notify(`Removed exception for ${productName}`, { type: \"success\" });\n            onSuccess();\n          },\n          onError: (error: unknown) => {\n            const errorMessage =\n              error instanceof Error ? error.message : \"Failed to remove exception\";\n            notify(errorMessage, { type: \"error\" });\n          },\n        }\n      );\n    } catch {\n      notify(\"Failed to remove exception. Please try again.\", { type: \"error\" });\n    }\n  };\n\n  return (\n    <AlertDialog open={!!productAuth} onOpenChange={onClose}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>Remove Product Exception?</AlertDialogTitle>\n          <AlertDialogDescription>\n            Remove the exception for <strong>{productName}</strong>? This product will revert to the\n            principal-level authorization setting.\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel className=\"h-11\">Cancel</AlertDialogCancel>\n          <AlertDialogAction\n            onClick={handleConfirm}\n            disabled={isPending}\n            className=\"h-11 bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n          >\n            {isPending ? \"Removing...\" : \"Remove Exception\"}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n\nexport default AuthorizationsTab;\n"],"names":["AuthorizationsTab","record","distributorId","propDistributorId","isActiveTab","id","addDialogOpen","setAddDialogOpen","useState","removeAuth","setRemoveAuth","refresh","useRefresh","data","authorizations","isPending","error","useGetList","filter","distributor_id","deleted_at","sort","field","order","pagination","page","perPage","enabled","principals","organization_type","authorizedPrincipalIds","Set","map","a","principal_id","availablePrincipals","p","has","Number","jsx","className","children","i","jsxs","Skeleton","authorizationsList","length","Button","variant","size","onClick","__name","Plus","EmptyState","onAddClick","auth","AuthorizationCard","authorization","onRemove","AddPrincipalDialog","open","onOpenChange","onSuccess","RemoveAuthorizationDialog","onClose","Building2","isExpanded","setIsExpanded","principal","productAuths","productAuthsLoading","principalProducts","principalName","name","expirationDate","expiration_date","parseDateSafely","isExpired","Date","isActive","is_authorized","principalProductIds","relevantProductAuths","pa","product_id","exceptionCount","Collapsible","CollapsibleTrigger","asChild","ChevronDown","ChevronRight","Badge","Package","title","Trash2","authorization_date","Calendar","format","territory_restrictions","MapPin","join","notes","FileText","CollapsibleContent","ProductExceptionsSection","products","isLoading","addExceptionOpen","setAddExceptionOpen","removeException","setRemoveException","productAuthMap","Map","productsWithExceptions","productsWithoutExceptions","product","productAuth","get","isAuthorized","isExceptionExpired","Check","X","sku","AddProductExceptionDialog","availableProducts","inheritedAuthorization","RemoveProductExceptionDialog","selectedPrincipalId","setSelectedPrincipalId","setNotes","create","useCreate","notify","useNotify","identity","useGetIdentity","handleSubmit","async","toISOString","split","trim","created_by","returnPromise","type","errorMessage","Error","message","handleClose","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","Label","htmlFor","Select","value","onValueChange","SelectTrigger","SelectValue","placeholder","SelectContent","SelectItem","disabled","String","Textarea","onChange","e","target","rows","DialogFooter","selectedProductId","setSelectedProductId","setIsAuthorized","AlertTriangle","deleteOne","useDelete","handleConfirm","onError","AlertDialog","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","find","productName"],"mappings":"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"}