var e=Object.defineProperty,s=(s,t)=>e(s,"name",{value:t,configurable:!0});import{i as t,P as a,j as n,l as r,G as i,H as l,aj as o,aw as c,_ as d,w as m,J as u,ak as h,U as p,al as x,W as g,u as f,Q as j,am as w,an as v}from"./chunk-ByJg_QQB.js";import{B as N}from"./chunk-BndLoydo.js";import{C as _,S as C,L as b,E as y}from"./chunk-BBQ6yJWi.js";import{S as k}from"./chunk-DDhuYt5_.js";import{C as S,u as z,c as I,F as R,b as T}from"./chunk-C8K6x_Yi.js";import{v as P,S as E,F as O}from"./chunk-A2EVsQEK.js";import{P as F}from"./chunk-CKWniV73.js";import{y as A,q as D,C as M,b as L,c as W,z as $,a as V,d as U,i as B,j as q,k as G,m as Q,n as H,L as J,p as K,B as Y,E as X,D as Z,e as ee,f as se,g as te,h as ae,F as ne,G as re,s as ie,H as le,I as oe,J as ce,K as de,r as me,S as ue,Q as he}from"../assets/index-BoLku8RR.js";import{R as pe}from"./chunk-DbeoRBEW.js";import{D as xe}from"./chunk-DkiUngdk.js";import{R as ge,u as fe}from"./chunk-a4jA-31v.js";import{r as je,L as we}from"./chunk-1NZFT-6z.js";import"./chunk-CFj7NhUg.js";import{u as ve}from"./chunk-CfuGOU5i.js";import{A as Ne,a as _e,b as Ce}from"./chunk-IswQf-N3.js";import{P as be}from"./chunk-ChZ4Kv6b.js";import{r as ye,u as ke}from"./chunk-CRKBdUTG.js";import{s as Se,v as ze,g as Ie}from"./chunk-BnJ5ohE_.js";import{r as Re}from"./chunk-JxeXaC9i.js";import{C as Te}from"./chunk-Dn-NAOCt.js";import{T as Pe,a as Ee,b as Oe,c as Fe,d as Ae,e as De}from"./chunk-D_rprtX5.js";import{C as Me,a as Le,b as We}from"./chunk-DsNwAyt-.js";import{T as $e,v as Ve,F as Ue,k as Be,a4 as qe,W as Ge,ae as Qe,q as He,p as Je,af as Ke,ag as Ye,X as Xe,ah as Ze,ai as es,aa as ss,m as ts,x as as,f as ns,aj as rs,U as is,z as ls,ad as os,ac as cs,a5 as ds,a as ms,J as us}from"./chunk-Bc6KM1xM.js";import{F as hs,T as ps}from"./chunk-C6dCzd_-.js";import{g as xs,S as gs}from"./chunk-B_VTrDwS.js";import{e as fs,s as js,g as ws,h as vs,j as Ns,k as _s,l as Cs,d as bs}from"./chunk-DwAffUXc.js";import{A as ys,E as ks}from"./chunk-l1wHq9zq.js";import{A as Ss}from"./chunk-BY7AmvEs.js";import{S as zs}from"./chunk-j7Lqvg-1.js";import{C as Is}from"./chunk-B8xrZQJc.js";import{A as Rs}from"./chunk-B9H_70fs.js";import{R as Ts}from"./chunk-Sp4WOLwD.js";import{N as Ps}from"./chunk-D2aCv_Ah.js";import{A as Es,a as Os}from"./chunk-B8iwsXIk.js";import{T as Fs}from"./chunk-BtJ7Qrct.js";import{f as As,a as Ds,b as Ms,c as Ls}from"./chunk-CK25VQTM.js";import{P as Ws,F as $s}from"./chunk-Nds5IV03.js";import"./chunk-Dc4zIuSl.js";import"./chunk-B1s-jt27.js";import"./chunk-knA4lag3.js";import"./chunk-Tyyhsnez.js";import"./chunk-DA1DYucv.js";import"./chunk-UKb2nn92.js";import"./chunk-XoqkUGE_.js";import"./chunk-DHnjrG--.js";import"./chunk-B5Y5c6gs.js";import"./chunk-DpghI3EP.js";import"./chunk-D6FmavVW.js";import"./chunk-nUtrHAIa.js";import"./chunk-CMQLDEz_.js";import"./chunk-C_u3nriX.js";import"./chunk-C5fZsuMg.js";import"./chunk-DhfTvo06.js";import"./chunk-C4sNritB.js";import"./chunk-sKlZvX2D.js";var Vs=ye();const Us="_full_name_split_",Bs={first_name:["first_name","first name","first","firstname","fname","given name","given_name","givenname","forename","christian name","christian_name","prenom","vorname"],last_name:["last_name","last name","last","lastname","lname","surname","family name","family_name","familyname","nom","nachname","apellido"],organization_name:["organization_name","organization name","organization","organisations","organizations","organizations (dropdown)","organisation","company","company name","company_name","companyname","business","business name","business_name","org","org name","org_name","employer","enterprise","firm","client","client name","client_name","customer","customer name","account","account name","vendor","vendor name"],organization_role:["organization_role","organization role","role","job role","job_role","position","position (dropdown)","title","job title","job_title","jobtitle","designation","function","responsibility"],email_work:["email_work","email work","work email","work_email","workemail","business email","business_email","businessemail","professional email","office email","office_email","company email","corporate email","email","e-mail","e mail","email address","email_address","emailaddress","mail","email_primary","primary email","primary_email"],email_home:["email_home","email home","home email","home_email","homeemail","personal email","personal_email","personalemail","private email","private_email","email personal","email_personal","secondary email","secondary_email","email_secondary"],email_other:["email_other","email other","other email","other_email","otheremail","alternate email","alternate_email","alternative email","additional email","additional_email","backup email","email_alternate","email alternate","email_additional","tertiary email","email_tertiary"],phone_work:["phone_work","phone work","work phone","work_phone","workphone","business phone","business_phone","businessphone","office phone","office_phone","officephone","company phone","desk phone","phone","phone number","phone_number","phonenumber","telephone","tel","mobile","mobile phone","mobile_phone","cell","cell phone","cellphone","contact number","contact_number","primary phone","phone_primary"],phone_home:["phone_home","phone home","home phone","home_phone","homephone","personal phone","personal_phone","personalphone","private phone","private_phone","residential phone","house phone","phone personal","phone_personal","secondary phone","phone_secondary"],phone_other:["phone_other","phone other","other phone","other_phone","otherphone","alternate phone","alternate_phone","alternative phone","additional phone","additional_phone","backup phone","fax","fax number","phone_alternate","phone alternate","phone_additional","tertiary phone","phone_tertiary"],title:["title","job title","job_title","jobtitle","position title","position_title","professional title","role title","designation","job position","job_position","work title"],gender:["gender","sex","gender identity","gender_identity","m/f","male/female","pronouns"],avatar:["avatar","photo","picture","profile picture","profile_picture","profile photo","profile_photo","headshot","image","image url","image_url","photo url","photo_url","avatar url","avatar_url"],first_seen:["first_seen","first seen","date added","date_added","dateadded","created","created date","created_date","creation date","added on","added_on","first contact","first_contact","initial contact"],last_seen:["last_seen","last seen","last contact","last_contact","last contacted","last_contacted","last activity","last_activity","last interaction","last_interaction","recent contact","updated","updated date","modified","modified date"],tags:["tags","tag","categories","category","labels","label","groups","group","segments","segment","keywords","keyword","classifications"],linkedin_url:["linkedin_url","linkedin url","linkedin","linkedin profile","linkedin_profile","linkedin link","linkedin_link","social media","social_media","linkedin address","li url","li_url"],notes:["notes","note","comments","comment","description","remarks","remark","memo","memos","additional info","additional_info","additional information","details","detail","observations","observation"]};function qs(e){return e&&"string"==typeof e?e.toLowerCase().trim().replace(/[^a-z0-9\s_-]/g," ").replace(/\s+/g," ").trim():""}s(qs,"normalizeHeader");const Gs=new Map;for(const[fa,ja]of Object.entries(Bs))for(const e of ja){const s=qs(e);s&&!Gs.has(s)&&Gs.set(s,fa)}const Qs=new Set(["full name","fullname","full_name","name","contact name","contact_name","contactname","person name","person_name","full name (first, last)","full name (first,last)","full name (first last)","complete name","complete_name","whole name","display name","display_name","customer name","client name","user name","username","contact","person"].map(e=>qs(e)).filter(Boolean));function Hs(e){if(!e||"string"!=typeof e)return null;const s=qs(e);return s&&Gs.get(s)||null}function Js(e){if(!e||"string"!=typeof e)return!1;const s=qs(e);return Qs.has(s)}function Ks(e){if(!Array.isArray(e))return{};const s={};for(const t of e)t&&"string"==typeof t&&(Js(t)?s[t]=Us:s[t]=Hs(t));return s}function Ys(){return Object.keys(Bs).sort()}function Xs(){const e=Ys();return[{value:Us,label:"Full Name (will be split into first + last)"},...e.map(e=>({value:e,label:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}))]}function Zs(e){if(!e||"string"!=typeof e)return{first_name:"",last_name:""};const s=e.trim().split(/\s+/);return 0===s.length||""===e.trim()?{first_name:"",last_name:""}:1===s.length?{first_name:"",last_name:s[0]}:{first_name:s[0],last_name:s.slice(1).join(" ")}}function et(e){const s=Ks(e);return e.map(e=>{if(!e)return e;return s[e]||e})}function st(e,s){const t=et(e);return s.map(s=>{const a={};return e.forEach((e,n)=>{const r=t[n],i=s[n],l=Se(i);if(r===Us){const{first_name:e,last_name:s}=Zs(l||"");a.first_name=Se(e),a.last_name=Se(s)}else a[r]=l}),a})}function tt(e,s,t){return s.map(s=>{const a={};return e.forEach((e,n)=>{const r=t[e],i=s[n],l=Se(i);if(r===Us){const{first_name:e,last_name:s}=Zs(l||"");a.first_name=Se(e),a.last_name=Se(s)}else r&&(a[r]=l)}),a})}function at(e){if(!Array.isArray(e)||e.length<4)throw new Error("CSV file is too short (less than 4 rows)");const s=e[2];return{contacts:st(s,e.slice(3)),headers:s}}function nt({batchSize:e=10,processBatch:s,onPreview:t,previewRowCount:a}){const n=je.useRef(0),[r,i]=je.useState({state:"idle"}),l=je.useCallback(()=>{i({state:"idle"}),n.current+=1},[]),o=je.useCallback(r=>{i({state:"parsing"});const l=n.current;Vs.parse(r,{header:!1,skipEmptyLines:!0,preview:a+2,async complete(r){if(n.current!==l)return;let o,c;try{const e=at(r.data);o=e.contacts,c=e.headers}catch(m){return void i({state:"error",error:m instanceof Error?m:new Error(String(m))})}if(t&&a){const e=r.data.slice(3);return t({rows:o,headers:c,rawDataRows:e}),void i({state:"idle"})}if(!s)return void i({state:"error",error:new Error("processBatch function not provided")});i({state:"running",rowCount:o.length,errorCount:r.errors.length,importCount:0,remainingTime:null});let d=0;for(let t=0;t<o.length;t+=e){const a=o.slice(t,t+e);try{const e=Date.now();await s(a);d+=Date.now()-e;const n=d/(t+a.length);i(e=>{if("running"===e.state){const s=e.importCount+a.length;return{...e,importCount:s,remainingTime:n*(o.length-s)}}return e})}catch(m){i(e=>"running"===e.state?{...e,errorCount:e.errorCount+a.length}:e)}}i(e=>"running"===e.state?{...e,state:"complete",remainingTime:null}:e)},error(e){i({state:"error",error:e})},dynamicTyping:!1})},[e,s,t,a]);return je.useMemo(()=>({importer:r,parseCsv:o,reset:l}),[r,o,l])}function rt(e){const s=e.organization_name&&String(e.organization_name).trim(),t=e.first_name&&String(e.first_name).trim(),a=e.last_name&&String(e.last_name).trim();return!(!s||t||a)}function it(e){const s=e.first_name&&String(e.first_name).trim(),t=e.last_name&&String(e.last_name).trim(),a=s||t,n=e.email_work&&String(e.email_work).trim()||e.email_home&&String(e.email_home).trim()||e.email_other&&String(e.email_other).trim(),r=e.phone_work&&String(e.phone_work).trim()||e.phone_home&&String(e.phone_home).trim()||e.phone_other&&String(e.phone_other).trim();return!(!a||n||r)}function lt(e,t={importOrganizationsWithoutContacts:!1,importContactsWithoutContactInfo:!1}){const a=new Set;return{transformedContacts:e.map((e,s)=>{const n={...e};return rt(n)&&t.importOrganizationsWithoutContacts&&(n.first_name="General",n.last_name="Contact",a.add(s)),n}),autoFilledCount:a.size,wasAutoFilled:s(e=>a.has(e),"wasAutoFilled")}}function ot(e){const s=e.map((e,s)=>{const t=A.safeParse(e);return{index:s,contact:e,success:t.success,error:t.success?null:t.error}});return{successful:s.filter(e=>e.success).map(e=>({...e.contact,originalIndex:e.index})),failed:s.filter(e=>!e.success).map(e=>({originalIndex:e.index,data:e.contact,errors:e.error.issues.map(e=>({field:e.path.join("."),message:e.message}))}))}}function ct(){const e=(new Date).toISOString(),{data:s}=t(),n=a(),r=je.useMemo(()=>new Map,[n]),i=je.useCallback(async(e,t=!1)=>t?ut(e):dt("organizations",r,e,e=>({name:e,created_at:(new Date).toISOString(),sales_id:s?.id}),n),[r,s?.id,n]),l=je.useMemo(()=>new Map,[n]),o=je.useCallback(async(e,s=!1)=>s?ht(e):dt("tags",l,e,e=>({name:e,color:"gray"}),n),[l,n]);return je.useCallback(async(t,a={})=>{const{preview:r=!1,onProgress:l,startingRow:c=1,dataQualityDecisions:d}=a,m=new Date,u=[];let h=0,p=0;const x=t.length;l&&l(0,x);const{transformedContacts:g}=lt(t,d),{successful:f,failed:j}=ot(g);j.forEach(e=>{u.push({row:c+e.originalIndex,data:e.data,errors:e.errors})});let w=f;if(!d?.importContactsWithoutContactInfo){const e=new Set;w=f.filter(s=>!it(s)||(e.add(s.originalIndex),!1)),p=e.size}const[v,N]=await Promise.all([i(w.map(e=>e.organization_name?.trim()).filter(e=>!!e),r),o(w.flatMap(e=>mt(e.tags)),r)]);(await Promise.allSettled(w.map(async(t,a)=>{const i=c+t.originalIndex,o=[],{first_name:d,last_name:m,gender:u,title:h,email_work:p,email_home:g,email_other:f,phone_work:w,phone_home:_,phone_other:C,first_seen:b,last_seen:y,organization_name:k,tags:S,linkedin_url:z,notes:I}=t,R=String(k||"").trim(),T=v.get(R);if(!R||T?.id||r||o.push({field:"organization_name",message:`Failed to find or create organization "${R}"`,value:R}),o.length>0)return{rowNumber:i,success:!1,errors:o,data:t};try{const t=[{value:p,type:"work"},{value:g,type:"home"},{value:f,type:"other"}].filter(({value:e})=>e),a=[{value:w,type:"work"},{value:_,type:"home"},{value:C,type:"other"}].filter(({value:e})=>e),l=mt(S).map(e=>N.get(e)).filter(e=>!!e),o={first_name:d,last_name:m,gender:u,title:h,email:t,phone:a,first_seen:b?D(b)?.toISOString()??e:e,last_seen:y?D(y)?.toISOString()??e:e,tags:r?[]:l.map(e=>e.id),sales_id:s?.id,linkedin_url:z,notes:I,organization_id:T?.id,avatar:void 0};return r?await n.create("contacts",{data:o,meta:{dryRun:!0}}):await n.create("contacts",{data:o}),{rowNumber:i,success:!0}}catch(P){const e=[];if(P instanceof Re)P.issues.forEach(s=>{e.push({field:s.path.join("."),message:s.message})});else if(P.body?.errors)for(const[s,t]of Object.entries(P.body.errors))e.push({field:s,message:String(t)});else e.push({field:"general",message:P.message||"Unknown error during record creation"});return{rowNumber:i,success:!1,errors:e,data:t}}finally{l&&l(a+1+j.length,x)}}))).forEach(e=>{if("fulfilled"===e.status){const s=e.value;s.success?h++:u.push({row:s.rowNumber,data:s.data,errors:s.errors})}else u.push({row:0,data:{},errors:[{field:"processing",message:e.reason?.message||"Unknown processing error"}]})});const _=new Date;return{totalProcessed:x,successCount:h,skippedCount:p,failedCount:u.length,errors:u,duration:_.getTime()-m.getTime(),startTime:m,endTime:_}},[n,i,o,s?.id,e])}s(Hs,"findCanonicalField"),s(Js,"isFullNameColumn"),s(Ks,"mapHeadersToFields"),s(Ys,"getAvailableFields"),s(Xs,"getAvailableFieldsWithLabels"),s(Zs,"splitFullName"),s(et,"transformHeaders"),s(st,"processCsvData"),s(tt,"processCsvDataWithMappings"),s(at,"parseRawCsvData"),s(nt,"usePapaParse"),s(rt,"isOrganizationOnlyEntry"),s(it,"isContactWithoutContactInfo"),s(lt,"applyDataQualityTransformations"),s(ot,"validateTransformedContacts"),s(ct,"useContactImport");const dt=s(async function(e,s,t,a,n){const r=[...new Set(t.map(e=>e.trim()))],i=r.filter(e=>!s.has(e));if(i.length>0){const t=await n.getList(e,{filter:{"name@in":`(${i.map(e=>`"${e}"`).join(",")})`},pagination:{page:1,perPage:r.length},sort:{field:"id",order:"ASC"}});for(const e of t.data)s.set(e.name.trim(),e)}return await Promise.all(i.map(async t=>{if(s.has(t))return;const r=await n.create(e,{data:a(t)});s.set(t,r.data)})),r.reduce((e,t)=>(e.set(t,s.get(t)),e),new Map)},"fetchRecordsWithCache"),mt=s(e=>e?.split(",")?.map(e=>e.trim())?.filter(e=>e)??[],"parseTags"),ut=s(async e=>{const s=[...new Set(e.map(e=>e.trim()))],t=new Map;for(const a of s)t.set(a,{id:`preview-org-${a}`,name:a,created_at:(new Date).toISOString()});return t},"validateOrganizationNames"),ht=s(async e=>{const s=[...new Set(e.map(e=>e.trim()))],t=new Map;for(const a of s)t.set(a,{id:`preview-tag-${a}`,name:a,color:"gray"});return t},"validateTagNames");function pt({preview:e,onContinue:t,onCancel:a,onRemap:r,onMappingChange:i,userOverrides:l}){const[o,c]=je.useState({organizations:!1,tags:!1,errors:!1,warnings:!1,sampleData:!1,organizationsWithoutContacts:!1,contactsWithoutContactInfo:!1,skippedColumns:!1}),[d,m]=je.useState({importOrganizationsWithoutContacts:!1,importContactsWithoutContactInfo:!1}),u=s(e=>{c(s=>({...s,[e]:!s[e]}))},"toggleSection"),h=s(()=>e.sampleRows.map((e,s)=>{try{return X.parse(e),{row:s+1,valid:!0}}catch(t){return t instanceof Re?{row:s+1,valid:!1,errors:t.issues.map(e=>({field:e.path.join("."),message:e.message}))}:{row:s+1,valid:!1,errors:[]}}}),"validateSampleRows")(),p=h.filter(e=>e.valid).length,x=e.mappings.filter(e=>null!==e.target),g=e.mappings.filter(e=>null===e.target),f=Xs(),j=new Map,w=new Set;e.mappings.forEach(e=>{if(e.target&&"(ignored - no matching field)"!==e.target){const s=j.get(e.target)||0;j.set(e.target,s+1),s+1>1&&w.add(e.target)}});const v=w.size>0;return n.jsxs("div",{className:"flex flex-col gap-4",children:[n.jsxs(Ne,{variant:e.hasErrors?"destructive":"default",className:"mb-2",children:[n.jsx(_e,{className:"flex items-center gap-2",children:e.hasErrors?n.jsxs(n.Fragment,{children:[n.jsx($e,{className:"h-4 w-4"}),"Review Required"]}):n.jsxs(n.Fragment,{children:[n.jsx(Ve,{className:"h-4 w-4"}),"Ready to Import"]})}),n.jsx(Ce,{className:"mt-2",children:n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Ue,{className:"h-3 w-3"}),n.jsx("strong",{children:e.validCount})," contacts will be imported"]}),e.skipCount>0&&n.jsxs("span",{className:"flex items-center gap-1 text-warning",children:[n.jsx(Be,{className:"h-3 w-3"}),n.jsx("strong",{children:e.skipCount})," rows will be skipped"]})]}),(e.newOrganizations.length>0||e.newTags.length>0)&&n.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.newOrganizations.length>0&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(qe,{className:"h-3 w-3"}),e.newOrganizations.length," new organizations"]}),e.newTags.length>0&&n.jsxs("span",{className:"flex items-center gap-1",children:[n.jsx(Ge,{className:"h-3 w-3"}),e.newTags.length," new tags"]})]})]})})]}),v&&n.jsxs(Ne,{variant:"destructive",children:[n.jsx($e,{className:"h-4 w-4"}),n.jsx(_e,{children:"Duplicate Field Mappings Detected"}),n.jsx(Ce,{children:n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsx("p",{children:"Multiple CSV columns cannot be mapped to the same CRM field. Please fix the following duplicates:"}),n.jsx("ul",{className:"list-disc list-inside",children:Array.from(w).map(e=>n.jsxs("li",{children:[n.jsx("strong",{children:e})," is mapped ",j.get(e)," times"]},e))})]})})]}),x.length>0&&n.jsxs(M,{children:[n.jsxs(L,{children:[n.jsx(W,{children:"Column Mappings"}),n.jsxs($,{children:[x.length," CSV column",1!==x.length?"s":""," will be imported",g.length>0&&` â€¢ ${g.length} column${1!==g.length?"s":""} will be skipped`]})]}),n.jsx(V,{children:n.jsxs(Pe,{children:[n.jsx(Ee,{children:n.jsxs(Oe,{children:[n.jsx(Fe,{children:"CSV Column"}),n.jsx(Fe,{className:"text-center w-12",children:n.jsx(Qe,{className:"h-4 w-4 mx-auto"})}),n.jsx(Fe,{children:"CRM Field"}),n.jsx(Fe,{children:"Sample Value"})]})}),n.jsx(Ae,{children:x.map((e,t)=>{const a=l?.has(e.source),r="first_name + last_name (will be split)"===e.target?Us:e.target||"__no_mapping__";return n.jsxs(Oe,{className:a?"bg-primary-subtle":"",children:[n.jsxs(De,{className:"font-mono text-sm text-muted-foreground",children:[e.source,a&&n.jsx(U,{variant:"secondary",className:"ml-2 text-xs",children:"Custom"})]}),n.jsx(De,{className:"text-center",children:n.jsx(Qe,{className:"h-3 w-3 mx-auto text-muted-foreground"})}),n.jsx(De,{children:i?n.jsxs(B,{value:r,onValueChange:s(s=>{i(e.source,"__no_mapping__"===s?null:s)},"onValueChange"),children:[n.jsx(q,{className:"w-full",children:n.jsx(G,{placeholder:"(No mapping)"})}),n.jsxs(Q,{children:[n.jsx(H,{value:"__no_mapping__",children:"(No mapping)"}),f.map(e=>n.jsx(H,{value:e.value,children:e.label},e.value))]})]}):n.jsx(U,{variant:"outline",className:"font-mono text-xs",children:e.target})}),n.jsx(De,{className:"text-sm text-muted-foreground max-w-[200px] truncate",children:e.sampleValue||n.jsx("span",{className:"text-muted-foreground",children:"-"})})]},t)})})]})})]}),g.length>0&&n.jsx(Me,{open:o.skippedColumns,children:n.jsxs(M,{className:"border-muted",children:[n.jsx(Le,{asChild:!0,children:n.jsxs(L,{className:"cursor-pointer",onClick:s(()=>u("skippedColumns"),"onClick"),children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Be,{className:"h-4 w-4 text-muted-foreground"}),n.jsx(W,{className:"text-muted-foreground",children:"Skipped Columns"}),n.jsx(U,{variant:"secondary",children:g.length})]}),o.skippedColumns?n.jsx(He,{className:"h-4 w-4"}):n.jsx(Je,{className:"h-4 w-4"})]}),n.jsx($,{children:"These CSV columns don't match any CRM fields and will be ignored"})]})}),n.jsx(We,{children:n.jsx(V,{children:n.jsxs(Pe,{children:[n.jsx(Ee,{children:n.jsxs(Oe,{children:[n.jsx(Fe,{children:"CSV Column"}),n.jsx(Fe,{children:"Sample Value"})]})}),n.jsx(Ae,{children:g.map((e,s)=>n.jsxs(Oe,{children:[n.jsx(De,{className:"font-mono text-sm text-muted-foreground",children:e.source}),n.jsx(De,{className:"text-sm text-muted-foreground max-w-[300px] truncate",children:e.sampleValue||"-"})]},s))})]})})})]})}),n.jsx(Me,{open:o.sampleData,children:n.jsxs(M,{children:[n.jsx(Le,{asChild:!0,children:n.jsx(L,{className:"cursor-pointer",onClick:s(()=>u("sampleData"),"onClick"),children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx(W,{children:"Sample Data Preview"}),n.jsxs($,{children:["First 5 rows after transformation (",p,"/5 valid)"]})]}),o.sampleData?n.jsx(He,{className:"h-4 w-4"}):n.jsx(Je,{className:"h-4 w-4"})]})})}),n.jsx(We,{children:n.jsx(V,{children:n.jsx("div",{className:"overflow-x-auto",children:n.jsxs(Pe,{children:[n.jsx(Ee,{children:n.jsxs(Oe,{children:[n.jsx(Fe,{className:"w-12",children:"Row"}),n.jsx(Fe,{children:"Name"}),n.jsx(Fe,{children:"Email"}),n.jsx(Fe,{children:"Organization"}),n.jsx(Fe,{children:"Status"})]})}),n.jsx(Ae,{children:e.sampleRows.slice(0,5).map((e,s)=>{const t=h[s];return n.jsxs(Oe,{children:[n.jsx(De,{children:n.jsxs("div",{className:"flex items-center gap-2",children:[s+1,t?.valid?n.jsx(Ve,{className:"h-3 w-3 text-success"}):n.jsx(Be,{className:"h-3 w-3 text-destructive"})]})}),n.jsx(De,{children:e.name||`${e.first_name} ${e.last_name}`}),n.jsx(De,{className:"font-mono text-sm",children:e.email?.[0]?.email||"-"}),n.jsx(De,{children:e.organization_name||"-"}),n.jsx(De,{children:n.jsx(U,{variant:"outline",className:"text-xs",children:t?.valid?"Valid":"Has Issues"})})]},s)})})]})})})})]})}),e.newOrganizations.length>0&&n.jsx(Me,{open:o.organizations,children:n.jsxs(M,{children:[n.jsx(Le,{asChild:!0,children:n.jsxs(L,{className:"cursor-pointer",onClick:s(()=>u("organizations"),"onClick"),children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(qe,{className:"h-4 w-4"}),n.jsx(W,{children:"New Organizations"}),n.jsx(U,{variant:"secondary",children:e.newOrganizations.length})]}),o.organizations?n.jsx(He,{className:"h-4 w-4"}):n.jsx(Je,{className:"h-4 w-4"})]}),n.jsx($,{children:"These organizations will be created automatically"})]})}),n.jsx(We,{children:n.jsx(V,{children:n.jsx("div",{className:"flex flex-wrap gap-2",children:e.newOrganizations.map((e,s)=>n.jsx(U,{variant:"outline",children:e},s))})})})]})}),e.newTags.length>0&&n.jsx(Me,{open:o.tags,children:n.jsxs(M,{children:[n.jsx(Le,{asChild:!0,children:n.jsxs(L,{className:"cursor-pointer",onClick:s(()=>u("tags"),"onClick"),children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Ge,{className:"h-4 w-4"}),n.jsx(W,{children:"New Tags"}),n.jsx(U,{variant:"secondary",children:e.newTags.length})]}),o.tags?n.jsx(He,{className:"h-4 w-4"}):n.jsx(Je,{className:"h-4 w-4"})]}),n.jsx($,{children:"These tags will be created automatically"})]})}),n.jsx(We,{children:n.jsx(V,{children:n.jsx("div",{className:"flex flex-wrap gap-2",children:e.newTags.map((e,s)=>n.jsx(U,{variant:"secondary",children:e},s))})})})]})}),e.errors.length>0&&n.jsx(Me,{open:o.errors,children:n.jsxs(M,{className:"border-destructive/50",children:[n.jsx(Le,{asChild:!0,children:n.jsxs(L,{className:"cursor-pointer",onClick:s(()=>u("errors"),"onClick"),children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Be,{className:"h-4 w-4 text-destructive"}),n.jsx(W,{className:"text-destructive",children:"Validation Errors"}),n.jsx(U,{variant:"destructive",children:e.errors.length})]}),o.errors?n.jsx(He,{className:"h-4 w-4"}):n.jsx(Je,{className:"h-4 w-4"})]}),n.jsx($,{children:"These rows cannot be imported due to validation errors"})]})}),n.jsx(We,{children:n.jsx(V,{children:n.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[e.errors.slice(0,10).map((e,s)=>n.jsxs("div",{className:"flex items-start gap-2 text-sm p-2 bg-destructive/10 rounded",children:[n.jsx(Be,{className:"h-4 w-4 text-destructive mt-0.5 flex-shrink-0"}),n.jsxs("div",{children:[n.jsxs("span",{className:"font-medium",children:["Row ",e.row]}),e.field&&n.jsxs("span",{className:"text-muted-foreground",children:[" (",e.field,")"]}),": ",e.message]})]},s)),e.errors.length>10&&n.jsxs("div",{className:"text-sm text-muted-foreground text-center pt-2",children:["... and ",e.errors.length-10," more errors"]})]})})})]})}),e.warnings.length>0&&n.jsx(Me,{open:o.warnings,children:n.jsxs(M,{className:"border-warning/50",children:[n.jsx(Le,{asChild:!0,children:n.jsxs(L,{className:"cursor-pointer",onClick:s(()=>u("warnings"),"onClick"),children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx($e,{className:"h-4 w-4 text-warning"}),n.jsx(W,{className:"text-warning",children:"Warnings"}),n.jsx(U,{variant:"outline",className:"border-warning text-warning",children:e.warnings.length})]}),o.warnings?n.jsx(He,{className:"h-4 w-4"}):n.jsx(Je,{className:"h-4 w-4"})]}),n.jsx($,{children:"These issues won't prevent import but should be reviewed"})]})}),n.jsx(We,{children:n.jsx(V,{children:n.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[e.warnings.slice(0,10).map((e,s)=>n.jsxs("div",{className:"flex items-start gap-2 text-sm p-2 bg-warning/10 rounded",children:[n.jsx($e,{className:"h-4 w-4 text-warning mt-0.5 flex-shrink-0"}),n.jsxs("div",{children:[n.jsxs("span",{className:"font-medium",children:["Row ",e.row]}),e.field&&n.jsxs("span",{className:"text-muted-foreground",children:[" (",e.field,")"]}),": ",e.message]})]},s)),e.warnings.length>10&&n.jsxs("div",{className:"text-sm text-muted-foreground text-center pt-2",children:["... and ",e.warnings.length-10," more warnings"]})]})})})]})}),e.organizationsWithoutContacts&&e.organizationsWithoutContacts.length>0&&n.jsx(Me,{open:o.organizationsWithoutContacts,children:n.jsxs(M,{className:"border-primary/50",children:[n.jsx(Le,{asChild:!0,children:n.jsxs(L,{className:"cursor-pointer",onClick:s(()=>u("organizationsWithoutContacts"),"onClick"),children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(qe,{className:"h-4 w-4 text-primary"}),n.jsx(W,{className:"text-primary",children:"Organizations Without Contact Person"}),n.jsx(U,{variant:"outline",className:"border-primary text-primary",children:e.organizationsWithoutContacts.length})]}),o.organizationsWithoutContacts?n.jsx(He,{className:"h-4 w-4"}):n.jsx(Je,{className:"h-4 w-4"})]}),n.jsx($,{children:"CSV rows with organization names but no contact person"})]})}),n.jsx(We,{children:n.jsxs(V,{className:"space-y-4",children:[n.jsxs(Ne,{children:[n.jsx(Ke,{className:"h-4 w-4"}),n.jsx(_e,{children:"What happens if I import these?"}),n.jsx(Ce,{children:'A placeholder contact named "General Contact" will be created for each organization. This allows you to maintain organizational records even without specific contact details.'})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Te,{id:"import-orgs-without-contacts",checked:d.importOrganizationsWithoutContacts,onCheckedChange:s(e=>m(s=>({...s,importOrganizationsWithoutContacts:!0===e})),"onCheckedChange")}),n.jsxs(J,{htmlFor:"import-orgs-without-contacts",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:["Create placeholder contacts for these"," ",e.organizationsWithoutContacts.length," organizations"]})]}),n.jsxs("div",{className:"max-h-40 overflow-y-auto space-y-1",children:[e.organizationsWithoutContacts.slice(0,20).map((e,s)=>n.jsxs("div",{className:"flex items-start gap-2 text-sm p-2 bg-primary/10 rounded",children:[n.jsx(qe,{className:"h-4 w-4 text-primary mt-0.5 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("span",{className:"font-medium",children:e.organization_name}),n.jsxs("span",{className:"text-muted-foreground",children:[" (Row ",e.row,")"]})]})]},s)),e.organizationsWithoutContacts.length>20&&n.jsxs("div",{className:"text-sm text-muted-foreground text-center pt-2",children:["... and ",e.organizationsWithoutContacts.length-20," more"]})]})]})})]})}),e.contactsWithoutContactInfo&&e.contactsWithoutContactInfo.length>0&&n.jsx(Me,{open:o.contactsWithoutContactInfo,children:n.jsxs(M,{className:"border-warning/50",children:[n.jsx(Le,{asChild:!0,children:n.jsxs(L,{className:"cursor-pointer",onClick:s(()=>u("contactsWithoutContactInfo"),"onClick"),children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(Ue,{className:"h-4 w-4 text-warning"}),n.jsx(W,{className:"text-warning",children:"Contacts Without Email or Phone"}),n.jsx(U,{variant:"outline",className:"border-warning text-warning",children:e.contactsWithoutContactInfo.length})]}),o.contactsWithoutContactInfo?n.jsx(He,{className:"h-4 w-4"}):n.jsx(Je,{className:"h-4 w-4"})]}),n.jsx($,{children:"Contacts missing both email and phone information"})]})}),n.jsx(We,{children:n.jsxs(V,{className:"space-y-4",children:[n.jsxs(Ne,{children:[n.jsx($e,{className:"h-4 w-4"}),n.jsx(_e,{children:"Limited Usefulness"}),n.jsx(Ce,{children:"These contacts have no email or phone number, which significantly limits their value in a CRM. You can still import them, but you won't be able to contact them through standard channels."})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Te,{id:"import-contacts-without-info",checked:d.importContactsWithoutContactInfo,onCheckedChange:s(e=>m(s=>({...s,importContactsWithoutContactInfo:!0===e})),"onCheckedChange")}),n.jsxs(J,{htmlFor:"import-contacts-without-info",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:["Import these ",e.contactsWithoutContactInfo.length," contacts anyway"]})]}),n.jsxs("div",{className:"max-h-40 overflow-y-auto space-y-1",children:[e.contactsWithoutContactInfo.slice(0,20).map((e,s)=>n.jsxs("div",{className:"flex items-start gap-2 text-sm p-2 bg-warning/10 rounded",children:[n.jsx(Ue,{className:"h-4 w-4 text-warning mt-0.5 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("span",{className:"font-medium",children:e.name}),e.organization_name&&n.jsxs("span",{className:"text-muted-foreground",children:[" ","at ",e.organization_name]}),n.jsxs("span",{className:"text-muted-foreground",children:[" (Row ",e.row,")"]})]})]},s)),e.contactsWithoutContactInfo.length>20&&n.jsxs("div",{className:"text-sm text-muted-foreground text-center pt-2",children:["... and ",e.contactsWithoutContactInfo.length-20," more"]})]})]})})]})}),n.jsxs(K,{className:"gap-2",children:[n.jsx(Y,{variant:"outline",onClick:a,children:"Cancel"}),e.lowConfidenceMappings>0&&r&&n.jsxs(Y,{variant:"outline",onClick:r,children:["Review Mappings (",e.lowConfidenceMappings," uncertain)"]}),n.jsxs(Y,{variant:"default",onClick:s(()=>t(d),"onClick"),disabled:0===e.validCount||v,children:["Continue Import (",e.validCount," contacts)"]})]})]})}function xt({open:e,onClose:t,onRetry:a,result:r,allowRetry:i=!1}){const l=r.totalProcessed>0?Math.round(r.successCount/r.totalProcessed*100):0,o=r.failedCount>0||r.skippedCount>0,c=r.successCount===r.totalProcessed,d=s(e=>{const s=Math.floor(e/1e3%60),t=Math.floor(e/6e4%60),a=Math.floor(e/36e5);return a>0?`${a}h ${t}m ${s}s`:t>0?`${t}m ${s}s`:`${s}s`},"formatDuration"),m=s(()=>{const e=[["Row","Error Reasons","First Name","Last Name","Organization","Title","Email (Work)","Email (Home)","Email (Other)","Phone (Work)","Phone (Home)","Phone (Other)","LinkedIn URL","Notes"],...r.errors.map(e=>[e.row.toString(),e.errors.map(e=>`${e.field}: ${e.message}`).join("; "),e.data.first_name||"",e.data.last_name||"",e.data.organization_name||"",e.data.title||"",e.data.email_work||"",e.data.email_home||"",e.data.email_other||"",e.data.phone_work||"",e.data.phone_home||"",e.data.phone_other||"",e.data.linkedin_url||"",e.data.notes||""])].map(e=>e.map(e=>`"${String(e).replace(/"/g,'""')}"`).join(",")).join("\n"),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),a=URL.createObjectURL(s);t.setAttribute("href",a),t.setAttribute("download",`import_errors_${(new Date).toISOString().split("T")[0]}.csv`),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)},"handleDownloadErrors");return n.jsx(Z,{open:e,onOpenChange:t,children:n.jsxs(ee,{className:"max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[n.jsxs(se,{children:[n.jsx(te,{className:"flex items-center gap-2",children:c?n.jsxs(n.Fragment,{children:[n.jsx(Ye,{className:"h-5 w-5 text-success"}),"Import Completed Successfully"]}):o?n.jsxs(n.Fragment,{children:[n.jsx($e,{className:"h-5 w-5 text-warning"}),"Import Completed with Issues"]}):n.jsxs(n.Fragment,{children:[n.jsx(Ye,{className:"h-5 w-5 text-success"}),"Import Completed"]})}),n.jsxs(ae,{children:["Processed ",r.totalProcessed.toLocaleString()," contacts in"," ",d(r.duration)]})]}),n.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 py-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsx("div",{className:"border rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-muted-foreground",children:"Successful"}),n.jsx("p",{className:"text-2xl font-semibold text-success",children:r.successCount.toLocaleString()})]}),n.jsx(Ye,{className:"h-11 w-11 text-success opacity-20"})]})}),n.jsx("div",{className:"border rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-muted-foreground",children:"Skipped"}),n.jsx("p",{className:"text-2xl font-semibold text-warning",children:r.skippedCount.toLocaleString()})]}),n.jsx($e,{className:"h-11 w-11 text-warning opacity-20"})]})}),n.jsx("div",{className:"border rounded-lg p-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-muted-foreground",children:"Failed"}),n.jsx("p",{className:"text-2xl font-semibold text-error",children:r.failedCount.toLocaleString()})]}),n.jsx(Xe,{className:"h-11 w-11 text-error opacity-20"})]})})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm font-medium",children:"Success Rate"}),n.jsxs("span",{className:"text-sm text-muted-foreground",children:[l,"%"]})]}),n.jsx("div",{className:"h-2 bg-muted rounded-full overflow-hidden",children:n.jsx("div",{className:"h-full transition-all "+(l>=90?"bg-success":l>=70?"bg-warning":"bg-error"),style:{width:`${l}%`}})})]}),n.jsxs("div",{className:"border rounded-lg p-4 space-y-2",children:[n.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[n.jsx(Ze,{className:"h-4 w-4"}),"Performance Metrics"]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("span",{className:"text-muted-foreground",children:"Total Duration:"})," ",n.jsx("span",{className:"font-medium",children:d(r.duration)})]}),n.jsxs("div",{children:[n.jsx("span",{className:"text-muted-foreground",children:"Processing Speed:"})," ",n.jsx("span",{className:"font-medium",children:r.duration>0?`${Math.round(r.totalProcessed/r.duration*1e3)} contacts/sec`:"N/A"})]}),r.startTime&&n.jsxs("div",{children:[n.jsx("span",{className:"text-muted-foreground",children:"Started at:"})," ",n.jsx("span",{className:"font-medium",children:r.startTime.toLocaleTimeString()})]}),r.endTime&&n.jsxs("div",{children:[n.jsx("span",{className:"text-muted-foreground",children:"Completed at:"})," ",n.jsx("span",{className:"font-medium",children:r.endTime.toLocaleTimeString()})]})]})]}),o&&r.errors.length>0&&n.jsxs("div",{className:"border rounded-lg p-4 space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("h3",{className:"font-medium flex items-center gap-2",children:[n.jsx(Be,{className:"h-4 w-4"}),"Rejected Records (",r.errors.length,")"]}),n.jsx("div",{className:"flex gap-2",children:n.jsxs(Y,{variant:"outline",size:"sm",onClick:m,className:"gap-2",children:[n.jsx(es,{className:"h-3 w-3"}),"Export"]})})]}),n.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto p-1",children:r.errors.map(e=>n.jsxs("div",{className:"flex flex-col gap-2 p-3 bg-muted/40 rounded border border-error-subtle",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(U,{variant:"outline",className:"text-xs",children:["Row ",e.row]}),n.jsxs("span",{className:"font-medium text-sm",children:[e.data.first_name||"(no first name)"," ",e.data.last_name||"(no last name)"]})]}),n.jsx("ul",{className:"text-xs text-error space-y-1 ml-4 list-disc list-inside",children:e.errors.map((e,s)=>n.jsxs("li",{children:[n.jsxs("span",{className:"font-semibold capitalize",children:[e.field.replace(/_/g," "),":"]})," ",e.message,e.value&&n.jsxs("span",{className:"text-muted-foreground italic ml-1",children:['(was: "',String(e.value),'")']})]},s))})]},e.row))})]}),r.skippedCount>0&&n.jsxs(Ne,{children:[n.jsx($e,{className:"h-4 w-4"}),n.jsx(_e,{children:"Skipped Rows"}),n.jsxs(Ce,{children:[r.skippedCount," ",1===r.skippedCount?"row was":"rows were"," skipped during import. These typically include rows with missing required fields like organization name. Review the error details above for specific reasons."]})]})]}),n.jsx(K,{children:n.jsxs("div",{className:"flex gap-2 w-full justify-between",children:[n.jsx("div",{className:"flex gap-2",children:o&&r.errors.length>0&&n.jsxs(Y,{variant:"outline",onClick:m,className:"gap-2",children:[n.jsx(ss,{className:"h-4 w-4"}),"Download Error Report"]})}),n.jsxs("div",{className:"flex gap-2",children:[i&&o&&n.jsxs(Y,{variant:"outline",onClick:s(()=>{a?.(),t()},"onClick"),className:"gap-2",children:[n.jsx(ts,{className:"h-4 w-4"}),"Retry Failed"]}),n.jsx(Y,{onClick:t,variant:c?"default":"outline",children:c?"Done":"Close"})]})]})})]})})}s(pt,"ContactImportPreview"),s(xt,"ContactImportResult");function gt(e){const s=new Set;for(const t of e)if(t.organization_name){const e=t.organization_name.trim();e&&s.add(e)}return Array.from(s)}function ft(e){const s=new Set;for(const t of e)if(t.tags){const e=t.tags.split(",");for(const t of e){const e=t.trim();e&&s.add(e)}}return Array.from(s)}function jt(e){const s=[];for(let t=0;t<e.length;t++){const a=e[t];rt(a)&&s.push({organization_name:String(a.organization_name).trim(),row:t+4})}return s}function wt(e){const s=[];for(let t=0;t<e.length;t++){const a=e[t];if(it(a)){const e=[];a.first_name&&String(a.first_name).trim()&&e.push(String(a.first_name).trim()),a.last_name&&String(a.last_name).trim()&&e.push(String(a.last_name).trim());const n=e.length>0?e.join(" "):"Unknown";s.push({name:n,organization_name:a.organization_name?String(a.organization_name).trim():"",row:t+4})}}return s}function vt(){const[e,s]=je.useState([]),[t,a]=je.useState([]),[n,r]=je.useState(new Map),i=je.useRef([]);je.useEffect(()=>{e.length>0&&(i.current.length!==e.length||!e.every((e,s)=>e===i.current[s]))&&(r(new Map),i.current=e)},[e]);const l=je.useMemo(()=>{if(0===e.length)return{};const s=Ks(e),t={};return e.forEach(e=>{t[e]=n.get(e)??s[e]}),t},[e,n]),o=je.useMemo(()=>e.length&&t.length?tt(e,t,l):[],[e,t,l]),c=je.useCallback((e,s)=>{r(t=>{const a=new Map(t);return null===s||""===s?a.delete(e):a.set(e,s),a})},[]),d=je.useCallback((e,t)=>{s(e),a(t)},[]),m=je.useCallback(()=>{r(new Map),s([]),a([]),i.current=[]},[]);return{mappings:l,overrides:n,contacts:o,headers:e,setOverride:c,setRawData:d,reset:m,hasData:e.length>0}}s(gt,"extractNewOrganizations"),s(ft,"extractNewTags"),s(jt,"findOrganizationsWithoutContacts"),s(wt,"findContactsWithoutContactInfo"),s(vt,"useColumnMapping");const Nt={totalProcessed:0,successCount:0,skippedCount:0,failedCount:0,errors:[],startTime:null};function _t(e){throw new Error(`Unhandled discriminated union member: ${JSON.stringify(e)}`)}function Ct(e){return"file_selected"===e.step||"parsing"===e.step||"preview"===e.step||"importing"===e.step}function bt(e){return"complete"===e.step||"error"===e.step}function yt(e){return"parsing"===e.step||"importing"===e.step}function kt(e){return{showPreview:"preview"===e.step,showResult:"complete"===e.step,isImporting:"importing"===e.step,isParsing:"parsing"===e.step,hasError:"error"===e.step,hasFile:Ct(e),isTerminal:bt(e),isProcessing:yt(e)}}function St(){return{step:"idle"}}function zt(e,s){if("RESET"===s.type)return{step:"idle"};switch(e.step){case"idle":return It(e,s);case"file_selected":return Rt(e,s);case"parsing":return Tt(e,s);case"preview":return Pt(e,s);case"importing":return Et(e,s);case"complete":return Ot(e);case"error":return Ft(e);default:return _t(e)}}function It(e,s){return"SELECT_FILE"===s.type?{step:"file_selected",file:s.payload.file,validationErrors:s.payload.validationErrors,validationWarnings:s.payload.validationWarnings}:e}function Rt(e,s){switch(s.type){case"START_PARSING":return{step:"parsing",file:e.file};case"CLEAR_FILE":return{step:"idle"};case"SELECT_FILE":return{step:"file_selected",file:s.payload.file,validationErrors:s.payload.validationErrors,validationWarnings:s.payload.validationWarnings};default:return e}}function Tt(e,s){switch(s.type){case"PARSING_COMPLETE":return{step:"preview",file:e.file,previewData:s.payload.previewData,dataQualityDecisions:{importOrganizationsWithoutContacts:!1,importContactsWithoutContactInfo:!1}};case"PARSING_FAILED":return{step:"error",error:s.payload.error,previousStep:"parsing"};case"CANCEL":return{step:"idle"};default:return e}}function Pt(e,s){switch(s.type){case"START_IMPORT":return{step:"importing",file:e.file,progress:{count:0,total:s.payload.totalContacts},accumulated:{...Nt,startTime:new Date},rowOffset:0};case"UPDATE_PREVIEW":return{...e,previewData:s.payload.previewData};case"UPDATE_DATA_QUALITY_DECISIONS":return{...e,dataQualityDecisions:s.payload.decisions};case"CANCEL":return{step:"idle"};default:return e}}function Et(e,s){switch(s.type){case"UPDATE_PROGRESS":return{...e,progress:{...e.progress,count:s.payload.count}};case"ACCUMULATE_RESULT":{const{batchProcessed:t,batchSuccess:a,batchSkipped:n,batchFailed:r,batchErrors:i,batchSize:l}=s.payload;return{...e,accumulated:{...e.accumulated,totalProcessed:e.accumulated.totalProcessed+t,successCount:e.accumulated.successCount+a,skippedCount:e.accumulated.skippedCount+n,failedCount:e.accumulated.failedCount+r,errors:[...e.accumulated.errors,...i]},rowOffset:e.rowOffset+l}}case"IMPORT_COMPLETE":{const s=new Date,t=e.accumulated.startTime||s,a=s.getTime()-t.getTime();return{step:"complete",result:{totalProcessed:e.accumulated.totalProcessed,successCount:e.accumulated.successCount,skippedCount:e.accumulated.skippedCount,failedCount:e.accumulated.failedCount,errors:e.accumulated.errors,duration:a,startTime:t,endTime:s}}}case"IMPORT_FAILED":return{step:"error",error:s.payload.error,previousStep:"importing"};case"CANCEL":return{step:"idle"};default:return e}}function Ot(e,s){return e}function Ft(e,s){return e}function At(e){return{selectFile:s((s,t=[],a=[])=>{e({type:"SELECT_FILE",payload:{file:s,validationErrors:t,validationWarnings:a}})},"selectFile"),clearFile:s(()=>{e({type:"CLEAR_FILE"})},"clearFile"),startParsing:s(()=>{e({type:"START_PARSING"})},"startParsing"),parsingComplete:s(s=>{e({type:"PARSING_COMPLETE",payload:{previewData:s}})},"parsingComplete"),parsingFailed:s(s=>{e({type:"PARSING_FAILED",payload:{error:s}})},"parsingFailed"),updatePreview:s(s=>{e({type:"UPDATE_PREVIEW",payload:{previewData:s}})},"updatePreview"),updateDataQualityDecisions:s(s=>{e({type:"UPDATE_DATA_QUALITY_DECISIONS",payload:{decisions:s}})},"updateDataQualityDecisions"),startImport:s(s=>{e({type:"START_IMPORT",payload:{totalContacts:s}})},"startImport"),updateProgress:s(s=>{e({type:"UPDATE_PROGRESS",payload:{count:s}})},"updateProgress"),accumulateResult:s(s=>{e({type:"ACCUMULATE_RESULT",payload:s})},"accumulateResult"),importComplete:s(()=>{e({type:"IMPORT_COMPLETE"})},"importComplete"),importFailed:s(s=>{e({type:"IMPORT_FAILED",payload:{error:s}})},"importFailed"),cancel:s(()=>{e({type:"CANCEL"})},"cancel"),reset:s(()=>{e({type:"RESET"})},"reset")}}function Dt(){const[e,t]=je.useReducer(zt,void 0,St),a=je.useRef(null),n=je.useCallback(()=>(a.current&&a.current.abort(),a.current=new AbortController,a.current),[]),r=je.useCallback(()=>{a.current&&(a.current.abort(),a.current=null)},[]),i=je.useCallback(()=>a.current?.signal.aborted??!1,[]),l=je.useCallback(()=>a.current?.signal??null,[]);je.useEffect(()=>()=>{a.current&&(a.current.abort(),a.current=null)},[]);const o=je.useMemo(()=>{const e=At(t);return{...e,startParsing:s(()=>{n(),e.startParsing()},"startParsing"),startImport:s(s=>{n(),e.startImport(s)},"startImport"),cancel:s(()=>{r(),e.cancel()},"cancel"),reset:s(()=>{r(),e.reset()},"reset")}},[n,r]),c=je.useMemo(()=>kt(e),[e]);return{state:e,actions:o,flags:c,dispatch:t,abortSignal:l(),isAborted:i,getAbortSignal:l}}s(_t,"assertNever"),s(Ct,"hasFile"),s(bt,"isTerminal"),s(yt,"isProcessing"),s(kt,"deriveWizardFlags"),s(St,"createInitialState"),s(zt,"importWizardReducer"),s(It,"reduceIdleState"),s(Rt,"reduceFileSelectedState"),s(Tt,"reduceParsingState"),s(Pt,"reducePreviewState"),s(Et,"reduceImportingState"),s(Ot,"reduceCompleteState"),s(Ft,"reduceErrorState"),s(At,"createWizardActions"),s(Dt,"useImportWizard");var Mt=Object.defineProperty,Lt=s((e,s,t)=>s in e?Mt(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,"__defNormalProp"),Wt=s((e,s,t)=>Lt(e,s+"",t),"__publicField");const $t=class{constructor(e){Wt(this,"config"),this.config=e}canProceed(){const e=this.getState(),s=Date.now(),t=e.requests.filter(e=>s-e<this.config.windowMs);return t.length<this.config.maxRequests&&(t.push(s),this.setState({requests:t,firstRequest:t[0]}),!0)}getRemaining(){const e=this.getState(),s=Date.now(),t=e.requests.filter(e=>s-e<this.config.windowMs);return Math.max(0,this.config.maxRequests-t.length)}getResetTime(){const e=this.getState();if(0===e.requests.length)return 0;const s=Date.now(),t=e.requests[0];return Math.max(0,this.config.windowMs-(s-t))}getResetTimeFormatted(){const e=this.getResetTime();if(0===e)return"now";const s=Math.ceil(e/6e4);if(s<60)return`${s} minute${s>1?"s":""}`;const t=Math.ceil(s/60);return`${t} hour${t>1?"s":""}`}reset(){sessionStorage.removeItem(this.config.storageKey)}getState(){try{const e=sessionStorage.getItem(this.config.storageKey);if(e)return JSON.parse(e)}catch(e){}return{requests:[],firstRequest:Date.now()}}setState(e){try{sessionStorage.setItem(this.config.storageKey,JSON.stringify(e))}catch(s){}}};s($t,"ClientRateLimiter");let Vt=$t;const Ut=new Vt({maxRequests:10,windowMs:864e5,storageKey:"rate_limit_contact_import"});new Vt({maxRequests:10,windowMs:864e5,storageKey:"rate_limit_organization_import"});const Bt=s(e=>{const{alwaysOn:t,defaultValue:a,format:d,label:m,helperText:u,name:h,onBlur:p,onChange:x,parse:g,resource:f,source:j,validate:w,readOnly:v,disabled:N,accept:_,maxSize:C,minSize:b,multiple:y=!1,options:k={},children:S,className:z,inputProps:I,onRemove:R,validateFileRemoval:T,placeholder:P,labelMultiple:E="ra.input.file.upload_several",labelSingle:O="ra.input.file.upload_single",removeIcon:F,...A}=e,{onDrop:D}=k,M=r(),L=s(e=>{if(!(e instanceof File))return e;return{rawFile:e,src:URL.createObjectURL(e),title:e.name}},"transformFile"),W=s(e=>e?Array.isArray(e)?e.map(L):L(e):y?[]:null,"transformFiles"),{id:$,field:{onChange:V,onBlur:U,value:B,name:q},isRequired:G}=i({alwaysOn:t,defaultValue:a,format:d||W,label:m,helperText:u,name:h,onBlur:p,onChange:x,parse:g||W,resource:f,source:j,validate:w,readOnly:v,disabled:N}),Q=B?Array.isArray(B)?B:[B]:[],H=s((e,s,t)=>{const a=y?[...Q,...e]:[...e];y?(V(a),U()):(V(a[0]),U()),D&&D(e,s,t)},"onDrop"),J=s(e=>async()=>{if(T)try{await T(e)}catch{return}if(y){const s=Q.filter(s=>!c(s,e));V(s),U()}else V(null),U();R&&R(e)},"onRemove"),K=S&&je.isValidElement(je.Children.only(S))?je.Children.only(S):void 0,{getRootProps:Y,getInputProps:X,fileRejections:Z}=ke({accept:_,maxSize:C??5242880,minSize:b,multiple:y,disabled:N||v,validator:s(e=>e.name.length>255?{code:"name-too-long",message:"Filename exceeds 255 characters"}:/[<>:"/\\|?*]/.test(e.name)?{code:"invalid-chars",message:"Filename contains invalid characters"}:null,"validator"),...k,onDrop:H});return n.jsxs(ne,{id:$,name:q,className:ie("w-full",z),...re(A),children:[n.jsx(le,{htmlFor:$,className:N||v?"cursor-default":"cursor-pointer",children:n.jsx(l,{label:m,source:j,resource:f,isRequired:G})}),n.jsxs("div",{...Y({className:ie("border-2 border-dashed border-muted rounded-lg p-6 text-center transition-colors","hover:border-sidebar-ring focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",N||v?"bg-muted cursor-not-allowed":"bg-muted text-muted-foreground cursor-pointer"),role:"button","aria-label":M(y?E:O),tabIndex:N||v?-1:0}),children:[n.jsx("input",{id:$,name:q,...X({...I})}),P||(y?n.jsx("p",{className:"text-sm",children:M(E)}):n.jsx("p",{className:"text-sm",children:M(O)}))]}),Z.length>0&&n.jsx("ul",{role:"alert","aria-live":"polite",className:"text-sm text-destructive mt-2 list-disc pl-5",children:Z.map(({file:e,errors:s})=>n.jsxs("li",{children:[e.name,": ",s.map(e=>e.message).join(", ")]},e.name))}),n.jsx(oe,{helperText:u}),n.jsx(ce,{}),S&&n.jsx("div",{className:"previews flex flex-col gap-1",children:Q.map((e,s)=>n.jsx(qt,{file:e,onRemove:J(e),removeIcon:F,children:n.jsx(o,{value:e,children:K})},s))})]})},"FileInput"),qt=s(e=>{const{className:s,children:t,file:a,onRemove:i,removeIcon:l=as,...o}=e,c=r();return je.useEffect(()=>()=>{const e=a.rawFile?a.rawFile.preview:a.preview;e&&window.URL.revokeObjectURL(e)},[a]),n.jsxs("div",{className:ie("flex flex-row gap-1",s),...o,children:[n.jsx(Y,{variant:"ghost",size:"icon",className:"h-11 w-11 rounded-full shadow-sm cursor-pointer",onClick:i,"aria-label":c("ra.action.delete"),title:c("ra.action.delete"),children:n.jsx(l,{className:"h-4 w-4"})}),t]})},"FileInputPreview"),Gt=s(e=>{const{className:t,empty:a,title:i,src:l,target:o,download:c,defaultValue:m,source:u,record:h,label:p,sortable:x,sortBy:g,textAlign:f,rowClassName:j,cellClassName:w,headerClassName:v,resource:N,..._}=e,C=d({defaultValue:m,source:u,record:h}),b=d({...e,source:i})?.toString()??i,y=r();return null==C||Array.isArray(C)&&0===C.length?a?n.jsx("div",{className:ie("inline-block",t),..._,children:"string"==typeof a?y(a,{_:a}):a}):null:Array.isArray(C)?n.jsx("ul",{className:ie("inline-block",t),..._,children:C.map((e,t)=>{const a=i?de(e,i,i):i,r=l?de(e,l,i):i;return n.jsx("li",{children:n.jsx("a",{href:r,title:a,target:o,download:c,onClick:s(e=>e.stopPropagation(),"onClick"),children:a})},t)})}):n.jsx("div",{className:ie("inline-block",t),..._,children:n.jsx("a",{href:C?.toString(),title:b,target:o,download:c,onClick:s(e=>e.stopPropagation(),"onClick"),children:b})})},"FileField"),Qt=`data:text/csv;name=crm_contacts_sample.csv;charset=utf-8,${encodeURIComponent('first_name,last_name,gender,title,organization_name,organization_role,first_seen,last_seen,tags,linkedin_url,email_work,email_home,email_other,phone_work,phone_home,phone_other\nJohn,Doe,male,Sales Executive,Acme Corporation,decision_maker,2024-07-01T00:00:00+00:00,2024-07-01T11:54:49.95+00:00,"influencer, developer",https://www.linkedin.com/in/johndoe,john@doe.example,john.doe@gmail.com,jdoe@caramail.com,659-980-2015,740.645.3807,(446) 758-2122\nJane,Doe,female,UX Designer,Acme Corporation,influencer,2024-07-01T00:00:00+00:00,2024-07-01T11:54:49.95+00:00,"UI, design",https://www.linkedin.com/in/janedoe,jane@doe.example,,,659-980-2020,740.647.3802,\n')}`;function Ht({open:e,onClose:t}){const a=m(),r=ct(),{state:i,actions:l,isAborted:o}=Dt(),{mappings:c,overrides:d,contacts:h,headers:p,setOverride:x,setRawData:g,reset:f,hasData:j}=vt(),w=je.useCallback(e=>{const{rows:s,headers:t,rawDataRows:a}=e;a&&g(t,a);const n=jt(s),r=wt(s),i=t.map((e,s)=>{const t=Hs(e),n=Js(e);let r=0;t?r=1:n&&(r=.9);return{source:e||"(empty)",target:t||(n?"first_name + last_name (will be split)":null),confidence:r,sampleValue:a?.[0]?.[s]?String(a[0][s]).substring(0,50):void 0}}),o={mappings:i,sampleRows:s.slice(0,5),validCount:s.length,skipCount:0,totalRows:s.length,errors:[],warnings:[],newOrganizations:gt(s),newTags:ft(s),hasErrors:!1,lowConfidenceMappings:i.filter(e=>e.confidence>0&&e.confidence<.8).length,organizationsWithoutContacts:n,contactsWithoutContactInfo:r};l.parsingComplete(o)},[g,l]),v=je.useMemo(()=>{if("preview"!==i.step||!j)return"preview"===i.step?i.previewData:null;const e=jt(h),s=wt(h),t=p.map(e=>{const s=c[e];let t=0;d.has(e)?t=1:s===Us?t=.9:s&&(t=1);const a=h[0];let n;if(a)if(s===Us||"first_name + last_name (will be split)"===s){n=[a.first_name||"",a.last_name||""].filter(Boolean).join(" ").substring(0,50)}else s&&a[s]&&(n=String(a[s]).substring(0,50));return{source:e||"(empty)",target:s===Us?"first_name + last_name (will be split)":s,confidence:t,sampleValue:n}}),a=[],n=Object.values(c),r=n.includes(Us),l=n.includes("first_name"),o=n.includes("last_name");return r&&l&&a.push({row:0,message:"A column is mapped to 'Full Name (split)' and another to 'First Name'. The explicit 'First Name' column will take precedence."}),r&&o&&a.push({row:0,message:"A column is mapped to 'Full Name (split)' and another to 'Last Name'. The explicit 'Last Name' column will take precedence."}),{mappings:t,sampleRows:h.slice(0,5),validCount:h.length,skipCount:0,totalRows:h.length,errors:[],warnings:a,newOrganizations:gt(h),newTags:ft(h),hasErrors:!1,lowConfidenceMappings:t.filter(e=>e.confidence>0&&e.confidence<.8).length,organizationsWithoutContacts:e,contactsWithoutContactInfo:s}},[h,c,p,j,d,i]),{importer:N,parseCsv:_,reset:C}=nt({onPreview:w,previewRowCount:100,papaConfig:Ie()}),b=je.useCallback(async(e,t)=>{if("importing"===i.step)try{const a=await r(e,{preview:!1,startingRow:i.rowOffset+1,dataQualityDecisions:t,onProgress:s(()=>{},"onProgress")});l.accumulateResult({batchProcessed:a.totalProcessed,batchSuccess:a.successCount,batchSkipped:a.skippedCount,batchFailed:a.failedCount,batchErrors:a.errors,batchSize:e.length})}catch(a){const s=a.message||"A critical error occurred during batch processing.",t=i.rowOffset+1,n=e.map((e,a)=>({row:t+a,data:e,errors:[{field:"batch_processing",message:s}]}));l.accumulateResult({batchProcessed:e.length,batchSuccess:0,batchSkipped:0,batchFailed:e.length,batchErrors:n,batchSize:e.length})}},[r,i,l]),y=je.useCallback(async e=>{if(!Ut.canProceed()){const e=Ut.getResetTimeFormatted(),s=Ut.getRemaining();return void alert(`Import rate limit exceeded.\n\nYou have ${s} imports remaining.\nRate limit resets in ${e}.\n\nThis limit prevents accidental bulk data corruption and protects database performance.`)}l.updateDataQualityDecisions(e),l.startImport(h.length);for(let s=0;s<h.length;s+=10){if(o())return;const t=h.slice(s,s+10);await b(t,e),l.updateProgress(s+t.length)}o()||(l.importComplete(),a())},[h,b,a,l,o]),k=je.useCallback(async e=>{if(!e)return void l.reset();const s=await ze(e);s.valid||!s.errors?l.selectFile(e,[],s.warnings||[]):l.selectFile(e,s.errors,[])},[l]),S=je.useCallback(()=>{"file_selected"===i.step&&(l.startParsing(),_(i.file))},[i,l,_]),z=je.useCallback(()=>{l.cancel(),C(),f()},[l,C,f]),I=je.useCallback(()=>{C(),f(),l.reset(),t()},[C,f,l,t]),R=je.useCallback(e=>{e.preventDefault(),I()},[I]),T=s(()=>{const e="file_selected"===i.step?i.validationErrors:[],s="file_selected"===i.step?i.validationWarnings:[],t="file_selected"===i.step?i.file:null,a="parsing"===i.step||"parsing"===N.state;return n.jsxs(n.Fragment,{children:[n.jsx(Ne,{children:n.jsxs(Ce,{className:"flex flex-col gap-4",children:["Here is a sample CSV file you can use as a template",n.jsx(Y,{asChild:!0,variant:"outline",size:"sm",children:n.jsx(we,{to:Qt,download:"crm_contacts_sample.csv",children:"Download CSV sample"})})]})}),n.jsx(Bt,{source:"csv",label:"CSV File",accept:{"text/csv":[".csv"]},onChange:k,children:n.jsx(Gt,{source:"src",title:"title",target:"_blank"})}),e.length>0&&n.jsx(Ne,{variant:"destructive",children:n.jsxs(Ce,{children:[n.jsx("div",{className:"font-semibold mb-2",children:"File validation failed:"}),n.jsx("ul",{className:"list-disc pl-5 space-y-1",children:e.map((e,s)=>n.jsx("li",{children:e.message},s))})]})}),s.length>0&&n.jsx(Ne,{children:n.jsxs(Ce,{children:[n.jsx("div",{className:"font-semibold mb-2",children:"Warnings:"}),n.jsx("ul",{className:"list-disc pl-5 space-y-1",children:s.map((e,s)=>n.jsx("li",{children:e},s))})]})}),n.jsx("div",{className:"flex justify-start pt-6 gap-2",children:n.jsxs(Y,{onClick:S,disabled:!t||a||e.length>0,children:[a?n.jsx(ns,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Import"]})})]})},"renderFileSelectionStep"),P=s(()=>n.jsxs("div",{className:"flex flex-col items-center justify-center py-8 space-y-4",children:[n.jsx(ns,{className:"h-11 w-11 animate-spin text-primary"}),n.jsx("p",{className:"text-muted-foreground",children:"Parsing CSV file..."}),n.jsx(Y,{variant:"ghost",onClick:I,children:"Cancel"})]}),"renderParsingStep"),E=s(()=>{if("importing"!==i.step)return null;const{progress:e,accumulated:s}=i,t=e.total>0?e.count/e.total*100:0;return n.jsx(M,{className:"border-primary/20",children:n.jsxs(V,{className:"pt-6 space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ns,{className:"h-5 w-5 animate-spin text-primary"}),n.jsx("span",{className:"font-medium",children:"Processing CSV Import"})]}),n.jsx("div",{className:"ml-auto",children:n.jsx(Y,{variant:"ghost",size:"sm",onClick:R,className:"h-11 px-4 text-destructive hover:text-destructive hover:bg-destructive/10",children:"Cancel Import"})})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(be,{value:t,className:"h-3"}),n.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[n.jsxs("span",{children:["Processing ",e.count," of ",e.total," contacts"]}),n.jsxs("span",{children:[Math.round(t),"% Complete"]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 pt-2",children:[n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"Processed"}),n.jsx("p",{className:"text-2xl font-bold text-primary",children:e.count}),n.jsxs("p",{className:"text-xs text-muted-foreground",children:["of ",e.total," contacts"]})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"Errors"}),n.jsx("p",{className:"text-2xl font-bold text-destructive",children:s.errors.length}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"failed imports"})]}),n.jsxs("div",{className:"space-y-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"Success"}),n.jsx("p",{className:"text-2xl font-bold text-success",children:s.successCount}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"imported"})]})]}),n.jsx(Ne,{className:"border-warning/50 bg-warning/10",children:n.jsx(Ce,{className:"text-sm",children:"Please keep this tab open until the import completes"})})]})})},"renderImportingStep"),O=s(()=>n.jsxs(n.Fragment,{children:[n.jsx(Ne,{variant:"destructive",children:n.jsx(Ce,{children:"Failed to import this file, please make sure your provided a valid CSV file."})}),n.jsx("div",{className:"flex justify-start pt-6 gap-2",children:n.jsx(Y,{variant:"outline",onClick:I,children:"Close"})})]}),"renderErrorStep"),F=s(()=>{switch(i.step){case"idle":case"file_selected":return T();case"parsing":return P();case"importing":return E();case"error":return O();case"preview":case"complete":return null;default:return _t(i)}},"renderMainDialogContent"),A=e&&"preview"!==i.step&&"complete"!==i.step,D=e&&"preview"===i.step&&v,L=e&&"complete"===i.step;return n.jsxs(n.Fragment,{children:[n.jsx(Z,{open:A,onOpenChange:I,children:n.jsx(ee,{className:"max-w-2xl",children:n.jsxs(u,{className:"flex flex-col gap-4",children:[n.jsxs(se,{children:[n.jsx(te,{children:"Import Contacts"}),n.jsx(ae,{children:"Upload a CSV file to import contacts into your CRM."})]}),n.jsx("div",{className:"flex flex-col space-y-2",children:F()})]})})}),D&&v&&n.jsx(Z,{open:!0,onOpenChange:z,children:n.jsxs(ee,{className:"sm:max-w-7xl h-[90vh] flex flex-col p-0",children:[n.jsxs(se,{className:"px-6 pt-6 pb-4 border-b",children:[n.jsx(te,{children:"Import Preview"}),n.jsx(ae,{children:"Review and map columns before importing your contacts."})]}),n.jsx("div",{className:"flex-1 overflow-y-auto px-6",children:n.jsx(pt,{preview:v,onContinue:y,onCancel:z,onMappingChange:x,userOverrides:d})})]})}),L&&"complete"===i.step&&n.jsx(xt,{open:!0,onClose:I,result:i.result,allowRetry:!1})]})}s(Ht,"ContactImportDialog");const Jt=s(()=>{const[e,t]=je.useState(!1),a=s(()=>{t(!0)},"handleOpenModal"),r=s(()=>{t(!1)},"handleCloseModal");return n.jsxs(n.Fragment,{children:[n.jsxs(Y,{variant:"outline",onClick:a,className:"flex items-center gap-2 cursor-pointer",children:[n.jsx(rs,{})," Import"]}),n.jsx(Ht,{open:e,onClose:r})]})},"ContactImportButton"),Kt=s(()=>{const e=ve();return n.jsxs("div",{className:"flex flex-col justify-center items-center gap-3",style:{height:`calc(100dvh - ${e}px)`},children:[n.jsx("img",{src:"./img/empty.svg",alt:"No contacts found"}),n.jsxs("div",{className:"flex flex-col gap-0 items-center",children:[n.jsx("h2",{className:"text-lg font-bold",children:"No contacts found"}),n.jsx("p",{className:"text-sm text-muted-foreground text-center mb-4",children:"It seems your contact list is empty."})]}),n.jsxs("div",{className:"flex flex-row gap-2",children:[n.jsx(_,{label:"New Contact"}),n.jsx(Jt,{})]})]})},"ContactEmpty"),Yt=s(()=>{const{data:e}=t(),{filterValues:a,setFilters:r}=h(),{data:i}=p("tags",{pagination:{page:1,perPage:10},sort:{field:"name",order:"ASC"}}),{data:l}=p("organizations",{pagination:{page:1,perPage:100},sort:{field:"name",order:"ASC"},filter:{deleted_at:null}}),o=s(e=>{if("all"===e){const{organization_id:e,...s}=a||{};r(s)}else r({...a,organization_id:Number(e)})},"handleOrganizationChange"),c=a?.organization_id?String(a.organization_id):"all";return n.jsxs("div",{className:"flex flex-col gap-4","data-tutorial":"contact-filters",children:[n.jsx(x,{children:n.jsx(C,{source:"q",placeholder:"Search contacts..."})}),n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs(hs,{label:"Last activity",icon:n.jsx(Ze,{className:"h-4 w-4"}),children:[n.jsx(ps,{className:"w-full justify-between",label:"Today",value:{"last_seen@gte":fs().toISOString(),"last_seen@lte":void 0}}),n.jsx(ps,{className:"w-full justify-between",label:"This week",value:{"last_seen@gte":js(new Date).toISOString(),"last_seen@lte":void 0}}),n.jsx(ps,{className:"w-full justify-between",label:"Before this week",value:{"last_seen@gte":void 0,"last_seen@lte":js(new Date).toISOString()}}),n.jsx(ps,{className:"w-full justify-between",label:"Before this month",value:{"last_seen@gte":void 0,"last_seen@lte":ws(new Date).toISOString()}}),n.jsx(ps,{className:"w-full justify-between",label:"Before last month",value:{"last_seen@gte":void 0,"last_seen@lte":vs(ws(new Date)).toISOString()}})]}),n.jsx(hs,{label:"Tags",icon:n.jsx(Ge,{className:"h-4 w-4"}),children:i&&i.map(e=>n.jsx(ps,{multiselect:!0,className:"w-full justify-between",label:n.jsx(U,{variant:"secondary",className:ie("text-xs font-normal cursor-pointer",xs(e?.color)),children:e?.name}),value:{tags:e.id}},e.id))}),n.jsx(hs,{label:"Organization",icon:n.jsx(qe,{className:"h-4 w-4"}),children:n.jsxs(B,{value:c,onValueChange:o,children:[n.jsx(q,{className:"w-full min-h-11 bg-background border-border text-foreground","aria-label":"Filter by organization",children:n.jsx(G,{placeholder:"All Organizations"})}),n.jsxs(Q,{className:"max-h-60",children:[n.jsx(H,{value:"all",className:"min-h-11",children:n.jsx("span",{className:"text-muted-foreground",children:"All Organizations"})}),l?.map(e=>n.jsx(H,{value:String(e.id),className:"min-h-11",children:n.jsx("span",{className:"truncate",title:e.name,children:e.name})},e.id))]})]})}),n.jsx(hs,{icon:n.jsx(is,{className:"h-4 w-4"}),label:"Account Manager",children:n.jsx(ps,{className:"w-full justify-between",label:"Me",value:{sales_id:e?.id}})})]})]})},"ContactListFilter");function Xt({record:e,mode:t,onModeToggle:a}){const[r]=g(),i=f(),l=s(async s=>{try{await r("contacts",{id:e.id,data:s,previousData:e}),i("Contact updated successfully",{type:"success"}),a?.()}catch(t){i("Error updating contact",{type:"error"})}},"handleSave");return"edit"===t?n.jsx(o,{value:e,children:n.jsx(u,{id:"slide-over-edit-form",onSubmit:l,record:e,children:n.jsx("div",{className:"space-y-6",children:n.jsx(Is,{})})})}):n.jsx(o,{value:e,children:n.jsxs("div",{className:"space-y-6",children:[n.jsx(Ss,{title:"Identity",children:n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx(Rs,{}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("h3",{className:"text-lg font-semibold",children:[e.first_name," ",e.last_name]}),e.gender&&n.jsx("p",{className:"text-sm text-muted-foreground",children:e.gender}),e.title&&n.jsx("p",{className:"text-sm text-muted-foreground",children:e.title})]})]})}),n.jsx(Ss,{title:"Position",children:n.jsx(M,{children:n.jsxs(V,{className:"p-4 space-y-2",children:[e.organization_id&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(qe,{className:"size-4 text-muted-foreground"}),n.jsx(pe,{source:"organization_id",reference:"organizations",link:"show",children:n.jsx(me,{source:"name",className:"font-medium"})})]}),e.department&&n.jsxs("div",{className:"text-sm",children:[n.jsx("span",{className:"text-muted-foreground",children:"Department: "}),n.jsx("span",{className:"font-medium",children:e.department})]}),e.title&&n.jsxs("div",{className:"text-sm",children:[n.jsx("span",{className:"text-muted-foreground",children:"Title: "}),n.jsx("span",{className:"font-medium",children:e.title})]})]})})}),n.jsx(Ss,{title:"Contact Info",children:n.jsxs("div",{className:"space-y-3",children:[e.email&&e.email.length>0&&n.jsx(ys,{source:"email",children:n.jsx(gs,{className:"flex-col gap-2",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(ls,{className:"size-4 text-muted-foreground"}),n.jsx(ks,{source:"email"}),n.jsx(me,{source:"type",className:"text-xs text-muted-foreground"})]})})}),e.phone&&e.phone.length>0&&n.jsx(ys,{source:"phone",children:n.jsx(gs,{className:"flex-col gap-2",children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(os,{className:"size-4 text-muted-foreground"}),n.jsx(me,{source:"number"}),n.jsx(me,{source:"type",className:"text-xs text-muted-foreground"})]})})}),e.linkedin_url&&n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(cs,{className:"size-4 text-muted-foreground"}),n.jsx("a",{href:e.linkedin_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline",children:"LinkedIn Profile"})]})]})}),n.jsx(Ss,{title:"Account",children:n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"text-sm",children:[n.jsx("span",{className:"text-muted-foreground",children:"Added on "}),n.jsx(xe,{source:"first_seen",options:{year:"numeric",month:"long",day:"numeric"}})]}),n.jsxs("div",{className:"text-sm",children:[n.jsx("span",{className:"text-muted-foreground",children:"Last activity on "}),n.jsx(xe,{source:"last_seen",options:{year:"numeric",month:"long",day:"numeric"}})]}),n.jsxs("div",{className:"text-sm",children:[n.jsx("span",{className:"text-muted-foreground",children:"Followed by "}),n.jsx(pe,{source:"sales_id",reference:"sales",children:n.jsx(zs,{})})]})]})}),e.tags&&e.tags.length>0&&n.jsx(Ss,{title:"Tags",children:n.jsx("div",{className:"flex flex-wrap gap-2",children:e.tags.map(e=>n.jsx(pe,{record:{tag_id:e},source:"tag_id",reference:"tags",link:!1,children:n.jsx(U,{variant:"outline",children:n.jsx(me,{source:"name"})})},e))})}),e.notes&&n.jsx(Ss,{title:"Notes",children:n.jsx(M,{children:n.jsx(V,{className:"p-4",children:n.jsx("p",{className:"text-sm whitespace-pre-wrap",children:e.notes})})})})]})})}function Zt({record:e,mode:s}){return n.jsx(o,{value:e,children:n.jsxs("div",{className:"space-y-4",children:[n.jsx(Ts,{target:"contact_id",reference:"contactNotes",sort:{field:"created_at",order:"DESC"},children:n.jsx(Ps,{reference:"contacts"})}),n.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"view"===s?"Notes are visible to all team members":"Add notes to track important information about this contact"})]})})}s(Xt,"ContactDetailsTab"),s(Zt,"ContactNotesTab");const ea=s(({contactId:e})=>{const[t,a]=je.useState(!1),{data:r,isPending:i,error:l,refetch:o}=p("activities",{filter:{contact_id:e},sort:{field:"created_at",order:"DESC"},pagination:{page:1,perPage:Es}}),c="string"==typeof e?parseInt(e,10):e;if(i)return n.jsx("div",{className:"space-y-4",children:[1,2,3].map(e=>n.jsxs("div",{className:"p-4 border border-border rounded-lg",children:[n.jsx(ue,{className:"h-4 w-32 mb-2"}),n.jsx(ue,{className:"h-3 w-full mb-1"}),n.jsx(ue,{className:"h-3 w-3/4"})]},e))});if(l)return n.jsx("div",{className:"text-center py-8 text-destructive",children:"Failed to load activities"});const d=r||[];return n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"flex justify-end",children:n.jsxs(Y,{variant:"outline",className:"h-11 gap-2",onClick:s(()=>a(!0),"onClick"),children:[n.jsx(ds,{className:"h-4 w-4"}),"Log Activity"]})}),0===d.length?n.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No activities recorded yet"}):n.jsx("div",{className:"space-y-3",children:d.map(e=>n.jsx(Os,{activity:e},e.id))}),n.jsx(he,{open:t,onOpenChange:a,entityContext:{contactId:c},config:{enableDraftPersistence:!1,showSaveAndNew:!1},onSuccess:s(()=>{o()},"onSuccess")})]})},"ActivitiesTab");function sa({record:e}){const{data:s,isLoading:t}=j("organizations",{id:e.organization_id},{enabled:!!e.organization_id});if(!e.organization_id||t||!s)return null;const a=[e.first_name,e.last_name].filter(Boolean).join(" ");return n.jsxs("nav",{"aria-label":"Contact hierarchy",className:"flex items-center gap-0.5 text-sm -ml-2",children:[n.jsxs(we,{to:`/organizations?view=${s.id}`,className:"inline-flex items-center gap-1.5 min-h-11 px-2 text-muted-foreground hover:text-primary hover:bg-muted/50 rounded-md transition-colors truncate max-w-[200px]",title:s.name,children:[n.jsx(qe,{className:"h-4 w-4 shrink-0"}),s.name]}),n.jsx(ms,{className:"h-4 w-4 text-muted-foreground shrink-0"}),n.jsxs("span",{className:"flex items-center gap-1.5 min-h-11 px-2 text-foreground font-medium truncate",children:[n.jsx(Ue,{className:"h-4 w-4 shrink-0"}),a||`Contact #${e.id}`]})]})}function ta({recordId:e,isOpen:t,mode:a,onClose:r,onModeToggle:i}){const l=[{key:"details",label:"Details",component:Xt,icon:Ue},{key:"activities",label:"Activities",component:s(({record:e})=>n.jsx(ea,{contactId:e.id}),"component"),icon:us,countFromRecord:s(e=>e.nb_activities,"countFromRecord")},{key:"notes",label:"Notes",component:Zt,icon:ss,countFromRecord:s(e=>e.nb_notes,"countFromRecord")}],o=s(e=>`${e.first_name} ${e.last_name}`,"getContactName");return n.jsx(ge,{resource:"contacts",recordId:e,isOpen:t,onClose:r,mode:a,onModeToggle:i,tabs:l,recordRepresentation:o,breadcrumbComponent:sa,loadingSkeleton:S})}function aa({status:e}){if(!e)return n.jsx(U,{className:"text-xs px-2 py-1 tag-gray",children:"--"});const{label:s,className:t}={cold:{label:"Cold",className:"tag-blue"},warm:{label:"Warm",className:"tag-amber"},hot:{label:"Hot",className:"tag-pink"},"in-contract":{label:"Contract",className:"tag-sage"}}[e]||{label:e.charAt(0).toUpperCase()+e.slice(1),className:"tag-gray"};return n.jsx(U,{className:`text-xs px-2 py-1 ${t}`,children:s})}s(sa,"ContactHierarchyBreadcrumb"),s(ta,"ContactSlideOver"),s(aa,"ContactStatusBadge");const na=As,ra=Ds;function ia(e,s){return e?.find(e=>e.type===s)?.value}function la(e,s){return e?.find(e=>e.type===s)?.value}function oa(e){return{email_work:ia(e,"work"),email_home:ia(e,"home"),email_other:ia(e,"other")}}function ca(e){return{phone_work:la(e,"work"),phone_home:la(e,"home"),phone_other:la(e,"other")}}s(ia,"extractEmailByType"),s(la,"extractPhoneByType"),s(oa,"flattenEmailsForExport"),s(ca,"flattenPhonesForExport");const da=s(e=>{if(null==e)return"";const s=String(e);return["=","-","+","@","\t","\r"].some(e=>s.startsWith(e))?`\t${s}`:s},"sanitizeForCSV"),ma=s(async(e,s)=>{const t=await s(e,"sales_id","sales"),a=await s(e,"tags","tags"),n=await s(e,"organization_id","organizations"),r=e.map(e=>({first_name:e.first_name,last_name:e.last_name,gender:e.gender,title:e.title,organization_name:e.organization_id?n[e.organization_id]?.name:void 0,...oa(e.email),...ca(e.phone),avatar:e.avatar,first_seen:e.first_seen,last_seen:e.last_seen,tags:Ls(e.tags,a),linkedin_url:e.linkedin_url,sales:Ms(e.sales_id?t[e.sales_id]:null),department:e.department||"",id:e.id,sales_id:e.sales_id,organization_id:e.organization_id})).map(e=>Object.fromEntries(Object.entries(e).map(([e,s])=>[e,da(s)])));return w(r,{rowDelimiter:",",endOfLine:"\r\n"},(e,s)=>{if(e)throw new Error(`CSV export failed: ${e.message}`);v(s,"contacts")})},"contactExporter");function ua(e){if(!e||"string"!=typeof e)return String(e);const s=new Date(e);return isNaN(s.getTime())?String(e):Ns(s)?"Today":_s(s)?"This week":Cs(s)?"This month":bs(s,"MMM d, yyyy")}s(ua,"formatDateLabel");const ha=P([{key:"tags",label:"Tag",type:"multiselect",reference:"tags"},{key:"organization_id",label:"Organization",type:"reference",reference:"organizations"},{key:"last_seen@gte",label:"Activity after",type:"date-range",formatLabel:ua,removalGroup:"last_seen_range"},{key:"last_seen@lte",label:"Activity before",type:"date-range",formatLabel:ua,removalGroup:"last_seen_range"},{key:"sales_id",label:"Owner",type:"reference",reference:"sales"}]),pa=s(()=>{const{data:e,isPending:s}=t(),{slideOverId:a,isOpen:r,mode:i,openSlideOver:l,closeSlideOver:o,toggleMode:c}=fe();return z("contacts"),s?n.jsx(I,{}):e?n.jsxs(n.Fragment,{children:[n.jsx("div",{"data-tutorial":"contacts-list",children:n.jsxs(b,{title:!1,actions:n.jsx(ga,{}),perPage:25,sort:{field:"last_seen",order:"DESC"},exporter:ma,children:[n.jsx(xa,{openSlideOver:l,isSlideOverOpen:r}),n.jsx(R,{})]})}),n.jsx(ta,{recordId:a,isOpen:r,mode:i,onClose:o,onModeToggle:c}),n.jsx(Ws,{chapter:"contacts",position:"bottom-left"})]}):null},"ContactList"),xa=s(({openSlideOver:e,isSlideOverOpen:t})=>{const{data:a,isPending:r,filterValues:i}=h(),{focusedIndex:l}=T({onSelect:s(s=>e(Number(s),"view"),"onSelect"),enabled:!t}),o=i&&Object.keys(i).length>0;return r?n.jsx(E,{resource:"contacts",filterComponent:n.jsx(Yt,{}),children:n.jsx(I,{})}):a?.length||o?n.jsxs(n.Fragment,{children:[n.jsxs(E,{resource:"contacts",filterComponent:n.jsx(Yt,{}),children:[n.jsx(O,{filterConfig:ha}),n.jsxs(F,{onRowClick:s(s=>e(Number(s),"view"),"onRowClick"),focusedIndex:l,children:[n.jsx($s,{label:"",sortable:!1,render:s(e=>n.jsx(Rs,{record:e,width:40,height:40}),"render"),cellClassName:"hidden lg:table-cell",headerClassName:"hidden lg:table-cell"}),n.jsx($s,{label:"Name",sortBy:"first_name",render:s(e=>na(e.first_name,e.last_name),"render")}),n.jsx($s,{label:"Role",sortBy:"title",render:s(e=>ra(e.title,e.department),"render"),cellClassName:"hidden lg:table-cell",headerClassName:"hidden lg:table-cell"}),n.jsx(pe,{source:"organization_id",reference:"organizations",label:"Organization",link:!1,sortable:!0,children:n.jsx(me,{source:"name"})}),n.jsx($s,{label:"Status",sortable:!1,render:s(e=>n.jsx(aa,{status:e.status}),"render")}),n.jsx($s,{label:"Notes",sortable:!1,render:s(e=>e.nb_notes??0,"render"),textAlign:"center",cellClassName:"hidden lg:table-cell",headerClassName:"hidden lg:table-cell"}),n.jsx(xe,{source:"last_seen",label:"Last Activity",sortable:!0,showTime:!1,cellClassName:"hidden lg:table-cell",headerClassName:"hidden lg:table-cell"})]})]}),n.jsx(N,{})]}):n.jsx(Kt,{})},"ContactListLayout"),ga=s(()=>n.jsxs(Fs,{children:[n.jsx("span",{"data-tutorial":"contact-sort-btn",children:n.jsx(k,{fields:["first_name","last_name","last_seen"]})}),n.jsx("span",{"data-tutorial":"contact-export-btn",children:n.jsx(y,{exporter:ma})}),n.jsx("span",{"data-tutorial":"create-contact-btn",children:n.jsx(_,{})})]}),"ContactListActions");export{pa as ContactList,pa as default};
