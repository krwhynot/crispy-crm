var e=Object.defineProperty,a=(a,s)=>e(a,"name",{value:s,configurable:!0});import{aI as s,ak as n,a1 as i,ax as r,aJ as o,aF as t,j as l,al as c,bI as d,aV as u,bJ as m,bk as p}from"./chunk-DWisBx5Y.js";import{r as x}from"./chunk-CPNr-gD1.js";import{i as h,k as g,l as f,o as j,B as b,aq as y,q as v,s as _,t as C,aa as N,v as w,w as k,x as z,g as T,y as D,ar as I}from"../assets/index-BMLg8LT4.js";import{X as O,ad as S}from"./chunk-BePsjq0D.js";import{u as A,a as V}from"./chunk-DAbVPE3R.js";import{A as R}from"./chunk-CL328sMP.js";import{d as F}from"./chunk-DlK383r0.js";const L=a(e=>{const{filterToQuery:d=E,inputText:u}=e,{allChoices:m=[],source:p,resource:k,isFromReference:z,setFilters:T}=s(e),{id:D,field:I,isRequired:S}=n({...e,source:p}),A=i(),{placeholder:V=A("ra.action.search",{_:"Search..."})}=e,R=r(k),{getChoiceText:F,getChoiceValue:L}=o({optionText:e.optionText??(z?R:"name"),optionValue:e.optionValue??"id",disableValue:e.disableValue,translateChoice:e.translateChoice??!z}),M=x.useRef(null),[P,q]=x.useState(!1),B=t(e=>{I.onChange(I.value.filter(a=>a!==L(e)))}),K=t(e=>{const a=M.current;a&&("Delete"!==e.key&&"Backspace"!==e.key||""===a.value&&I.onChange(I.value.slice(0,-1)),"Escape"===e.key&&a.blur())}),$=m.filter(e=>!I.value.includes(L(e))),J=m.filter(e=>I.value.includes(L(e))),[Q,G]=x.useState(""),H=x.useCallback(e=>"function"==typeof u?u(e):void 0!==u?u:F(e),[u,F]);return l.jsxs(h,{className:e.className,id:D,name:I.name,children:[!1!==e.label&&l.jsx(g,{children:l.jsx(c,{label:e.label,source:e.source??p,resource:k,isRequired:S})}),l.jsx(f,{children:l.jsxs(j,{onKeyDown:K,shouldFilter:!z,className:"overflow-visible bg-transparent",children:[l.jsx("div",{className:"group rounded-md bg-transparent dark:bg-input/30 border border-input px-3 py-1.75 text-sm transition-all ring-offset-background focus-within:border-ring focus-within:ring-ring/50 focus-within:ring-[3px]",children:l.jsxs("div",{className:"flex flex-wrap gap-1",children:[J.map(e=>l.jsxs(b,{variant:"outline",children:[H(e),l.jsxs("button",{className:"ml-1 rounded-full outline-none ring-offset-background focus:ring-2 focus:ring-ring focus:ring-offset-2",onKeyDown:a(a=>{"Enter"===a.key&&B(e)},"onKeyDown"),onMouseDown:a(e=>{e.preventDefault(),e.stopPropagation()},"onMouseDown"),onClick:a(a=>{a.preventDefault(),B(e)},"onClick"),children:[l.jsx("span",{className:"sr-only",children:A("ra.action.remove",{_:"Remove"})}),l.jsx(O,{className:"h-3 w-3"})]})]},L(e))),l.jsx(y.Input,{ref:M,value:Q,onValueChange:a(e=>{G(e),z&&T(d(e),void 0,!0)},"onValueChange"),onBlur:a(()=>q(!1),"onBlur"),onFocus:a(()=>q(!0),"onFocus"),placeholder:V,className:"ml-2 flex-1 bg-transparent outline-none placeholder:text-muted-foreground"})]})}),l.jsx("div",{className:"relative",children:l.jsx(v,{children:P&&$.length>0?l.jsx("div",{className:"absolute top-2 z-10 w-full rounded-md border bg-popover text-popover-foreground shadow-md outline-none animate-in",children:l.jsx(_,{className:"h-full overflow-auto",children:$.map(e=>l.jsx(C,{onMouseDown:a(e=>{e.preventDefault(),e.stopPropagation()},"onMouseDown"),onSelect:a(()=>{G(""),z&&T(d("")),I.onChange([...I.value,L(e)])},"onSelect"),className:"cursor-pointer",children:F(e)},L(e)))})}):null})})]})}),l.jsx(N,{helperText:e.helperText}),l.jsx(w,{})]})},"AutocompleteArrayInput"),E=a(e=>({q:e}),"DefaultFilterToQuery"),M=a(e=>{const{children:a=P,reference:s,sort:n,filter:i=q}=e;if(1!==x.Children.count(a))throw new Error("<ReferenceArrayInput> only accepts a single child (like <AutocompleteArrayInput>)");const r=d({...e,sort:n,filter:i});return l.jsx(u,{value:s,children:l.jsx(m,{value:r,children:a})})},"ReferenceArrayInput"),P=l.jsx(L,{}),q={},B=a(e=>{const{setValue:a}=A(),s=V({name:"customer_organization_id"}),n=V({name:"principal_organization_id"}),i=V({name:"name"}),{data:r,isLoading:o}=p("organizations",{id:s},{enabled:!!s}),{data:t,isLoading:l}=p("organizations",{id:n},{enabled:!!n}),c=o||l,d=x.useCallback(()=>[r?.name,t?.name,(new Date).toLocaleDateString("en-US",{month:"short",year:"numeric"})].filter(Boolean).join(" - "),[r?.name,t?.name]),u=x.useCallback(()=>{if(!c){const e=d();e&&a("name",e,{shouldValidate:!0,shouldDirty:!0})}},[d,a,c]);return x.useEffect(()=>{if("create"===e&&!i&&!c){const e=d();e&&a("name",e,{shouldValidate:!0,shouldDirty:!0})}},[e,i,d,a,c]),{regenerate:u,isLoading:c}},"useAutoGenerateName"),K=[{id:"referral",name:"Referral"},{id:"trade_show",name:"Trade Show"},{id:"website",name:"Website"},{id:"cold_call",name:"Cold Call"},{id:"email_campaign",name:"Email Campaign"},{id:"social_media",name:"Social Media"},{id:"partner",name:"Partner"},{id:"existing_customer",name:"Existing Customer"}],$=a(()=>l.jsx(k,{source:"lead_source",label:"Lead Source",choices:K,helperText:!1}),"LeadSourceInput"),J=a(({mode:e})=>l.jsxs("div",{className:"flex flex-col gap-2 p-3",children:[l.jsx(Q,{mode:e}),l.jsx(G,{}),l.jsx(H,{}),l.jsx(U,{})]}),"OpportunityInputs"),Q=a(({mode:e})=>{const{regenerate:a,isLoading:s}=B(e);return l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsx("h3",{className:"text-sm font-medium mb-2",children:"Opportunity Details"}),l.jsx("div",{className:"relative",children:l.jsx(z,{source:"name",label:"Opportunity name *",helperText:!1,InputProps:{endAdornment:"edit"===e?l.jsx(T,{type:"button",variant:"ghost",size:"sm",onClick:a,disabled:s,children:l.jsx(S,{className:"w-4 h-4"})}):null}})}),l.jsx(z,{source:"description",multiline:!0,rows:1,helperText:!1}),l.jsx(z,{source:"estimated_close_date",label:"Expected Closing Date *",helperText:!1,type:"date"})]})},"OpportunityInfoInputs"),G=a(()=>l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsx("h3",{className:"text-sm font-medium mb-2",children:"Classification & Tracking"}),l.jsxs("div",{className:"grid gap-2 grid-cols-1 md:grid-cols-2 xl:grid-cols-3",children:[l.jsx(k,{source:"stage",label:"Stage *",choices:F,helperText:!1}),l.jsx(k,{source:"priority",label:"Priority *",choices:[{id:"low",name:"Low"},{id:"medium",name:"Medium"},{id:"high",name:"High"},{id:"critical",name:"Critical"}],helperText:!1}),l.jsx($,{})]})]}),"OpportunityClassificationInputs"),H=a(()=>l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsx("h3",{className:"text-sm font-medium mb-2",children:"Key Relationships"}),l.jsxs("div",{className:"grid gap-2 grid-cols-1 md:grid-cols-2 xl:grid-cols-4",children:[l.jsx(D,{source:"customer_organization_id",reference:"organizations",filter:{organization_type:"customer"},children:l.jsx(R,{label:"Customer Organization *",organizationType:"customer"})}),l.jsx(D,{source:"account_manager_id",reference:"sales",children:l.jsx(k,{optionText:a(e=>e?.first_name||e?.last_name?`${e.first_name||""} ${e.last_name||""} (${e.email})`.trim():e?.email||"","optionText"),label:"Account Manager",helperText:!1})}),l.jsx(D,{source:"principal_organization_id",reference:"organizations",filter:{organization_type:"principal"},children:l.jsx(R,{label:"Principal Organization",organizationType:"principal"})}),l.jsx(D,{source:"distributor_organization_id",reference:"organizations",filter:{organization_type:"distributor"},children:l.jsx(R,{label:"Distributor Organization",organizationType:"distributor"})})]})]}),"OpportunityOrganizationInputs"),U=a(()=>{const e=V({name:"customer_organization_id"});return l.jsxs("div",{className:"flex flex-col gap-2",children:[l.jsx("h3",{className:"text-sm font-medium mb-2",children:"Contacts *"}),l.jsx(M,{source:"contact_ids",reference:"contacts_summary",filter:e?{organization_id:e}:{},children:l.jsx(L,{label:!1,optionText:I,helperText:!1})})]})},"OpportunityContactsInput");export{L as A,J as O};
