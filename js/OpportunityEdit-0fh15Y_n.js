var e=Object.defineProperty,t=(t,s)=>e(t,"name",{value:s,configurable:!0});import{P as s,u as a,j as i,U as r,$ as n,a0 as c,au as o,J as l}from"./chunk-ByJg_QQB.js";import{u as d,at as m,au as u,a4 as p,i as j,j as h,k as x,m as g,av as f,n as y,t as v,B as k,C as N,a as b,w as _}from"../assets/index-BoLku8RR.js";import{S}from"./chunk-B1s-jt27.js";import{D as C}from"./chunk-6VRQ4sAj.js";import"./chunk-1NZFT-6z.js";import{C as w}from"./chunk-BM66RvuK.js";import{R as z}from"./chunk-DbeoRBEW.js";import{F as D}from"./chunk-C0lbEKTL.js";import{O as F}from"./chunk-sKlZvX2D.js";import{O}from"./chunk-nZ5rfQld.js";import{R as V}from"./chunk-Sp4WOLwD.js";import{a as E}from"./chunk-Cw2QhEKy.js";import{d as A,C as I}from"./chunk-JxeXaC9i.js";import{N as P}from"./chunk-D2aCv_Ah.js";import"./chunk-DwAffUXc.js";import"./chunk-knA4lag3.js";import"./chunk-Tyyhsnez.js";import"./chunk-Bc6KM1xM.js";import"./chunk-XoqkUGE_.js";import"./chunk-CRKBdUTG.js";import"./chunk-D6FmavVW.js";import"./chunk-nUtrHAIa.js";import"./chunk-CMQLDEz_.js";import"./chunk-C_u3nriX.js";import"./chunk-BLkgKceb.js";import"./chunk-DRZQUu5H.js";import"./chunk-C5fZsuMg.js";import"./chunk-B8xrZQJc.js";import"./chunk-DpghI3EP.js";import"./chunk-DhfTvo06.js";import"./chunk-B9H_70fs.js";import"./chunk-C4sNritB.js";import"./chunk-DsNwAyt-.js";import"./chunk-CypxJXwf.js";import"./chunk-B0BZInrb.js";import"./chunk-CIlS_x6D.js";import"./chunk-X0dz3Jmp.js";import"./chunk-IswQf-N3.js";import"./chunk-D62ZQQIe.js";import"./chunk-CFj7NhUg.js";import"./chunk-j7Lqvg-1.js";const R=t(({control:e,organizationId:s,error:a})=>{const{data:n,isPending:c}=r("contacts_summary",{filter:{organization_id:s},pagination:{page:1,perPage:100}});return i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{htmlFor:"contact_id",className:"text-sm font-medium",children:"Contact"}),i.jsx(I,{name:"contact_id",control:e,render:t(({field:e})=>i.jsxs(j,{value:e.value?.toString()||"none",onValueChange:t(t=>e.onChange("none"===t?null:Number(t)),"onValueChange"),disabled:c,children:[i.jsx(h,{id:"contact_id",children:i.jsx(x,{placeholder:c?"Loading...":"Select contact (optional)"})}),i.jsxs(g,{children:[i.jsx(y,{value:"none",children:"None"}),n?.map(e=>i.jsxs(y,{value:e.id.toString(),children:[e.first_name," ",e.last_name]},e.id))]})]}),"render")}),a&&i.jsx("p",{className:"text-sm text-destructive",children:a})]})},"ContactSelectField"),T=t(({opportunity:e,onSuccess:r})=>{const n=s(),c=a(),{opportunityStages:o}=d(),l=m.partial().parse({}),{control:N,handleSubmit:b,setValue:_,reset:S,formState:{errors:C,isSubmitting:w}}=A({resolver:E(u),defaultValues:{activity_date:new Date(l.activity_date),type:l.type,contact_id:null,stage:e.stage,subject:""}}),z=t(async t=>{try{await n.update("opportunities",{id:e.id,data:{stage:t},previousData:e}),_("stage",t),c("Stage updated successfully",{type:"success"})}catch(s){c("Error updating stage",{type:"error"})}},"handleStageChange"),D=t(async t=>{try{await n.create("activities",{data:{activity_type:"interaction",type:t.type,subject:t.subject,activity_date:t.activity_date.toISOString(),contact_id:t.contact_id,opportunity_id:e.id,organization_id:e.customer_organization_id}}),c("Activity created successfully",{type:"success"}),S(),r?.()}catch(s){c("Error creating activity",{type:"error"})}},"onSubmit");return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{htmlFor:"activity_date",className:"text-sm font-medium",children:"Date"}),i.jsx(I,{name:"activity_date",control:N,render:t(({field:e})=>i.jsx(p,{id:"activity_date",type:"date",value:e.value instanceof Date?e.value.toISOString().split("T")[0]:"",onChange:t(t=>{const s=t.target.value?new Date(t.target.value):new Date;e.onChange(s)},"onChange")}),"render")}),C.activity_date&&i.jsx("p",{className:"text-sm text-destructive",children:C.activity_date.message})]}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{htmlFor:"type",className:"text-sm font-medium",children:"Type"}),i.jsx(I,{name:"type",control:N,render:t(({field:e})=>i.jsxs(j,{value:e.value,onValueChange:e.onChange,children:[i.jsx(h,{id:"type",children:i.jsx(x,{placeholder:"Select type"})}),i.jsx(g,{children:f.map(e=>i.jsx(y,{value:e.value,children:e.label},e.value))})]}),"render")}),C.type&&i.jsx("p",{className:"text-sm text-destructive",children:C.type.message})]}),i.jsx(R,{control:N,organizationId:e.customer_organization_id,error:C.contact_id?.message}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{htmlFor:"stage",className:"text-sm font-medium",children:"Stage"}),i.jsx(I,{name:"stage",control:N,render:t(({field:e})=>i.jsxs(j,{value:e.value,onValueChange:t(t=>{e.onChange(t),z(t)},"onValueChange"),children:[i.jsx(h,{id:"stage",children:i.jsx(x,{placeholder:"Select stage"})}),i.jsx(g,{children:o.map(e=>i.jsx(y,{value:e.value,children:e.label},e.value))})]}),"render")}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Changing stage will update the opportunity immediately"}),C.stage&&i.jsx("p",{className:"text-sm text-destructive",children:C.stage.message})]})]}),i.jsxs("div",{className:"flex flex-col gap-2",children:[i.jsx("label",{htmlFor:"subject",className:"text-sm font-medium",children:"Subject"}),i.jsx(I,{name:"subject",control:N,render:t(({field:e})=>i.jsx(v,{...e,id:"subject",placeholder:"Enter activity subject...",className:"min-h-12"}),"render")}),C.subject&&i.jsx("p",{className:"text-sm text-destructive",children:C.subject.message})]}),i.jsx("div",{className:"flex justify-end",children:i.jsx(k,{type:"button",onClick:b(D),disabled:w,className:"bg-primary text-primary-foreground hover:bg-primary/90",children:w?"Creating...":"Add Activity"})})]})},"ActivityNoteForm"),B=t(()=>{const e=n();return e?i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Activity History"}),i.jsx(T,{opportunity:e}),i.jsx(S,{}),i.jsx(V,{target:"opportunity_id",reference:"opportunityNotes",sort:{field:"created_at",order:"DESC"},children:i.jsx(P,{reference:"opportunities"})})]}):null},"OpportunityActivitySection"),H=t(()=>{const e=c();return i.jsx(o,{actions:!1,redirect:"show",mutationMode:"pessimistic",mutationOptions:{onSuccess:t(()=>{e.invalidateQueries({queryKey:["opportunities"]})},"onSuccess")},children:i.jsx("div",{className:"mt-2",children:i.jsx(K,{})})})},"OpportunityEdit"),K=t(()=>{const e=n();return e?i.jsx(l,{className:"flex flex-1 flex-col gap-4 pb-2",defaultValues:e,children:i.jsx(N,{children:i.jsxs(b,{className:"pt-6",children:[i.jsx(L,{}),i.jsxs("div",{className:"mt-6",children:[i.jsx(O,{mode:"edit"}),i.jsx(S,{className:"my-6"}),i.jsx(B,{})]}),i.jsx(D,{children:i.jsxs("div",{className:"flex flex-row gap-2 justify-between w-full",children:[i.jsx(C,{}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(w,{}),i.jsx(_,{})]})]})})]})})},e.id):null},"OpportunityEditForm"),L=t(()=>{const e=n();return e?i.jsx("div",{className:"flex justify-between items-start mb-4",children:i.jsxs("div",{className:"flex items-center gap-4",children:[e.customer_organization_id&&i.jsx(z,{source:"customer_organization_id",reference:"organizations",link:!1,children:i.jsx(F,{})}),i.jsxs("h2",{className:"text-2xl font-semibold",children:["Edit ",e.name]})]})}):null},"EditHeader");export{H as OpportunityEdit,H as default};
