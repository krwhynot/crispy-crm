var e=Object.defineProperty,s=(s,t)=>e(s,"name",{value:t,configurable:!0});import{u as t,j as a}from"./chunk-ByJg_QQB.js";import{r as o,R as n}from"./chunk-1NZFT-6z.js";import{P as r,C as l,D as i}from"./chunk-XoqkUGE_.js";import{by as d,B as c,Z as u,$ as m,a0 as x,a1 as h,ao as p,d as f,s as j,S as g}from"../assets/index-BoLku8RR.js";import{C as b}from"./chunk-Dn-NAOCt.js";import{f as k,aZ as w,aq as y,s as N,y as v,a7 as C,aa as T,a_ as D,a$ as S,ag as I,U as $,z,ad as P,a5 as F}from"./chunk-Bc6KM1xM.js";import{d as M,n as V,Z as W,_ as U,o as E}from"./chunk-DwAffUXc.js";import{u as R}from"./chunk-BOz4rw7K.js";import"./chunk-JxeXaC9i.js";import"./chunk-knA4lag3.js";import"./chunk-Tyyhsnez.js";import"./chunk-CRKBdUTG.js";import"./chunk-B5Y5c6gs.js";function K({task:e,onCreateFollowUp:t}){d.success(`Task completed: ${e.subject}`,{description:"Would you like to schedule a follow-up?",duration:5e3,action:{label:"Create Follow-up",onClick:s(()=>t(e),"onClick")}})}s(K,"showFollowUpToast");const _={critical:"bg-destructive text-destructive-foreground",high:"bg-warning/10 text-warning",medium:"bg-primary/10 text-primary",low:"bg-muted text-muted-foreground"},O=s(e=>{switch(e){case"Call":return a.jsx(P,{className:"h-3.5 w-3.5"});case"Email":return a.jsx(z,{className:"h-3.5 w-3.5"});case"Meeting":return a.jsx($,{className:"h-3.5 w-3.5"});case"Follow-up":return a.jsx(I,{className:"h-3.5 w-3.5"});case"Demo":return a.jsx(S,{className:"h-3.5 w-3.5"});case"Proposal":return a.jsx(D,{className:"h-3.5 w-3.5"});default:return a.jsx(T,{className:"h-3.5 w-3.5"})}},"getTaskIcon");function q(e,s){if(e.index!==s.index)return!1;if(e.onComplete!==s.onComplete)return!1;if(e.onSnooze!==s.onSnooze)return!1;if(e.onDelete!==s.onDelete)return!1;if(e.onView!==s.onView)return!1;const t=e.task,a=s.task;return t.id===a.id&&t.subject===a.subject&&t.status===a.status&&t.priority===a.priority&&t.taskType===a.taskType&&t.dueDate.getTime()===a.dueDate.getTime()&&t.relatedTo.name===a.relatedTo.name}s(q,"arePropsEqual$1");const Z=o.memo(s(function({task:e,index:n,onComplete:l,onSnooze:i,onDelete:d,onView:j}){const[g,T]=o.useState(!1),[D,S]=o.useState(!1),I=t(),$=s(s=>{s.target.closest("[data-action-button]")||(s.preventDefault(),s.stopPropagation(),j(e.id))},"handleCardClick"),z=s(async s=>{s.stopPropagation(),T(!0);try{await i(e.id),I("Task snoozed for tomorrow",{type:"success"})}catch{I("Failed to snooze task",{type:"error"})}finally{T(!1)}},"handleSnooze"),P=s(async()=>{S(!0);try{await d(e.id),I("Task deleted",{type:"success"})}catch{I("Failed to delete task",{type:"error"})}finally{S(!1)}},"handleDelete"),F=s(()=>{window.location.href=`/#/tasks/${e.id}`},"handleEdit"),V=_[e.priority]||_.medium;return a.jsx(r,{draggableId:String(e.id),index:n,children:s((t,o)=>a.jsxs("div",{ref:t.innerRef,...t.draggableProps,...t.dragHandleProps,role:"button",tabIndex:0,onClick:$,onKeyDown:s(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),$(e))},"onKeyDown"),className:`\n            bg-card rounded-lg border border-border\n            p-3\n            transition-all duration-200\n            hover:shadow-md hover:-translate-y-0.5\n            cursor-pointer\n            ${o.isDragging?"opacity-60 rotate-1 shadow-lg":"opacity-100"}\n          `,"data-testid":"task-kanban-card",children:[a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("div",{"data-action-button":!0,className:"flex h-11 w-11 shrink-0 items-center justify-center -ml-2 -mt-1",children:a.jsx(b,{className:"h-5 w-5",onCheckedChange:s(async t=>{if(t)try{await l(e.id),K({task:e,onCreateFollowUp:s(e=>{const s=new URLSearchParams;s.set("type","follow_up"),s.set("title",`Follow-up: ${e.subject}`),"opportunity"===e.relatedTo.type?s.set("opportunity_id",String(e.relatedTo.id)):"contact"===e.relatedTo.type&&s.set("contact_id",String(e.relatedTo.id)),window.location.href=`/#/tasks/create?${s.toString()}`},"onCreateFollowUp")})}catch{I("Failed to complete task",{type:"error"})}},"onCheckedChange"),"aria-label":`Complete task: ${e.subject}`})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-1.5 mb-1",children:[O(e.taskType),a.jsx("h3",{className:"font-medium text-sm text-foreground line-clamp-2",children:e.subject})]}),a.jsx("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:a.jsxs("span",{className:"truncate",children:["â†’ ",e.relatedTo.name]})})]}),a.jsxs("div",{"data-action-button":!0,className:"flex items-center gap-0.5 shrink-0 -mr-1",children:[a.jsx(c,{variant:"ghost",size:"sm",className:"h-11 w-11 p-0",onClick:z,disabled:g,title:"Snooze task by 1 day","aria-label":`Snooze "${e.subject}" by 1 day`,children:g?a.jsx(k,{className:"h-4 w-4 animate-spin"}):a.jsx(w,{className:"h-4 w-4"})}),a.jsxs(u,{children:[a.jsx(m,{asChild:!0,children:a.jsx(c,{variant:"ghost",size:"sm",className:"h-11 w-11 p-0","aria-label":`More actions for "${e.subject}"`,disabled:D,children:D?a.jsx(k,{className:"h-4 w-4 animate-spin"}):a.jsx(y,{className:"h-4 w-4"})})}),a.jsxs(x,{align:"end",children:[a.jsxs(h,{onClick:s(()=>j(e.id),"onClick"),children:[a.jsx(N,{className:"mr-2 h-4 w-4"}),"View"]}),a.jsxs(h,{onClick:F,children:[a.jsx(v,{className:"mr-2 h-4 w-4"}),"Edit"]}),a.jsx(p,{}),a.jsxs(h,{onClick:P,className:"text-destructive",children:[a.jsx(C,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})]}),a.jsxs("div",{className:"flex items-center justify-between mt-2 pt-2 border-t border-border/50",children:[a.jsx(f,{className:`text-xs ${V}`,children:e.priority.charAt(0).toUpperCase()+e.priority.slice(1)}),a.jsx("span",{className:"text-xs text-muted-foreground",children:M(e.dueDate,"MMM d")})]})]}),"children")})},"TaskKanbanCard2"),q),A={overdue:{accentColor:"border-destructive",bgColor:"bg-destructive/5",emptyText:"No overdue tasks",emptySubtext:"Great job staying on top of things!"},today:{accentColor:"border-primary",bgColor:"bg-primary/5",emptyText:"No tasks due today",emptySubtext:"Drag tasks here to focus on them today"},thisWeek:{accentColor:"border-muted-foreground",bgColor:"bg-muted/30",emptyText:"No upcoming tasks",emptySubtext:"Plan your week by adding tasks here"}};function B(e,s){if(e.columnId!==s.columnId)return!1;if(e.title!==s.title)return!1;if(e.onComplete!==s.onComplete)return!1;if(e.onSnooze!==s.onSnooze)return!1;if(e.onDelete!==s.onDelete)return!1;if(e.onView!==s.onView)return!1;const t=e.tasks,a=s.tasks;if(t.length!==a.length)return!1;for(let o=0;o<t.length;o++)if(t[o].id!==a[o].id||t[o].status!==a[o].status)return!1;return!0}s(B,"arePropsEqual");const G=n.memo(s(function({columnId:e,title:t,tasks:o,onComplete:n,onSnooze:r,onDelete:i,onView:d}){const c=A[e];return a.jsxs("div",{className:j("flex flex-col rounded-xl border-t-4 bg-card","w-full lg:min-w-0 lg:flex-1","shadow-sm",c.accentColor),"data-testid":`task-kanban-column-${e}`,children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[a.jsx("h2",{className:"font-semibold text-foreground",children:t}),a.jsx("span",{className:"text-sm text-muted-foreground",children:o.length})]}),a.jsx(l,{droppableId:e,children:s((e,s)=>a.jsxs("div",{ref:e.innerRef,...e.droppableProps,className:j("flex-1 p-3 space-y-2 overflow-y-auto","min-h-[120px] transition-colors duration-200",s.isDraggingOver&&c.bgColor),children:[0===o.length?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full min-h-[100px] text-center p-4",children:[a.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:c.emptyText}),a.jsx("p",{className:"text-xs text-muted-foreground/70 mt-1",children:c.emptySubtext})]}):o.map((e,s)=>a.jsx(Z,{task:e,index:s,onComplete:n,onSnooze:r,onDelete:i,onView:d},e.id)),e.placeholder]}),"children")})]})},"TaskKanbanColumn2"),B),H={overdue:"Overdue",today:"Today",thisWeek:"This Week"};function L(){const{tasks:e,loading:n,error:r,completeTask:l,snoozeTask:d,deleteTask:u,viewTask:m,updateTaskDueDate:x}=R(),h=t(),p=o.useMemo(()=>{const s=[],t=[],a=[];for(const o of e)switch(o.status){case"overdue":s.push(o);break;case"today":t.push(o);break;case"tomorrow":case"upcoming":a.push(o)}return{overdue:s,today:t,thisWeek:a}},[e]),j=o.useCallback((e,s)=>{const t=V(new Date);switch(e){case"overdue":default:return s;case"today":return W(U(t,17),0);case"thisWeek":return W(U(E(t,3),17),0)}},[]),b=o.useCallback((s,t)=>{const a=parseInt(s.draggableId,10),o=e.find(e=>e.id===a);if(o){const e=H[s.source.droppableId];t.announce(`Picked up task: ${o.subject}. Currently in ${e}.`)}},[e]),k=o.useCallback((e,s)=>{if(e.destination){const t=H[e.destination.droppableId];s.announce(`Moving to ${t}, position ${e.destination.index+1}`)}},[]),w=o.useCallback(async(s,t)=>{const{destination:a,source:o,draggableId:n}=s;if(!a)return void t.announce("Drag cancelled. Task returned to original position.");if(a.droppableId===o.droppableId&&a.index===o.index)return void t.announce("Dropped in original position.");const r=parseInt(n,10),l=e.find(e=>e.id===r);if(!l)return;const i=a.droppableId;if(i===o.droppableId)return void t.announce(`Reordered within ${H[i]}.`);const d=j(i,l.dueDate);try{await x(r,d),t.announce(`Moved to ${H[i]} at position ${a.index+1}`),h(`Moved to ${H[i]}`,{type:"success"})}catch{t.announce("Failed to move task. Returned to original position."),h("Failed to move task. Please try again.",{type:"error"})}},[e,j,x,h]);if(n)return a.jsxs("div",{className:"flex flex-col p-4",children:[a.jsxs("div",{className:"mb-4 flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx(g,{className:"mb-2 h-6 w-32"}),a.jsx(g,{className:"h-4 w-64"})]}),a.jsx(g,{className:"h-11 w-28"})]}),a.jsx("div",{className:"flex gap-3 flex-col lg:flex-row",children:[1,2,3].map(e=>a.jsxs("div",{className:"flex flex-col rounded-xl border-t-4 border-muted bg-card w-full lg:min-w-0 lg:flex-1 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-border",children:[a.jsx(g,{className:"h-5 w-20"}),a.jsx(g,{className:"h-4 w-6"})]}),a.jsxs("div",{className:"flex-1 p-3 space-y-2 min-h-[120px]",children:[a.jsx(g,{className:"h-20 w-full rounded-lg"}),a.jsx(g,{className:"h-20 w-full rounded-lg"})]})]},e))})]});if(r)return a.jsxs("div",{className:"flex flex-col p-4",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"My Tasks"}),a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-destructive",children:"Failed to load tasks"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:r.message})]})})]});const y=p.overdue.length+p.today.length+p.thisWeek.length;return a.jsxs("div",{className:"flex flex-col",children:[a.jsx("div",{className:"border-b border-border px-4 py-3 shrink-0",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold",children:"My Tasks"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Drag tasks between columns to reschedule"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[p.overdue.length>0&&a.jsxs(f,{variant:"destructive",className:"text-xs",children:[p.overdue.length," overdue"]}),a.jsxs(c,{variant:"outline",size:"sm",className:"h-11 gap-1",onClick:s(()=>{window.location.href="/#/tasks/create"},"onClick"),children:[a.jsx(F,{className:"h-4 w-4"}),"New Task"]})]})]})}),a.jsx("div",{children:0===y?a.jsx("div",{className:"flex items-center justify-center p-8",children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{className:"text-muted-foreground",children:"No tasks to show"}),a.jsx("p",{className:"text-sm text-muted-foreground/70 mt-1",children:"Create a task to get started"})]})}):a.jsx(i,{onDragStart:b,onDragUpdate:k,onDragEnd:w,children:a.jsxs("div",{className:"\n                flex gap-3 p-4\n                flex-col lg:flex-row\n              ","data-testid":"task-kanban-board","data-tutorial":"dashboard-tasks-kanban",children:[a.jsx(G,{columnId:"overdue",title:"Overdue",tasks:p.overdue,onComplete:l,onSnooze:d,onDelete:u,onView:m}),a.jsx(G,{columnId:"today",title:"Today",tasks:p.today,onComplete:l,onSnooze:d,onDelete:u,onView:m}),a.jsx(G,{columnId:"thisWeek",title:"This Week",tasks:p.thisWeek,onComplete:l,onSnooze:d,onDelete:u,onView:m})]})})})]})}s(L,"TasksKanbanPanel");export{L as TasksKanbanPanel,L as default};
