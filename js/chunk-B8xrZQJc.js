var e=Object.defineProperty,a=(a,r)=>e(a,"name",{value:r,configurable:!0});import{aN as r,aO as s,a6 as t,aP as n,aQ as l,aR as i,j as o,H as c,a9 as d,aS as u,aT as m,l as p,af as h,$ as x,aU as j,F as b,aj as f,ar as g,i as v,u as C}from"./chunk-ByJg_QQB.js";import{u as y,b as N,c as k}from"./chunk-JxeXaC9i.js";import{F as _}from"./chunk-DpghI3EP.js";import{S as w,F as T,G as I,s as S,L as O,I as R,J as A,D as F,e as L,f as z,g as P,h as E,p as $,B,U as D,V as M,W as V,X as q,K as U,T as J}from"../assets/index-BoLku8RR.js";import{R as Q}from"./chunk-D6FmavVW.js";import{S as W}from"./chunk-C5fZsuMg.js";import{r as G}from"./chunk-1NZFT-6z.js";import{v as H,k as K,aF as X,aG as Y,aH as Z,aI as ee,x as ae}from"./chunk-Bc6KM1xM.js";import{C as re,s as se}from"./chunk-DhfTvo06.js";import{A as te}from"./chunk-B9H_70fs.js";import{C as ne}from"./chunk-C4sNritB.js";import{A as le}from"./chunk-nUtrHAIa.js";const ie=G.createContext(void 0),oe=a(e=>{const a=G.useContext(ie),r=G.useMemo(()=>({append:e?.append,fields:e?.fields,insert:e?.insert,move:e?.move,prepend:e?.prepend,remove:e?.remove,replace:e?.replace,swap:e?.swap,update:e?.update}),[e]);if(e?.fields)return r;if(!a)throw new Error("useArrayInput must be used inside an ArrayInputContextProvider");return a},"useArrayInput"),ce=a(e=>{const{className:p,defaultValue:h=[],label:x,isPending:j,children:b,helperText:f,resource:g,source:v,validate:C,...k}=e,_=r(),F=s(),L=t(),z=L.getSource(v),P=Array.isArray(C)?n(C):C,E=l(),{getValues:$}=y(),B=N({name:z,rules:{validate:a(async a=>{if(!P)return!0;const r=await P(a,$(),e);return!r||E(r)},"validate")}});G.useEffect(()=>(F&&null!=_&&F.registerField(z,_),()=>{F&&null!=_&&F.unregisterField(z,_)}),[z,F,_]),i({inputProps:{...e,defaultValue:h},isArrayInput:!0,fieldArrayInputControl:B});const D=G.useMemo(()=>({getSource:a(e=>e?L.getSource(`${v}.${e}`):L.getSource(v),"getSource"),getLabel:a(e=>L.getLabel(`${v}.${e}`),"getLabel")}),[L,v]);return j?o.jsx(w,{className:"w-full h-9"}):o.jsxs(T,{className:S("ra-input",`ra-input-${z}`,p,"w-full flex flex-col gap-2"),name:z,...I(k),children:[o.jsx(O,{className:"text-sm",children:o.jsx(c,{label:x,source:v,resource:g,isRequired:d(C)})}),o.jsx(ie.Provider,{value:B,children:o.jsx(u,{value:g,children:o.jsx(m,{value:D,children:b})})}),o.jsx(R,{helperText:f}),o.jsx(A,{})]})},"ArrayInput"),de=G.createContext(void 0),ue=a(()=>{const e=G.useContext(de);if(!e)throw new Error("useSimpleFormIterator must be used inside a SimpleFormIterator");return e},"useSimpleFormIterator"),me=G.createContext(void 0),pe=a(()=>{const e=G.useContext(me);if(!e)throw new Error("useSimpleFormIteratorItem must be used inside a SimpleFormIteratorItem");return e},"useSimpleFormIteratorItem"),he=a(e=>{const{className:r,isOpen:s=!1,loading:t,title:n,content:l,cancel:i="ra.action.cancel",confirm:c="ra.action.confirm",confirmColor:d="primary",ConfirmIcon:u=H,CancelIcon:m=K,onClose:h,onConfirm:x,translateOptions:j={},titleTranslateOptions:b=j,contentTranslateOptions:f=j,...g}=e,v=p(),C=G.useCallback(e=>{e.stopPropagation(),x(e)},[x]),y=G.useCallback(e=>{e.stopPropagation()},[]);return o.jsx(F,{open:s,onOpenChange:a(()=>h(),"onOpenChange"),children:o.jsxs(L,{className:r,onClick:y,...g,children:[o.jsxs(z,{children:[o.jsx(P,{children:"string"==typeof n?v(n,{_:n,...b}):n}),"string"==typeof l?o.jsx(E,{children:v(l,{_:l,...f})}):l]}),o.jsxs($,{children:[o.jsxs(B,{variant:"ghost",disabled:t,onClick:h,className:"gap-1",children:[o.jsx(m,{className:"h-5 w-5"}),v(i,{_:i})]}),o.jsxs(B,{disabled:t,onClick:C,className:"gap-1",variant:"warning"===d?"destructive":"default",children:[o.jsx(u,{className:"h-5 w-5"}),v(c,{_:c})]})]})]})})},"Confirm"),xe=a(({label:e,onClick:r,children:s,disabled:t,...n})=>{const l=p(),[i,c]=G.useState(!1),d=a(()=>{c(!1)},"handleClose"),u=a(()=>{c(!0)},"handleOpen");let m=e;"string"==typeof e&&(m=l(e,{_:e}));const h=a(e=>{d(),r?.(e)},"handleClick");return o.jsx(D,{children:o.jsxs(M,{open:i,onOpenChange:c,children:[o.jsx(V,{asChild:!0,children:o.jsx(B,{type:"button",variant:"ghost",size:"icon","aria-label":"string"==typeof m?m:void 0,onClick:h,disabled:t,onMouseEnter:u,onMouseLeave:d,...n,children:s})}),o.jsx(q,{children:o.jsx("p",{children:m})})]})})},"IconButtonWithTooltip"),je=a(e=>{const{addButton:r=ye,removeButton:s,reOrderButtons:t,children:n,className:l,resource:i,disabled:c,disableAdd:d=!1,disableClear:u,disableRemove:m=!1,disableReordering:b,inline:f,getItemLabel:g=!1}=e,v=h("");if(!v)throw new Error("SimpleFormIterator can only be called within an iterator input like ArrayInput");const[C,N]=G.useState(!1),{append:k,fields:_,move:w,remove:T,replace:I}=oe(e),{trigger:O,getValues:R}=y(),A=p(),F=x(e),L=G.useRef({}),z=G.useCallback(e=>{T(e);R(v).every(e=>"object"!=typeof e)&&O(v)},[T,O,v,R]);if(_.length>0){const{id:e,...a}=_[0];L.current=a;for(const r in L.current)L.current[r]=null}const P=G.useCallback((e=void 0)=>{let a=e;null==e&&(a=L.current,1===G.Children.count(n)&&G.isValidElement(G.Children.only(n))&&!G.Children.only(n).props.source&&G.Children.only(n).type!==j?a="":(a=a||{},G.Children.forEach(n,e=>{G.isValidElement(e)&&e.type!==j&&e.props.source&&(a[e.props.source]=e.props.defaultValue??null)}))),k(a)},[k,n]),E=G.useCallback((e,a)=>{w(e,a)},[w]),$=G.useCallback(()=>{I([]),N(!1)},[I]),B=U(F,v),D=G.useMemo(()=>({total:_.length,add:P,remove:z,reOrder:E,source:v}),[P,_.length,E,z,v]);return _?o.jsx(de.Provider,{value:D,children:o.jsxs("div",{className:S("w-full",c&&"disabled",l),children:[o.jsx("ul",{className:"p-0 m-0 flex flex-col gap-2",children:_.map((e,a)=>o.jsx(be,{disabled:c,disableRemove:m,disableReordering:b,fields:_,getItemLabel:g,index:a,onRemoveField:z,onReorder:E,record:B&&B[a]||{},removeButton:s,reOrderButtons:t,resource:i,inline:f,children:n},e.id))}),!c&&!(d&&(u||m))&&o.jsxs("div",{className:"flex flex-row items-center gap-2",children:[!d&&r,_.length>0&&!u&&!m&&o.jsxs(o.Fragment,{children:[o.jsx(he,{isOpen:C,title:A("ra.action.clear_array_input"),content:A("ra.message.clear_array_input"),onConfirm:$,onClose:a(()=>N(!1),"onClose")}),o.jsx(ve,{onClick:a(()=>N(!0),"onClick")})]})]})]})}):null},"SimpleFormIterator"),be=G.forwardRef((e,r)=>{const{children:s,disabled:n,disableReordering:l,disableRemove:i,getItemLabel:c,index:d,inline:u,record:p,removeButton:h=Ne,reOrderButtons:x=ke}=e;if(!b(e))throw new Error("SimpleFormIteratorItem must be used in a ResourceContextProvider or be passed a resource prop.");const{total:j,reOrder:g,remove:v}=ue(),C=a(e=>"boolean"==typeof i?i:i&&i(e),"disableRemoveField"),y=G.useMemo(()=>({index:d,total:j,reOrder:a(e=>g(d,e),"reOrder"),remove:a(()=>v(d),"remove")}),[d,j,g,v]),N="function"==typeof c?c(d):c,k=t(),_=G.useMemo(()=>({getSource:a(e=>e?k.getSource(`${d}.${e}`):k.getSource(`${d}`),"getSource"),getLabel:a(e=>k.getLabel(e),"getLabel")}),[d,k]);return o.jsx(me.Provider,{value:y,children:o.jsxs("li",{ref:r,className:S("flex flex-row items-start justify-between gap-3 pb-2 border-b border-border last:border-b-0","[&:has(label)>.simple-form-iterator-item-actions]:pt-10"),children:[null!=N&&!1!==N&&o.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:N}),o.jsx(m,{value:_,children:o.jsx(f,{value:p,children:o.jsx("div",{className:S("flex flex-1 gap-2",u?"flex-col sm:flex-row gap-2":"flex-col"),children:s})})}),!n&&o.jsxs("div",{className:"simple-form-iterator-item-actions flex flex-row h-9 items-center gap-1",children:[!l&&x,!C(p)&&h]})]})})}),fe=a(e=>{const{add:r,source:s}=ue(),{className:t,...n}=e,l=p();return o.jsx(D,{children:o.jsxs(M,{children:[o.jsx(V,{asChild:!0,children:o.jsx(B,{type:"button",variant:"ghost",size:"icon",onClick:a(()=>r(),"onClick"),className:S("button-add",`button-add-${s}`,t),...n,children:o.jsx(Y,{className:"h-5 w-5"})})}),o.jsx(q,{children:l("ra.action.add")})]})})},"AddItemButton"),ge=a(({className:e})=>{const{index:r,total:s,reOrder:t}=pe(),{source:n}=ue();return o.jsxs("span",{className:S("button-reorder",`button-reorder-${n}-${r}`,e),children:[o.jsx(xe,{label:"ra.action.move_up",onClick:a(()=>t(r-1),"onClick"),disabled:r<=0,children:o.jsx(Z,{className:"h-4 w-4"})}),o.jsx(xe,{label:"ra.action.move_down",onClick:a(()=>t(r+1),"onClick"),disabled:null==s||r>=s-1,children:o.jsx(ee,{className:"h-4 w-4"})})]})},"ReOrderButtons"),ve=a(e=>{const a=p();return o.jsx(D,{children:o.jsxs(M,{children:[o.jsx(V,{asChild:!0,children:o.jsx(B,{type:"button",variant:"ghost",size:"icon",...e,children:o.jsx(X,{className:"h-5 w-5 text-destructive","aria-hidden":"true"})})}),o.jsx(q,{children:a("ra.action.clear_array_input")})]})})},"ClearArrayButton"),Ce=a(e=>{const{remove:r,index:s}=pe(),{source:t}=ue(),{className:n,...l}=e,i=p();return o.jsx(D,{children:o.jsxs(M,{children:[o.jsx(V,{asChild:!0,children:o.jsx(B,{type:"button",variant:"ghost",size:"icon",onClick:a(()=>r(),"onClick"),className:S("button-remove",`button-remove-${t}-${s}`,n),...l,children:o.jsx(ae,{className:"h-5 w-5 text-destructive","aria-hidden":"true"})})}),o.jsx(q,{children:i("ra.action.remove")})]})})},"RemoveItemButton"),ye=o.jsx(fe,{}),Ne=o.jsx(Ce,{}),ke=o.jsx(ge,{}),_e=a(()=>{const e=x();return o.jsx(Q,{source:"manager_id",reference:"contacts",filter:e?.id?{"id@neq":e.id}:{},children:o.jsx(le,{label:"Reports To",emptyText:"No manager",helperText:"Direct manager / supervisor",optionText:a(e=>e?`${e.first_name||""} ${e.last_name||""}`.trim()||"Unknown":"","optionText"),filterToQuery:a(e=>({"first_name,last_name@ilike":`%${e}%`}),"filterToQuery")})})},"ContactManagerInput"),we=[{id:"senior_management",name:"Senior Management"},{id:"sales_management",name:"Sales Management"},{id:"district_management",name:"District Management"},{id:"area_sales",name:"Area Sales"},{id:"sales_specialist",name:"Sales Specialist"},{id:"sales_support",name:"Sales Support"},{id:"procurement",name:"Procurement"},{id:"operations",name:"Operations"},{id:"marketing",name:"Marketing"},{id:"finance",name:"Finance"},{id:"other",name:"Other"}],Te=a(()=>o.jsxs(o.Fragment,{children:[o.jsx(ne,{title:"Additional Details",children:o.jsxs("div",{className:"space-y-4",children:[o.jsxs(re,{children:[o.jsx(J,{source:"title",label:"Job Title",helperText:!1}),o.jsx(W,{source:"department",label:"Department",choices:we,helperText:!1,emptyText:"Select department"})]}),o.jsx(J,{source:"linkedin_url",label:"LinkedIn URL",helperText:"Format: https://linkedin.com/in/username"}),o.jsx(J,{source:"notes",label:"Notes",multiline:!0,rows:3,helperText:!1})]})}),o.jsx(ne,{title:"Organization & Territory",children:o.jsxs("div",{className:"space-y-4",children:[o.jsx(_e,{}),o.jsxs(re,{children:[o.jsx(J,{source:"district_code",label:"District Code",helperText:"e.g., D1, D73"}),o.jsx(J,{source:"territory_name",label:"Territory",helperText:"e.g., Western Suburbs"})]})]})})]}),"ContactAdditionalDetails"),Ie=a(({label:e,organizationType:r,helperText:s})=>{const[t]=g(),{data:n}=v(),l=C(),i=a(async e=>{if(e)try{return await t("organizations",{data:{name:e,sales_id:n?.id,created_at:(new Date).toISOString(),...r&&{organization_type:r}}},{returnPromise:!0})}catch{l("An error occurred while creating the organization",{type:"error"})}},"handleCreateOrganization");return o.jsx(le,{optionText:"name",helperText:s,onCreate:i,createItemLabel:"Create %{item}",label:e})},"AutocompleteOrganizationInput"),Se=[{id:"work"},{id:"home"},{id:"other"}],Oe=a(()=>{const{setValue:e,getValues:r}=y(),s=a(a=>{const{first_name:s,last_name:t}=r();if(s||t||!a)return;const[n,l]=a.split("@")[0].split(".");e("first_name",n.charAt(0).toUpperCase()+n.slice(1)),e("last_name",l?l.charAt(0).toUpperCase()+l.slice(1):"")},"handleEmailChange"),t=a(e=>{const a=e.clipboardData?.getData("text/plain");s(a)},"handleEmailPaste"),n=a(e=>{const a=e.target.value;s(a)},"handleEmailBlur");return o.jsxs("div",{className:"space-y-3",children:[o.jsxs(re,{columns:"md:grid-cols-[1fr_1fr_auto]",alignItems:"start",children:[o.jsx("div",{"data-tutorial":"contact-first-name",children:o.jsx(J,{source:"first_name",label:"First Name *",helperText:"Required field"})}),o.jsx("div",{"data-tutorial":"contact-last-name",children:o.jsx(J,{source:"last_name",label:"Last Name *",helperText:"Required field"})}),o.jsx("div",{className:"pt-6",children:o.jsx(te,{})})]}),o.jsx("div",{"data-tutorial":"contact-organization",children:o.jsx(Q,{source:"organization_id",reference:"organizations",label:"Organization *",isRequired:!0,children:o.jsx(Ie,{helperText:"Required field"})})}),o.jsx("div",{"data-tutorial":"contact-account-manager",children:o.jsx(Q,{reference:"sales",source:"sales_id",sort:{field:"last_name",order:"ASC"},filter:{"disabled@neq":!0,"user_id@not.is":null},children:o.jsx(W,{helperText:"Required field",label:"Account manager *",optionText:se})})}),o.jsx("div",{"data-tutorial":"contact-email",children:o.jsx(ce,{source:"email",label:"Email addresses",helperText:!1,children:o.jsxs(je,{inline:!0,disableReordering:!0,disableClear:!0,className:"[&>ul>li]:border-b-0 [&>ul>li]:pb-0",children:[o.jsx(J,{source:"value",className:"w-full",helperText:!1,label:!1,placeholder:"Email (valid email required)",onPaste:t,onBlur:n}),o.jsx(W,{source:"type",helperText:!1,label:!1,optionText:"id",choices:Se,className:"w-24 min-w-24"})]})})}),o.jsx("div",{"data-tutorial":"contact-phone",children:o.jsx(ce,{source:"phone",label:"Phone numbers",helperText:!1,children:o.jsxs(je,{inline:!0,disableReordering:!0,disableClear:!0,className:"[&>ul>li]:border-b-0 [&>ul>li]:pb-0",children:[o.jsx(J,{source:"value",className:"w-full",helperText:!1,label:!1,placeholder:"Phone number"}),o.jsx(W,{source:"type",helperText:!1,label:!1,optionText:"id",choices:Se,className:"w-24 min-w-24"})]})})}),o.jsx(Te,{})]})},"ContactCompactForm"),Re={first_name:"First Name",last_name:"Last Name",organization_id:"Organization",sales_id:"Account Manager",email:"Email",phone:"Phone",title:"Job Title",department:"Department",linkedin_url:"LinkedIn URL",notes:"Notes"},Ae=a(()=>{const{errors:e}=k(),a=Object.keys(e||{}).length>0;return o.jsxs("div",{className:"flex flex-col gap-4",children:[a&&o.jsx(_,{errors:e,fieldLabels:Re,defaultExpanded:Object.keys(e).length<=3}),o.jsx(Oe,{})]})},"ContactInputs");export{Ie as A,Ae as C,je as S,ce as a};
