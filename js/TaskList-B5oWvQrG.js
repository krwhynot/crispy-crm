var e=Object.defineProperty,s=(s,t)=>e(s,"name",{value:t,configurable:!0});import{j as t,i as a,al as i,W as r,u as l,aj as o,J as n,am as c,an as d,ak as m}from"./chunk-ByJg_QQB.js";import{R as p}from"./chunk-1NZFT-6z.js";import{S as u,C as x,L as j}from"./chunk-BBQ6yJWi.js";import{v as h,S as y,F as f}from"./chunk-A2EVsQEK.js";import{P as k}from"./chunk-CKWniV73.js";import{B as g}from"./chunk-BndLoydo.js";import{d as b,u as N,T as _,C as v,a as w,r as T}from"../assets/index-BoLku8RR.js";import{D as S}from"./chunk-DkiUngdk.js";import{R as C}from"./chunk-DbeoRBEW.js";import{u as O,T as D,F as M,b as I}from"./chunk-C8K6x_Yi.js";import{R as z,u as R}from"./chunk-a4jA-31v.js";import"./chunk-CFj7NhUg.js";import{C as P}from"./chunk-C0a-ooKP.js";import{F as A,T as L}from"./chunk-C6dCzd_-.js";import{A as F,m as E,o as $,j as B,k as V,l as U,d as W}from"./chunk-DwAffUXc.js";import{a8 as Y,an as G,Y as H,W as K,U as q,a4 as J,aL as Q,a0 as X,aM as Z}from"./chunk-Bc6KM1xM.js";import{S as ee}from"./chunk-C5fZsuMg.js";import{R as se}from"./chunk-D6FmavVW.js";import{A as te}from"./chunk-nUtrHAIa.js";import{B as ae}from"./chunk-CIlS_x6D.js";import{A as ie}from"./chunk-BY7AmvEs.js";import"./chunk-CRKBdUTG.js";import{S as re}from"./chunk-j7Lqvg-1.js";import{c as le}from"./chunk-X0dz3Jmp.js";import{u as oe}from"./chunk-CfuGOU5i.js";import{P as ne,F as ce}from"./chunk-Nds5IV03.js";import"./chunk-JxeXaC9i.js";import"./chunk-Dc4zIuSl.js";import"./chunk-B1s-jt27.js";import"./chunk-knA4lag3.js";import"./chunk-Tyyhsnez.js";import"./chunk-DA1DYucv.js";import"./chunk-UKb2nn92.js";import"./chunk-XoqkUGE_.js";import"./chunk-DHnjrG--.js";import"./chunk-B5Y5c6gs.js";import"./chunk-CMQLDEz_.js";import"./chunk-C_u3nriX.js";import"./chunk-B9H_70fs.js";const de={low:"outline",medium:"secondary",high:"default",critical:"destructive"};function me({priority:e,className:s}){const a=de[e]||"outline",i=e.charAt(0).toUpperCase()+e.slice(1);return t.jsx(b,{variant:a,className:s,children:i})}s(me,"PriorityBadge");const pe=s(()=>{const{data:e}=a(),{taskTypes:s}=N(),r={low:"outline",medium:"secondary",high:"default",critical:"destructive"};return t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsx(i,{children:t.jsx(u,{source:"q",placeholder:"Search tasks..."})}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs(A,{label:"Due Date",icon:t.jsx(Y,{className:"h-4 w-4"}),children:[t.jsx(L,{className:"w-full justify-between",label:"Today",value:{"due_date@gte":E().toISOString(),"due_date@lte":F().toISOString()}}),t.jsx(L,{className:"w-full justify-between",label:"This Week",value:{"due_date@gte":E().toISOString(),"due_date@lte":$(E(),7).toISOString()}}),t.jsx(L,{className:"w-full justify-between",label:"Overdue",value:{"due_date@lte":E().toISOString(),completed:!1}})]}),t.jsxs(A,{label:"Status",icon:t.jsx(G,{className:"h-4 w-4"}),children:[t.jsx(L,{className:"w-full justify-between",label:"Incomplete",value:{completed:!1}}),t.jsx(L,{className:"w-full justify-between",label:"Completed",value:{completed:!0}})]}),t.jsx(A,{label:"Priority",icon:t.jsx(H,{className:"h-4 w-4"}),children:["low","medium","high","critical"].map(e=>t.jsx(L,{multiselect:!0,className:"w-full justify-between",label:t.jsx(b,{variant:r[e],className:"text-xs px-1 py-0",children:e.charAt(0).toUpperCase()+e.slice(1)}),value:{priority:e}},e))}),t.jsx(A,{label:"Type",icon:t.jsx(K,{className:"h-4 w-4"}),children:s.map(e=>t.jsx(L,{multiselect:!0,className:"w-full justify-between",label:e,value:{type:e}},e))}),t.jsx(A,{icon:t.jsx(q,{className:"h-4 w-4"}),label:"Assigned To",children:t.jsx(L,{className:"w-full justify-between",label:"Me",value:{sales_id:e?.id}})})]})]})},"TaskListFilter");function ue({record:e,mode:a,onModeToggle:i}){const[c]=r(),d=l(),{taskTypes:m}=N(),p=s(async s=>{try{await c("tasks",{id:e.id,data:s,previousData:e}),d("Task updated successfully",{type:"success"}),i?.()}catch(t){d("Error updating task",{type:"error"})}},"handleSave"),u=s(async s=>{try{await c("tasks",{id:e.id,data:{completed:s,completed_at:s?(new Date).toISOString():null},previousData:e}),d(s?"Task marked complete":"Task marked incomplete",{type:"success"})}catch(t){d("Error updating task",{type:"error"})}},"handleCompletionToggle");return"edit"===a?t.jsx(o,{value:e,children:t.jsx(n,{id:"slide-over-edit-form",onSubmit:p,record:e,children:t.jsx("div",{className:"space-y-6",role:"form","aria-label":"Edit task form",children:t.jsxs("div",{className:"space-y-4",children:[t.jsx(_,{source:"title",label:"Task Title"}),t.jsx(_,{source:"description",label:"Description",multiline:!0,rows:3}),t.jsx(_,{source:"due_date",label:"Due Date",type:"date"}),t.jsx(_,{source:"reminder_date",label:"Reminder Date",type:"date"}),t.jsx(ee,{source:"priority",label:"Priority",choices:[{id:"low",name:"Low"},{id:"medium",name:"Medium"},{id:"high",name:"High"},{id:"critical",name:"Critical"}]}),t.jsx(ee,{source:"type",label:"Type",choices:m.map(e=>({id:e,name:e}))}),t.jsx(ae,{source:"completed",label:"Completed"}),t.jsx(se,{source:"sales_id",reference:"sales",children:t.jsx(te,{label:"Assigned To"})}),t.jsx(se,{source:"contact_id",reference:"contacts_summary",children:t.jsx(te,{label:"Contact",optionText:le})}),t.jsx(se,{source:"opportunity_id",reference:"opportunities",children:t.jsx(te,{label:"Opportunity",optionText:"title"})})]})})})}):t.jsx(o,{value:e,children:t.jsxs("div",{className:"space-y-6",children:[t.jsx(ie,{title:"Task Details",children:t.jsx(v,{children:t.jsxs(w,{className:"p-4 space-y-3",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:e.title}),e.description&&t.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:e.description})]}),t.jsxs("label",{className:"flex items-center gap-2 pt-2 min-h-11 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:e.completed||!1,onChange:s(e=>u(e.target.checked),"onChange"),className:"h-4 w-4 rounded border-input","aria-label":e.completed?"Mark task as incomplete":"Mark task as complete"}),t.jsx("span",{className:"text-sm font-medium",children:e.completed?"Completed":"Mark as complete"}),e.completed_at&&t.jsxs("span",{className:"text-xs text-muted-foreground",children:["on ",t.jsx(S,{source:"completed_at",options:{dateStyle:"short"}})]})]})]})})}),t.jsx(ie,{title:"Schedule",children:t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:"Due: "}),t.jsx(S,{source:"due_date",options:{year:"numeric",month:"long",day:"numeric"},className:"font-medium"})]}),e.reminder_date&&t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:"Reminder: "}),t.jsx(S,{source:"reminder_date",options:{year:"numeric",month:"long",day:"numeric"},className:"font-medium"})]})]})}),t.jsx(ie,{title:"Classification",children:t.jsxs("div",{className:"space-y-2",children:[e.priority&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Priority:"}),t.jsx(me,{priority:e.priority})]}),e.type&&t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-sm text-muted-foreground",children:"Type:"}),t.jsx(b,{variant:"outline",children:e.type})]})]})}),e.sales_id&&t.jsx(ie,{title:"Assigned To",children:t.jsx(C,{source:"sales_id",reference:"sales",children:t.jsx(re,{})})}),t.jsx(ie,{title:"Timeline",children:t.jsxs("div",{className:"space-y-2",children:[e.created_at&&t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:"Created: "}),t.jsx(S,{source:"created_at",options:{year:"numeric",month:"short",day:"numeric"}})]}),e.updated_at&&t.jsxs("div",{className:"text-sm",children:[t.jsx("span",{className:"text-muted-foreground",children:"Updated: "}),t.jsx(S,{source:"updated_at",options:{year:"numeric",month:"short",day:"numeric"}})]})]})})]})})}function xe({record:e}){const s=e.organization_id||e.contact_id||e.opportunity_id||e.sales_id;return t.jsx(o,{value:e,children:t.jsxs("div",{className:"space-y-6",children:[!s&&t.jsx(v,{children:t.jsx(w,{className:"p-8 text-center",children:t.jsx("p",{className:"text-sm text-muted-foreground",children:"No related items. Add relationships in the Details tab."})})}),e.organization_id&&t.jsx(ie,{title:"Related Organization",children:t.jsx(v,{children:t.jsx(w,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(J,{className:"size-5 text-muted-foreground"}),t.jsx(C,{source:"organization_id",reference:"organizations",link:"show",children:t.jsx(T,{source:"name",className:"font-medium"})})]})})})}),e.contact_id&&t.jsx(ie,{title:"Related Contact",children:t.jsx(v,{children:t.jsx(w,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Q,{className:"size-5 text-muted-foreground"}),t.jsx(C,{source:"contact_id",reference:"contacts_summary",link:"show",children:t.jsx(T,{source:le,className:"font-medium"})})]})})})}),e.opportunity_id&&t.jsx(ie,{title:"Related Opportunity",children:t.jsx(v,{children:t.jsx(w,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(X,{className:"size-5 text-muted-foreground"}),t.jsx(C,{source:"opportunity_id",reference:"opportunities",link:"show",children:t.jsx(T,{source:"title",className:"font-medium"})})]})})})}),e.sales_id&&t.jsx(ie,{title:"Assigned To",children:t.jsx(v,{children:t.jsx(w,{className:"p-4",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(J,{className:"size-5 text-muted-foreground"}),t.jsx(C,{source:"sales_id",reference:"sales",link:!1,children:t.jsx(re,{})})]})})})})]})})}function je({recordId:e,isOpen:a,onClose:i,mode:r,onModeToggle:l}){const o=[{key:"details",label:"Details",component:ue,icon:G},{key:"related",label:"Related Items",component:xe,icon:Z}],n=s(e=>e.title||`Task #${e.id}`,"recordRepresentation");return t.jsx(z,{resource:"tasks",recordId:e,isOpen:a,onClose:i,mode:r,onModeToggle:l,tabs:o,recordRepresentation:n})}s(ue,"TaskSlideOverDetailsTab"),s(xe,"TaskRelatedItemsTab"),s(je,"TaskSlideOver");const he=s(()=>{const e=oe();return t.jsxs("div",{className:"flex flex-col justify-center items-center gap-3",style:{height:`calc(100dvh - ${e}px)`},children:[t.jsx("img",{src:"./img/empty.svg",alt:"No tasks found"}),t.jsxs("div",{className:"flex flex-col gap-0 items-center",children:[t.jsx("h2",{className:"text-lg font-bold",children:"No tasks found"}),t.jsx("p",{className:"text-sm text-muted-foreground text-center mb-4",children:"Your task list is empty. Create a task to get started."})]}),t.jsx("span",{"data-tutorial":"create-task-btn",children:t.jsx(x,{label:"New Task"})})]})},"TaskEmpty");function ye(e){if(!e||"string"!=typeof e)return String(e);const s=new Date(e);return isNaN(s.getTime())?String(e):B(s)?"Today":V(s)?"This week":U(s)?"This month":W(s,"MMM d, yyyy")}function fe(e){if(e&&"object"==typeof e&&"taskTypes"in e){return e.taskTypes.map(e=>({id:e,name:e}))}return[]}s(ye,"formatDateLabel"),s(fe,"getTaskTypeChoices");const ke=h([{key:"due_date@gte",label:"Due after",type:"date-range",formatLabel:ye,removalGroup:"due_date_range"},{key:"due_date@lte",label:"Due before",type:"date-range",formatLabel:ye,removalGroup:"due_date_range"},{key:"completed",label:"Status",type:"boolean",formatLabel:s(e=>!0===e?"Completed":"Incomplete","formatLabel")},{key:"priority",label:"Priority",type:"multiselect",choices:[{id:"low",name:"Low"},{id:"medium",name:"Medium"},{id:"high",name:"High"},{id:"critical",name:"Critical"}]},{key:"type",label:"Type",type:"multiselect",choices:fe},{key:"sales_id",label:"Assigned To",type:"reference",reference:"sales"}]);function ge(){const{data:e,isPending:s}=a(),{slideOverId:i,isOpen:r,mode:l,openSlideOver:o,closeSlideOver:n,toggleMode:c}=R();return O("tasks"),s?t.jsx(D,{}):e?t.jsxs(t.Fragment,{children:[t.jsx("div",{"data-tutorial":"tasks-list",children:t.jsxs(j,{title:!1,perPage:100,sort:{field:"due_date",order:"ASC"},exporter:_e,children:[t.jsx(be,{openSlideOver:o,isSlideOverOpen:r}),t.jsx(M,{})]})}),t.jsx(je,{recordId:i,isOpen:r,mode:l,onClose:n,onModeToggle:c}),t.jsx(ne,{chapter:"tasks",position:"bottom-left"})]}):null}s(ge,"TaskList");const be=s(({openSlideOver:e,isSlideOverOpen:a})=>{const{data:i,isPending:r,filterValues:l}=m(),{focusedIndex:o}=I({onSelect:s(s=>e(Number(s),"edit"),"onSelect"),enabled:!a}),n=l&&Object.keys(l).length>0;return r?t.jsx(y,{resource:"tasks",filterComponent:t.jsx(pe,{}),children:t.jsx(D,{})}):i?.length||n?t.jsxs(t.Fragment,{children:[t.jsxs(y,{resource:"tasks",filterComponent:t.jsx(pe,{}),children:[t.jsx(f,{filterConfig:ke}),t.jsxs(k,{onRowClick:s(s=>e(Number(s),"edit"),"onRowClick"),focusedIndex:o,children:[t.jsx(ce,{label:"Done",sortable:!1,render:s(e=>t.jsx(Ne,{task:e}),"render"),...P.alwaysVisible}),t.jsx(T,{source:"title",label:"Title",...P.alwaysVisible}),t.jsx(S,{source:"due_date",label:"Due Date",sortable:!0,...P.alwaysVisible}),t.jsx(ce,{label:"Priority",sortBy:"priority",render:s(e=>e.priority&&t.jsx(me,{priority:e.priority}),"render"),...P.alwaysVisible}),t.jsx(ce,{label:"Type",sortBy:"type",render:s(e=>e.type&&t.jsx(b,{variant:"outline",children:e.type}),"render"),...P.desktopOnly}),t.jsx(C,{source:"sales_id",reference:"sales",label:"Assigned To",link:!1,sortable:!0,...P.desktopOnly,children:t.jsx(re,{})}),t.jsx(C,{source:"contact_id",reference:"contacts_summary",label:"Contact",link:!1,sortable:!1,...P.desktopOnly,children:t.jsx(T,{source:le})}),t.jsx(C,{source:"opportunity_id",reference:"opportunities",label:"Opportunity",link:!1,sortable:!1,...P.desktopOnly,children:t.jsx(T,{source:"title"})})]})]}),t.jsx(g,{})]}):t.jsx(he,{})},"TaskListLayout"),Ne=p.memo(s(function({task:e}){const[a]=r(),i=l(),o=s(async s=>{s.stopPropagation();const t=s.target.checked;try{await a("tasks",{id:e.id,data:{completed:t,completed_at:t?(new Date).toISOString():null},previousData:e}),i(t?"Task completed":"Task reopened",{type:"success"})}catch(r){throw i("Error updating task",{type:"error"}),new Error(`Failed to update task ${e.id}: ${r}`)}},"handleToggle");return t.jsx("label",{className:"flex items-center justify-center h-11 w-11 cursor-pointer",children:t.jsx("input",{type:"checkbox",checked:e.completed||!1,onChange:o,onClick:s(e=>e.stopPropagation(),"onClick"),className:"h-4 w-4 rounded border-input focus:ring-2 focus:ring-primary focus:ring-offset-2","aria-label":e.completed?`Mark "${e.title}" as incomplete`:`Mark "${e.title}" as complete`})})},"CompletionCheckbox2")),_e=s(async(e,s)=>{const t=await s(e,"opportunity_id","opportunities"),a=Array.from(new Set(t.filter(e=>e.organization_id).map(e=>e.organization_id))),i=a.length>0?await s(a.map(e=>({id:e,organization_id:e})),"organization_id","organizations"):[],r=new Map(t.map(e=>[e.id,e])),l=new Map(i.map(e=>[e.id,e])),o=e.map(e=>{const s=e.opportunity_id?r.get(e.opportunity_id):null,t=s?.organization_id?l.get(s.organization_id):null;return{id:e.id,title:e.title,description:e.description,type:e.type,priority:e.priority,due_date:e.due_date,completed:e.completed?"Yes":"No",completed_at:e.completed_at||"",principal:t?.name||"",opportunity_id:e.opportunity_id||"",contact_id:e.contact_id||"",created_at:e.created_at}});c(o,{headers:["id","title","description","type","priority","due_date","completed","completed_at","principal","opportunity_id","contact_id","created_at"]},(e,s)=>{if(e)throw new Error(`CSV export failed: ${e.message}`);d(s,"tasks")})},"exporter");export{ge as default};
