{"version":3,"file":"ActivityList-CHClmTPI.js","sources":["../../src/atomic-crm/activities/ActivityListFilter.tsx","../../src/atomic-crm/components/SampleStatusBadge.tsx","../../src/atomic-crm/activities/activityFilterConfig.ts","../../src/atomic-crm/activities/ActivityList.tsx"],"sourcesContent":["import { Badge } from \"@/components/ui/badge\";\nimport { endOfToday, startOfToday, startOfWeek, subDays } from \"date-fns\";\nimport { Calendar, Filter, Package, Tag, Users } from \"lucide-react\";\nimport { FilterLiveForm, useGetIdentity } from \"ra-core\";\n\nimport { ToggleFilterButton } from \"@/components/admin/toggle-filter-button\";\nimport { SearchInput } from \"@/components/admin/search-input\";\nimport { FilterCategory } from \"../filters/FilterCategory\";\nimport { INTERACTION_TYPE_OPTIONS, SAMPLE_STATUS_OPTIONS } from \"../validation/activities\";\n\n/**\n * ActivityListFilter Component\n *\n * Sidebar filter panel for activities list using the collapsible FilterCategory pattern.\n *\n * Filters:\n * - Quick filters: Samples (type='sample'), Pending Feedback (sample_status='feedback_pending')\n * - Activity Type: All 13 interaction types (call, email, sample, etc.)\n * - Sample Status: sent, received, feedback_pending, feedback_received\n * - Date Range: Today, This Week, Last 7 Days\n * - Created By: Me filter\n */\nexport const ActivityListFilter = () => {\n  const { data: identity } = useGetIdentity();\n\n  // Sample status badge colors for visual consistency\n  const sampleStatusColors: Record<string, string> = {\n    sent: \"outline\",\n    received: \"secondary\",\n    feedback_pending: \"default\",\n    feedback_received: \"destructive\",\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4\">\n      {/* Search - Always visible */}\n      <FilterLiveForm>\n        <SearchInput source=\"q\" placeholder=\"Search activities...\" />\n      </FilterLiveForm>\n\n      {/* Quick Filters - Most commonly used */}\n      <div className=\"flex flex-col gap-2\">\n        <h3 className=\"font-semibold text-sm text-muted-foreground\">Quick Filters</h3>\n        <div className=\"flex flex-col gap-1\">\n          <ToggleFilterButton\n            className=\"w-full justify-between\"\n            label={\n              <span className=\"flex items-center gap-2\">\n                <Package className=\"h-4 w-4\" aria-hidden=\"true\" />\n                Samples Only\n              </span>\n            }\n            value={{ type: \"sample\" }}\n          />\n          <ToggleFilterButton\n            className=\"w-full justify-between\"\n            label={\n              <Badge variant=\"default\" className=\"text-xs\">\n                Pending Feedback\n              </Badge>\n            }\n            value={{ sample_status: \"feedback_pending\" }}\n          />\n        </div>\n      </div>\n\n      {/* Divider */}\n      <div className=\"border-b border-border\" />\n\n      {/* Collapsible Filter Sections */}\n      <div className=\"flex flex-col gap-2\">\n        {/* Activity Type Filter */}\n        <FilterCategory label=\"Activity Type\" icon={<Tag className=\"h-4 w-4\" aria-hidden=\"true\" />}>\n          {INTERACTION_TYPE_OPTIONS.map((option) => (\n            <ToggleFilterButton\n              multiselect\n              key={option.value}\n              className=\"w-full justify-between\"\n              label={option.label}\n              value={{ type: option.value }}\n            />\n          ))}\n        </FilterCategory>\n\n        {/* Sample Status Filter - Only relevant for sample activities */}\n        <FilterCategory\n          label=\"Sample Status\"\n          icon={<Package className=\"h-4 w-4\" aria-hidden=\"true\" />}\n          defaultExpanded={false}\n        >\n          {SAMPLE_STATUS_OPTIONS.map((option) => (\n            <ToggleFilterButton\n              multiselect\n              key={option.value}\n              className=\"w-full justify-between\"\n              label={\n                <Badge\n                  variant={sampleStatusColors[option.value] as any}\n                  className=\"text-xs px-1 py-0\"\n                >\n                  {option.label}\n                </Badge>\n              }\n              value={{ sample_status: option.value }}\n            />\n          ))}\n        </FilterCategory>\n\n        {/* Activity Date Filter */}\n        <FilterCategory\n          label=\"Activity Date\"\n          icon={<Calendar className=\"h-4 w-4\" aria-hidden=\"true\" />}\n        >\n          <ToggleFilterButton\n            className=\"w-full justify-between\"\n            label=\"Today\"\n            value={{\n              \"activity_date@gte\": startOfToday().toISOString(),\n              \"activity_date@lte\": endOfToday().toISOString(),\n            }}\n          />\n          <ToggleFilterButton\n            className=\"w-full justify-between\"\n            label=\"This Week\"\n            value={{\n              \"activity_date@gte\": startOfWeek(new Date()).toISOString(),\n              \"activity_date@lte\": endOfToday().toISOString(),\n            }}\n          />\n          <ToggleFilterButton\n            className=\"w-full justify-between\"\n            label=\"Last 7 Days\"\n            value={{\n              \"activity_date@gte\": subDays(startOfToday(), 7).toISOString(),\n              \"activity_date@lte\": endOfToday().toISOString(),\n            }}\n          />\n        </FilterCategory>\n\n        {/* Sentiment Filter */}\n        <FilterCategory label=\"Sentiment\" icon={<Filter className=\"h-4 w-4\" aria-hidden=\"true\" />}>\n          <ToggleFilterButton\n            multiselect\n            className=\"w-full justify-between\"\n            label={\n              <Badge\n                variant=\"default\"\n                className=\"text-xs px-1 py-0 bg-success text-success-foreground\"\n              >\n                Positive\n              </Badge>\n            }\n            value={{ sentiment: \"positive\" }}\n          />\n          <ToggleFilterButton\n            multiselect\n            className=\"w-full justify-between\"\n            label={\n              <Badge variant=\"secondary\" className=\"text-xs px-1 py-0\">\n                Neutral\n              </Badge>\n            }\n            value={{ sentiment: \"neutral\" }}\n          />\n          <ToggleFilterButton\n            multiselect\n            className=\"w-full justify-between\"\n            label={\n              <Badge variant=\"destructive\" className=\"text-xs px-1 py-0\">\n                Negative\n              </Badge>\n            }\n            value={{ sentiment: \"negative\" }}\n          />\n        </FilterCategory>\n\n        {/* Created By Filter */}\n        <FilterCategory icon={<Users className=\"h-4 w-4\" aria-hidden=\"true\" />} label=\"Created By\">\n          <ToggleFilterButton\n            className=\"w-full justify-between\"\n            label=\"Me\"\n            value={{ created_by: identity?.id }}\n          />\n        </FilterCategory>\n      </div>\n    </div>\n  );\n};\n","/**\n * SampleStatusBadge Component\n *\n * Displays the current status of a sample activity with visual workflow progression.\n * Supports inline status updates via PATCH when in interactive mode.\n *\n * Workflow: Sent → Received → Feedback Pending → Feedback Received\n *\n * Badge Variant Mapping (P8 Design Constraint):\n * - sent: muted (secondary) - Initial state, sample dispatched\n * - received: success - Confirmed receipt by customer\n * - feedback_pending: warning - Awaiting customer feedback\n * - feedback_received: primary - Workflow complete with feedback\n *\n * @see PRD §4.4 for sample tracking requirements\n */\n\n/* eslint-disable react-refresh/only-export-components */\n// This file intentionally exports both a component and related utilities (workflow constants,\n// status config, helper functions) as a cohesive module. Separating them would reduce cohesion.\n\nimport { useState, useCallback } from \"react\";\nimport { useUpdate, useNotify } from \"react-admin\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { cn } from \"@/lib/utils\";\nimport {\n  Check,\n  ChevronRight,\n  Package,\n  PackageCheck,\n  Clock,\n  MessageSquareText,\n  Loader2,\n} from \"lucide-react\";\nimport type { SampleStatus } from \"@/atomic-crm/validation/activities\";\n\n// Re-export type for consumers\nexport type { SampleStatus };\n\n/**\n * Sample status workflow definition\n * Linear progression: sent → received → feedback_pending → feedback_received\n */\nexport const SAMPLE_STATUS_WORKFLOW: readonly SampleStatus[] = [\n  \"sent\",\n  \"received\",\n  \"feedback_pending\",\n  \"feedback_received\",\n] as const;\n\n/**\n * Display configuration for each status\n */\ninterface StatusConfig {\n  label: string;\n  shortLabel: string;\n  icon: typeof Package;\n  variant: \"secondary\" | \"default\" | \"destructive\" | \"outline\";\n  className: string;\n  description: string;\n}\n\n/**\n * Status configuration mapping\n * P8 Design: sent=muted, received=success, pending=warning, feedback=primary\n */\nexport const SAMPLE_STATUS_CONFIG: Record<SampleStatus, StatusConfig> = {\n  sent: {\n    label: \"Sent\",\n    shortLabel: \"Sent\",\n    icon: Package,\n    variant: \"secondary\",\n    className: \"bg-muted text-muted-foreground border-muted-foreground/20\",\n    description: \"Sample has been dispatched to customer\",\n  },\n  received: {\n    label: \"Received\",\n    shortLabel: \"Recv\",\n    icon: PackageCheck,\n    variant: \"default\",\n    className: \"bg-success text-success-foreground border-success/20\",\n    description: \"Customer confirmed receipt of sample\",\n  },\n  feedback_pending: {\n    label: \"Feedback Pending\",\n    shortLabel: \"Pending\",\n    icon: Clock,\n    variant: \"outline\",\n    className: \"bg-warning text-warning-foreground border-warning/20\",\n    description: \"Awaiting customer feedback on sample\",\n  },\n  feedback_received: {\n    label: \"Feedback Received\",\n    shortLabel: \"Complete\",\n    icon: MessageSquareText,\n    variant: \"default\",\n    className: \"bg-primary text-primary-foreground border-primary/20\",\n    description: \"Feedback collected, workflow complete\",\n  },\n};\n\n/**\n * Get the next status in the workflow progression\n * Returns undefined if already at final status\n */\nexport function getNextStatus(currentStatus: SampleStatus): SampleStatus | undefined {\n  const currentIndex = SAMPLE_STATUS_WORKFLOW.indexOf(currentStatus);\n  if (currentIndex === -1 || currentIndex >= SAMPLE_STATUS_WORKFLOW.length - 1) {\n    return undefined;\n  }\n  return SAMPLE_STATUS_WORKFLOW[currentIndex + 1];\n}\n\n/**\n * Get the previous status in the workflow\n * Returns undefined if already at first status\n */\nexport function getPreviousStatus(currentStatus: SampleStatus): SampleStatus | undefined {\n  const currentIndex = SAMPLE_STATUS_WORKFLOW.indexOf(currentStatus);\n  if (currentIndex <= 0) {\n    return undefined;\n  }\n  return SAMPLE_STATUS_WORKFLOW[currentIndex - 1];\n}\n\n/**\n * Check if a status transition is valid (only forward progression)\n */\nexport function isValidTransition(from: SampleStatus, to: SampleStatus): boolean {\n  const fromIndex = SAMPLE_STATUS_WORKFLOW.indexOf(from);\n  const toIndex = SAMPLE_STATUS_WORKFLOW.indexOf(to);\n  // Allow forward progression only (or same status)\n  return toIndex > fromIndex;\n}\n\n// ============================================\n// Component Props\n// ============================================\n\ninterface SampleStatusBadgeProps {\n  /** Current sample status */\n  status: SampleStatus;\n  /** Activity record ID for PATCH updates */\n  activityId?: number | string;\n  /** Enable interactive mode with status progression controls */\n  interactive?: boolean;\n  /** Show workflow stepper visualization */\n  showStepper?: boolean;\n  /** Compact mode - smaller badge without icon */\n  compact?: boolean;\n  /** Callback after successful status update */\n  onStatusChange?: (newStatus: SampleStatus) => void;\n  /** Additional className for the badge */\n  className?: string;\n}\n\n/**\n * SampleStatusBadge - Visual sample workflow status with optional progression controls\n *\n * Features:\n * - Color-coded badges per P8 design constraints\n * - Optional workflow stepper showing all stages\n * - Interactive mode with \"Advance to Next Status\" button\n * - PATCH updates via React Admin data provider\n *\n * @example\n * // Read-only badge\n * <SampleStatusBadge status=\"received\" />\n *\n * @example\n * // Interactive with stepper\n * <SampleStatusBadge\n *   status=\"received\"\n *   activityId={123}\n *   interactive\n *   showStepper\n *   onStatusChange={(s) => console.log('Updated to:', s)}\n * />\n */\nexport function SampleStatusBadge({\n  status,\n  activityId,\n  interactive = false,\n  showStepper = false,\n  compact = false,\n  onStatusChange,\n  className,\n}: SampleStatusBadgeProps) {\n  const config = SAMPLE_STATUS_CONFIG[status];\n  const nextStatus = getNextStatus(status);\n  const Icon = config.icon;\n\n  const [isPopoverOpen, setIsPopoverOpen] = useState(false);\n\n  // React Admin update hook for PATCH operations\n  const [update, { isPending: isUpdating }] = useUpdate();\n  const notify = useNotify();\n\n  /**\n   * Handle status progression to next workflow state\n   * Uses React Admin data provider for PATCH update\n   */\n  const handleAdvanceStatus = useCallback(async () => {\n    if (!activityId || !nextStatus) return;\n\n    try {\n      await update(\n        \"activities\",\n        {\n          id: activityId,\n          data: { sample_status: nextStatus },\n          previousData: { sample_status: status },\n        },\n        {\n          onSuccess: () => {\n            notify(`Sample status updated to ${SAMPLE_STATUS_CONFIG[nextStatus].label}`, {\n              type: \"success\",\n            });\n            onStatusChange?.(nextStatus);\n            setIsPopoverOpen(false);\n          },\n          onError: (error) => {\n            notify(\n              `Failed to update sample status: ${error instanceof Error ? error.message : \"Unknown error\"}`,\n              { type: \"error\" }\n            );\n          },\n        }\n      );\n    } catch {\n      // Error handled by onError callback\n    }\n  }, [activityId, nextStatus, status, update, notify, onStatusChange]);\n\n  /**\n   * Handle direct status selection (for non-linear jumps if needed)\n   */\n  const handleStatusSelect = useCallback(\n    async (targetStatus: SampleStatus) => {\n      if (!activityId || targetStatus === status) return;\n\n      try {\n        await update(\n          \"activities\",\n          {\n            id: activityId,\n            data: { sample_status: targetStatus },\n            previousData: { sample_status: status },\n          },\n          {\n            onSuccess: () => {\n              notify(`Sample status updated to ${SAMPLE_STATUS_CONFIG[targetStatus].label}`, {\n                type: \"success\",\n              });\n              onStatusChange?.(targetStatus);\n              setIsPopoverOpen(false);\n            },\n            onError: (error) => {\n              notify(\n                `Failed to update sample status: ${error instanceof Error ? error.message : \"Unknown error\"}`,\n                { type: \"error\" }\n              );\n            },\n          }\n        );\n      } catch {\n        // Error handled by onError callback\n      }\n    },\n    [activityId, status, update, notify, onStatusChange]\n  );\n\n  // ============================================\n  // Render: Read-Only Badge\n  // ============================================\n\n  if (!interactive) {\n    return (\n      <Badge variant={config.variant} className={cn(config.className, className)}>\n        {!compact && <Icon className=\"h-3 w-3\" />}\n        {compact ? config.shortLabel : config.label}\n      </Badge>\n    );\n  }\n\n  // ============================================\n  // Render: Interactive Badge with Popover\n  // ============================================\n\n  return (\n    <Popover open={isPopoverOpen} onOpenChange={setIsPopoverOpen}>\n      <PopoverTrigger asChild>\n        <button\n          type=\"button\"\n          className={cn(\n            \"inline-flex cursor-pointer transition-opacity hover:opacity-80\",\n            \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n            \"rounded-md\"\n          )}\n          aria-label={`Sample status: ${config.label}. Click to change.`}\n          disabled={isUpdating}\n        >\n          <Badge variant={config.variant} className={cn(config.className, className)}>\n            {isUpdating ? (\n              <Loader2 className=\"h-3 w-3 animate-spin\" />\n            ) : (\n              !compact && <Icon className=\"h-3 w-3\" />\n            )}\n            {compact ? config.shortLabel : config.label}\n          </Badge>\n        </button>\n      </PopoverTrigger>\n\n      <PopoverContent className=\"w-80 p-0\" align=\"start\" side=\"bottom\" sideOffset={4}>\n        <div className=\"p-4 space-y-4\">\n          {/* Header */}\n          <div className=\"space-y-1\">\n            <h4 className=\"font-medium text-sm\">Sample Workflow Status</h4>\n            <p className=\"text-xs text-muted-foreground\">{config.description}</p>\n          </div>\n\n          {/* Workflow Stepper */}\n          {showStepper && (\n            <div className=\"flex items-center justify-between py-2\">\n              {SAMPLE_STATUS_WORKFLOW.map((stepStatus, index) => {\n                const stepConfig = SAMPLE_STATUS_CONFIG[stepStatus];\n                const StepIcon = stepConfig.icon;\n                const currentIndex = SAMPLE_STATUS_WORKFLOW.indexOf(status);\n                const isCompleted = index < currentIndex;\n                const isCurrent = stepStatus === status;\n\n                return (\n                  <div key={stepStatus} className=\"flex items-center\">\n                    {/* Step indicator */}\n                    <button\n                      type=\"button\"\n                      onClick={() => handleStatusSelect(stepStatus)}\n                      disabled={isUpdating || index <= currentIndex}\n                      className={cn(\n                        \"flex flex-col items-center gap-1 p-1 rounded transition-colors\",\n                        \"focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring\",\n                        index > currentIndex ? \"cursor-pointer hover:bg-muted\" : \"cursor-default\"\n                      )}\n                      aria-label={`${isCompleted ? \"Completed: \" : isCurrent ? \"Current: \" : \"\"}${stepConfig.label}`}\n                    >\n                      <div\n                        className={cn(\n                          \"h-11 w-11 rounded-full flex items-center justify-center transition-colors\",\n                          isCompleted && \"bg-success text-success-foreground\",\n                          isCurrent && stepConfig.className,\n                          !isCompleted && !isCurrent && \"bg-muted text-muted-foreground\"\n                        )}\n                      >\n                        {isCompleted ? (\n                          <Check className=\"h-4 w-4\" />\n                        ) : (\n                          <StepIcon className=\"h-4 w-4\" />\n                        )}\n                      </div>\n                      <span\n                        className={cn(\n                          \"text-[10px] font-medium\",\n                          isCurrent ? \"text-foreground\" : \"text-muted-foreground\"\n                        )}\n                      >\n                        {stepConfig.shortLabel}\n                      </span>\n                    </button>\n\n                    {/* Connector line */}\n                    {index < SAMPLE_STATUS_WORKFLOW.length - 1 && (\n                      <ChevronRight\n                        className={cn(\n                          \"h-4 w-4 mx-1\",\n                          index < currentIndex ? \"text-success\" : \"text-muted-foreground/40\"\n                        )}\n                      />\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          )}\n\n          {/* Quick Actions */}\n          <div className=\"flex flex-col gap-2\">\n            {nextStatus && (\n              <Button\n                onClick={handleAdvanceStatus}\n                disabled={isUpdating}\n                className=\"w-full h-11\"\n                size=\"default\"\n              >\n                {isUpdating ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    Updating...\n                  </>\n                ) : (\n                  <>\n                    Advance to {SAMPLE_STATUS_CONFIG[nextStatus].label}\n                    <ChevronRight className=\"h-4 w-4 ml-1\" />\n                  </>\n                )}\n              </Button>\n            )}\n\n            {!nextStatus && (\n              <div className=\"text-center py-2\">\n                <Badge variant=\"default\" className=\"bg-success text-success-foreground\">\n                  <Check className=\"h-3 w-3\" />\n                  Workflow Complete\n                </Badge>\n              </div>\n            )}\n          </div>\n\n          {/* Status Selection List (for direct jumps) */}\n          <div className=\"border-t pt-3 mt-3\">\n            <p className=\"text-xs text-muted-foreground mb-2\">Or select a status directly:</p>\n            <div className=\"grid grid-cols-2 gap-2\">\n              {SAMPLE_STATUS_WORKFLOW.map((selectStatus) => {\n                const selectConfig = SAMPLE_STATUS_CONFIG[selectStatus];\n                const SelectIcon = selectConfig.icon;\n                const isCurrent = selectStatus === status;\n\n                return (\n                  <Button\n                    key={selectStatus}\n                    variant={isCurrent ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    className={cn(\"h-11 justify-start\", isCurrent && \"pointer-events-none\")}\n                    onClick={() => handleStatusSelect(selectStatus)}\n                    disabled={isUpdating || isCurrent}\n                  >\n                    <SelectIcon className=\"h-3 w-3 mr-2\" />\n                    {selectConfig.shortLabel}\n                    {isCurrent && <Check className=\"h-3 w-3 ml-auto\" />}\n                  </Button>\n                );\n              })}\n            </div>\n          </div>\n        </div>\n      </PopoverContent>\n    </Popover>\n  );\n}\n\n// ============================================\n// Utility Components\n// ============================================\n\n/**\n * Compact inline stepper showing workflow progression\n * Useful for list views or tight spaces\n */\nexport function SampleStatusStepper({\n  status,\n  className,\n}: {\n  status: SampleStatus;\n  className?: string;\n}) {\n  const currentIndex = SAMPLE_STATUS_WORKFLOW.indexOf(status);\n\n  return (\n    <div className={cn(\"flex items-center gap-1\", className)}>\n      {SAMPLE_STATUS_WORKFLOW.map((stepStatus, index) => {\n        const isCompleted = index < currentIndex;\n        const isCurrent = stepStatus === status;\n\n        return (\n          <div key={stepStatus} className=\"flex items-center\">\n            <div\n              className={cn(\n                \"h-2 w-2 rounded-full transition-colors\",\n                isCompleted && \"bg-success\",\n                isCurrent && \"bg-primary\",\n                !isCompleted && !isCurrent && \"bg-muted-foreground/30\"\n              )}\n              title={SAMPLE_STATUS_CONFIG[stepStatus].label}\n            />\n            {index < SAMPLE_STATUS_WORKFLOW.length - 1 && (\n              <div\n                className={cn(\n                  \"h-0.5 w-3\",\n                  index < currentIndex ? \"bg-success\" : \"bg-muted-foreground/20\"\n                )}\n              />\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\nexport default SampleStatusBadge;\n","/**\n * Activity Filter Configuration\n *\n * Defines how activity filters are displayed in the FilterChipBar.\n * Imports from validation schema to prevent label drift.\n *\n * @module activities/activityFilterConfig\n */\n\nimport { validateFilterConfig } from \"../filters/filterConfigSchema\";\nimport { format, isToday, isThisWeek, isThisMonth } from \"date-fns\";\nimport {\n  INTERACTION_TYPE_OPTIONS,\n  SAMPLE_STATUS_OPTIONS,\n  sentimentSchema,\n} from \"../validation/activities\";\n\n/**\n * Convert validation options to filter choices format\n */\nconst INTERACTION_TYPE_CHOICES = INTERACTION_TYPE_OPTIONS.map((opt) => ({\n  id: opt.value,\n  name: opt.label,\n}));\n\nconst SAMPLE_STATUS_CHOICES = SAMPLE_STATUS_OPTIONS.map((opt) => ({\n  id: opt.value,\n  name: opt.label,\n}));\n\nconst SENTIMENT_CHOICES = sentimentSchema.options.map((value) => ({\n  id: value,\n  name: value.charAt(0).toUpperCase() + value.slice(1),\n}));\n\n/**\n * Format date values for chip display\n */\nfunction formatDateLabel(value: unknown): string {\n  if (!value || typeof value !== \"string\") return String(value);\n\n  const date = new Date(value);\n  if (isNaN(date.getTime())) return String(value);\n\n  if (isToday(date)) return \"Today\";\n  if (isThisWeek(date)) return \"This week\";\n  if (isThisMonth(date)) return \"This month\";\n  return format(date, \"MMM d, yyyy\");\n}\n\n/**\n * Filter configuration for Activities list\n *\n * Matches filters available in ActivityListFilter.tsx:\n * - type: Interaction type (NOT activity_type)\n * - sample_status: Sample tracking status\n * - activity_date@gte/lte: Activity date range\n * - sentiment: Activity sentiment\n * - created_by: Creator reference (NOT sales_id)\n *\n * ⚠️ NOTE: Activities use @gte/@lte format for date filters\n */\nexport const ACTIVITY_FILTER_CONFIG = validateFilterConfig([\n  {\n    key: \"type\",\n    label: \"Type\",\n    type: \"multiselect\",\n    choices: INTERACTION_TYPE_CHOICES,\n  },\n  {\n    key: \"sample_status\",\n    label: \"Sample Status\",\n    type: \"multiselect\",\n    choices: SAMPLE_STATUS_CHOICES,\n  },\n  {\n    key: \"activity_date@gte\",\n    label: \"After\",\n    type: \"date-range\",\n    formatLabel: formatDateLabel,\n    removalGroup: \"activity_date_range\",\n  },\n  {\n    key: \"activity_date@lte\",\n    label: \"Before\",\n    type: \"date-range\",\n    formatLabel: formatDateLabel,\n    removalGroup: \"activity_date_range\",\n  },\n  {\n    key: \"sentiment\",\n    label: \"Sentiment\",\n    type: \"multiselect\",\n    choices: SENTIMENT_CHOICES,\n  },\n  {\n    key: \"created_by\",\n    label: \"Created By\",\n    type: \"reference\",\n    reference: \"sales\",\n  },\n]);\n","import jsonExport from \"jsonexport/dist\";\nimport { downloadCSV, type Exporter, useGetIdentity, useListContext } from \"ra-core\";\nimport { FunctionField } from \"react-admin\";\n\nimport { List } from \"@/components/admin/list\";\nimport { CreateButton } from \"@/components/admin/create-button\";\nimport { ExportButton } from \"@/components/admin/export-button\";\nimport { FloatingCreateButton } from \"@/components/admin/FloatingCreateButton\";\nimport { StandardListLayout } from \"@/components/layouts/StandardListLayout\";\nimport { PremiumDatagrid } from \"@/components/admin/PremiumDatagrid\";\nimport { TextField } from \"@/components/admin/text-field\";\nimport { DateField } from \"@/components/admin/date-field\";\nimport { ReferenceField } from \"@/components/admin/reference-field\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ActivityListSkeleton } from \"@/components/ui/list-skeleton\";\nimport { SaleName } from \"../sales/SaleName\";\nimport { TopToolbar } from \"../layout/TopToolbar\";\nimport { ActivityListFilter } from \"./ActivityListFilter\";\nimport { SampleStatusBadge } from \"../components/SampleStatusBadge\";\nimport { useFilterCleanup } from \"../hooks/useFilterCleanup\";\nimport { FilterChipBar } from \"../filters\";\nimport { useListKeyboardNavigation } from \"@/hooks/useListKeyboardNavigation\";\nimport { BulkActionsToolbar } from \"@/components/admin/bulk-actions-toolbar\";\nimport { COLUMN_VISIBILITY } from \"../utils/listPatterns\";\nimport { PageTutorialTrigger } from \"../tutorial\";\nimport type { ActivityRecord, Contact, Opportunity, Organization, Sale } from \"../types\";\nimport { INTERACTION_TYPE_OPTIONS } from \"../validation/activities\";\nimport { ACTIVITY_FILTER_CONFIG } from \"./activityFilterConfig\";\n\n/**\n * ActivityList - Standard list page for Activity records\n *\n * Follows ContactList reference pattern:\n * - Identity-aware rendering with skeleton loading\n * - Keyboard navigation (no slide-over - activities edited inline/modal)\n * - BulkActionsToolbar for selection operations\n * - Responsive columns using COLUMN_VISIBILITY semantic presets\n *\n * Features:\n * - Filter by activity type (13 types including samples)\n * - Filter by sample_status (sent, received, feedback_pending, feedback_received)\n * - Quick filters: \"Samples Only\", \"Pending Feedback\"\n * - Date range filters\n * - Sentiment filters\n * - Export to CSV\n *\n * @see PRD §4.4 for sample tracking requirements\n */\nexport default function ActivityList() {\n  const { data: identity, isPending: isIdentityPending } = useGetIdentity();\n\n  // Clean up stale cached filters from localStorage\n  useFilterCleanup(\"activities\");\n\n  if (isIdentityPending) return <ActivityListSkeleton />;\n  if (!identity) return null;\n\n  return (\n    <>\n      <div data-tutorial=\"activities-list\">\n        <List\n          title={false}\n          perPage={50}\n          sort={{ field: \"activity_date\", order: \"DESC\" }}\n          exporter={exporter}\n          filter={{\n            \"deleted_at@is\": null,\n          }}\n          actions={<ActivityListActions />}\n        >\n          <ActivityListLayout />\n          <FloatingCreateButton />\n        </List>\n      </div>\n      <PageTutorialTrigger chapter=\"activities\" position=\"bottom-left\" />\n    </>\n  );\n}\n\n/**\n * ActivityListLayout - Handles loading, empty states, and datagrid rendering\n */\nconst ActivityListLayout = () => {\n  const { data, isPending, filterValues } = useListContext();\n\n  // Keyboard navigation for list rows\n  // Note: Activities don't use slide-over pattern, so no enabled toggle needed\n  const { focusedIndex } = useListKeyboardNavigation({\n    onSelect: () => {}, // Activities use inline editing or modal\n    enabled: true,\n  });\n\n  const hasFilters = filterValues && Object.keys(filterValues).length > 0;\n\n  if (isPending) {\n    return (\n      <StandardListLayout resource=\"activities\" filterComponent={<ActivityListFilter />}>\n        <ActivityListSkeleton />\n      </StandardListLayout>\n    );\n  }\n\n  if (!data?.length && !hasFilters) {\n    return (\n      <StandardListLayout resource=\"activities\" filterComponent={<ActivityListFilter />}>\n        <div className=\"flex flex-col items-center justify-center py-12 text-center\">\n          <p className=\"text-muted-foreground\">No activities found.</p>\n          <p className=\"text-sm text-muted-foreground mt-2\">\n            Activities will appear here as you log interactions with customers.\n          </p>\n        </div>\n      </StandardListLayout>\n    );\n  }\n\n  return (\n    <>\n      <StandardListLayout resource=\"activities\" filterComponent={<ActivityListFilter />}>\n        <FilterChipBar filterConfig={ACTIVITY_FILTER_CONFIG} />\n        <PremiumDatagrid focusedIndex={focusedIndex}>\n          {/* Column 1: Activity Type - Classification badge (sortable) - always visible */}\n          <FunctionField\n            label=\"Type\"\n            sortBy=\"type\"\n            render={(record: ActivityRecord) => {\n              const typeOption = INTERACTION_TYPE_OPTIONS.find((opt) => opt.value === record.type);\n              return (\n                <Badge variant=\"outline\" className=\"text-xs\">\n                  {typeOption?.label || record.type}\n                </Badge>\n              );\n            }}\n            {...COLUMN_VISIBILITY.alwaysVisible}\n          />\n\n          {/* Column 2: Subject - Primary identifier (sortable) - always visible */}\n          <TextField source=\"subject\" label=\"Subject\" {...COLUMN_VISIBILITY.alwaysVisible} />\n\n          {/* Column 3: Activity Date - Time field (sortable) - always visible */}\n          <DateField\n            source=\"activity_date\"\n            label=\"Date\"\n            showTime={false}\n            sortable\n            {...COLUMN_VISIBILITY.alwaysVisible}\n          />\n\n          {/* Column 4: Sample Status - Only for sample activities (non-sortable) - hidden on tablet/mobile */}\n          <FunctionField\n            label=\"Sample Status\"\n            sortable={false}\n            render={(record: ActivityRecord) => {\n              if (record.type !== \"sample\" || !record.sample_status) {\n                return <span className=\"text-muted-foreground\">—</span>;\n              }\n              return <SampleStatusBadge status={record.sample_status} readonly />;\n            }}\n            {...COLUMN_VISIBILITY.desktopOnly}\n          />\n\n          {/* Column 5: Sentiment - Feedback indicator (non-sortable) - hidden on tablet/mobile */}\n          <FunctionField\n            label=\"Sentiment\"\n            sortable={false}\n            render={(record: ActivityRecord) => {\n              if (!record.sentiment) {\n                return <span className=\"text-muted-foreground\">—</span>;\n              }\n              const sentimentColors: Record<string, string> = {\n                positive: \"bg-success/10 text-success\",\n                neutral: \"bg-muted text-muted-foreground\",\n                negative: \"bg-destructive/10 text-destructive\",\n              };\n              return (\n                <Badge className={sentimentColors[record.sentiment] || \"\"} variant=\"outline\">\n                  {record.sentiment.charAt(0).toUpperCase() + record.sentiment.slice(1)}\n                </Badge>\n              );\n            }}\n            {...COLUMN_VISIBILITY.desktopOnly}\n          />\n\n          {/* Column 6: Organization - Reference field (sortable) - always visible */}\n          <ReferenceField\n            source=\"organization_id\"\n            reference=\"organizations\"\n            label=\"Organization\"\n            link={false}\n            sortable\n            {...COLUMN_VISIBILITY.alwaysVisible}\n          >\n            <TextField source=\"name\" />\n          </ReferenceField>\n\n          {/* Column 7: Opportunity - Reference field (non-sortable) - hidden on tablet/mobile */}\n          <ReferenceField\n            source=\"opportunity_id\"\n            reference=\"opportunities\"\n            label=\"Opportunity\"\n            link={false}\n            sortable={false}\n            {...COLUMN_VISIBILITY.desktopOnly}\n          >\n            <TextField source=\"name\" />\n          </ReferenceField>\n\n          {/* Column 8: Created By - Sales reference (non-sortable) - hidden on tablet/mobile */}\n          <ReferenceField\n            source=\"created_by\"\n            reference=\"sales\"\n            label=\"Created By\"\n            link={false}\n            sortable={false}\n            {...COLUMN_VISIBILITY.desktopOnly}\n          >\n            <SaleName />\n          </ReferenceField>\n        </PremiumDatagrid>\n      </StandardListLayout>\n      <BulkActionsToolbar />\n    </>\n  );\n};\n\n/**\n * ActivityListActions - TopToolbar with export and create actions\n */\nconst ActivityListActions = () => (\n  <TopToolbar>\n    <ExportButton exporter={exporter} />\n    <span data-tutorial=\"create-activity-btn\">\n      <CreateButton label=\"Log Activity\" />\n    </span>\n  </TopToolbar>\n);\n\n/**\n * CSV exporter for Activity records\n */\nconst exporter: Exporter<ActivityRecord> = async (records, fetchRelatedRecords) => {\n  // Fetch related data\n  const contacts = await fetchRelatedRecords<Contact>(records, \"contact_id\", \"contacts\");\n  const organizations = await fetchRelatedRecords<Organization>(\n    records,\n    \"organization_id\",\n    \"organizations\"\n  );\n  const opportunities = await fetchRelatedRecords<Opportunity>(\n    records,\n    \"opportunity_id\",\n    \"opportunities\"\n  );\n  const sales = await fetchRelatedRecords<Sale>(records, \"created_by\", \"sales\");\n\n  const dataForExport = records.map((activity) => {\n    const contact = activity.contact_id ? contacts[activity.contact_id] : null;\n    const organization = activity.organization_id ? organizations[activity.organization_id] : null;\n    const opportunity = activity.opportunity_id ? opportunities[activity.opportunity_id] : null;\n    const createdBy = activity.created_by ? sales[activity.created_by] : null;\n\n    return {\n      id: activity.id,\n      activity_type: activity.activity_type,\n      type: activity.type,\n      subject: activity.subject,\n      description: activity.description || \"\",\n      activity_date: activity.activity_date,\n      duration_minutes: activity.duration_minutes || \"\",\n      sample_status: activity.sample_status || \"\",\n      sentiment: activity.sentiment || \"\",\n      contact_name: contact ? `${contact.first_name || \"\"} ${contact.last_name || \"\"}`.trim() : \"\",\n      organization_name: organization?.name || \"\",\n      opportunity_name: opportunity?.name || \"\",\n      created_by: createdBy\n        ? `${createdBy.first_name || \"\"} ${createdBy.last_name || \"\"}`.trim()\n        : \"\",\n      created_at: activity.created_at,\n    };\n  });\n\n  jsonExport(\n    dataForExport,\n    {\n      headers: [\n        \"id\",\n        \"activity_type\",\n        \"type\",\n        \"subject\",\n        \"description\",\n        \"activity_date\",\n        \"duration_minutes\",\n        \"sample_status\",\n        \"sentiment\",\n        \"contact_name\",\n        \"organization_name\",\n        \"opportunity_name\",\n        \"created_by\",\n        \"created_at\",\n      ],\n    },\n    (err, csv) => {\n      if (err) {\n        throw new Error(`CSV export failed: ${err.message}`);\n      }\n      downloadCSV(csv, \"activities\");\n    }\n  );\n};\n"],"names":["ActivityListFilter","__name","data","identity","useGetIdentity","sampleStatusColors","sent","received","feedback_pending","feedback_received","jsxs","className","children","jsx","FilterLiveForm","SearchInput","source","placeholder","ToggleFilterButton","label","Package","value","type","Badge","variant","sample_status","FilterCategory","icon","Tag","INTERACTION_TYPE_OPTIONS","map","option","multiselect","defaultExpanded","SAMPLE_STATUS_OPTIONS","Calendar","startOfToday","toISOString","endOfToday","startOfWeek","Date","subDays","Filter","sentiment","Users","created_by","id","SAMPLE_STATUS_WORKFLOW","SAMPLE_STATUS_CONFIG","shortLabel","description","PackageCheck","Clock","MessageSquareText","getNextStatus","currentStatus","currentIndex","indexOf","length","SampleStatusBadge","status","activityId","interactive","showStepper","compact","onStatusChange","config","nextStatus","Icon","isPopoverOpen","setIsPopoverOpen","useState","update","isPending","isUpdating","useUpdate","notify","useNotify","handleAdvanceStatus","useCallback","async","previousData","onSuccess","onError","error","Error","message","handleStatusSelect","targetStatus","Popover","open","onOpenChange","PopoverTrigger","asChild","cn","disabled","Loader2","PopoverContent","align","side","sideOffset","stepStatus","index","stepConfig","StepIcon","isCompleted","isCurrent","onClick","Check","ChevronRight","Button","size","Fragment","selectStatus","selectConfig","SelectIcon","INTERACTION_TYPE_CHOICES","opt","name","SAMPLE_STATUS_CHOICES","SENTIMENT_CHOICES","sentimentSchema","options","charAt","toUpperCase","slice","formatDateLabel","String","date","isNaN","getTime","isToday","isThisWeek","isThisMonth","format","ACTIVITY_FILTER_CONFIG","validateFilterConfig","key","choices","formatLabel","removalGroup","reference","ActivityList","isIdentityPending","useFilterCleanup","ActivityListSkeleton","List","title","perPage","sort","field","order","exporter","filter","actions","ActivityListActions","ActivityListLayout","FloatingCreateButton","PageTutorialTrigger","chapter","position","filterValues","useListContext","focusedIndex","useListKeyboardNavigation","onSelect","enabled","hasFilters","Object","keys","StandardListLayout","resource","filterComponent","FilterChipBar","filterConfig","PremiumDatagrid","FunctionField","sortBy","render","record","typeOption","find","COLUMN_VISIBILITY","alwaysVisible","TextField","DateField","showTime","sortable","readonly","desktopOnly","positive","neutral","negative","ReferenceField","link","SaleName","BulkActionsToolbar","TopToolbar","ExportButton","CreateButton","records","fetchRelatedRecords","contacts","organizations","opportunities","sales","dataForExport","activity","contact","contact_id","organization","organization_id","opportunity","opportunity_id","createdBy","activity_type","subject","activity_date","duration_minutes","contact_name","first_name","last_name","trim","organization_name","opportunity_name","created_at","jsonExport","headers","err","csv","downloadCSV"],"mappings":"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"}