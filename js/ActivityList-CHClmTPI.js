var e=Object.defineProperty,s=(s,t)=>e(s,"name",{value:t,configurable:!0});import{i as t,j as a,al as i,W as l,u as n,am as r,an as c,ak as o}from"./chunk-ByJg_QQB.js";import{S as d,L as u,E as m,C as p}from"./chunk-BBQ6yJWi.js";import{u as x,A as f,F as j,b as h}from"./chunk-C8K6x_Yi.js";import{v as b,S as y,F as v}from"./chunk-A2EVsQEK.js";import{P as g}from"./chunk-CKWniV73.js";import{d as N,av as _,a_ as k,s as w,B as S,a$ as C,r as O}from"../assets/index-BoLku8RR.js";import{D as L}from"./chunk-DkiUngdk.js";import{R as A}from"./chunk-DbeoRBEW.js";import{S as F}from"./chunk-j7Lqvg-1.js";import{T as P}from"./chunk-BtJ7Qrct.js";import{T,F as $}from"./chunk-C6dCzd_-.js";import{o as z,W as D,a8 as E,aN as I,U as B,aO as U,ah as V,aP as M,f as R,C as W,a as G}from"./chunk-Bc6KM1xM.js";import{A as q,m as K,s as Q,x as H,j as J,k as X,l as Y,d as Z}from"./chunk-DwAffUXc.js";import{r as ee}from"./chunk-1NZFT-6z.js";import{P as se,a as te,b as ae}from"./chunk-C_u3nriX.js";import"./chunk-CFj7NhUg.js";import{B as ie}from"./chunk-BndLoydo.js";import{C as le}from"./chunk-C0a-ooKP.js";import{P as ne,F as re}from"./chunk-Nds5IV03.js";import"./chunk-JxeXaC9i.js";import"./chunk-Dc4zIuSl.js";import"./chunk-B1s-jt27.js";import"./chunk-knA4lag3.js";import"./chunk-Tyyhsnez.js";import"./chunk-DA1DYucv.js";import"./chunk-UKb2nn92.js";import"./chunk-XoqkUGE_.js";import"./chunk-DHnjrG--.js";import"./chunk-CRKBdUTG.js";const ce=s(()=>{const{data:e}=t(),s={sent:"outline",received:"secondary",feedback_pending:"default",feedback_received:"destructive"};return a.jsxs("div",{className:"flex flex-col gap-4",children:[a.jsx(i,{children:a.jsx(d,{source:"q",placeholder:"Search activities..."})}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("h3",{className:"font-semibold text-sm text-muted-foreground",children:"Quick Filters"}),a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx(T,{className:"w-full justify-between",label:a.jsxs("span",{className:"flex items-center gap-2",children:[a.jsx(z,{className:"h-4 w-4","aria-hidden":"true"}),"Samples Only"]}),value:{type:"sample"}}),a.jsx(T,{className:"w-full justify-between",label:a.jsx(N,{variant:"default",className:"text-xs",children:"Pending Feedback"}),value:{sample_status:"feedback_pending"}})]})]}),a.jsx("div",{className:"border-b border-border"}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx($,{label:"Activity Type",icon:a.jsx(D,{className:"h-4 w-4","aria-hidden":"true"}),children:_.map(e=>a.jsx(T,{multiselect:!0,className:"w-full justify-between",label:e.label,value:{type:e.value}},e.value))}),a.jsx($,{label:"Sample Status",icon:a.jsx(z,{className:"h-4 w-4","aria-hidden":"true"}),defaultExpanded:!1,children:k.map(e=>a.jsx(T,{multiselect:!0,className:"w-full justify-between",label:a.jsx(N,{variant:s[e.value],className:"text-xs px-1 py-0",children:e.label}),value:{sample_status:e.value}},e.value))}),a.jsxs($,{label:"Activity Date",icon:a.jsx(E,{className:"h-4 w-4","aria-hidden":"true"}),children:[a.jsx(T,{className:"w-full justify-between",label:"Today",value:{"activity_date@gte":K().toISOString(),"activity_date@lte":q().toISOString()}}),a.jsx(T,{className:"w-full justify-between",label:"This Week",value:{"activity_date@gte":Q(new Date).toISOString(),"activity_date@lte":q().toISOString()}}),a.jsx(T,{className:"w-full justify-between",label:"Last 7 Days",value:{"activity_date@gte":H(K(),7).toISOString(),"activity_date@lte":q().toISOString()}})]}),a.jsxs($,{label:"Sentiment",icon:a.jsx(I,{className:"h-4 w-4","aria-hidden":"true"}),children:[a.jsx(T,{multiselect:!0,className:"w-full justify-between",label:a.jsx(N,{variant:"default",className:"text-xs px-1 py-0 bg-success text-success-foreground",children:"Positive"}),value:{sentiment:"positive"}}),a.jsx(T,{multiselect:!0,className:"w-full justify-between",label:a.jsx(N,{variant:"secondary",className:"text-xs px-1 py-0",children:"Neutral"}),value:{sentiment:"neutral"}}),a.jsx(T,{multiselect:!0,className:"w-full justify-between",label:a.jsx(N,{variant:"destructive",className:"text-xs px-1 py-0",children:"Negative"}),value:{sentiment:"negative"}})]}),a.jsx($,{icon:a.jsx(B,{className:"h-4 w-4","aria-hidden":"true"}),label:"Created By",children:a.jsx(T,{className:"w-full justify-between",label:"Me",value:{created_by:e?.id}})})]})]})},"ActivityListFilter"),oe=["sent","received","feedback_pending","feedback_received"],de={sent:{label:"Sent",shortLabel:"Sent",icon:z,variant:"secondary",className:"bg-muted text-muted-foreground border-muted-foreground/20",description:"Sample has been dispatched to customer"},received:{label:"Received",shortLabel:"Recv",icon:M,variant:"default",className:"bg-success text-success-foreground border-success/20",description:"Customer confirmed receipt of sample"},feedback_pending:{label:"Feedback Pending",shortLabel:"Pending",icon:V,variant:"outline",className:"bg-warning text-warning-foreground border-warning/20",description:"Awaiting customer feedback on sample"},feedback_received:{label:"Feedback Received",shortLabel:"Complete",icon:U,variant:"default",className:"bg-primary text-primary-foreground border-primary/20",description:"Feedback collected, workflow complete"}};function ue(e){const s=oe.indexOf(e);if(!(-1===s||s>=oe.length-1))return oe[s+1]}function me({status:e,activityId:t,interactive:i=!1,showStepper:r=!1,compact:c=!1,onStatusChange:o,className:d}){const u=de[e],m=ue(e),p=u.icon,[x,f]=ee.useState(!1),[j,{isPending:h}]=l(),b=n(),y=ee.useCallback(async()=>{if(t&&m)try{await j("activities",{id:t,data:{sample_status:m},previousData:{sample_status:e}},{onSuccess:s(()=>{b(`Sample status updated to ${de[m].label}`,{type:"success"}),o?.(m),f(!1)},"onSuccess"),onError:s(e=>{b(`Failed to update sample status: ${e instanceof Error?e.message:"Unknown error"}`,{type:"error"})},"onError")})}catch{}},[t,m,e,j,b,o]),v=ee.useCallback(async a=>{if(t&&a!==e)try{await j("activities",{id:t,data:{sample_status:a},previousData:{sample_status:e}},{onSuccess:s(()=>{b(`Sample status updated to ${de[a].label}`,{type:"success"}),o?.(a),f(!1)},"onSuccess"),onError:s(e=>{b(`Failed to update sample status: ${e instanceof Error?e.message:"Unknown error"}`,{type:"error"})},"onError")})}catch{}},[t,e,j,b,o]);return i?a.jsxs(se,{open:x,onOpenChange:f,children:[a.jsx(te,{asChild:!0,children:a.jsx("button",{type:"button",className:w("inline-flex cursor-pointer transition-opacity hover:opacity-80","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","rounded-md"),"aria-label":`Sample status: ${u.label}. Click to change.`,disabled:h,children:a.jsxs(N,{variant:u.variant,className:w(u.className,d),children:[h?a.jsx(R,{className:"h-3 w-3 animate-spin"}):!c&&a.jsx(p,{className:"h-3 w-3"}),c?u.shortLabel:u.label]})})}),a.jsx(ae,{className:"w-80 p-0",align:"start",side:"bottom",sideOffset:4,children:a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("h4",{className:"font-medium text-sm",children:"Sample Workflow Status"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:u.description})]}),r&&a.jsx("div",{className:"flex items-center justify-between py-2",children:oe.map((t,i)=>{const l=de[t],n=l.icon,r=oe.indexOf(e),c=i<r,o=t===e;return a.jsxs("div",{className:"flex items-center",children:[a.jsxs("button",{type:"button",onClick:s(()=>v(t),"onClick"),disabled:h||i<=r,className:w("flex flex-col items-center gap-1 p-1 rounded transition-colors","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",i>r?"cursor-pointer hover:bg-muted":"cursor-default"),"aria-label":`${c?"Completed: ":o?"Current: ":""}${l.label}`,children:[a.jsx("div",{className:w("h-11 w-11 rounded-full flex items-center justify-center transition-colors",c&&"bg-success text-success-foreground",o&&l.className,!c&&!o&&"bg-muted text-muted-foreground"),children:c?a.jsx(W,{className:"h-4 w-4"}):a.jsx(n,{className:"h-4 w-4"})}),a.jsx("span",{className:w("text-[10px] font-medium",o?"text-foreground":"text-muted-foreground"),children:l.shortLabel})]}),i<oe.length-1&&a.jsx(G,{className:w("h-4 w-4 mx-1",i<r?"text-success":"text-muted-foreground/40")})]},t)})}),a.jsxs("div",{className:"flex flex-col gap-2",children:[m&&a.jsx(S,{onClick:y,disabled:h,className:"w-full h-11",size:"default",children:h?a.jsxs(a.Fragment,{children:[a.jsx(R,{className:"h-4 w-4 animate-spin"}),"Updating..."]}):a.jsxs(a.Fragment,{children:["Advance to ",de[m].label,a.jsx(G,{className:"h-4 w-4 ml-1"})]})}),!m&&a.jsx("div",{className:"text-center py-2",children:a.jsxs(N,{variant:"default",className:"bg-success text-success-foreground",children:[a.jsx(W,{className:"h-3 w-3"}),"Workflow Complete"]})})]}),a.jsxs("div",{className:"border-t pt-3 mt-3",children:[a.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Or select a status directly:"}),a.jsx("div",{className:"grid grid-cols-2 gap-2",children:oe.map(t=>{const i=de[t],l=i.icon,n=t===e;return a.jsxs(S,{variant:n?"default":"outline",size:"sm",className:w("h-11 justify-start",n&&"pointer-events-none"),onClick:s(()=>v(t),"onClick"),disabled:h||n,children:[a.jsx(l,{className:"h-3 w-3 mr-2"}),i.shortLabel,n&&a.jsx(W,{className:"h-3 w-3 ml-auto"})]},t)})})]})]})})]}):a.jsxs(N,{variant:u.variant,className:w(u.className,d),children:[!c&&a.jsx(p,{className:"h-3 w-3"}),c?u.shortLabel:u.label]})}s(ue,"getNextStatus"),s(me,"SampleStatusBadge");const pe=_.map(e=>({id:e.value,name:e.label})),xe=k.map(e=>({id:e.value,name:e.label})),fe=C.options.map(e=>({id:e,name:e.charAt(0).toUpperCase()+e.slice(1)}));function je(e){if(!e||"string"!=typeof e)return String(e);const s=new Date(e);return isNaN(s.getTime())?String(e):J(s)?"Today":X(s)?"This week":Y(s)?"This month":Z(s,"MMM d, yyyy")}s(je,"formatDateLabel");const he=b([{key:"type",label:"Type",type:"multiselect",choices:pe},{key:"sample_status",label:"Sample Status",type:"multiselect",choices:xe},{key:"activity_date@gte",label:"After",type:"date-range",formatLabel:je,removalGroup:"activity_date_range"},{key:"activity_date@lte",label:"Before",type:"date-range",formatLabel:je,removalGroup:"activity_date_range"},{key:"sentiment",label:"Sentiment",type:"multiselect",choices:fe},{key:"created_by",label:"Created By",type:"reference",reference:"sales"}]);function be(){const{data:e,isPending:s}=t();return x("activities"),s?a.jsx(f,{}):e?a.jsxs(a.Fragment,{children:[a.jsx("div",{"data-tutorial":"activities-list",children:a.jsxs(u,{title:!1,perPage:50,sort:{field:"activity_date",order:"DESC"},exporter:ge,filter:{"deleted_at@is":null},actions:a.jsx(ve,{}),children:[a.jsx(ye,{}),a.jsx(j,{})]})}),a.jsx(ne,{chapter:"activities",position:"bottom-left"})]}):null}s(be,"ActivityList");const ye=s(()=>{const{data:e,isPending:t,filterValues:i}=o(),{focusedIndex:l}=h({onSelect:s(()=>{},"onSelect"),enabled:!0}),n=i&&Object.keys(i).length>0;return t?a.jsx(y,{resource:"activities",filterComponent:a.jsx(ce,{}),children:a.jsx(f,{})}):e?.length||n?a.jsxs(a.Fragment,{children:[a.jsxs(y,{resource:"activities",filterComponent:a.jsx(ce,{}),children:[a.jsx(v,{filterConfig:he}),a.jsxs(g,{focusedIndex:l,children:[a.jsx(re,{label:"Type",sortBy:"type",render:s(e=>{const s=_.find(s=>s.value===e.type);return a.jsx(N,{variant:"outline",className:"text-xs",children:s?.label||e.type})},"render"),...le.alwaysVisible}),a.jsx(O,{source:"subject",label:"Subject",...le.alwaysVisible}),a.jsx(L,{source:"activity_date",label:"Date",showTime:!1,sortable:!0,...le.alwaysVisible}),a.jsx(re,{label:"Sample Status",sortable:!1,render:s(e=>"sample"===e.type&&e.sample_status?a.jsx(me,{status:e.sample_status,readonly:!0}):a.jsx("span",{className:"text-muted-foreground",children:"—"}),"render"),...le.desktopOnly}),a.jsx(re,{label:"Sentiment",sortable:!1,render:s(e=>{if(!e.sentiment)return a.jsx("span",{className:"text-muted-foreground",children:"—"});return a.jsx(N,{className:{positive:"bg-success/10 text-success",neutral:"bg-muted text-muted-foreground",negative:"bg-destructive/10 text-destructive"}[e.sentiment]||"",variant:"outline",children:e.sentiment.charAt(0).toUpperCase()+e.sentiment.slice(1)})},"render"),...le.desktopOnly}),a.jsx(A,{source:"organization_id",reference:"organizations",label:"Organization",link:!1,sortable:!0,...le.alwaysVisible,children:a.jsx(O,{source:"name"})}),a.jsx(A,{source:"opportunity_id",reference:"opportunities",label:"Opportunity",link:!1,sortable:!1,...le.desktopOnly,children:a.jsx(O,{source:"name"})}),a.jsx(A,{source:"created_by",reference:"sales",label:"Created By",link:!1,sortable:!1,...le.desktopOnly,children:a.jsx(F,{})})]})]}),a.jsx(ie,{})]}):a.jsx(y,{resource:"activities",filterComponent:a.jsx(ce,{}),children:a.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[a.jsx("p",{className:"text-muted-foreground",children:"No activities found."}),a.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Activities will appear here as you log interactions with customers."})]})})},"ActivityListLayout"),ve=s(()=>a.jsxs(P,{children:[a.jsx(m,{exporter:ge}),a.jsx("span",{"data-tutorial":"create-activity-btn",children:a.jsx(p,{label:"Log Activity"})})]}),"ActivityListActions"),ge=s(async(e,s)=>{const t=await s(e,"contact_id","contacts"),a=await s(e,"organization_id","organizations"),i=await s(e,"opportunity_id","opportunities"),l=await s(e,"created_by","sales"),n=e.map(e=>{const s=e.contact_id?t[e.contact_id]:null,n=e.organization_id?a[e.organization_id]:null,r=e.opportunity_id?i[e.opportunity_id]:null,c=e.created_by?l[e.created_by]:null;return{id:e.id,activity_type:e.activity_type,type:e.type,subject:e.subject,description:e.description||"",activity_date:e.activity_date,duration_minutes:e.duration_minutes||"",sample_status:e.sample_status||"",sentiment:e.sentiment||"",contact_name:s?`${s.first_name||""} ${s.last_name||""}`.trim():"",organization_name:n?.name||"",opportunity_name:r?.name||"",created_by:c?`${c.first_name||""} ${c.last_name||""}`.trim():"",created_at:e.created_at}});r(n,{headers:["id","activity_type","type","subject","description","activity_date","duration_minutes","sample_status","sentiment","contact_name","organization_name","opportunity_name","created_by","created_at"]},(e,s)=>{if(e)throw new Error(`CSV export failed: ${e.message}`);c(s,"activities")})},"exporter");export{be as default};
