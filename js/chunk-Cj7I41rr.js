var e=Object.defineProperty,s=(s,a)=>e(s,"name",{value:a,configurable:!0});import{j as a,aL as n,bq as t,ay as r,aB as o,bu as l,au as i,aU as c,aW as d,a1 as u,bv as m}from"./chunk-DWisBx5Y.js";import{Z as x,J as h,K as p,M as j,N as g,_ as f,$ as v,g as y,j as N,a0 as w,a1 as C,a2 as k,a3 as b,a4 as S,B as T,z as E,u as D,T as P,G as _,R as A,D as F,a5 as $,a6 as I}from"../assets/index-BMLg8LT4.js";import{r as R}from"./chunk-CPNr-gD1.js";import{g as B,n as L,v as M}from"./chunk-Ifmr_1lo.js";import{d as U,X as z,k as G,a6 as K,a7 as O,a3 as V,a4 as q}from"./chunk-BePsjq0D.js";import{E as H}from"./chunk-DKgfbnVd.js";import{R as J}from"./chunk-D5BivTro.js";import{S as W,A as Z}from"./chunk-C55trUSB.js";import{S as Q}from"./chunk-Caaz7sLq.js";const X=x,Y=s(({color:e,handleClick:s,selected:n})=>{const t=L(e),r=B(e);return a.jsx("button",{type:"button",className:`\n        w-8 h-8 rounded-full inline-block m-1 transition-all\n        ${r}\n        ${n?"ring-2 ring-offset-2 ring-primary shadow-md scale-110":"hover:scale-105 hover:shadow-sm"}\n      `,onClick:s,"aria-label":`Select ${t} color`,"aria-pressed":n})},"RoundButton");function ee({open:e,tag:n,title:t,onClose:r,onSubmit:o}){const[l,i]=R.useState(""),[c,d]=R.useState(X[0]),[u,m]=R.useState(!1),[x,C]=R.useState(),k=s(e=>{i(e.target.value)},"handleNewTagNameChange"),b=s(()=>{m(!1),C(void 0),r()},"handleClose"),S=s(async e=>{e.preventDefault();const s=M(c);s?C(s):(await o({name:l,color:c}),m(!0),i(""),d(X[0]),C(void 0),b())},"handleSubmit");return R.useEffect(()=>{i(n?.name??"");const e=n?.color?L(n.color):X[0];d(e)},[n]),a.jsx(h,{open:e,onOpenChange:b,children:a.jsx(p,{className:"sm:max-w-lg",children:a.jsxs("form",{onSubmit:S,children:[a.jsx(j,{children:a.jsx(g,{children:t})}),a.jsxs("div",{className:"space-y-4 py-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(f,{htmlFor:"tag-name",children:"Tag name"}),a.jsx(v,{id:"tag-name",autoFocus:!0,value:l,onChange:k,placeholder:"Enter tag name"})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(f,{children:"Color"}),a.jsx("div",{className:"flex flex-wrap gap-1",children:X.map(e=>a.jsxs("div",{className:"relative group",children:[a.jsx(Y,{color:e,selected:e===c,handleClick:s(()=>{d(e),C(void 0)},"handleClick")}),a.jsx("span",{className:"absolute -bottom-6 left-1/2 transform -translate-x-1/2 text-xs text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:e})]},e))}),x&&a.jsx("p",{className:"text-sm text-destructive mt-1",children:x})]})]}),a.jsx("div",{className:"flex justify-end pt-4",children:a.jsxs(y,{variant:"outline",disabled:u||!l.trim(),className:N(w({variant:"outline"}),"text-primary",u||!l.trim()?"opacity-50 cursor-not-allowed":"cursor-pointer"),children:[a.jsx(U,{}),"Save"]})})]})})})}function se({tag:e,open:t,onClose:r,onSuccess:o}){const[l]=n(),i=s(async a=>{await l("tags",{id:e.id,data:a,previousData:e},{onSuccess:s(async e=>{await(o?.(e))},"onSuccess")})},"handleEditTag");return a.jsx(ee,{open:t,title:"Edit tag",onClose:r,onSubmit:i,tag:e})}function ae({tag:e,onUnlink:n}){const[t,r]=R.useState(!1),o=s(()=>{r(!1)},"handleClose"),l=s(()=>{r(!0)},"handleClick");return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:N("inline-flex items-center gap-1 px-2 py-1 text-xs rounded-md cursor-pointer","transition-all duration-200","hover:shadow-sm hover:scale-[1.02] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2",B(e.color)),onClick:l,tabIndex:0,role:"button",onKeyDown:s(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),l())},"onKeyDown"),children:[e.name,a.jsx("button",{onClick:s(e=>{e.stopPropagation(),n()},"onClick"),className:"transition-colors p-0 ml-1 cursor-pointer hover:opacity-70","aria-label":`Remove ${e.name} tag`,children:a.jsx(z,{className:"w-3 h-3"})})]}),a.jsx(se,{tag:e,open:t,onClose:o})]})}function ne({open:e,onClose:n,onSuccess:r}){const[o]=t(),l=s(async e=>{await o("tags",{data:e},{onSuccess:s(async e=>{await(r?.(e))},"onSuccess")})},"handleCreateTag");return a.jsx(ee,{open:e,title:"Create a new tag",onClose:n,onSubmit:l})}s(ee,"TagDialog"),s(se,"TagEditModal"),s(ae,"TagChip"),s(ne,"TagCreateModal");const te=s(()=>{const e=r(),[t,i]=R.useState(!1),{data:c,isPending:d}=o("tags",{pagination:{page:1,perPage:10},sort:{field:"name",order:"ASC"}}),{data:u,isPending:m}=l("tags",{ids:e?.tags},{enabled:e&&e.tags&&e.tags.length>0}),[x]=n(),h=c&&e&&c.filter(s=>!e.tags.includes(s.id)),p=s(s=>{if(!e)throw new Error("No contact record found");const a=[...e.tags,s];x("contacts",{id:e.id,data:{tags:a},previousData:e})},"handleTagAdd"),j=s(async s=>{if(!e)throw new Error("No contact record found");const a=e.tags.filter(e=>e!==s);await x("contacts",{id:e.id,data:{tags:a},previousData:e})},"handleTagDelete"),g=s(()=>{i(!0)},"openTagCreateDialog"),f=s(()=>{i(!1)},"handleTagCreateClose"),v=R.useCallback(async a=>{if(!e)throw new Error("No contact record found");await x("contacts",{id:e.id,data:{tags:[...e.tags,a.id]},previousData:e},{onSuccess:s(()=>{i(!1)},"onSuccess")})},[x,e]);return m||d?null:a.jsxs("div",{className:"flex flex-wrap gap-2",children:[u?.map(e=>a.jsx("div",{children:a.jsx(ae,{tag:e,onUnlink:s(()=>j(e.id),"onUnlink")})},e.id)),a.jsx("div",{children:a.jsxs(C,{children:[a.jsx(k,{asChild:!0,children:a.jsxs(y,{variant:"outline",size:"sm",className:"h-6 cursor-pointer",children:[a.jsx(G,{className:"h-3 w-3 mr-1"}),"Add tag"]})}),a.jsxs(b,{children:[h?.map(e=>a.jsx(S,{onClick:s(()=>p(e.id),"onClick"),children:a.jsx(T,{variant:"secondary",className:N("text-xs font-normal",B(e.color)),children:e.name})},e.id)),a.jsx(S,{onClick:g,children:a.jsxs(y,{variant:"ghost",size:"sm",className:"w-full justify-start p-0 cursor-pointer",children:[a.jsx(K,{className:"h-3 w-3 mr-2"}),"Create new tag"]})})]})]})}),a.jsx(ne,{open:t,onClose:f,onSuccess:v})]})},"TagsListEdit"),re=s(e=>{const{children:s,resource:n,perPage:t,sort:r,filter:o}=e,l=i(e),u=R.useMemo(()=>l?Array.isArray(l)?l:"object"==typeof l?[l]:oe:oe,[l,e.source]),m=c({data:u,resource:n,perPage:t,sort:r,filter:o});return a.jsx(d,{value:m,children:s})},"ArrayField"),oe=[],le=s(e=>{const{className:s,empty:n,defaultValue:t,source:r,record:o,...l}=e,c=i({defaultValue:t,source:r,record:o}),d=u();return null==c?n?a.jsx("span",{className:s,...l,children:"string"==typeof n?d(n,{_:n}):n}):null:a.jsx("a",{className:N("underline hover:no-underline",s),href:`mailto:${c}`,onClick:ce,...l,children:c})},"EmailFieldImpl");le.displayName="EmailFieldImpl";const ie=E(le),ce=s(e=>e.stopPropagation(),"stopPropagation"),de=s(({link:e="edit"})=>{const{contactGender:s}=D(),n=r();return n?a.jsxs("div",{className:"hidden sm:block w-64 min-w-64 text-sm",children:[a.jsx("div",{className:"mb-4 -ml-1",children:"edit"===e?a.jsx(H,{label:"Edit Contact"}):a.jsx(W,{label:"Show Contact"})}),a.jsxs(Z,{title:"Personal info",children:[a.jsx(re,{source:"email",children:a.jsx(Q,{className:"flex-col",children:a.jsx(ue,{icon:a.jsx(O,{className:"w-4 h-4 text-muted-foreground"}),primary:a.jsx(ie,{source:"email"})})})}),n.linkedin_url&&a.jsx(ue,{icon:a.jsx(V,{className:"w-4 h-4 text-muted-foreground"}),primary:a.jsx("a",{className:"underline hover:no-underline text-sm text-muted-foreground",href:n.linkedin_url,target:"_blank",rel:"noopener noreferrer",title:n.linkedin_url,children:"LinkedIn"})}),a.jsx(re,{source:"phone",children:a.jsx(Q,{className:"flex-col",children:a.jsx(ue,{icon:a.jsx(q,{className:"w-4 h-4 text-muted-foreground"}),primary:a.jsx(P,{source:"number"}),showType:!0})})}),s.map(e=>n.gender===e.value?a.jsx(ue,{icon:a.jsx(e.icon,{className:"w-4 h-4 text-muted-foreground"}),primary:a.jsx("span",{children:e.label})},e.value):null).filter(Boolean)]}),a.jsxs(Z,{title:"Contact info",children:[a.jsxs("div",{className:"text-muted-foreground",children:[a.jsx("span",{className:"text-sm",children:"Added on"})," ",a.jsx(_,{source:"first_seen",options:{year:"numeric",month:"long",day:"numeric"}})]}),a.jsxs("div",{className:"text-muted-foreground",children:[a.jsx("span",{className:"text-sm",children:"Last activity on"})," ",a.jsx(_,{source:"last_seen",options:{year:"numeric",month:"long",day:"numeric"}})]}),a.jsxs("div",{className:"text-muted-foreground",children:["Followed by"," ",a.jsx(A,{source:"sales_id",reference:"sales",children:a.jsx(F,{})})]})]}),a.jsx(Z,{title:"Tags",children:a.jsx(te,{})}),a.jsxs(Z,{title:"Tasks",children:[a.jsx(J,{target:"contact_id",reference:"tasks",sort:{field:"due_date",order:"ASC"},children:a.jsx($,{})}),a.jsx(I,{})]})]}):null},"ContactAside"),ue=s(({icon:e,primary:n,showType:t})=>a.jsxs("div",{className:"flex flex-row items-center gap-2 min-h-6",children:[e,a.jsxs("div",{className:"flex flex-wrap gap-x-2 gap-y-0",children:[n,t?a.jsx(m,{render:s(e=>"Other"!==e.type&&a.jsx(P,{source:"type",className:"text-muted-foreground"}),"render")}):null]})]}),"PersonalInfoRow");export{de as C};
