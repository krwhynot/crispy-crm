var e=Object.defineProperty,r=(r,s)=>e(r,"name",{value:s,configurable:!0});import{bw as s,bx as a,by as t,bz as n,bA as l,j as o,al as i,bB as c,bC as d,bD as u,bE as m,a1 as p,bF as x,ay as h,bG as b,v as j,aj as f,bd as g}from"./chunk-DWisBx5Y.js";import{r as v}from"./chunk-CPNr-gD1.js";import{u as C,m as y}from"./chunk-DAbVPE3R.js";import{W as w,i as N,a9 as I,j as k,_ as S,aa as O,v as F,J as R,K as A,M as _,N as B,ab as $,ac as E,g as L,ad as P,ae as M,af as V,ag as T}from"../assets/index-BMLg8LT4.js";import{a9 as z,h as W,T as q,aa as D,ab as G,ac as J,v as K}from"./chunk-BePsjq0D.js";const H=v.createContext(void 0),Q=r(e=>{const r=v.useContext(H),s=v.useMemo(()=>({append:e?.append,fields:e?.fields,insert:e?.insert,move:e?.move,prepend:e?.prepend,remove:e?.remove,replace:e?.replace,swap:e?.swap,update:e?.update}),[e]);if(e?.fields)return s;if(!r)throw new Error("useArrayInput must be used inside an ArrayInputContextProvider");return r},"useArrayInput"),U=r(e=>{const{className:p,defaultValue:x=[],label:h,isPending:b,children:j,helperText:f,resource:g,source:R,validate:A,..._}=e,B=s(),$=a(),E=t(),L=E.getSource(R),P=Array.isArray(A)?m(A):A,M=n(),{getValues:V}=C(),T=y({name:L,rules:{validate:r(async r=>{if(!P)return!0;const s=await P(r,V(),e);return!s||M(s)},"validate")}});v.useEffect(()=>($&&null!=B&&$.registerField(L,B),()=>{$&&null!=B&&$.unregisterField(L,B)}),[L,$,B]),l({inputProps:{...e,defaultValue:x},isArrayInput:!0,fieldArrayInputControl:T});const z=v.useMemo(()=>({getSource:r(e=>e?E.getSource(`${R}.${e}`):E.getSource(R),"getSource"),getLabel:r(e=>E.getLabel(`${R}.${e}`),"getLabel")}),[E,R]);return b?o.jsx(w,{className:"w-full h-9"}):o.jsxs(N,{className:k("ra-input",`ra-input-${L}`,p,"w-full flex flex-col gap-2"),name:L,...I(_),children:[o.jsx(S,{className:"text-sm",children:o.jsx(i,{label:h,source:R,resource:g,isRequired:c(A)})}),o.jsx(H.Provider,{value:T,children:o.jsx(d,{value:g,children:o.jsx(u,{value:z,children:j})})}),o.jsx(O,{helperText:f}),o.jsx(F,{})]})},"ArrayInput"),X=v.createContext(void 0),Y=r(()=>{const e=v.useContext(X);if(!e)throw new Error("useSimpleFormIterator must be used inside a SimpleFormIterator");return e},"useSimpleFormIterator"),Z=v.createContext(void 0),ee=r(()=>{const e=v.useContext(Z);if(!e)throw new Error("useSimpleFormIteratorItem must be used inside a SimpleFormIteratorItem");return e},"useSimpleFormIteratorItem"),re=r(e=>{const{className:s,isOpen:a=!1,loading:t,title:n,content:l,cancel:i="ra.action.cancel",confirm:c="ra.action.confirm",confirmColor:d="primary",ConfirmIcon:u=z,CancelIcon:m=W,onClose:x,onConfirm:h,translateOptions:b={},titleTranslateOptions:j=b,contentTranslateOptions:f=b,...g}=e,C=p(),y=v.useCallback(e=>{e.stopPropagation(),h(e)},[h]),w=v.useCallback(e=>{e.stopPropagation()},[]);return o.jsx(R,{open:a,onOpenChange:r(()=>x(),"onOpenChange"),children:o.jsxs(A,{className:s,onClick:w,...g,children:[o.jsxs(_,{children:[o.jsx(B,{children:"string"==typeof n?C(n,{_:n,...j}):n}),"string"==typeof l?o.jsx($,{children:C(l,{_:l,...f})}):l]}),o.jsxs(E,{children:[o.jsxs(L,{variant:"ghost",disabled:t,onClick:x,className:"gap-1",children:[o.jsx(m,{className:"h-5 w-5"}),C(i,{_:i})]}),o.jsxs(L,{disabled:t,onClick:y,className:"gap-1",variant:"warning"===d?"destructive":"default",children:[o.jsx(u,{className:"h-5 w-5"}),C(c,{_:c})]})]})]})})},"Confirm"),se=r(({label:e,onClick:s,children:a,disabled:t,...n})=>{const l=p(),[i,c]=v.useState(!1),d=r(()=>{c(!1)},"handleClose"),u=r(()=>{c(!0)},"handleOpen");let m=e;"string"==typeof e&&(m=l(e,{_:e}));const x=r(e=>{d(),s?.(e)},"handleClick");return o.jsx(P,{children:o.jsxs(M,{open:i,onOpenChange:c,children:[o.jsx(V,{asChild:!0,children:o.jsx(L,{type:"button",variant:"ghost",size:"icon","aria-label":"string"==typeof m?m:void 0,onClick:x,disabled:t,onMouseEnter:u,onMouseLeave:d,...n,children:a})}),o.jsx(T,{children:o.jsx("p",{children:m})})]})})},"IconButtonWithTooltip"),ae=r(e=>{const{addButton:s=ce,removeButton:a,reOrderButtons:t,children:n,className:l,resource:i,disabled:c,disableAdd:d=!1,disableClear:u,disableRemove:m=!1,disableReordering:f,inline:g,getItemLabel:y=!1}=e,w=x("");if(!w)throw new Error("SimpleFormIterator can only be called within an iterator input like ArrayInput");const[N,I]=v.useState(!1),{append:S,fields:O,move:F,remove:R,replace:A}=Q(e),{trigger:_,getValues:B}=C(),$=p(),E=h(e),L=v.useRef({}),P=v.useCallback(e=>{R(e);B(w).every(e=>"object"!=typeof e)&&_(w)},[R,_,w,B]);if(O.length>0){const{id:e,...r}=O[0];L.current=r;for(const s in L.current)L.current[s]=null}const M=v.useCallback((e=void 0)=>{let r=e;null==e&&(r=L.current,1===v.Children.count(n)&&v.isValidElement(v.Children.only(n))&&!v.Children.only(n).props.source&&v.Children.only(n).type!==b?r="":(r=r||{},v.Children.forEach(n,e=>{v.isValidElement(e)&&e.type!==b&&e.props.source&&(r[e.props.source]=e.props.defaultValue??null)}))),S(r)},[S,n]),V=v.useCallback((e,r)=>{F(e,r)},[F]),T=v.useCallback(()=>{A([]),I(!1)},[A]),z=j(E,w),W=v.useMemo(()=>({total:O.length,add:M,remove:P,reOrder:V,source:w}),[M,O.length,V,P,w]);return O?o.jsx(X.Provider,{value:W,children:o.jsxs("div",{className:k("w-full",c&&"disabled",l),children:[o.jsx("ul",{className:"p-0 m-0 flex flex-col gap-2",children:O.map((e,r)=>o.jsx(te,{disabled:c,disableRemove:m,disableReordering:f,fields:O,getItemLabel:y,index:r,onRemoveField:P,onReorder:V,record:z&&z[r]||{},removeButton:a,reOrderButtons:t,resource:i,inline:g,children:n},e.id))}),!c&&!(d&&(u||m))&&o.jsxs("div",{className:"flex flex-row items-center gap-2",children:[!d&&s,O.length>0&&!u&&!m&&o.jsxs(o.Fragment,{children:[o.jsx(re,{isOpen:N,title:$("ra.action.clear_array_input"),content:$("ra.message.clear_array_input"),onConfirm:T,onClose:r(()=>I(!1),"onClose")}),o.jsx(oe,{onClick:r(()=>I(!0),"onClick")})]})]})]})}):null},"SimpleFormIterator"),te=v.forwardRef((e,s)=>{const{children:a,disabled:n,disableReordering:l,disableRemove:i,getItemLabel:c,index:d,inline:m,record:p,removeButton:x=de,reOrderButtons:h=ue}=e;if(!f(e))throw new Error("SimpleFormIteratorItem must be used in a ResourceContextProvider or be passed a resource prop.");const{total:b,reOrder:j,remove:C}=Y(),y=r(e=>"boolean"==typeof i?i:i&&i(e),"disableRemoveField"),w=v.useMemo(()=>({index:d,total:b,reOrder:r(e=>j(d,e),"reOrder"),remove:r(()=>C(d),"remove")}),[d,b,j,C]),N="function"==typeof c?c(d):c,I=t(),S=v.useMemo(()=>({getSource:r(e=>e?I.getSource(`${d}.${e}`):I.getSource(`${d}`),"getSource"),getLabel:r(e=>I.getLabel(e),"getLabel")}),[d,I]);return o.jsx(Z.Provider,{value:w,children:o.jsxs("li",{ref:s,className:k("flex flex-row items-start justify-between gap-3 pb-2 border-b border-border last:border-b-0","[&:has(label)>.simple-form-iterator-item-actions]:pt-10"),children:[null!=N&&!1!==N&&o.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:N}),o.jsx(u,{value:S,children:o.jsx(g,{value:p,children:o.jsx("div",{className:k("flex flex-1 gap-2",m?"flex-col sm:flex-row gap-2":"flex-col"),children:a})})}),!n&&o.jsxs("div",{className:"simple-form-iterator-item-actions flex flex-row h-9 items-center gap-1",children:[!l&&h,!y(p)&&x]})]})})}),ne=r(e=>{const{add:s,source:a}=Y(),{className:t,...n}=e,l=p();return o.jsx(P,{children:o.jsxs(M,{children:[o.jsx(V,{asChild:!0,children:o.jsx(L,{type:"button",variant:"ghost",size:"icon",onClick:r(()=>s(),"onClick"),className:k("button-add",`button-add-${a}`,t),...n,children:o.jsx(D,{className:"h-5 w-5"})})}),o.jsx(T,{children:l("ra.action.add")})]})})},"AddItemButton"),le=r(({className:e})=>{const{index:s,total:a,reOrder:t}=ee(),{source:n}=Y();return o.jsxs("span",{className:k("button-reorder",`button-reorder-${n}-${s}`,e),children:[o.jsx(se,{label:"ra.action.move_up",onClick:r(()=>t(s-1),"onClick"),disabled:s<=0,children:o.jsx(G,{className:"h-4 w-4"})}),o.jsx(se,{label:"ra.action.move_down",onClick:r(()=>t(s+1),"onClick"),disabled:null==a||s>=a-1,children:o.jsx(J,{className:"h-4 w-4"})})]})},"ReOrderButtons"),oe=r(e=>{const r=p();return o.jsx(P,{children:o.jsxs(M,{children:[o.jsx(V,{asChild:!0,children:o.jsx(L,{type:"button",variant:"ghost",size:"icon",...e,children:o.jsx(q,{className:"h-5 w-5 text-red-500"})})}),o.jsx(T,{children:r("ra.action.clear_array_input")})]})})},"ClearArrayButton"),ie=r(e=>{const{remove:s,index:a}=ee(),{source:t}=Y(),{className:n,...l}=e,i=p();return o.jsx(P,{children:o.jsxs(M,{children:[o.jsx(V,{asChild:!0,children:o.jsx(L,{type:"button",variant:"ghost",size:"icon",onClick:r(()=>s(),"onClick"),className:k("button-remove",`button-remove-${t}-${a}`,n),...l,children:o.jsx(K,{className:"h-5 w-5 text-red-500"})})}),o.jsx(T,{children:i("ra.action.remove")})]})})},"RemoveItemButton"),ce=o.jsx(ne,{}),de=o.jsx(ie,{}),ue=o.jsx(le,{});export{U as A,ae as S};
