{"version":3,"file":"ContactCreate-CDDgkpA4.js","sources":["../../src/atomic-crm/contacts/ContactFormTutorial.tsx","../../src/atomic-crm/contacts/ContactCreate.tsx"],"sourcesContent":["import { useRef, useCallback } from \"react\";\nimport { driver, type DriveStep } from \"driver.js\";\nimport \"driver.js/dist/driver.css\";\nimport { HelpCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\n\n/**\n * Tutorial steps for the Contact Create form.\n * Highlights required fields and guides users through form completion.\n */\nconst FORM_TUTORIAL_STEPS: DriveStep[] = [\n  {\n    popover: {\n      title: \"üìù Create a Contact\",\n      description: \"Let's walk through adding a new contact. Fields marked with * are required.\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"contact-first-name\"]',\n    popover: {\n      title: \"First Name *\",\n      description: \"Enter the contact's first name. This field is required for all contacts.\",\n      side: \"right\",\n      align: \"start\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"contact-last-name\"]',\n    popover: {\n      title: \"Last Name *\",\n      description:\n        \"Enter the contact's last name. Together with first name, this identifies the person.\",\n      side: \"right\",\n      align: \"start\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"contact-organization\"]',\n    popover: {\n      title: \"Organization *\",\n      description:\n        \"Select which organization this contact belongs to. Start typing to search existing organizations.\",\n      side: \"right\",\n      align: \"start\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"contact-account-manager\"]',\n    popover: {\n      title: \"Account Manager *\",\n      description:\n        \"Choose who will own this contact. This determines who sees it in their pipeline.\",\n      side: \"right\",\n      align: \"start\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"contact-email\"]',\n    popover: {\n      title: \"Email Address *\",\n      description:\n        \"Add at least one email address. You can add multiple with different types (Work, Home, Other). Pro tip: paste an email to auto-fill names!\",\n      side: \"right\",\n      align: \"start\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"contact-phone\"]',\n    popover: {\n      title: \"Phone Numbers\",\n      description:\n        \"Optional: Add phone numbers with different types. You can add multiple phone numbers.\",\n      side: \"right\",\n      align: \"start\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"contact-save-btn\"]',\n    popover: {\n      title: \"Save Your Contact\",\n      description:\n        'Click \"Save & Close\" to create the contact, or \"Save & Add Another\" to continue adding more contacts.',\n      side: \"top\",\n      align: \"end\",\n    },\n  },\n  {\n    popover: {\n      title: \"‚úÖ Ready to Go!\",\n      description:\n        \"You now know how to create a contact. Fill in the required fields and click Save when you're ready.\",\n    },\n  },\n];\n\n/**\n * Standalone tutorial component for the Contact Create form.\n * Displays a floating help button that triggers a Driver.js tutorial\n * walking users through all form fields.\n *\n * Only renders on the /contacts/create page (where ContactCreate mounts this).\n */\nexport function ContactFormTutorial() {\n  const driverRef = useRef<ReturnType<typeof driver> | null>(null);\n\n  const startTutorial = useCallback(() => {\n    // Clean up any existing instance\n    if (driverRef.current) {\n      driverRef.current.destroy();\n    }\n\n    // Create new Driver.js instance\n    driverRef.current = driver({\n      showProgress: true,\n      animate: true,\n      smoothScroll: true,\n      overlayOpacity: 0.75,\n      popoverClass: \"tutorial-popover\",\n      nextBtnText: \"Next ‚Üí\",\n      prevBtnText: \"‚Üê Back\",\n      doneBtnText: \"Done ‚úì\",\n      steps: FORM_TUTORIAL_STEPS,\n      onDestroyStarted: () => {\n        // Cleanup on close\n        driverRef.current?.destroy();\n        driverRef.current = null;\n      },\n    });\n\n    driverRef.current.drive();\n  }, []);\n\n  return (\n    <div className=\"fixed bottom-4 left-4 z-50\">\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <Button\n            variant=\"default\"\n            size=\"icon\"\n            onClick={startTutorial}\n            className=\"h-11 w-11 rounded-full shadow-lg bg-primary text-primary-foreground hover:scale-105 transition-transform\"\n            aria-label=\"Start contact form tutorial\"\n          >\n            <HelpCircle className=\"h-5 w-5\" />\n          </Button>\n        </TooltipTrigger>\n        <TooltipContent side=\"right\">\n          <p>Learn how to add a contact</p>\n        </TooltipContent>\n      </Tooltip>\n    </div>\n  );\n}\n","import { CreateBase, Form, useNotify, useRedirect } from \"ra-core\";\nimport { useFormContext, useFormState } from \"react-hook-form\";\nimport { useCallback } from \"react\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { SaveButton, FormLoadingSkeleton } from \"@/components/admin/form\";\nimport { useSmartDefaults } from \"@/atomic-crm/hooks/useSmartDefaults\";\nimport type { Contact } from \"../types\";\nimport { ContactInputs } from \"./ContactInputs\";\nimport { contactBaseSchema } from \"../validation/contacts\";\nimport { ContactFormTutorial } from \"./ContactFormTutorial\";\n\nconst ContactCreate = () => {\n  const notify = useNotify();\n  const redirect = useRedirect();\n  const { defaults, isLoading } = useSmartDefaults();\n\n  const transformData = (data: Contact) => ({\n    ...data,\n    first_seen: new Date().toISOString(),\n    last_seen: new Date().toISOString(),\n    tags: [],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"bg-muted px-6 py-6\">\n        <div className=\"max-w-4xl mx-auto\">\n          <FormLoadingSkeleton rows={4} />\n        </div>\n      </div>\n    );\n  }\n\n  // Generate defaults from schema truth\n  // Per Constitution #5: FORM STATE DERIVED FROM TRUTH\n  // contactBaseSchema is a ZodObject (not ZodEffects), so .partial().parse({}) works\n  // Note: Only spread sales_id from defaults - contacts don't have activity_date\n  const formDefaults = {\n    ...contactBaseSchema.partial().parse({}),\n    sales_id: defaults.sales_id,\n  };\n\n  return (\n    <CreateBase redirect=\"list\" transform={transformData}>\n      <div className=\"bg-muted px-6 py-6\">\n        <div className=\"max-w-4xl mx-auto create-form-card\">\n          <Form defaultValues={formDefaults}>\n            <ContactFormContent notify={notify} redirect={redirect} />\n          </Form>\n        </div>\n      </div>\n      <ContactFormTutorial />\n    </CreateBase>\n  );\n};\n\nconst ContactFormContent = ({\n  notify,\n  redirect,\n}: {\n  notify: ReturnType<typeof useNotify>;\n  redirect: ReturnType<typeof useRedirect>;\n}) => {\n  return (\n    <>\n      <ContactInputs />\n      <ContactCreateFooter notify={notify} redirect={redirect} />\n    </>\n  );\n};\n\nconst ContactCreateFooter = ({\n  notify,\n  redirect,\n}: {\n  notify: ReturnType<typeof useNotify>;\n  redirect: ReturnType<typeof useRedirect>;\n}) => {\n  const { reset } = useFormContext();\n  const { isDirty } = useFormState();\n\n  const handleCancel = useCallback(() => {\n    if (isDirty) {\n      const confirmed = window.confirm(\"You have unsaved changes. Are you sure you want to leave?\");\n      if (!confirmed) return;\n    }\n    redirect(\"/contacts\");\n  }, [isDirty, redirect]);\n\n  const handleError = useCallback(\n    (error: Error) => {\n      notify(error.message || \"Failed to create contact\", { type: \"error\" });\n    },\n    [notify]\n  );\n\n  return (\n    <div className=\"sticky bottom-12 bg-card border-t border-border p-4 flex justify-between mt-6\">\n      <Button variant=\"outline\" onClick={handleCancel}>\n        Cancel\n      </Button>\n      <div className=\"flex gap-2\">\n        <SaveButton\n          type=\"button\"\n          label=\"Save & Close\"\n          data-tutorial=\"contact-save-btn\"\n          mutationOptions={{\n            onSuccess: () => {\n              notify(\"Contact created successfully\", { type: \"success\" });\n              redirect(\"/contacts\");\n            },\n            onError: handleError,\n          }}\n        />\n        <SaveButton\n          type=\"button\"\n          label=\"Save & Add Another\"\n          mutationOptions={{\n            onSuccess: () => {\n              notify(\"Contact created successfully\", { type: \"success\" });\n              reset();\n            },\n            onError: handleError,\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default ContactCreate;\n"],"names":["FORM_TUTORIAL_STEPS","popover","title","description","element","side","align","ContactFormTutorial","driverRef","useRef","startTutorial","useCallback","current","destroy","driver","showProgress","animate","smoothScroll","overlayOpacity","popoverClass","nextBtnText","prevBtnText","doneBtnText","steps","onDestroyStarted","__name","drive","jsx","className","children","Tooltip","TooltipTrigger","asChild","Button","variant","size","onClick","HelpCircle","TooltipContent","ContactCreate","notify","useNotify","redirect","useRedirect","defaults","isLoading","useSmartDefaults","transformData","data","first_seen","Date","toISOString","last_seen","tags","FormLoadingSkeleton","rows","formDefaults","contactBaseSchema","partial","parse","sales_id","jsxs","CreateBase","transform","Form","defaultValues","ContactFormContent","Fragment","ContactInputs","ContactCreateFooter","reset","useFormContext","isDirty","useFormState","handleCancel","window","confirm","handleError","error","message","type","SaveButton","label","mutationOptions","onSuccess","onError"],"mappings":"k2BAWA,MAAMA,EAAmC,CACvC,CACEC,QAAS,CACPC,MAAO,sBACPC,YAAa,gFAGjB,CACEC,QAAS,uCACTH,QAAS,CACPC,MAAO,eACPC,YAAa,2EACbE,KAAM,QACNC,MAAO,UAGX,CACEF,QAAS,sCACTH,QAAS,CACPC,MAAO,cACPC,YACE,uFACFE,KAAM,QACNC,MAAO,UAGX,CACEF,QAAS,yCACTH,QAAS,CACPC,MAAO,iBACPC,YACE,oGACFE,KAAM,QACNC,MAAO,UAGX,CACEF,QAAS,4CACTH,QAAS,CACPC,MAAO,oBACPC,YACE,mFACFE,KAAM,QACNC,MAAO,UAGX,CACEF,QAAS,kCACTH,QAAS,CACPC,MAAO,kBACPC,YACE,6IACFE,KAAM,QACNC,MAAO,UAGX,CACEF,QAAS,kCACTH,QAAS,CACPC,MAAO,gBACPC,YACE,wFACFE,KAAM,QACNC,MAAO,UAGX,CACEF,QAAS,qCACTH,QAAS,CACPC,MAAO,oBACPC,YACE,wGACFE,KAAM,MACNC,MAAO,QAGX,CACEL,QAAS,CACPC,MAAO,iBACPC,YACE,yGAYD,SAASI,IACd,MAAMC,EAAYC,EAAAA,OAAyC,MAErDC,EAAgBC,EAAAA,YAAY,KAE5BH,EAAUI,SACZJ,EAAUI,QAAQC,UAIpBL,EAAUI,QAAUE,EAAO,CACzBC,cAAc,EACdC,SAAS,EACTC,cAAc,EACdC,eAAgB,IAChBC,aAAc,mBACdC,YAAa,SACbC,YAAa,SACbC,YAAa,SACbC,MAAOvB,EACPwB,iBAAkBC,EAAA,KAEhBjB,EAAUI,SAASC,UACnBL,EAAUI,QAAU,MAHJ,sBAOpBJ,EAAUI,QAAQc,SACjB,IAEH,OACEC,EAAAA,IAAC,MAAA,CAAIC,UAAU,6BACbC,gBAACC,EAAA,CACCD,SAAA,GAAAF,IAACI,EAAA,CAAeC,SAAO,EACrBH,SAAAF,EAAAA,IAACM,EAAA,CACCC,QAAQ,UACRC,KAAK,OACLC,QAAS1B,EACTkB,UAAU,2GACV,aAAW,8BAEXC,SAAAF,EAAAA,IAACU,EAAA,CAAWT,UAAU,sBAGzBU,EAAA,CAAejC,KAAK,QACnBwB,SAAAF,EAAAA,IAAC,IAAA,CAAEE,8CAKb,CAlDgBJ,EAAAlB,EAAA,uBC3FhB,MAAMgC,EAAgBd,EAAA,KACpB,MAAMe,EAASC,IACTC,EAAWC,KACXC,SAAEA,EAAAC,UAAUA,GAAcC,IAE1BC,IAAiBC,IAAA,IAClBA,EACHC,YAAA,IAAgBC,MAAOC,cACvBC,WAAA,IAAeF,MAAOC,cACtBE,KAAM,KAJc,iBAOtB,GAAIR,EACF,OACElB,EAAAA,IAAC,MAAA,CAAIC,UAAU,qBACbC,SAAAF,EAAAA,IAAC,MAAA,CAAIC,UAAU,oBACbC,SAAAF,EAAAA,IAAC2B,EAAA,CAAoBC,KAAM,QAUnC,MAAMC,EAAe,IAChBC,EAAkBC,UAAUC,MAAM,CAAA,GACrCC,SAAUhB,EAASgB,UAGrB,OACEC,EAAAA,KAACC,EAAA,CAAWpB,SAAS,OAAOqB,UAAWhB,EACrClB,SAAA,CAAAF,EAAAA,IAAC,OAAIC,UAAU,qBACbC,SAAAF,MAAC,MAAA,CAAIC,UAAU,qCACbC,SAAAF,EAAAA,IAACqC,EAAA,CAAKC,cAAeT,EACnB3B,SAAAF,EAAAA,IAACuC,EAAA,CAAmB1B,SAAgBE,yBAIzCnC,EAAA,CAAA,OAxCe,iBA6ChB2D,EAAqBzC,EAAA,EACzBe,SACAE,cAMEmB,EAAAA,KAAAM,WAAA,CACEtC,SAAA,CAAAF,EAAAA,IAACyC,EAAA,MACDzC,IAAC0C,EAAA,CAAoB7B,SAAgBE,gBAVhB,sBAerB2B,EAAsB5C,EAAA,EAC1Be,SACAE,eAKA,MAAM4B,MAAEA,GAAUC,KACZC,QAAEA,GAAYC,IAEdC,EAAe/D,EAAAA,YAAY,KAC/B,GAAI6D,EAAS,CAEX,IADkBG,OAAOC,QAAQ,6DACjB,MAClB,CACAlC,EAAS,cACR,CAAC8B,EAAS9B,IAEPmC,EAAclE,EAAAA,YACjBmE,IACCtC,EAAOsC,EAAMC,SAAW,2BAA4B,CAAEC,KAAM,WAE9D,CAACxC,IAGH,SACEqB,KAAC,MAAA,CAAIjC,UAAU,gFACbC,SAAA,CAAAF,MAACM,EAAA,CAAOC,QAAQ,UAAUE,QAASsC,EAAc7C,SAAA,aAGjDgC,KAAC,MAAA,CAAIjC,UAAU,aACbC,SAAA,CAAAF,EAAAA,IAACsD,EAAA,CACCD,KAAK,SACLE,MAAM,eACN,gBAAc,mBACdC,gBAAiB,CACfC,UAAW3D,EAAA,KACTe,EAAO,+BAAgC,CAAEwC,KAAM,YAC/CtC,EAAS,cAFA,aAIX2C,QAASR,KAGblD,EAAAA,IAACsD,EAAA,CACCD,KAAK,SACLE,MAAM,qBACNC,gBAAiB,CACfC,UAAW3D,EAAA,KACTe,EAAO,+BAAgC,CAAEwC,KAAM,YAC/CV,KAFS,aAIXe,QAASR,YAnDO"}