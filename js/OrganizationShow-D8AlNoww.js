var e=Object.defineProperty,s=(s,t)=>e(s,"name",{value:t,configurable:!0});import{j as t,$ as a,P as r,a1 as i,ao as n,ak as o,U as c,ap as l,aq as d,aj as x}from"./chunk-ByJg_QQB.js";import{r as m,L as u,e as h,s as j,d as p}from"./chunk-1NZFT-6z.js";import{o as f,r as g,S as v,A as N,d as y,s as w,u as b,B as _,Q as k,C as z,a as C}from"../assets/index-BoLku8RR.js";import{T as A,a as S,b as O,c as L}from"./chunk-B5Y5c6gs.js";import{R as P}from"./chunk-Sp4WOLwD.js";import{S as $}from"./chunk-DDhuYt5_.js";import{R as I}from"./chunk-CFwunwMO.js";import{A as F}from"./chunk-IswQf-N3.js";import{S as R}from"./chunk-B1s-jt27.js";import{R as q}from"./chunk-DbeoRBEW.js";import{O as B,R as D}from"./chunk-sKlZvX2D.js";import"./chunk-CRKBdUTG.js";import{S as T}from"./chunk-j7Lqvg-1.js";import{A as V}from"./chunk-B9H_70fs.js";import{S as E,g as Q}from"./chunk-B_VTrDwS.js";import{g as U}from"./chunk-CFj7NhUg.js";import{O as K}from"./chunk-RY-5-xkE.js";import{A as X,a as G}from"./chunk-B8iwsXIk.js";import{a5 as H,Q as J,a6 as M}from"./chunk-Bc6KM1xM.js";import{A as W}from"./chunk-sbYpr125.js";import{b as Y}from"./chunk-DwAffUXc.js";import"./chunk-JxeXaC9i.js";import"./chunk-knA4lag3.js";import"./chunk-Tyyhsnez.js";import"./chunk-XoqkUGE_.js";import"./chunk-DfGVVS-c.js";import"./chunk-BI4rbfTW.js";import"./chunk-DkiUngdk.js";import"./chunk-BY7AmvEs.js";import"./chunk-B0BZInrb.js";import"./chunk-D62ZQQIe.js";import"./chunk-DsNwAyt-.js";const Z=m.createContext("all"),ee=s(()=>m.useContext(Z),"useActivityLogContext");function se({activity:e}){const s=ee(),{organization:a}=e;return t.jsx("div",{className:"p-0",children:t.jsxs("div",{className:"flex flex-row space-x-1 items-center w-full",children:[t.jsx(B,{width:20,height:20,record:a}),t.jsxs("div",{className:"text-sm text-muted-foreground flex-grow",children:[t.jsx(q,{source:"sales_id",reference:"sales",record:e,children:t.jsx(T,{})})," ","added organization"," ",t.jsx(u,{to:`/organizations/${a.id}/show`,children:a.name}),"all"===s&&t.jsx(t.Fragment,{children:t.jsx(D,{date:e.date})})]}),"organization"===s&&t.jsx("span",{className:"text-muted-foreground text-sm",children:t.jsx(D,{date:e.date})})]})})}function te({activity:e}){const s=ee(),{contact:a}=e;return t.jsx("div",{className:"p-0",children:t.jsxs("div",{className:"flex flex-row gap-2 items-center w-full",children:[t.jsx(V,{width:20,height:20,record:a}),t.jsxs("span",{className:"text-muted-foreground text-sm flex-grow",children:[t.jsx(q,{source:"sales_id",reference:"sales",record:e,children:t.jsx(T,{})})," ","added"," ",t.jsx(u,{to:`/contacts/${a.id}/show`,children:f(a.first_name,a.last_name)})," ","company"!==s&&t.jsxs(t.Fragment,{children:["to organization ",e.customer_organization_id]})]}),"company"===s&&t.jsx("span",{className:"text-muted-foreground text-sm",children:t.jsx(D,{date:e.date})})]})})}function ae({header:e,text:s}){if(!s)return null;const a=s.split("\n");return t.jsx("div",{className:"p-0",children:t.jsxs("div",{className:"flex flex-col space-y-2 w-full",children:[t.jsx("div",{className:"flex flex-row space-x-1 items-center w-full",children:e}),t.jsx("div",{children:t.jsx("div",{className:"text-sm line-clamp-3 overflow-hidden",children:a.map((e,s)=>t.jsxs(m.Fragment,{children:[e,s<a.length-1&&t.jsx("br",{})]},s))})})]})})}function re(){const e=a();return t.jsx(V,{width:20,height:20,record:e})}function ie({activity:e}){const s=ee(),{contactNote:a}=e;return t.jsx(ae,{header:t.jsxs("div",{className:"flex items-center gap-2 w-full",children:[t.jsx(q,{source:"contact_id",reference:"contacts",record:e.contactNote,children:t.jsx(re,{})}),t.jsxs("div",{className:"flex flex-row flex-grow",children:[t.jsxs("div",{className:"text-sm text-muted-foreground flex-grow",children:[t.jsx(q,{source:"sales_id",reference:"sales",record:e,children:t.jsx(T,{})})," ","added a note about"," ",t.jsxs(q,{source:"contact_id",reference:"contacts",record:e.contactNote,children:[t.jsx(g,{source:"first_name"})," ",t.jsx(g,{source:"last_name"})]})]}),"company"===s&&t.jsx("span",{className:"text-muted-foreground text-sm",children:t.jsx(D,{date:e.date})})]})]}),text:a.text})}function ne({activity:e}){const s=ee(),{opportunity:a}=e;return t.jsx("div",{className:"p-0",children:t.jsxs("div",{className:"flex flex-row space-x-1 items-center w-full",children:[t.jsx("div",{className:"w-5 h-5 bg-loading-pulse rounded-full"}),t.jsxs("div",{className:"text-sm text-muted-foreground flex-grow",children:[t.jsxs("span",{className:"text-muted-foreground text-sm",children:["Sales ID: ",e.sales_id]})," added opportunity ",t.jsx(u,{to:`/opportunities/${a.id}/show`,children:a.name})," ","company"!==s&&t.jsxs(t.Fragment,{children:["to organization ",e.customer_organization_id," ",t.jsx(D,{date:e.date})]})]}),"company"===s&&t.jsx("span",{className:"text-muted-foreground text-sm",children:t.jsx(D,{date:e.date})})]})})}function oe({activity:e}){const s=ee(),{opportunityNote:a}=e;return t.jsx(ae,{header:t.jsxs("div",{className:"flex flex-row items-center gap-2 flex-grow",children:[t.jsx(q,{source:"opportunity_id",reference:"opportunities",record:a,link:!1,children:t.jsx(q,{source:"customer_organization_id",reference:"organizations",link:!1,children:t.jsx(B,{width:20,height:20})})}),t.jsxs("span",{className:"text-sm text-muted-foreground flex-grow",children:[t.jsx(q,{source:"sales_id",reference:"sales",record:e,link:!1,children:t.jsx(T,{})})," ","added a note about opportunity"," ",t.jsx(q,{source:"opportunity_id",reference:"opportunities",record:a,link:"show"}),"company"!==s&&t.jsxs(t.Fragment,{children:[" at ",t.jsx(q,{source:"opportunity_id",reference:"opportunities",record:a,link:!1,children:t.jsx(q,{source:"customer_organization_id",reference:"organizations",link:"show"})})," "]})]}),"company"===s&&t.jsx("span",{className:"text-muted-foreground text-sm",children:t.jsx(D,{date:e.date})})]}),text:a.text})}function ce({activities:e,pageSize:a}){const[r,i]=m.useState(a),n=e.slice(0,r);return t.jsxs("div",{className:"space-y-4",children:[n.map((e,s)=>t.jsxs(m.Fragment,{children:[t.jsx(le,{activity:e},e.id),t.jsx(R,{})]},s)),r<e.length&&t.jsx("button",{type:"button",onClick:s(()=>{i(e=>e+a)},"onClick"),className:"flex w-full justify-center text-sm underline hover:no-underline",children:"Load more activity"})]})}function le({activity:e}){return"organization.created"===e.type?t.jsx(se,{activity:e}):"contact.created"===e.type?t.jsx(te,{activity:e}):"contactNote.created"===e.type?t.jsx(ie,{activity:e}):"opportunity.created"===e.type?t.jsx(ne,{activity:e}):"opportunityNote.created"===e.type?t.jsx(oe,{activity:e}):null}function de({organizationId:e,pageSize:a=20,context:n="all"}){const o=r(),c=new N(o),{data:l,isPending:d,error:x}=i({queryKey:["activityLog",e],queryFn:s(()=>c.getActivityLog(e),"queryFn")});return d?t.jsx("div",{className:"mt-1",children:Array.from({length:5}).map((e,s)=>t.jsxs("div",{className:"space-y-2 mt-1",children:[t.jsxs("div",{className:"flex flex-row space-x-2 items-center",children:[t.jsx(v,{className:"w-5 h-5 rounded-full"}),t.jsx(v,{className:"w-full h-4"})]}),t.jsx(v,{className:"w-full h-12"}),t.jsx(R,{})]},s))}):x?t.jsx(F,{children:"Failed to load activity log"}):t.jsx("div",{"data-testid":"activity-log",children:t.jsx(Z.Provider,{value:n,children:t.jsx(ce,{activities:l,pageSize:a})})})}s(se,"ActivityLogOrganizationCreated"),s(te,"ActivityLogContactCreated"),s(ae,"ActivityLogNote"),s(re,"ContactAvatar"),s(ie,"ActivityLogContactNoteCreated"),s(ne,"ActivityLogOpportunityCreated"),s(oe,"ActivityLogOpportunityNoteCreated"),s(ce,"ActivityLogIterator"),s(le,"ActivityItem"),s(de,"ActivityLog");const xe=s(e=>{const{filter:s,page:a=1,perPage:r,reference:i,resource:o,sort:c,source:l,queryOptions:d,render:x,label:m,sortable:u,sortBy:h,textAlign:j,rowClassName:p,cellClassName:f,headerClassName:g,...v}=e;return t.jsx(n,{filter:s,page:a,perPage:r,reference:i,resource:o,sort:c,source:l,queryOptions:d,render:x,children:t.jsx(he,{...v})})},"ReferenceArrayField"),me=s(e=>{const{children:s=ue,className:a,empty:r,error:i,loading:n,pagination:c}=e,{isPending:l,error:d,total:x,hasPreviousPage:m,hasNextPage:u,data:h,filterValues:j}=o();return t.jsx("div",{className:a,children:l&&!1!==n?n:d&&!1!==i?i:0!==x&&(null!=x||!1!==m||!1!==u||0!==h.length||Object.keys(j).length)||!1===r?t.jsxs("span",{children:[s,c&&void 0!==x?c:null]}):r})},"ReferenceArrayFieldView"),ue=t.jsx(E,{}),he=m.memo(me),je=s(e=>{const s=a();if(!s)return null;const{source:r,label:i,sortable:n,sortBy:o,textAlign:c,rowClassName:l,cellClassName:d,headerClassName:x,resource:m,...u}=e;return t.jsx(y,{...u,variant:"outline",className:w("font-normal border-0",Q(s.color),e.className),children:s.name})},"ColoredBadge"),pe=s(()=>t.jsx(xe,{className:"inline-block",resource:"contacts",source:"tags",reference:"tags",children:t.jsx(E,{children:t.jsx(je,{source:"name"})})}),"TagsList"),fe=s((e,s)=>U(s),"findOpportunityLabel");function ge(e){return{cold:"bg-info-default",warm:"bg-warning-default",hot:"bg-error-default","in-contract":"bg-success-default"}[e]||"bg-muted"}s(ge,"getStatusBackgroundClass");const ve=s(({status:e,className:s})=>{const{noteStatuses:a}=b();if(!e||!a)return null;const r=a.find(s=>s.value===e);return r?t.jsxs("div",{className:w("group relative inline-block mr-2",s),children:[t.jsx("span",{className:w("inline-block w-2.5 h-2.5 rounded-full",ge(e))}),t.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 text-xs bg-popover text-popover-foreground border border-border rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none whitespace-nowrap z-10 shadow-sm",children:r.label})]}):null},"Status"),Ne=s(({organizationId:e})=>{const[a,r]=m.useState(!1),{data:i,isPending:n,error:o,refetch:l}=c("activities",{filter:{organization_id:e},sort:{field:"created_at",order:"DESC"},pagination:{page:1,perPage:X}}),d="string"==typeof e?parseInt(e,10):e;if(n)return t.jsx("div",{className:"space-y-4",children:[1,2,3].map(e=>t.jsxs("div",{className:"p-4 border border-border rounded-lg",children:[t.jsx(v,{className:"h-4 w-32 mb-2"}),t.jsx(v,{className:"h-3 w-full mb-1"}),t.jsx(v,{className:"h-3 w-3/4"})]},e))});if(o)return t.jsx("div",{className:"text-center py-8 text-destructive",children:"Failed to load activities"});const x=i||[];return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex justify-end",children:t.jsxs(_,{variant:"outline",className:"h-11 gap-2",onClick:s(()=>r(!0),"onClick"),children:[t.jsx(H,{className:"h-4 w-4"}),"Log Activity"]})}),0===x.length?t.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No activities recorded yet"}):t.jsx("div",{className:"space-y-3",children:x.map(e=>t.jsx(G,{activity:e},e.id))}),t.jsx(k,{open:a,onOpenChange:r,entityContext:{organizationId:d},config:{enableDraftPersistence:!1,showSaveAndNew:!1},onSuccess:s(()=>{l()},"onSuccess")})]})},"ActivitiesTab"),ye=s(()=>t.jsx(l,{children:t.jsx(we,{})}),"OrganizationShow"),we=s(()=>{const{record:e,isPending:a}=d(),r=h(),i=j("/organizations/:id/show/:tab"),n=i?.params?.tab||"activity",o=s(s=>{s!==n&&r("activity"!==s?`/organizations/${e?.id}/show/${s}`:`/organizations/${e?.id}/show`)},"handleTabChange");if(a||!e)return null;const c="distributor"===e.organization_type,l=c?"grid-cols-5":"grid-cols-4";return t.jsxs(I,{variant:"dashboard",className:"mt-2 mb-2",children:[t.jsx("main",{role:"main","aria-label":"Organization details",children:t.jsx(z,{children:t.jsxs(C,{className:"p-6",children:[t.jsxs("div",{className:"flex mb-3",children:[t.jsx(B,{}),t.jsx("h2",{className:"text-xl ml-2 flex-1",children:e.name})]}),t.jsxs(A,{defaultValue:n,onValueChange:o,children:[t.jsxs(S,{className:`grid w-full ${l}`,children:[t.jsx(O,{value:"activity",children:"Activity"}),t.jsx(O,{value:"contacts",children:e.nb_contacts?1===e.nb_contacts?"1 Contact":`${e.nb_contacts} Contacts`:"No Contacts"}),t.jsx(O,{value:"opportunities",children:e.nb_opportunities?1===e.nb_opportunities?"1 opportunity":`${e.nb_opportunities} opportunities`:"No Opportunities"}),t.jsx(O,{value:"activities",children:"Activities"}),c&&t.jsx(O,{value:"authorizations",children:"Authorizations"})]}),t.jsx(L,{value:"activity",className:"pt-2",children:t.jsx(de,{organizationId:e.id,context:"organization"})}),t.jsx(L,{value:"activities",className:"pt-2",children:t.jsx(Ne,{organizationId:e.id})}),t.jsx(L,{value:"contacts",children:e.nb_contacts?t.jsx(P,{reference:"contacts_summary",target:"organization_id",sort:{field:"last_name",order:"ASC"},children:t.jsxs("div",{className:"flex flex-col gap-4",children:[t.jsxs("div",{className:"flex flex-row justify-end space-x-2 mt-1",children:[!!e.nb_contacts&&t.jsx($,{fields:["last_name","first_name","last_seen"]}),t.jsx(_e,{})]}),t.jsx(be,{})]})}):t.jsx("div",{className:"flex flex-col gap-4",children:t.jsx("div",{className:"flex flex-row justify-end space-x-2 mt-1",children:t.jsx(_e,{})})})}),t.jsx(L,{value:"opportunities",children:e.nb_opportunities?t.jsx(P,{reference:"opportunities",target:"customer_organization_id",sort:{field:"name",order:"ASC"},children:t.jsx(ze,{})}):t.jsx("div",{className:"flex flex-col gap-4",children:t.jsx("div",{className:"flex flex-row justify-end space-x-2 mt-1",children:t.jsx(ke,{})})})}),c&&t.jsx(L,{value:"authorizations",className:"pt-2",children:t.jsx(W,{distributorId:e.id})})]})]})})}),t.jsx("aside",{"aria-label":"Organization information",children:t.jsx(K,{})})]})},"OrganizationShowContent"),be=s(()=>{const e=p(),{data:s,error:a,isPending:r}=o();if(r||a)return null;const i=Date.now();return t.jsx("div",{className:"pt-0",children:s.map(s=>t.jsx(x,{value:s,children:t.jsx("div",{className:"p-0 text-sm",children:t.jsxs(u,{to:`/contacts/${s.id}/show`,state:{from:e.pathname},className:"flex items-center justify-between hover:bg-accent/10 py-2 transition-colors",children:[t.jsx("div",{className:"mr-4",children:t.jsx(V,{})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium",children:f(s.first_name,s.last_name)}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.title,s.nb_tasks?` - ${s.nb_tasks} task${s.nb_tasks>1?"s":""}`:"","   ",t.jsx(pe,{})]})]}),s.last_seen&&t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"text-sm text-muted-foreground",children:["last activity ",Y(s.last_seen,i)," ago"," ",t.jsx(ve,{status:s.status})]})})]})})},s.id))})},"ContactsIterator"),_e=s(()=>{const e=a();return t.jsx(_,{variant:"outline",asChild:!0,size:"sm",className:"h-11",children:t.jsxs(u,{to:"/contacts/create",state:e?{record:{organization_id:e.id}}:void 0,className:"flex items-center gap-2",children:[t.jsx(J,{className:"h-4 w-4"}),"Add contact"]})})},"CreateRelatedContactButton"),ke=s(()=>{const e=a();return t.jsx(_,{variant:"outline",asChild:!0,size:"sm",className:"h-11",children:t.jsxs(u,{to:"/opportunities/create",state:e?{record:{customer_organization_id:e.id}}:void 0,className:"flex items-center gap-2",children:[t.jsx(M,{className:"h-4 w-4"}),"Add opportunity"]})})},"CreateRelatedOpportunityButton"),ze=s(()=>{const{data:e,error:s,isPending:a}=o(),{opportunityStages:r}=b();if(a||s)return null;const i=Date.now();return t.jsx("div",{children:t.jsx("div",{children:e.map(e=>t.jsx("div",{className:"p-0 text-sm",children:t.jsxs(u,{to:`/opportunities/${e.id}/show`,className:"flex items-center justify-between hover:bg-accent/10 py-2 px-4 transition-colors",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium",children:e.name}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:[fe(r,e.stage),e.estimated_close_date?`, Expected close: ${new Date(e.estimated_close_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`:""]})]}),t.jsx("div",{className:"text-right",children:t.jsxs("div",{className:"text-sm text-muted-foreground",children:["last activity ",Y(e.updated_at,i)," ago"," "]})})]})},e.id))})})},"OpportunitiesIterator");export{ye as OrganizationShow,ye as default};
