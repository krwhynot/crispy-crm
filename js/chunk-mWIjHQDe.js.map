{"version":3,"file":"chunk-mWIjHQDe.js","sources":["../../src/components/admin/form/FormLoadingSkeleton.tsx","../../src/atomic-crm/hooks/useSmartDefaults.ts"],"sourcesContent":["import { Skeleton } from \"@/components/ui/skeleton\";\nimport { Card, CardContent } from \"@/components/ui/card\";\n\ninterface FormLoadingSkeletonProps {\n  /** Number of field rows to show (default: 4) */\n  rows?: number;\n  /** Show 2-column grid for each row (default: true) */\n  twoColumn?: boolean;\n}\n\n/**\n * Loading skeleton for forms waiting on async data (e.g., identity).\n * Matches the visual structure of FormGrid's 2-column layout.\n *\n * Usage in Create forms:\n * ```tsx\n * const { defaults, isLoading } = useSmartDefaults();\n * if (isLoading) return <FormLoadingSkeleton rows={4} />;\n * ```\n */\nexport const FormLoadingSkeleton = ({ rows = 4, twoColumn = true }: FormLoadingSkeletonProps) => (\n  <Card data-slot=\"card\">\n    <CardContent className=\"space-y-6 p-6\">\n      {Array.from({ length: rows }).map((_, rowIndex) => (\n        <div key={rowIndex} className={twoColumn ? \"grid grid-cols-2 gap-6\" : \"\"}>\n          {/* First field */}\n          <div className=\"space-y-2\">\n            <Skeleton data-slot=\"skeleton\" className=\"h-4 w-20\" />\n            <Skeleton data-slot=\"skeleton\" className=\"h-11 w-full\" />\n          </div>\n\n          {/* Second field (only in 2-column mode) */}\n          {twoColumn && (\n            <div className=\"space-y-2\">\n              <Skeleton data-slot=\"skeleton\" className=\"h-4 w-20\" />\n              <Skeleton data-slot=\"skeleton\" className=\"h-11 w-full\" />\n            </div>\n          )}\n        </div>\n      ))}\n    </CardContent>\n  </Card>\n);\n","import { useEffect, useRef } from \"react\";\nimport { useGetIdentity } from \"react-admin\";\nimport { format } from \"date-fns\";\nimport type { UserIdentity } from \"@/hooks/useUserRole\";\n\ninterface UseSmartDefaultsOptions {\n  reset?: (values: Record<string, any>, options?: { keepDirtyValues?: boolean }) => void;\n}\n\ninterface SmartDefaults {\n  sales_id: string | null;\n  activity_date: string;\n}\n\nexport const useSmartDefaults = (\n  options?: UseSmartDefaultsOptions\n): {\n  defaults: SmartDefaults;\n  isLoading: boolean;\n} => {\n  const { data: identity, isLoading } = useGetIdentity<UserIdentity>();\n  const hasResetRef = useRef(false);\n\n  const defaults: SmartDefaults = {\n    sales_id: identity?.id || null,\n    activity_date: format(new Date(), \"yyyy-MM-dd\"),\n  };\n\n  useEffect(() => {\n    if (options?.reset && identity && !isLoading && !hasResetRef.current) {\n      hasResetRef.current = true;\n      options.reset(defaults, { keepDirtyValues: true });\n    }\n    // Note: 'defaults' and 'options' are intentionally omitted from deps.\n    // 'defaults' is computed fresh each render (not stable reference).\n    // 'options' should only trigger reset when its .reset function changes.\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [identity, isLoading, options?.reset]);\n\n  return { defaults, isLoading };\n};\n"],"names":["FormLoadingSkeleton","__name","rows","twoColumn","jsx","Card","children","CardContent","className","Array","from","length","map","_","rowIndex","jsxs","Skeleton","useSmartDefaults","options","data","identity","isLoading","useGetIdentity","useRef","defaults","sales_id","id","activity_date","format","Date","useEffect","reset"],"mappings":"wQAoBO,MAAMA,EAAsBC,EAAA,EAAGC,OAAO,EAAGC,aAAY,KAC1DC,EAAAA,IAACC,EAAA,CAAK,YAAU,OACdC,SAAAF,EAAAA,IAACG,GAAYC,UAAU,gBACpBF,SAAAG,MAAMC,KAAK,CAAEC,OAAQT,IAAQU,IAAI,CAACC,EAAGC,IACpCC,EAAAA,KAAC,MAAA,CAAmBP,UAAWL,EAAY,yBAA2B,GAEpEG,SAAA,GAAAS,KAAC,MAAA,CAAIP,UAAU,YACbF,SAAA,CAAAF,EAAAA,IAACY,EAAA,CAAS,YAAU,WAAWR,UAAU,aACzCJ,EAAAA,IAACY,EAAA,CAAS,YAAU,WAAWR,UAAU,mBAI1CL,GACCY,EAAAA,KAAC,MAAA,CAAIP,UAAU,YACbF,SAAA,CAAAF,EAAAA,IAACY,EAAA,CAAS,YAAU,WAAWR,UAAU,aACzCJ,EAAAA,IAACY,EAAA,CAAS,YAAU,WAAWR,UAAU,qBAXrCM,QAJiB,uBCNtBG,IACXC,IAKA,MAAQC,KAAMC,EAAAC,UAAUA,GAAcC,IAClBC,EAAAA,QAAO,GAE3B,MAAMC,EAA0B,CAC9BC,SAAUL,GAAUM,IAAM,KAC1BC,cAAeC,EAAO,IAAIC,KAAQ,eAcpC,OAXAC,EAAAA,UAAU,OASP,CAACV,EAAUC,EAAWH,GAASa,QAE3B,CAAEP,WAAUH,cAzBW"}