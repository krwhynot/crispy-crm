{"version":3,"file":"OrganizationCreate-BqcS633U.js","sources":["../../src/atomic-crm/organizations/useDuplicateOrgCheck.ts","../../src/atomic-crm/organizations/DuplicateOrgWarningDialog.tsx","../../src/atomic-crm/organizations/OrganizationCreate.tsx"],"sourcesContent":["/**\n * useDuplicateOrgCheck - Hook for soft duplicate organization detection\n *\n * Provides a way to check for potential duplicate organizations before saving,\n * with the ability to bypass the warning if the user confirms.\n *\n * This implements a \"soft warning\" pattern instead of hard validation blocking:\n * - Check is performed on save attempt\n * - If duplicate found, returns the duplicate org info\n * - User can confirm to proceed anyway via the confirmation dialog\n * - Once bypassed, the same name won't trigger the warning again\n *\n * @example\n * ```tsx\n * const { checkForDuplicate, duplicateOrg, clearDuplicate, bypassDuplicate } = useDuplicateOrgCheck();\n *\n * // In save handler:\n * const duplicate = await checkForDuplicate(name, currentOrgId);\n * if (duplicate) {\n *   // Show confirmation dialog\n *   return; // Don't save yet\n * }\n * // No duplicate or already bypassed - proceed with save\n * ```\n */\nimport { useState, useCallback, useRef } from \"react\";\nimport { useDataProvider } from \"ra-core\";\nimport type { Company } from \"../types\";\n\ninterface DuplicateOrgInfo {\n  id: string | number;\n  name: string;\n}\n\ninterface UseDuplicateOrgCheckResult {\n  /** Check if a name has duplicates. Returns the duplicate org if found (and not bypassed). */\n  checkForDuplicate: (\n    name: string,\n    currentOrgId?: string | number\n  ) => Promise<DuplicateOrgInfo | null>;\n  /** The currently detected duplicate org (if any) */\n  duplicateOrg: DuplicateOrgInfo | null;\n  /** Clear the duplicate warning (user chose to change name) */\n  clearDuplicate: () => void;\n  /** Mark the duplicate as bypassed (user confirmed to proceed anyway) */\n  bypassDuplicate: () => void;\n  /** Whether a duplicate check is in progress */\n  isChecking: boolean;\n}\n\nexport function useDuplicateOrgCheck(): UseDuplicateOrgCheckResult {\n  const dataProvider = useDataProvider();\n  const [duplicateOrg, setDuplicateOrg] = useState<DuplicateOrgInfo | null>(null);\n  const [isChecking, setIsChecking] = useState(false);\n\n  // Track bypassed names (lowercase for case-insensitive comparison)\n  const bypassedNamesRef = useRef<Set<string>>(new Set());\n\n  const checkForDuplicate = useCallback(\n    async (name: string, currentOrgId?: string | number): Promise<DuplicateOrgInfo | null> => {\n      // Empty names handled by required validation\n      if (!name || name.trim().length === 0) {\n        return null;\n      }\n\n      const normalizedName = name.trim().toLowerCase();\n\n      // Check if this name was already bypassed\n      if (bypassedNamesRef.current.has(normalizedName)) {\n        return null;\n      }\n\n      setIsChecking(true);\n      try {\n        // Search for organizations with the same name (case-insensitive via ilike)\n        // NOTE: Don't add deleted_at filter here - the composed data provider\n        // routes list operations to organizations_summary view which handles\n        // soft-delete filtering internally and doesn't expose deleted_at column\n        const { data } = await dataProvider.getList<Company>(\"organizations\", {\n          filter: {\n            \"name@ilike\": name.trim(),\n          },\n          pagination: { page: 1, perPage: 10 },\n          sort: { field: \"id\", order: \"ASC\" },\n        });\n\n        // Filter out current record (for edit mode)\n        const duplicates = data.filter((org) => String(org.id) !== String(currentOrgId));\n\n        if (duplicates.length > 0) {\n          const duplicate: DuplicateOrgInfo = {\n            id: duplicates[0].id,\n            name: duplicates[0].name,\n          };\n          setDuplicateOrg(duplicate);\n          return duplicate;\n        }\n\n        return null;\n      } catch (error) {\n        console.error(\"Failed to check for duplicate organization:\", error);\n        // Don't block on check errors - let the DB constraint handle it\n        return null;\n      } finally {\n        setIsChecking(false);\n      }\n    },\n    [dataProvider]\n  );\n\n  const clearDuplicate = useCallback(() => {\n    setDuplicateOrg(null);\n  }, []);\n\n  const bypassDuplicate = useCallback(() => {\n    if (duplicateOrg) {\n      // Add to bypassed set so it won't warn again\n      bypassedNamesRef.current.add(duplicateOrg.name.toLowerCase());\n    }\n    setDuplicateOrg(null);\n  }, [duplicateOrg]);\n\n  return {\n    checkForDuplicate,\n    duplicateOrg,\n    clearDuplicate,\n    bypassDuplicate,\n    isChecking,\n  };\n}\n","/**\n * DuplicateOrgWarningDialog - Soft warning for potential duplicate organizations\n *\n * Shows a confirmation dialog when a user attempts to create/update an organization\n * with a name that already exists. Unlike a hard block, this allows the user to:\n * 1. Go back and change the name\n * 2. Proceed anyway (creates the organization despite the duplicate)\n *\n * This follows the established AlertDialog pattern from UnlinkConfirmDialog.tsx\n *\n * @example\n * ```tsx\n * <DuplicateOrgWarningDialog\n *   open={!!duplicateOrg}\n *   duplicateName={duplicateOrg?.name}\n *   onCancel={() => setDuplicateOrg(null)}\n *   onProceed={() => handleCreateAnyway()}\n * />\n * ```\n */\nimport {\n  AlertDialog,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogCancel,\n  AlertDialogAction,\n} from \"@/components/ui/alert-dialog\";\n\ninterface DuplicateOrgWarningDialogProps {\n  /** Whether the dialog is open */\n  open: boolean;\n  /** Name of the existing duplicate organization */\n  duplicateName?: string;\n  /** Called when user cancels (go back to edit name) */\n  onCancel: () => void;\n  /** Called when user confirms they want to proceed anyway */\n  onProceed: () => void;\n  /** Whether the proceed action is in progress */\n  isLoading?: boolean;\n}\n\nexport function DuplicateOrgWarningDialog({\n  open,\n  duplicateName,\n  onCancel,\n  onProceed,\n  isLoading = false,\n}: DuplicateOrgWarningDialogProps) {\n  return (\n    <AlertDialog open={open} onOpenChange={(isOpen) => !isOpen && onCancel()}>\n      <AlertDialogContent>\n        <AlertDialogHeader>\n          <AlertDialogTitle>Potential Duplicate Organization</AlertDialogTitle>\n          <AlertDialogDescription asChild>\n            <div className=\"space-y-2 text-sm text-muted-foreground\">\n              <p>\n                An organization named <strong>&quot;{duplicateName}&quot;</strong> already exists in\n                the system.\n              </p>\n              <p>Would you like to proceed anyway, or go back to change the name?</p>\n            </div>\n          </AlertDialogDescription>\n        </AlertDialogHeader>\n        <AlertDialogFooter>\n          <AlertDialogCancel onClick={onCancel}>Change Name</AlertDialogCancel>\n          <AlertDialogAction\n            onClick={onProceed}\n            disabled={isLoading}\n            className=\"bg-warning text-warning-foreground hover:bg-warning/90\"\n          >\n            {isLoading ? \"Creating...\" : \"Create Anyway\"}\n          </AlertDialogAction>\n        </AlertDialogFooter>\n      </AlertDialogContent>\n    </AlertDialog>\n  );\n}\n","/**\n * OrganizationCreate - Create form for new organizations\n *\n * Features:\n * - Soft duplicate warning: Shows confirmation dialog instead of hard block\n * - Schema-derived defaults (Constitution #5: Form state from truth)\n * - Website URL auto-prefixing\n * - Parent organization pre-fill from router state\n *\n * The duplicate check uses useDuplicateOrgCheck hook which performs a\n * case-insensitive search before save. If a potential duplicate is found,\n * DuplicateOrgWarningDialog appears to let the user confirm or change the name.\n */\nimport { useState, useCallback, useRef } from \"react\";\nimport { CreateBase, Form, useGetList, useCreate, useRedirect, useNotify } from \"ra-core\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { CancelButton } from \"@/components/admin/cancel-button\";\nimport { SaveButton, FormLoadingSkeleton } from \"@/components/admin/form\";\nimport { FormToolbar } from \"@/components/admin/simple-form\";\nimport { useLocation } from \"react-router-dom\";\nimport { useFormContext } from \"react-hook-form\";\n\nimport { OrganizationInputs } from \"./OrganizationInputs\";\nimport { organizationSchema } from \"../validation/organizations\";\nimport { useDuplicateOrgCheck } from \"./useDuplicateOrgCheck\";\nimport { DuplicateOrgWarningDialog } from \"./DuplicateOrgWarningDialog\";\nimport { useSmartDefaults } from \"@/atomic-crm/hooks/useSmartDefaults\";\nimport type { Database } from \"@/types/database.generated\";\nimport type { OrganizationFormValues, DuplicateCheckCallback } from \"./types\";\n\ntype Segment = Database[\"public\"][\"Tables\"][\"segments\"][\"Row\"];\n\n/**\n * Custom save button that checks for duplicates before saving\n *\n * Uses a hidden submit button pattern:\n * 1. Visible button checks for duplicates on click\n * 2. If no duplicate, triggers hidden submit button to perform actual save\n * 3. Hidden button has type=\"submit\" which triggers React Admin's form submission\n */\ninterface DuplicateCheckSaveButtonProps {\n  onDuplicateFound: DuplicateCheckCallback;\n  checkForDuplicate: (name: string) => Promise<{ id: string | number; name: string } | null>;\n  isChecking: boolean;\n}\n\nconst DuplicateCheckSaveButton = ({\n  onDuplicateFound,\n  checkForDuplicate,\n  isChecking,\n}: DuplicateCheckSaveButtonProps) => {\n  const form = useFormContext();\n  // Ref to the hidden submit button\n  const hiddenSubmitRef = useRef<HTMLButtonElement>(null);\n\n  const handleClick = useCallback(\n    async (event: React.MouseEvent<HTMLButtonElement>) => {\n      event.preventDefault();\n\n      // Get current form values\n      const values = form.getValues();\n      const name = values.name?.trim();\n\n      if (!name) {\n        // Empty name - trigger validation to show required field error\n        form.trigger(\"name\");\n        return;\n      }\n\n      // Check for duplicates\n      const duplicate = await checkForDuplicate(name);\n      if (duplicate) {\n        // Duplicate found - trigger the dialog instead of saving\n        onDuplicateFound(duplicate.name, values);\n        return;\n      }\n\n      // No duplicate - trigger the hidden submit button\n      hiddenSubmitRef.current?.click();\n    },\n    [form, checkForDuplicate, onDuplicateFound]\n  );\n\n  return (\n    <>\n      {/* Hidden native submit button that triggers React Admin form submission */}\n      <button\n        ref={hiddenSubmitRef}\n        type=\"submit\"\n        style={{ display: \"none\" }}\n        aria-hidden=\"true\"\n        tabIndex={-1}\n      />\n      {/* Visible button that checks for duplicates first */}\n      <SaveButton\n        label={isChecking ? \"Checking...\" : \"Create Organization\"}\n        type=\"button\"\n        onClick={handleClick}\n        disabled={isChecking}\n        alwaysEnable={true}\n        data-tutorial=\"org-save-btn\"\n      />\n    </>\n  );\n};\n\nconst OrganizationCreate = () => {\n  const location = useLocation();\n  const [create] = useCreate();\n  const redirect = useRedirect();\n  const notify = useNotify();\n\n  // Smart defaults hook for async identity handling\n  const { defaults: smartDefaults, isLoading: isLoadingDefaults } = useSmartDefaults();\n\n  // Duplicate check hook for soft warning\n  const { checkForDuplicate, duplicateOrg, clearDuplicate, bypassDuplicate, isChecking } =\n    useDuplicateOrgCheck();\n\n  // Store pending values when duplicate is found\n  const pendingValuesRef = useRef<OrganizationFormValues | null>(null);\n  const [isCreating, setIsCreating] = useState(false);\n\n  const { data: segments = [] } = useGetList<Segment>(\n    \"segments\",\n    {\n      filter: { name: \"Unknown\" },\n      pagination: { page: 1, perPage: 1 },\n      sort: { field: \"name\", order: \"ASC\" },\n    },\n    {\n      enabled: true,\n    }\n  );\n\n  const unknownSegmentId = segments?.[0]?.id;\n\n  // Read parent_organization_id from router state (set by \"Add Branch\" button)\n  const parentOrgId = (location.state as any)?.record?.parent_organization_id;\n\n  // Transform function for URL prefixing\n  // NOTE: All useCallback hooks must be declared before any early returns (React rules-of-hooks)\n  const transformValues = useCallback((values: OrganizationFormValues) => {\n    if (values.website && !values.website.startsWith(\"http\")) {\n      values.website = `https://${values.website}`;\n    }\n    return values;\n  }, []);\n\n  // Handle when duplicate is found - store values and show dialog\n  const handleDuplicateFound = useCallback((_duplicateName: string, values: OrganizationFormValues) => {\n    pendingValuesRef.current = values;\n  }, []);\n\n  // Handle user confirming to create despite duplicate\n  const handleProceedAnyway = useCallback(async () => {\n    if (!pendingValuesRef.current) return;\n\n    setIsCreating(true);\n    try {\n      const transformedValues = transformValues(pendingValuesRef.current);\n      await create(\n        \"organizations\",\n        { data: transformedValues },\n        {\n          onSuccess: (data) => {\n            bypassDuplicate();\n            pendingValuesRef.current = null;\n            notify(\"Organization created\", { type: \"success\" });\n            redirect(\"show\", \"organizations\", data.id);\n          },\n          onError: (error: unknown) => {\n            notify(error instanceof Error ? error.message : \"Failed to create organization\", { type: \"error\" });\n          },\n        }\n      );\n    } finally {\n      setIsCreating(false);\n    }\n  }, [create, transformValues, bypassDuplicate, notify, redirect]);\n\n  // Handle user canceling (wants to change name)\n  const handleCancelDuplicate = useCallback(() => {\n    clearDuplicate();\n    pendingValuesRef.current = null;\n  }, [clearDuplicate]);\n\n  // Show loading skeleton while identity loads\n  if (isLoadingDefaults) {\n    return (\n      <div className=\"bg-muted px-6 py-6\">\n        <div className=\"max-w-4xl mx-auto create-form-card\">\n          <FormLoadingSkeleton rows={4} />\n        </div>\n      </div>\n    );\n  }\n\n  // Generate defaults from schema, then merge with runtime values\n  // Per Constitution #5: FORM STATE DERIVED FROM TRUTH\n  // Use .partial() to make all fields optional during default generation\n  // This extracts fields with .default() (organization_type, priority)\n  // Note: Only use sales_id from smartDefaults - activity_date is for activities only\n  const formDefaults = {\n    ...organizationSchema.partial().parse({}),\n    sales_id: smartDefaults.sales_id, // Only take sales_id, not activity_date\n    // Use null (not undefined) when no segment found - null is a valid value for nullable UUID fields\n    segment_id: unknownSegmentId ?? null,\n    ...(parentOrgId ? { parent_organization_id: parentOrgId } : {}), // Pre-fill parent when adding branch\n  };\n  const formKey = unknownSegmentId ? `org-create-${unknownSegmentId}` : \"org-create\";\n\n  return (\n    <>\n      <CreateBase redirect=\"show\" transform={transformValues}>\n        <div className=\"bg-muted px-6 py-6\">\n          <div className=\"max-w-4xl mx-auto create-form-card\">\n            <Form key={formKey} defaultValues={formDefaults}>\n              <Card>\n                <CardContent>\n                  <OrganizationFormContent\n                    onDuplicateFound={handleDuplicateFound}\n                    checkForDuplicate={checkForDuplicate}\n                    isChecking={isChecking}\n                  />\n                </CardContent>\n              </Card>\n            </Form>\n          </div>\n        </div>\n      </CreateBase>\n\n      {/* Soft duplicate warning dialog */}\n      <DuplicateOrgWarningDialog\n        open={!!duplicateOrg}\n        duplicateName={duplicateOrg?.name}\n        onCancel={handleCancelDuplicate}\n        onProceed={handleProceedAnyway}\n        isLoading={isCreating}\n      />\n    </>\n  );\n};\n\nconst OrganizationFormContent = ({\n  onDuplicateFound,\n  checkForDuplicate,\n  isChecking,\n}: {\n  onDuplicateFound: DuplicateCheckCallback;\n  checkForDuplicate: (name: string) => Promise<{ id: string | number; name: string } | null>;\n  isChecking: boolean;\n}) => {\n  return (\n    <>\n      <OrganizationInputs />\n      <FormToolbar>\n        <div className=\"flex flex-row gap-2 justify-end\">\n          <CancelButton />\n          <DuplicateCheckSaveButton\n            onDuplicateFound={onDuplicateFound}\n            checkForDuplicate={checkForDuplicate}\n            isChecking={isChecking}\n          />\n        </div>\n      </FormToolbar>\n    </>\n  );\n};\n\nexport { OrganizationCreate };\nexport default OrganizationCreate;\n"],"names":["useDuplicateOrgCheck","dataProvider","useDataProvider","duplicateOrg","setDuplicateOrg","useState","isChecking","setIsChecking","bypassedNamesRef","useRef","Set","checkForDuplicate","useCallback","async","name","currentOrgId","trim","length","normalizedName","toLowerCase","current","has","data","getList","filter","pagination","page","perPage","sort","field","order","duplicates","org","String","id","duplicate","error","clearDuplicate","bypassDuplicate","add","DuplicateOrgWarningDialog","open","duplicateName","onCancel","onProceed","isLoading","jsx","AlertDialog","onOpenChange","isOpen","children","jsxs","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","asChild","className","AlertDialogFooter","AlertDialogCancel","onClick","AlertDialogAction","disabled","__name","DuplicateCheckSaveButton","onDuplicateFound","form","useFormContext","hiddenSubmitRef","handleClick","event","preventDefault","values","getValues","trigger","click","Fragment","ref","type","style","display","tabIndex","SaveButton","label","alwaysEnable","OrganizationCreate","location","useLocation","create","useCreate","redirect","useRedirect","notify","useNotify","defaults","smartDefaults","isLoadingDefaults","useSmartDefaults","pendingValuesRef","isCreating","setIsCreating","segments","useGetList","enabled","unknownSegmentId","parentOrgId","state","record","parent_organization_id","transformValues","website","startsWith","handleDuplicateFound","_duplicateName","handleProceedAnyway","transformedValues","onSuccess","onError","Error","message","handleCancelDuplicate","FormLoadingSkeleton","rows","formDefaults","organizationSchema","partial","parse","sales_id","segment_id","formKey","CreateBase","transform","Form","defaultValues","Card","CardContent","OrganizationFormContent","OrganizationInputs","FormToolbar","CancelButton"],"mappings":"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"}