{"version":3,"file":"chunk-nZ5rfQld.js","sources":["../../src/components/admin/form/ButtonPlaceholder.tsx","../../src/components/admin/form/CompactFormFieldWithButton.tsx","../../src/atomic-crm/opportunities/utils/generateOpportunityName.ts","../../src/atomic-crm/opportunities/hooks/useAutoGenerateName.ts","../../src/atomic-crm/opportunities/hooks/useContactOrgMismatch.ts","../../src/atomic-crm/opportunities/hooks/useDistributorAuthorization.ts","../../src/components/admin/create-in-dialog-button.tsx","../../src/atomic-crm/opportunities/components/ContactOrgMismatchWarning.tsx","../../src/atomic-crm/opportunities/components/DistributorAuthorizationWarning.tsx","../../src/atomic-crm/opportunities/forms/NamingConventionHelp.tsx","../../src/atomic-crm/constants.ts","../../src/atomic-crm/opportunities/forms/OpportunityCompactForm.tsx"],"sourcesContent":["import { cn } from \"@/lib/utils\";\n\ninterface ButtonPlaceholderProps {\n  className?: string;\n}\n\n/**\n * Invisible placeholder that maintains button column width for alignment.\n * Use in CompactFormFieldWithButton when a field doesn't have an action button.\n *\n * Dimensions match CreateInDialogButton with size=\"sm\":\n * - h-9 (36px) = sm button height\n * - w-9 (36px) = square, icon-only button size\n */\nexport const ButtonPlaceholder = ({ className }: ButtonPlaceholderProps) => {\n  return (\n    <div\n      className={cn(\n        \"h-9 w-9 shrink-0\", // Match icon-only button size\n        \"invisible\", // Take space but don't display\n        className\n      )}\n      aria-hidden=\"true\"\n    />\n  );\n};\n","import { cn } from \"@/lib/utils\";\nimport { ButtonPlaceholder } from \"./ButtonPlaceholder\";\n\ninterface CompactFormFieldWithButtonProps {\n  children: React.ReactNode;\n  button?: React.ReactNode;\n  className?: string;\n  /** Content to render below the field (e.g., warnings) */\n  footer?: React.ReactNode;\n}\n\n/**\n * Consistent layout for form field + optional action button.\n * Always reserves space for button column to maintain alignment across rows.\n *\n * Usage:\n * - With button: <CompactFormFieldWithButton button={<CreateInDialogButton />}>\n * - Without button: <CompactFormFieldWithButton> (auto-adds placeholder)\n */\nexport const CompactFormFieldWithButton = ({\n  children,\n  button,\n  className,\n  footer,\n}: CompactFormFieldWithButtonProps) => {\n  return (\n    <div className={cn(\"flex flex-col\", className)}>\n      <div className=\"grid grid-cols-[1fr_auto] items-end gap-2\">\n        <div className=\"min-w-0\">{children}</div>\n        {button ?? <ButtonPlaceholder />}\n      </div>\n      {footer}\n    </div>\n  );\n};\n","/**\n * Generate Opportunity Name Utility\n *\n * Auto-generates opportunity names following the format:\n * \"{Customer Name} - {Principal Name} - Q{quarter} {year}\"\n *\n * Example: \"Nobu Miami - Ocean Hugger - Q1 2025\"\n *\n * Features:\n * - Calculates quarter from current date\n * - Handles missing customer or principal gracefully\n * - Truncates to 200 characters max\n * - Returns empty string if both customer and principal are missing\n */\n\nexport interface OpportunityNameParams {\n  customerName?: string | null;\n  principalName?: string | null;\n  date?: Date;\n}\n\n/**\n * Calculate the quarter (1-4) from a given date\n */\nexport function getQuarter(date: Date): number {\n  const month = date.getMonth(); // 0-11\n  return Math.floor(month / 3) + 1; // 1-4\n}\n\n/**\n * Generate an opportunity name from customer, principal, and date\n *\n * @param params - Customer name, principal name, and optional date (defaults to today)\n * @returns Generated name string, or empty string if insufficient data\n */\nexport function generateOpportunityName(params: OpportunityNameParams): string {\n  const { customerName, principalName, date = new Date() } = params;\n\n  const parts: string[] = [];\n\n  // Add customer name if available (check trimmed value is not empty)\n  const trimmedCustomer = customerName?.trim();\n  if (trimmedCustomer) {\n    parts.push(trimmedCustomer);\n  }\n\n  // Add principal name if available (check trimmed value is not empty)\n  const trimmedPrincipal = principalName?.trim();\n  if (trimmedPrincipal) {\n    parts.push(trimmedPrincipal);\n  }\n\n  // Return empty string if both customer and principal are missing/empty after trimming\n  if (parts.length === 0) {\n    return \"\";\n  }\n\n  // Add quarter and year\n  const quarter = getQuarter(date);\n  const year = date.getFullYear();\n  parts.push(`Q${quarter} ${year}`);\n\n  // Join parts with \" - \" separator\n  let name = parts.join(\" - \");\n\n  // Truncate to 200 characters if needed\n  if (name.length > 200) {\n    name = name.substring(0, 197) + \"...\";\n  }\n\n  return name;\n}\n","import { useEffect, useCallback } from \"react\";\nimport { useWatch, useFormContext } from \"react-hook-form\";\nimport { useGetOne } from \"ra-core\";\nimport { generateOpportunityName } from \"../utils/generateOpportunityName\";\n\n/**\n * Auto-Generate Name Hook\n * Automatically generates opportunity name from customer + principal + quarter/year\n *\n * Format: \"{Customer Name} - {Principal Name} - Q{quarter} {year}\"\n * Example: \"Nobu Miami - Ocean Hugger - Q1 2025\"\n *\n * @param mode - 'create' for auto-generation, 'edit' for manual regeneration\n * @returns regenerate function, loading state, and canGenerate flag\n */\nexport const useAutoGenerateName = (mode: \"create\" | \"edit\") => {\n  const { setValue } = useFormContext();\n\n  // Watch relevant fields\n  const customerOrgId = useWatch({ name: \"customer_organization_id\" });\n  const principalOrgId = useWatch({ name: \"principal_organization_id\" });\n  const currentName = useWatch({ name: \"name\" });\n\n  // Fetch customer organization name\n  const { data: customerOrg, isLoading: isLoadingCustomer } = useGetOne(\n    \"organizations\",\n    { id: customerOrgId },\n    { enabled: !!customerOrgId }\n  );\n\n  // Fetch principal organization name\n  const { data: principalOrg, isLoading: isLoadingPrincipal } = useGetOne(\n    \"organizations\",\n    { id: principalOrgId },\n    { enabled: !!principalOrgId }\n  );\n\n  const isLoading = isLoadingCustomer || isLoadingPrincipal;\n\n  // Button should be enabled when at least one of customer or principal is selected\n  const canGenerate = !!(customerOrg?.name || principalOrg?.name);\n\n  /**\n   * Generate name using the standardized utility function\n   * Format: \"{Customer Name} - {Principal Name} - Q{quarter} {year}\"\n   */\n  const generateName = useCallback(() => {\n    return generateOpportunityName({\n      customerName: customerOrg?.name,\n      principalName: principalOrg?.name,\n      date: new Date(),\n    });\n  }, [customerOrg?.name, principalOrg?.name]);\n\n  /**\n   * Manual regenerate function for edit mode\n   */\n  const regenerate = useCallback(() => {\n    if (!isLoading) {\n      const newName = generateName();\n      if (newName) {\n        setValue(\"name\", newName, {\n          shouldValidate: true,\n          shouldDirty: true,\n        });\n      }\n    }\n  }, [generateName, setValue, isLoading]);\n\n  /**\n   * Auto-generate in create mode when fields change and name is empty\n   */\n  useEffect(() => {\n    if (mode === \"create\" && !currentName && !isLoading) {\n      const newName = generateName();\n      if (newName) {\n        setValue(\"name\", newName, {\n          shouldValidate: true,\n          shouldDirty: true,\n        });\n      }\n    }\n  }, [mode, currentName, generateName, setValue, isLoading]);\n\n  return { regenerate, isLoading, canGenerate };\n};\n","import { useMemo } from \"react\";\nimport { useGetMany } from \"react-admin\";\nimport type { Contact } from \"../../types\";\nimport type { Identifier } from \"ra-core\";\n\n/**\n * Contact organization mismatch information\n */\nexport interface MismatchedContact {\n  contact: Contact;\n  contactOrgId: Identifier | null | undefined;\n}\n\n/**\n * Hook result for contact organization mismatch detection\n */\nexport interface UseContactOrgMismatchResult {\n  /** Contacts whose organization doesn't match the opportunity's customer org */\n  mismatchedContacts: MismatchedContact[];\n  /** Whether any contacts have mismatched organizations */\n  hasMismatch: boolean;\n  /** Whether the mismatch check is loading */\n  isLoading: boolean;\n}\n\n/**\n * Hook to detect when selected contacts belong to a different organization\n * than the opportunity's customer organization.\n *\n * This is a data quality check - contacts should typically belong to the\n * same organization as the opportunity's customer. A mismatch may indicate:\n * 1. User changed customer org after selecting contacts\n * 2. Intentional cross-org contact (rare but valid)\n * 3. Data entry error\n *\n * @param contactIds - Array of selected contact IDs\n * @param customerOrganizationId - The opportunity's customer organization ID\n * @returns Mismatch detection result with affected contacts\n */\nexport function useContactOrgMismatch(\n  contactIds: Identifier[],\n  customerOrganizationId: Identifier | null | undefined\n): UseContactOrgMismatchResult {\n  // Memoize IDs to prevent unnecessary re-fetches\n  const stableIds = useMemo(\n    () => contactIds.filter((id): id is Identifier => id != null),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [JSON.stringify(contactIds)]\n  );\n\n  // Fetch contact details to check their organization_id\n  const { data: contacts, isLoading } = useGetMany<Contact>(\n    \"contacts\",\n    { ids: stableIds },\n    { enabled: stableIds.length > 0 && customerOrganizationId != null }\n  );\n\n  // Detect mismatches\n  const result = useMemo(() => {\n    if (!contacts || !customerOrganizationId) {\n      return {\n        mismatchedContacts: [],\n        hasMismatch: false,\n        isLoading,\n      };\n    }\n\n    const mismatched: MismatchedContact[] = contacts\n      .filter((contact) => {\n        // A contact is mismatched if it has an organization_id that differs\n        // from the opportunity's customer organization\n        const contactOrgId = contact.organization_id;\n        return contactOrgId != null && String(contactOrgId) !== String(customerOrganizationId);\n      })\n      .map((contact) => ({\n        contact,\n        contactOrgId: contact.organization_id,\n      }));\n\n    return {\n      mismatchedContacts: mismatched,\n      hasMismatch: mismatched.length > 0,\n      isLoading,\n    };\n  }, [contacts, customerOrganizationId, isLoading]);\n\n  return result;\n}\n","import { useMemo } from \"react\";\nimport { useGetList, useGetOne } from \"react-admin\";\nimport type { Identifier, RaRecord } from \"ra-core\";\nimport type { Organization } from \"../../types\";\n\n/**\n * Distributor-Principal Authorization Record\n * Tracks which principals are authorized to sell through which distributors\n */\nexport interface DistributorPrincipalAuthorization extends RaRecord {\n  id: Identifier;\n  distributor_id: Identifier;\n  principal_id: Identifier;\n  is_authorized: boolean;\n  authorization_date?: string;\n  expiration_date?: string;\n  territory_restrictions?: string[];\n  notes?: string;\n  created_at: string;\n  updated_at: string;\n  deleted_at?: string;\n}\n\n/**\n * Hook result for distributor-principal authorization check\n */\nexport interface UseDistributorAuthorizationResult {\n  /** Whether the distributor is authorized to sell the principal's products */\n  isAuthorized: boolean;\n  /** Whether an authorization record exists (even if expired) */\n  hasAuthorizationRecord: boolean;\n  /** Whether the authorization has expired */\n  isExpired: boolean;\n  /** The authorization record if found */\n  authorization: DistributorPrincipalAuthorization | null;\n  /** Whether we have both principal and distributor selected */\n  hasBothSelected: boolean;\n  /** Whether the authorization check is loading */\n  isLoading: boolean;\n  /** Distributor organization name (for display) */\n  distributorName: string | undefined;\n  /** Principal organization name (for display) */\n  principalName: string | undefined;\n}\n\n/**\n * Hook to check if a distributor is authorized to sell a principal's products.\n *\n * This is a data quality check for the MFB three-party business model:\n * - Principal = Food manufacturer whose products MFB represents\n * - Distributor = Company that buys from principals and distributes (e.g., Sysco, USF)\n * - Not all distributors carry all principals' products\n *\n * A missing or expired authorization may indicate:\n * 1. User should select a different distributor\n * 2. New authorization relationship needs to be established\n * 3. Data entry error\n * 4. Legitimate case where authorization is being pursued\n *\n * @param principalId - The selected principal organization ID\n * @param distributorId - The selected distributor organization ID\n * @returns Authorization check result with status and organization details\n */\nexport function useDistributorAuthorization(\n  principalId: Identifier | null | undefined,\n  distributorId: Identifier | null | undefined\n): UseDistributorAuthorizationResult {\n  // Determine if we have both IDs to check\n  const hasBothSelected = principalId != null && distributorId != null;\n\n  // Fetch authorization record for this principal-distributor pair\n  const { data: authorizations, isLoading: isLoadingAuth } =\n    useGetList<DistributorPrincipalAuthorization>(\n      \"distributor_principal_authorizations\",\n      {\n        filter: {\n          principal_id: principalId,\n          distributor_id: distributorId,\n          deleted_at: null, // Only active records\n        },\n        pagination: { page: 1, perPage: 1 },\n      },\n      { enabled: hasBothSelected }\n    );\n\n  // Fetch distributor name for display\n  const { data: distributor, isLoading: isLoadingDistributor } = useGetOne<Organization>(\n    \"organizations\",\n    { id: distributorId! },\n    { enabled: distributorId != null }\n  );\n\n  // Fetch principal name for display\n  const { data: principal, isLoading: isLoadingPrincipal } = useGetOne<Organization>(\n    \"organizations\",\n    { id: principalId! },\n    { enabled: principalId != null }\n  );\n\n  // Compute authorization status\n  const result = useMemo((): UseDistributorAuthorizationResult => {\n    // If we don't have both selections, return early\n    if (!hasBothSelected) {\n      return {\n        isAuthorized: true, // Don't show warning if not both selected\n        hasAuthorizationRecord: false,\n        isExpired: false,\n        authorization: null,\n        hasBothSelected: false,\n        isLoading: false,\n        distributorName: distributor?.name,\n        principalName: principal?.name,\n      };\n    }\n\n    const isLoading = isLoadingAuth || isLoadingDistributor || isLoadingPrincipal;\n\n    // Get the authorization record (if any)\n    const authorization = authorizations?.[0] ?? null;\n    const hasAuthorizationRecord = authorization != null;\n\n    // Check if expired\n    const today = new Date().toISOString().split(\"T\")[0]; // YYYY-MM-DD\n    const isExpired =\n      hasAuthorizationRecord &&\n      authorization.expiration_date != null &&\n      authorization.expiration_date < today;\n\n    // Determine if authorized:\n    // - Must have a record\n    // - Record must have is_authorized = true\n    // - Must not be expired\n    const isAuthorized = hasAuthorizationRecord && authorization.is_authorized && !isExpired;\n\n    return {\n      isAuthorized,\n      hasAuthorizationRecord,\n      isExpired,\n      authorization,\n      hasBothSelected,\n      isLoading,\n      distributorName: distributor?.name,\n      principalName: principal?.name,\n    };\n  }, [\n    authorizations,\n    distributor?.name,\n    principal?.name,\n    hasBothSelected,\n    isLoadingAuth,\n    isLoadingDistributor,\n    isLoadingPrincipal,\n  ]);\n\n  return result;\n}\n","import React, { useState } from \"react\";\nimport { CreateBase, Form, useNotify, useRefresh } from \"ra-core\";\nimport { Button } from \"@/components/ui/button\";\nimport { Plus } from \"lucide-react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { FormToolbar } from \"@/components/admin/simple-form\";\nimport { SaveButton } from \"@/components/admin/form\";\n\ninterface CreateInDialogButtonProps {\n  resource: string;\n  children: React.ReactElement; // The Create component (e.g., OrganizationCreate content)\n  defaultValues?: Record<string, any>;\n  label?: string;\n  onSave?: (record: any) => void;\n  transform?: (data: any) => any;\n  title?: string;\n  description?: string;\n  variant?: \"default\" | \"outline\" | \"ghost\";\n  size?: \"sm\" | \"default\" | \"lg\";\n  className?: string;\n}\n\nexport const CreateInDialogButton = ({\n  resource,\n  children,\n  defaultValues = {},\n  label = \"New\",\n  onSave,\n  transform,\n  title = `Create new ${resource}`,\n  description,\n  variant = \"outline\",\n  size = \"sm\",\n  className,\n}: CreateInDialogButtonProps) => {\n  const [open, setOpen] = useState(false);\n  const notify = useNotify();\n  const refresh = useRefresh();\n\n  // Handle successful creation - CreateBase already called dataProvider.create(),\n  // so this callback receives the newly created record with its ID\n  const handleSuccess = (createdRecord: any) => {\n    // Close dialog\n    setOpen(false);\n\n    // Notify success\n    notify(`${resource} created successfully`, { type: \"success\" });\n\n    // Refresh the list/form to get new options\n    refresh();\n\n    // Call onSave callback if provided (for auto-selecting the new record)\n    if (onSave && createdRecord) {\n      onSave(createdRecord);\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button variant={variant} size={size} className={className}>\n          <Plus className=\"w-4 h-4 mr-1\" />\n          {label}\n        </Button>\n      </DialogTrigger>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle>{title}</DialogTitle>\n          {description && <DialogDescription>{description}</DialogDescription>}\n        </DialogHeader>\n        <CreateBase\n          resource={resource}\n          redirect={false}\n          transform={transform}\n          mutationOptions={{\n            onSuccess: handleSuccess,\n            onError: () => {\n              notify(`Error creating ${resource}`, { type: \"error\" });\n            },\n          }}\n        >\n          <Form defaultValues={defaultValues}>\n            <Card className=\"border-0 shadow-none\">\n              <CardContent className=\"p-0 pt-4\">\n                {children}\n                <FormToolbar>\n                  <div className=\"flex flex-row gap-2 justify-end\">\n                    <Button type=\"button\" variant=\"outline\" onClick={() => setOpen(false)}>\n                      Cancel\n                    </Button>\n                    <SaveButton label=\"Create\" />\n                  </div>\n                </FormToolbar>\n              </CardContent>\n            </Card>\n          </Form>\n        </CreateBase>\n      </DialogContent>\n    </Dialog>\n  );\n};\n","import { AlertTriangle } from \"lucide-react\";\nimport { useWatch, useFormContext } from \"react-hook-form\";\nimport { useGetOne } from \"react-admin\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { useContactOrgMismatch } from \"../hooks/useContactOrgMismatch\";\nimport type { Organization } from \"../../types\";\nimport type { Identifier } from \"ra-core\";\n\n/**\n * Warning banner displayed when selected contacts belong to a different\n * organization than the opportunity's customer organization.\n *\n * This is a \"soft warning\" - it alerts the user but doesn't block the action.\n * Users can acknowledge and override via the confirmation dialog.\n *\n * @example\n * // In OpportunityRelationshipsTab, after the contacts selector:\n * <ContactOrgMismatchWarning onClearMismatched={() => {\n *   // Remove mismatched contacts from form\n *   setValue(\"contact_ids\", []);\n * }} />\n */\ninterface ContactOrgMismatchWarningProps {\n  /** Callback to clear mismatched contacts from the form */\n  onClearMismatched?: () => void;\n}\n\nexport function ContactOrgMismatchWarning({ onClearMismatched }: ContactOrgMismatchWarningProps) {\n  const { setValue, getValues } = useFormContext();\n\n  // Watch form values for reactive updates\n  const contactIds = useWatch({ name: \"contact_ids\" }) as Identifier[] | undefined;\n  const customerOrgId = useWatch({ name: \"customer_organization_id\" }) as Identifier | undefined;\n\n  // Detect mismatches\n  const { mismatchedContacts, hasMismatch, isLoading } = useContactOrgMismatch(\n    contactIds || [],\n    customerOrgId\n  );\n\n  // Fetch customer org name for clearer messaging\n  const { data: customerOrg } = useGetOne<Organization>(\n    \"organizations\",\n    { id: customerOrgId! },\n    { enabled: !!customerOrgId }\n  );\n\n  // Don't render if no mismatch or still loading\n  if (!hasMismatch || isLoading) {\n    return null;\n  }\n\n  // Build contact names list\n  const mismatchedNames = mismatchedContacts\n    .map((m) => `${m.contact.first_name} ${m.contact.last_name}`.trim())\n    .filter(Boolean);\n\n  const handleClearMismatched = () => {\n    const currentContacts = (getValues(\"contact_ids\") || []) as Identifier[];\n    const mismatchedIds = new Set(mismatchedContacts.map((m) => String(m.contact.id)));\n    const validContacts = currentContacts.filter((id) => !mismatchedIds.has(String(id)));\n    setValue(\"contact_ids\", validContacts);\n    onClearMismatched?.();\n  };\n\n  return (\n    <Alert className=\"border-warning/50 bg-warning-subtle mt-3\">\n      <AlertTriangle className=\"h-4 w-4 text-warning\" />\n      <AlertTitle className=\"text-warning-strong\">Contact Organization Mismatch</AlertTitle>\n      <AlertDescription className=\"text-warning\">\n        <p className=\"mb-2\">\n          {mismatchedContacts.length === 1 ? (\n            <>\n              <strong>{mismatchedNames[0]}</strong> belongs to a different organization than the\n              selected customer\n              {customerOrg?.name && (\n                <>\n                  {\" \"}\n                  (<strong>{customerOrg.name}</strong>)\n                </>\n              )}\n              .\n            </>\n          ) : (\n            <>\n              <strong>{mismatchedContacts.length} contacts</strong> (\n              {mismatchedNames.slice(0, 3).join(\", \")}\n              {mismatchedNames.length > 3 && `, +${mismatchedNames.length - 3} more`}) belong to\n              different organizations than the selected customer\n              {customerOrg?.name && (\n                <>\n                  {\" \"}\n                  (<strong>{customerOrg.name}</strong>)\n                </>\n              )}\n              .\n            </>\n          )}\n        </p>\n\n        <div className=\"flex gap-2 mt-3\">\n          <AlertDialog>\n            <AlertDialogTrigger asChild>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                className=\"border-warning text-warning hover:bg-warning-subtle\"\n              >\n                Keep Anyway\n              </Button>\n            </AlertDialogTrigger>\n            <AlertDialogContent>\n              <AlertDialogHeader>\n                <AlertDialogTitle>Keep Mismatched Contacts?</AlertDialogTitle>\n                <AlertDialogDescription>\n                  <p className=\"mb-2\">\n                    The following contacts belong to organizations different from the\n                    opportunity&apos;s customer:\n                  </p>\n                  <ul className=\"list-disc list-inside mb-2 text-foreground\">\n                    {mismatchedNames.map((name, idx) => (\n                      <li key={idx}>{name}</li>\n                    ))}\n                  </ul>\n                  <p>\n                    This may indicate a data entry error, or you may have a legitimate reason to\n                    include cross-organization contacts.\n                  </p>\n                </AlertDialogDescription>\n              </AlertDialogHeader>\n              <AlertDialogFooter>\n                <AlertDialogCancel>Go Back</AlertDialogCancel>\n                <AlertDialogAction className=\"bg-warning hover:bg-warning-strong\">\n                  Yes, Keep These Contacts\n                </AlertDialogAction>\n              </AlertDialogFooter>\n            </AlertDialogContent>\n          </AlertDialog>\n\n          <Button variant=\"destructive\" size=\"sm\" onClick={handleClearMismatched}>\n            Remove Mismatched\n          </Button>\n        </div>\n      </AlertDescription>\n    </Alert>\n  );\n}\n","import { AlertTriangle, Clock, FileWarning } from \"lucide-react\";\nimport { useWatch } from \"react-hook-form\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { useDistributorAuthorization } from \"../hooks/useDistributorAuthorization\";\nimport type { Identifier } from \"ra-core\";\n\n/**\n * Warning banner displayed when the selected distributor is not authorized\n * to sell the selected principal's products.\n *\n * This is a \"soft warning\" - it alerts the user but doesn't block the action.\n * Users can acknowledge and proceed, as there may be legitimate reasons\n * (e.g., pursuing new authorization).\n *\n * Three warning states:\n * 1. No authorization record exists\n * 2. Authorization record exists but is_authorized = false\n * 3. Authorization record is expired\n *\n * @example\n * // In OpportunityRelationshipsTab, after the distributor selector:\n * <DistributorAuthorizationWarning />\n */\nexport function DistributorAuthorizationWarning() {\n  // Watch form values for reactive updates\n  const principalId = useWatch({ name: \"principal_organization_id\" }) as Identifier | undefined;\n  const distributorId = useWatch({ name: \"distributor_organization_id\" }) as Identifier | undefined;\n\n  // Check authorization status\n  const {\n    isAuthorized,\n    hasAuthorizationRecord,\n    isExpired,\n    hasBothSelected,\n    isLoading,\n    distributorName,\n    principalName,\n  } = useDistributorAuthorization(principalId, distributorId);\n\n  // Don't render if:\n  // - Both not selected (nothing to check)\n  // - Still loading\n  // - Authorization is valid\n  if (!hasBothSelected || isLoading || isAuthorized) {\n    return null;\n  }\n\n  // Determine the specific warning message\n  const getWarningContent = () => {\n    if (isExpired) {\n      return {\n        icon: <Clock className=\"h-4 w-4 text-warning\" />,\n        title: \"Authorization Expired\",\n        message: (\n          <>\n            <strong>{distributorName || \"This distributor\"}</strong>&apos;s authorization to carry{\" \"}\n            <strong>{principalName || \"this principal\"}</strong>&apos;s products has expired.\n          </>\n        ),\n        dialogTitle: \"Proceed with Expired Authorization?\",\n        dialogDescription: (\n          <>\n            The authorization for <strong>{distributorName}</strong> to distribute{\" \"}\n            <strong>{principalName}</strong> products has expired. This may mean the distributor is\n            no longer carrying these products, or the authorization needs to be renewed.\n          </>\n        ),\n      };\n    }\n\n    if (hasAuthorizationRecord) {\n      // Record exists but is_authorized = false\n      return {\n        icon: <FileWarning className=\"h-4 w-4 text-warning\" />,\n        title: \"Authorization Inactive\",\n        message: (\n          <>\n            <strong>{distributorName || \"This distributor\"}</strong> has an inactive authorization\n            record for <strong>{principalName || \"this principal\"}</strong>&apos;s products.\n          </>\n        ),\n        dialogTitle: \"Proceed with Inactive Authorization?\",\n        dialogDescription: (\n          <>\n            <strong>{distributorName}</strong> has an authorization record for{\" \"}\n            <strong>{principalName}</strong>, but it is marked as inactive. This typically means the\n            distributor previously carried these products but no longer does.\n          </>\n        ),\n      };\n    }\n\n    // No authorization record at all\n    return {\n      icon: <AlertTriangle className=\"h-4 w-4 text-warning\" />,\n      title: \"Distributor Not Authorized\",\n      message: (\n        <>\n          <strong>{distributorName || \"This distributor\"}</strong> is not currently authorized to\n          carry <strong>{principalName || \"this principal\"}</strong>&apos;s products.\n        </>\n      ),\n      dialogTitle: \"Proceed Without Authorization?\",\n      dialogDescription: (\n        <>\n          No authorization record exists between <strong>{distributorName}</strong> and{\" \"}\n          <strong>{principalName}</strong>. This may indicate the distributor doesn&apos;t carry\n          this principal&apos;s products, or a new authorization relationship is being pursued.\n        </>\n      ),\n    };\n  };\n\n  const content = getWarningContent();\n\n  return (\n    <Alert className=\"border-warning/50 bg-warning-subtle mt-3\">\n      {content.icon}\n      <AlertTitle className=\"text-warning-strong\">{content.title}</AlertTitle>\n      <AlertDescription className=\"text-warning\">\n        <p className=\"mb-2\">{content.message}</p>\n        <p className=\"text-sm mb-3\">\n          You can still create this opportunity, but the distribution channel may need to be\n          established or verified.\n        </p>\n\n        <AlertDialog>\n          <AlertDialogTrigger asChild>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              className=\"border-warning text-warning hover:bg-warning-subtle\"\n            >\n              I Understand, Continue\n            </Button>\n          </AlertDialogTrigger>\n          <AlertDialogContent>\n            <AlertDialogHeader>\n              <AlertDialogTitle>{content.dialogTitle}</AlertDialogTitle>\n              <AlertDialogDescription asChild>\n                <div className=\"space-y-3\">\n                  <p>{content.dialogDescription}</p>\n                  <div className=\"p-3 bg-muted rounded-md\">\n                    <p className=\"text-sm font-medium text-foreground mb-1\">Consider:</p>\n                    <ul className=\"text-sm list-disc list-inside space-y-1\">\n                      <li>Contacting the principal to verify distribution options</li>\n                      <li>Selecting a different authorized distributor</li>\n                      <li>Creating the opportunity anyway if pursuing new authorization</li>\n                    </ul>\n                  </div>\n                </div>\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <AlertDialogFooter>\n              <AlertDialogCancel>Go Back</AlertDialogCancel>\n              <AlertDialogAction className=\"bg-warning hover:bg-warning-strong\">\n                Yes, Create Anyway\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n      </AlertDescription>\n    </Alert>\n  );\n}\n","/**\n * Naming Convention Help Component\n *\n * Provides collapsible helper text with naming tips and examples\n * for opportunity names. Shows best practices and patterns.\n */\n\nimport * as React from \"react\";\nimport { ChevronDown, ChevronUp, Lightbulb } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\n\nexport const NamingConventionHelp: React.FC = () => {\n  const [isOpen, setIsOpen] = React.useState(false);\n\n  return (\n    <Collapsible open={isOpen} onOpenChange={setIsOpen}>\n      <CollapsibleTrigger asChild>\n        <Button\n          type=\"button\"\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"flex items-center gap-2 text-xs text-muted-foreground hover:text-foreground px-0\"\n        >\n          <Lightbulb className=\"w-3 h-3\" />\n          {isOpen ? \"Hide naming tips\" : \"Show naming tips\"}\n          {isOpen ? <ChevronUp className=\"w-3 h-3\" /> : <ChevronDown className=\"w-3 h-3\" />}\n        </Button>\n      </CollapsibleTrigger>\n      <CollapsibleContent className=\"mt-2\">\n        <div className=\"rounded-lg border border-border bg-muted/50 p-4 space-y-3 text-sm\">\n          <div>\n            <p className=\"font-medium text-foreground mb-2\">ðŸ’¡ Naming Convention Tips</p>\n            <p className=\"text-muted-foreground leading-relaxed\">\n              Opportunity names help you quickly identify deals at a glance. Use the auto-generate\n              button to create names following the standard format, or customize them for specific\n              situations.\n            </p>\n          </div>\n\n          <div>\n            <p className=\"font-medium text-foreground mb-1\">Standard Format (Auto-Generated):</p>\n            <ul className=\"list-disc list-inside space-y-1 text-muted-foreground ml-2\">\n              <li>\n                <code className=\"bg-background px-1.5 py-0.5 rounded text-xs\">\n                  Customer Name - Principal Name - Q1 2025\n                </code>\n              </li>\n              <li className=\"text-xs italic\">Example: \"Nobu Miami - Ocean Hugger - Q1 2025\"</li>\n            </ul>\n          </div>\n\n          <div>\n            <p className=\"font-medium text-foreground mb-1\">Custom Name Examples:</p>\n            <ul className=\"list-disc list-inside space-y-1 text-muted-foreground ml-2\">\n              <li className=\"text-xs\">\n                <strong className=\"text-foreground\">Program Name:</strong> \"Roka Akor - Tuna Roll\n                Program\"\n              </li>\n              <li className=\"text-xs\">\n                <strong className=\"text-foreground\">Trade Show Booth:</strong> \"NRA Show 2025 - Blue\n                Ribbon Sushi - Ocean Hugger\"\n              </li>\n              <li className=\"text-xs\">\n                <strong className=\"text-foreground\">Specific Product:</strong> \"Nobu - Tombo Tuna\n                Nigiri Launch\"\n              </li>\n              <li className=\"text-xs\">\n                <strong className=\"text-foreground\">Account Expansion:</strong> \"Katsuya -\n                Fishpeople - West Coast Rollout\"\n              </li>\n            </ul>\n          </div>\n\n          <div className=\"pt-2 border-t border-border\">\n            <p className=\"text-xs text-muted-foreground\">\n              <strong className=\"text-foreground\">Tip:</strong> Keep names concise (under 100\n              characters) and include the customer and principal for easy filtering and reporting.\n            </p>\n          </div>\n        </div>\n      </CollapsibleContent>\n    </Collapsible>\n  );\n};\n","/**\n * Default segment ID for new organizations created inline.\n * References the \"General\" segment in the database.\n * TODO: Consider moving to environment variable if varies by environment.\n */\nexport const DEFAULT_SEGMENT_ID = \"562062be-c15b-417f-b2a1-d4a643d69d52\";\n","import { useMemo } from \"react\";\nimport { TextInput } from \"@/components/admin/text-input\";\nimport { ReferenceInput } from \"@/components/admin/reference-input\";\nimport { ReferenceArrayInput } from \"@/components/admin/reference-array-input\";\nimport { AutocompleteArrayInput } from \"@/components/admin/autocomplete-array-input\";\nimport { SelectInput } from \"@/components/admin/select-input\";\nimport { ArrayInput } from \"@/components/admin/array-input\";\nimport { SimpleFormIterator } from \"@/components/admin/simple-form-iterator\";\nimport {\n  CompactFormRow,\n  CollapsibleSection,\n  CompactFormFieldWithButton,\n} from \"@/components/admin/form\";\nimport { CreateInDialogButton } from \"@/components/admin/create-in-dialog-button\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { RefreshCw } from \"lucide-react\";\nimport { useWatch, useFormContext } from \"react-hook-form\";\nimport { useGetIdentity } from \"ra-core\";\nimport { AutocompleteOrganizationInput } from \"../../organizations/AutocompleteOrganizationInput\";\nimport { OrganizationInputs } from \"../../organizations/OrganizationInputs\";\nimport { ContactInputs } from \"../../contacts/ContactInputs\";\nimport { contactOptionText } from \"../../contacts/ContactOption\";\nimport { ContactOrgMismatchWarning } from \"../components/ContactOrgMismatchWarning\";\nimport { DistributorAuthorizationWarning } from \"../components/DistributorAuthorizationWarning\";\nimport { NamingConventionHelp } from \"./NamingConventionHelp\";\nimport { useAutoGenerateName } from \"../hooks/useAutoGenerateName\";\nimport { OPPORTUNITY_STAGE_CHOICES } from \"../constants/stageConstants\";\nimport { DEFAULT_SEGMENT_ID } from \"../../constants\";\nimport { organizationSchema } from \"../../validation/organizations\";\nimport { contactBaseSchema } from \"../../validation/contacts\";\nimport { saleOptionRenderer } from \"../../utils/saleOptionRenderer\";\n\nconst priorityChoices = [\n  { id: \"low\", name: \"Low\" },\n  { id: \"medium\", name: \"Medium\" },\n  { id: \"high\", name: \"High\" },\n  { id: \"critical\", name: \"Critical\" },\n];\n\nconst organizationDefaults = organizationSchema.partial().parse({});\nconst contactDefaults = contactBaseSchema.partial().parse({});\n\ninterface OpportunityCompactFormProps {\n  mode?: \"create\" | \"edit\";\n}\n\nexport const OpportunityCompactForm = ({ mode = \"create\" }: OpportunityCompactFormProps) => {\n  const { data: identity } = useGetIdentity();\n  const { setValue, getValues } = useFormContext();\n  const { regenerate, isLoading, canGenerate } = useAutoGenerateName(mode);\n\n  const customerOrganizationId = useWatch({ name: \"customer_organization_id\" });\n  const principalOrganizationId = useWatch({ name: \"principal_organization_id\" });\n\n  const contactFilter = useMemo(\n    () => (customerOrganizationId ? { organization_id: customerOrganizationId } : {}),\n    [customerOrganizationId]\n  );\n\n  const productFilter = useMemo(\n    () => (principalOrganizationId ? { principal_id: principalOrganizationId } : {}),\n    [principalOrganizationId]\n  );\n  return (\n    <div className=\"space-y-4\">\n      {/* Row 1: Name (full width) with regenerate button in edit mode */}\n      <div className=\"relative\">\n        <div data-tutorial=\"opp-name\">\n          <TextInput\n            source=\"name\"\n            label=\"Opportunity Name *\"\n            helperText={false}\n            InputProps={\n              mode === \"edit\"\n                ? {\n                    endAdornment: (\n                      <TooltipProvider>\n                        <Tooltip>\n                          <TooltipTrigger asChild>\n                            <Button\n                              type=\"button\"\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={regenerate}\n                              disabled={!canGenerate || isLoading}\n                            >\n                              <RefreshCw className=\"w-4 h-4\" />\n                            </Button>\n                          </TooltipTrigger>\n                          <TooltipContent>\n                            <p>Generate name from customer and principal</p>\n                          </TooltipContent>\n                        </Tooltip>\n                      </TooltipProvider>\n                    ),\n                  }\n                : undefined\n            }\n          />\n        </div>\n        <div className=\"mt-2\">\n          <NamingConventionHelp />\n        </div>\n      </div>\n\n      {/* Row 2: Customer | Principal with inline create buttons */}\n      <CompactFormRow>\n        <CompactFormFieldWithButton\n          button={\n            <CreateInDialogButton\n              resource=\"organizations\"\n              label=\"New Customer\"\n              title=\"Create new Customer Organization\"\n              description=\"Create a new customer organization and select it automatically\"\n              defaultValues={{\n                ...organizationDefaults,\n                organization_type: \"prospect\",\n                sales_id: identity?.id,\n                segment_id: DEFAULT_SEGMENT_ID,\n              }}\n              onSave={(record) => {\n                setValue(\"customer_organization_id\", record.id);\n              }}\n              transform={(values) => {\n                if (values.website && !values.website.startsWith(\"http\")) {\n                  values.website = `https://${values.website}`;\n                }\n                return values;\n              }}\n            >\n              <OrganizationInputs />\n            </CreateInDialogButton>\n          }\n        >\n          <div data-tutorial=\"opp-customer\">\n            <ReferenceInput\n              source=\"customer_organization_id\"\n              reference=\"organizations\"\n              filter={{ \"organization_type@in\": \"(prospect,customer)\" }}\n            >\n              <AutocompleteOrganizationInput\n                label=\"Customer Organization *\"\n                organizationType=\"customer\"\n              />\n            </ReferenceInput>\n          </div>\n        </CompactFormFieldWithButton>\n        <CompactFormFieldWithButton\n          button={\n            <CreateInDialogButton\n              resource=\"organizations\"\n              label=\"New Principal\"\n              title=\"Create new Principal Organization\"\n              description=\"Create a new principal organization and select it automatically\"\n              defaultValues={{\n                ...organizationDefaults,\n                organization_type: \"principal\",\n                sales_id: identity?.id,\n                segment_id: DEFAULT_SEGMENT_ID,\n              }}\n              onSave={(record) => {\n                setValue(\"principal_organization_id\", record.id);\n              }}\n              transform={(values) => {\n                if (values.website && !values.website.startsWith(\"http\")) {\n                  values.website = `https://${values.website}`;\n                }\n                return values;\n              }}\n            >\n              <OrganizationInputs />\n            </CreateInDialogButton>\n          }\n        >\n          <div data-tutorial=\"opp-principal\">\n            <ReferenceInput\n              source=\"principal_organization_id\"\n              reference=\"organizations\"\n              filter={{ organization_type: \"principal\" }}\n            >\n              <AutocompleteOrganizationInput\n                label=\"Principal Organization *\"\n                organizationType=\"principal\"\n              />\n            </ReferenceInput>\n          </div>\n        </CompactFormFieldWithButton>\n      </CompactFormRow>\n\n      {/* Row 3: Stage | Priority | Close Date */}\n      <CompactFormRow columns=\"md:grid-cols-3\">\n        <div data-tutorial=\"opp-stage\">\n          <SelectInput\n            source=\"stage\"\n            label=\"Stage *\"\n            choices={OPPORTUNITY_STAGE_CHOICES}\n            helperText={false}\n          />\n        </div>\n        <div data-tutorial=\"opp-priority\">\n          <SelectInput\n            source=\"priority\"\n            label=\"Priority *\"\n            choices={priorityChoices}\n            helperText={false}\n          />\n        </div>\n        <div data-tutorial=\"opp-close-date\">\n          <TextInput\n            source=\"estimated_close_date\"\n            label=\"Est. Close Date *\"\n            helperText={false}\n            type=\"date\"\n          />\n        </div>\n      </CompactFormRow>\n\n      {/* Row 4: Account Manager | Distributor with inline create button */}\n      <CompactFormRow>\n        <CompactFormFieldWithButton>\n          {/* No button prop = auto placeholder for alignment */}\n          <div data-tutorial=\"opp-account-manager\">\n            <ReferenceInput\n              source=\"account_manager_id\"\n              reference=\"sales\"\n              sort={{ field: \"last_name\", order: \"ASC\" }}\n              filter={{ \"disabled@neq\": true }}\n            >\n              <SelectInput\n                label=\"Account Manager\"\n                optionText={saleOptionRenderer}\n                helperText={false}\n              />\n            </ReferenceInput>\n          </div>\n        </CompactFormFieldWithButton>\n        <CompactFormFieldWithButton\n          button={\n            <CreateInDialogButton\n              resource=\"organizations\"\n              label=\"New Distributor\"\n              title=\"Create new Distributor Organization\"\n              description=\"Create a new distributor organization and select it automatically\"\n              defaultValues={{\n                ...organizationDefaults,\n                organization_type: \"distributor\",\n                sales_id: identity?.id,\n                segment_id: DEFAULT_SEGMENT_ID,\n              }}\n              onSave={(record) => {\n                setValue(\"distributor_organization_id\", record.id);\n              }}\n              transform={(values) => {\n                if (values.website && !values.website.startsWith(\"http\")) {\n                  values.website = `https://${values.website}`;\n                }\n                return values;\n              }}\n            >\n              <OrganizationInputs />\n            </CreateInDialogButton>\n          }\n          footer={<DistributorAuthorizationWarning />}\n        >\n          <div data-tutorial=\"opp-distributor\">\n            <ReferenceInput\n              source=\"distributor_organization_id\"\n              reference=\"organizations\"\n              filter={{ organization_type: \"distributor\" }}\n            >\n              <AutocompleteOrganizationInput\n                label=\"Distributor Organization\"\n                organizationType=\"distributor\"\n              />\n            </ReferenceInput>\n          </div>\n        </CompactFormFieldWithButton>\n      </CompactFormRow>\n\n      {/* Collapsible: Contacts & Products (always open - contains required fields) */}\n      <CollapsibleSection title=\"Contacts & Products\" defaultOpen>\n        <div className=\"space-y-4\">\n          {/* Contacts */}\n          <div>\n            <div className=\"flex justify-between items-start mb-2\">\n              <div>\n                <h4 className=\"text-sm font-medium\">Contacts *</h4>\n                <p className=\"text-xs text-muted-foreground\">\n                  {customerOrganizationId\n                    ? \"At least one contact is required\"\n                    : \"Please select a Customer Organization first\"}\n                </p>\n              </div>\n              {customerOrganizationId && (\n                <CreateInDialogButton\n                  resource=\"contacts\"\n                  label=\"New Contact\"\n                  title=\"Create new Contact\"\n                  description=\"Create a new contact for the selected customer organization\"\n                  defaultValues={{\n                    ...contactDefaults,\n                    organization_id: customerOrganizationId,\n                    sales_id: identity?.id,\n                    first_seen: new Date().toISOString(),\n                    last_seen: new Date().toISOString(),\n                  }}\n                  onSave={(record) => {\n                    const currentContacts = getValues(\"contact_ids\") || [];\n                    setValue(\"contact_ids\", [...currentContacts, record.id]);\n                  }}\n                >\n                  <ContactInputs />\n                </CreateInDialogButton>\n              )}\n            </div>\n            <div data-tutorial=\"opp-contacts\">\n              {customerOrganizationId ? (\n                <ReferenceArrayInput\n                  source=\"contact_ids\"\n                  reference=\"contacts_summary\"\n                  filter={contactFilter}\n                >\n                  <AutocompleteArrayInput\n                    label={false}\n                    optionText={contactOptionText}\n                    helperText={false}\n                  />\n                </ReferenceArrayInput>\n              ) : (\n                <AutocompleteArrayInput\n                  source=\"contact_ids\"\n                  label={false}\n                  optionText={contactOptionText}\n                  helperText={false}\n                  disabled\n                  placeholder=\"Select Customer Organization first\"\n                  choices={[]}\n                />\n              )}\n            </div>\n            <ContactOrgMismatchWarning />\n          </div>\n\n          {/* Products */}\n          <div>\n            <div className=\"mb-2\">\n              <h4 className=\"text-sm font-medium\">Products *</h4>\n              <p className=\"text-xs text-muted-foreground\">\n                {principalOrganizationId\n                  ? \"At least one product is required (filtered by selected Principal)\"\n                  : \"At least one product is required (select Principal Organization to filter)\"}\n              </p>\n            </div>\n            <div data-tutorial=\"opp-products\">\n              <ArrayInput source=\"products_to_sync\" label={false}>\n                <SimpleFormIterator inline disableReordering>\n                  <ReferenceInput\n                    source=\"product_id_reference\"\n                    reference=\"products\"\n                    filter={productFilter}\n                  >\n                    <SelectInput\n                      optionText=\"name\"\n                      label=\"Product\"\n                      helperText={false}\n                      className=\"w-full\"\n                    />\n                  </ReferenceInput>\n                  <TextInput\n                    source=\"notes\"\n                    label=\"Notes\"\n                    helperText={false}\n                    placeholder=\"Optional notes\"\n                    className=\"w-full\"\n                  />\n                </SimpleFormIterator>\n              </ArrayInput>\n            </div>\n          </div>\n        </div>\n      </CollapsibleSection>\n\n      {/* Collapsible: Classification */}\n      <CollapsibleSection title=\"Classification\" data-tutorial=\"opp-section-classification\">\n        <div className=\"space-y-4\">\n          <CompactFormRow>\n            <div data-tutorial=\"opp-lead-source\">\n              <TextInput source=\"lead_source\" label=\"Lead Source\" helperText={false} />\n            </div>\n            <div data-tutorial=\"opp-campaign\">\n              <TextInput\n                source=\"campaign\"\n                label=\"Campaign\"\n                helperText={false}\n                placeholder=\"e.g., Q4 2025 Trade Show\"\n              />\n            </div>\n          </CompactFormRow>\n          <ArrayInput source=\"tags\" label=\"Tags\">\n            <SimpleFormIterator inline disableReordering>\n              <TextInput source=\"\" label={false} helperText={false} placeholder=\"Add tag\" />\n            </SimpleFormIterator>\n          </ArrayInput>\n        </div>\n      </CollapsibleSection>\n\n      {/* Collapsible: Additional Details */}\n      <CollapsibleSection title=\"Additional Details\" data-tutorial=\"opp-section-details\">\n        <div className=\"space-y-4\">\n          <div data-tutorial=\"opp-description\">\n            <TextInput\n              source=\"description\"\n              label=\"Description\"\n              multiline\n              rows={2}\n              helperText={false}\n            />\n          </div>\n          <CompactFormRow>\n            <div data-tutorial=\"opp-next-action\">\n              <TextInput\n                source=\"next_action\"\n                label=\"Next Action\"\n                helperText={false}\n                placeholder=\"e.g., Follow up with decision maker\"\n              />\n            </div>\n            <div data-tutorial=\"opp-next-action-date\">\n              <TextInput\n                source=\"next_action_date\"\n                label=\"Next Action Date\"\n                helperText={false}\n                type=\"date\"\n              />\n            </div>\n          </CompactFormRow>\n          <TextInput\n            source=\"decision_criteria\"\n            label=\"Decision Criteria\"\n            multiline\n            rows={2}\n            helperText={false}\n            placeholder=\"Key factors influencing the decision...\"\n          />\n          {mode === \"edit\" && (\n            <ReferenceInput source=\"related_opportunity_id\" reference=\"opportunities\">\n              <SelectInput optionText=\"name\" label=\"Related Opportunity\" helperText={false} />\n            </ReferenceInput>\n          )}\n          <TextInput\n            source=\"notes\"\n            label=\"Notes\"\n            multiline\n            rows={2}\n            helperText={false}\n            placeholder=\"General notes about the opportunity (separate from activity log)...\"\n          />\n        </div>\n      </CollapsibleSection>\n    </div>\n  );\n};\n"],"names":["ButtonPlaceholder","__name","className","jsx","cn","CompactFormFieldWithButton","children","button","footer","jsxs","getQuarter","date","month","getMonth","Math","floor","generateOpportunityName","params","customerName","principalName","Date","parts","trimmedCustomer","trim","push","trimmedPrincipal","length","quarter","year","getFullYear","name","join","substring","useAutoGenerateName","mode","setValue","useFormContext","customerOrgId","useWatch","principalOrgId","currentName","data","customerOrg","isLoading","isLoadingCustomer","useGetOne","id","enabled","principalOrg","isLoadingPrincipal","canGenerate","generateName","useCallback","regenerate","newName","shouldValidate","shouldDirty","useEffect","useContactOrgMismatch","contactIds","customerOrganizationId","stableIds","useMemo","filter","JSON","stringify","contacts","useGetMany","ids","mismatchedContacts","hasMismatch","mismatched","contact","contactOrgId","organization_id","String","map","useDistributorAuthorization","principalId","distributorId","hasBothSelected","authorizations","isLoadingAuth","useGetList","principal_id","distributor_id","deleted_at","pagination","page","perPage","distributor","isLoadingDistributor","principal","isAuthorized","hasAuthorizationRecord","isExpired","authorization","distributorName","today","toISOString","split","expiration_date","is_authorized","CreateInDialogButton","resource","defaultValues","label","onSave","transform","title","description","variant","size","open","setOpen","useState","notify","useNotify","refresh","useRefresh","handleSuccess","createdRecord","type","Dialog","onOpenChange","DialogTrigger","asChild","Button","Plus","DialogContent","DialogHeader","DialogTitle","DialogDescription","CreateBase","redirect","mutationOptions","onSuccess","onError","Form","Card","CardContent","FormToolbar","onClick","SaveButton","ContactOrgMismatchWarning","onClearMismatched","getValues","mismatchedNames","m","first_name","last_name","Boolean","handleClearMismatched","currentContacts","mismatchedIds","Set","validContacts","has","Alert","AlertTriangle","AlertTitle","AlertDescription","Fragment","slice","AlertDialog","AlertDialogTrigger","AlertDialogContent","AlertDialogHeader","AlertDialogTitle","AlertDialogDescription","idx","AlertDialogFooter","AlertDialogCancel","AlertDialogAction","DistributorAuthorizationWarning","content","icon","Clock","message","dialogTitle","dialogDescription","FileWarning","getWarningContent","NamingConventionHelp","isOpen","setIsOpen","React.useState","Collapsible","CollapsibleTrigger","Lightbulb","ChevronUp","ChevronDown","CollapsibleContent","DEFAULT_SEGMENT_ID","priorityChoices","organizationDefaults","organizationSchema","partial","parse","contactDefaults","contactBaseSchema","OpportunityCompactForm","identity","useGetIdentity","principalOrganizationId","contactFilter","productFilter","TextInput","source","helperText","InputProps","endAdornment","TooltipProvider","Tooltip","TooltipTrigger","disabled","RefreshCw","TooltipContent","CompactFormRow","organization_type","sales_id","segment_id","record","values","website","startsWith","OrganizationInputs","ReferenceInput","reference","AutocompleteOrganizationInput","organizationType","columns","SelectInput","choices","OPPORTUNITY_STAGE_CHOICES","sort","field","order","optionText","saleOptionRenderer","CollapsibleSection","defaultOpen","first_seen","last_seen","ContactInputs","ReferenceArrayInput","AutocompleteArrayInput","contactOptionText","placeholder","ArrayInput","SimpleFormIterator","inline","disableReordering","multiline","rows"],"mappings":"0rCAcO,MAAMA,GAAoBC,EAAA,EAAGC,eAEhCC,EAAAA,IAAC,MAAA,CACCD,UAAWE,EACT,mBACA,YACAF,GAEF,cAAY,SARe,qBCKpBG,GAA6BJ,EAAA,EACxCK,WACAC,SACAL,YACAM,mBAGG,MAAA,CAAIN,UAAWE,EAAG,gBAAiBF,GAClCI,SAAA,GAAAG,KAAC,MAAA,CAAIP,UAAU,4CACbI,SAAA,GAAAH,IAAC,MAAA,CAAID,UAAU,UAAWI,aACzBC,SAAWP,GAAA,CAAA,MAEbQ,KAZmC,8BCKnC,SAASE,GAAWC,GACzB,MAAMC,EAAQD,EAAKE,WACnB,OAAOC,KAAKC,MAAMH,EAAQ,GAAK,CACjC,CAQO,SAASI,GAAwBC,GACtC,MAAMC,aAAEA,EAAAC,cAAcA,EAAAR,KAAeA,EAAO,IAAIS,MAAWH,EAErDI,EAAkB,GAGlBC,EAAkBJ,GAAcK,OAClCD,GACFD,EAAMG,KAAKF,GAIb,MAAMG,EAAmBN,GAAeI,OAMxC,GALIE,GACFJ,EAAMG,KAAKC,GAIQ,IAAjBJ,EAAMK,OACR,MAAO,GAIT,MAAMC,EAAUjB,GAAWC,GACrBiB,EAAOjB,EAAKkB,cAClBR,EAAMG,KAAK,IAAIG,KAAWC,KAG1B,IAAIE,EAAOT,EAAMU,KAAK,OAOtB,OAJID,EAAKJ,OAAS,MAChBI,EAAOA,EAAKE,UAAU,EAAG,KAAO,OAG3BF,CACT,CA/CgB7B,EAAAS,GAAA,cAWAT,EAAAe,GAAA,2BCpBT,MAAMiB,KAAuBC,IAClC,MAAMC,SAAEA,GAAaC,IAGfC,EAAgBC,EAAS,CAAER,KAAM,6BACjCS,EAAiBD,EAAS,CAAER,KAAM,8BAClCU,EAAcF,EAAS,CAAER,KAAM,UAG7BW,KAAMC,EAAaC,UAAWC,GAAsBC,EAC1D,gBACA,CAAEC,GAAIT,GACN,CAAEU,UAAWV,KAIPI,KAAMO,EAAcL,UAAWM,GAAuBJ,EAC5D,gBACA,CAAEC,GAAIP,GACN,CAAEQ,UAAWR,IAGTI,EAAYC,GAAqBK,EAGjCC,KAAiBR,GAAaZ,OAAQkB,GAAclB,MAMpDqB,EAAeC,EAAAA,YAAY,IACxBpC,GAAwB,CAC7BE,aAAcwB,GAAaZ,KAC3BX,cAAe6B,GAAclB,KAC7BnB,SAAUS,OAEX,CAACsB,GAAaZ,KAAMkB,GAAclB,OAK/BuB,EAAaD,EAAAA,YAAY,KAC7B,IAAKT,EAAW,CACd,MAAMW,EAAUH,IACZG,GACFnB,EAAS,OAAQmB,EAAS,CACxBC,gBAAgB,EAChBC,aAAa,GAGnB,GACC,CAACL,EAAchB,EAAUQ,IAiB5B,OAZAc,EAAAA,UAAU,KACR,GAAa,WAATvB,IAAsBM,IAAgBG,EAAW,CACnD,MAAMW,EAAUH,IACZG,GACFnB,EAAS,OAAQmB,EAAS,CACxBC,gBAAgB,EAChBC,aAAa,GAGnB,GACC,CAACtB,EAAMM,EAAaW,EAAchB,EAAUQ,IAExC,CAAEU,aAAYV,YAAWO,gBArEC,uBCwB5B,SAASQ,GACdC,EACAC,GAGA,MAAMC,EAAYC,EAAAA,QAChB,IAAMH,EAAWI,OAAQjB,GAA+B,MAANA,GAElD,CAACkB,KAAKC,UAAUN,MAIVlB,KAAMyB,EAAAvB,UAAUA,GAAcwB,EACpC,WACA,CAAEC,IAAKP,GACP,CAAEd,QAASc,EAAUnC,OAAS,GAA+B,MAA1BkC,IAgCrC,OA5BeE,EAAAA,QAAQ,KACrB,IAAKI,IAAaN,EAChB,MAAO,CACLS,mBAAoB,GACpBC,aAAa,EACb3B,aAIJ,MAAM4B,EAAkCL,EACrCH,OAAQS,IAGP,MAAMC,EAAeD,EAAQE,gBAC7B,OAAuB,MAAhBD,GAAwBE,OAAOF,KAAkBE,OAAOf,KAEhEgB,IAAKJ,IAAA,CACJA,UACAC,aAAcD,EAAQE,mBAG1B,MAAO,CACLL,mBAAoBE,EACpBD,YAAaC,EAAW7C,OAAS,EACjCiB,cAED,CAACuB,EAAUN,EAAwBjB,GAGxC,CCxBO,SAASkC,GACdC,EACAC,GAGA,MAAMC,EAAiC,MAAfF,GAAwC,MAAjBC,GAGvCtC,KAAMwC,EAAgBtC,UAAWuC,GACvCC,EACE,uCACA,CACEpB,OAAQ,CACNqB,aAAcN,EACdO,eAAgBN,EAChBO,WAAY,MAEdC,WAAY,CAAEC,KAAM,EAAGC,QAAS,IAElC,CAAE1C,QAASiC,KAIPvC,KAAMiD,EAAa/C,UAAWgD,GAAyB9C,EAC7D,gBACA,CAAEC,GAAIiC,GACN,CAAEhC,QAA0B,MAAjBgC,KAILtC,KAAMmD,EAAWjD,UAAWM,GAAuBJ,EACzD,gBACA,CAAEC,GAAIgC,GACN,CAAE/B,QAAwB,MAAf+B,IA0Db,OAtDehB,EAAAA,QAAQ,KAErB,IAAKkB,EACH,MAAO,CACLa,cAAc,EACdC,wBAAwB,EACxBC,WAAW,EACXC,cAAe,KACfhB,iBAAiB,EACjBrC,WAAW,EACXsD,gBAAiBP,GAAa5D,KAC9BX,cAAeyE,GAAW9D,MAI9B,MAAMa,EAAYuC,GAAiBS,GAAwB1C,EAGrD+C,EAAgBf,IAAiB,IAAM,KACvCa,EAA0C,MAAjBE,EAGzBE,GAAA,IAAY9E,MAAO+E,cAAcC,MAAM,KAAK,GAC5CL,EACJD,GACiC,MAAjCE,EAAcK,iBACdL,EAAcK,gBAAkBH,EAQlC,MAAO,CACLL,aAHmBC,GAA0BE,EAAcM,gBAAkBP,EAI7ED,yBACAC,YACAC,gBACAhB,kBACArC,YACAsD,gBAAiBP,GAAa5D,KAC9BX,cAAeyE,GAAW9D,OAE3B,CACDmD,EACAS,GAAa5D,KACb8D,GAAW9D,KACXkD,EACAE,EACAS,EACA1C,GAIJ,CDpHgBhD,EAAAyD,GAAA,yBCwBAzD,EAAA4E,GAAA,+BCjCT,MAAM0B,GAAuBtG,EAAA,EAClCuG,WACAlG,WACAmG,gBAAgB,CAAA,EAChBC,QAAQ,MACRC,SACAC,YACAC,QAAQ,cAAcL,IACtBM,cACAC,UAAU,UACVC,OAAO,KACP9G,gBAEA,MAAO+G,EAAMC,GAAWC,EAAAA,UAAS,GAC3BC,EAASC,IACTC,EAAUC,IAIVC,IAAiBC,IAErBP,GAAQ,GAGRE,EAAO,GAAGZ,yBAAiC,CAAEkB,KAAM,YAGnDJ,IAGIX,GAAUc,GACZd,EAAOc,IAZW,iBAgBtB,SACEhH,KAACkH,EAAA,CAAOV,OAAYW,aAAcV,EAChC5G,SAAA,CAAAH,EAAAA,IAAC0H,GAAcC,SAAO,EACpBxH,gBAACyH,EAAA,CAAOhB,UAAkBC,OAAY9G,YACpCI,SAAA,GAAAH,IAAC6H,EAAA,CAAK9H,UAAU,iBACfwG,SAGLjG,KAACwH,EAAA,CAAc/H,UAAU,yCACvBI,SAAA,CAAAG,OAACyH,EAAA,CACC5H,SAAA,GAAAH,IAACgI,GAAa7H,SAAAuG,IACbC,GAAe3G,EAAAA,IAACiI,EAAA,CAAmB9H,SAAAwG,OAEtC3G,EAAAA,IAACkI,EAAA,CACC7B,WACA8B,UAAU,EACV1B,YACA2B,gBAAiB,CACfC,UAAWhB,EACXiB,QAASxI,EAAA,KACPmH,EAAO,kBAAkBZ,IAAY,CAAEkB,KAAM,WADtC,YAKXpH,WAAAH,IAACuI,EAAA,CAAKjC,gBACJnG,WAAAH,IAACwI,EAAA,CAAKzI,UAAU,uBACdI,SAAAG,OAACmI,EAAA,CAAY1I,UAAU,WACpBI,SAAA,CAAAA,EACDH,MAAC0I,EAAA,CACCvI,SAAAG,EAAAA,KAAC,MAAA,CAAIP,UAAU,kCACbI,SAAA,GAAAH,IAAC4H,EAAA,CAAOL,KAAK,SAASX,QAAQ,UAAU+B,QAAS7I,EAAA,IAAMiH,GAAQ,GAAd,WAAsB5G,SAAA,aAGvEH,IAAC4I,EAAA,CAAWrC,MAAM,gCApEF,wBCS7B,SAASsC,IAA0BC,kBAAEA,IAC1C,MAAM9G,SAAEA,EAAA+G,UAAUA,GAAc9G,IAG1BuB,EAAarB,EAAS,CAAER,KAAM,gBAC9BO,EAAgBC,EAAS,CAAER,KAAM,8BAGjCuC,mBAAEA,EAAAC,YAAoBA,EAAA3B,UAAaA,GAAce,GACrDC,GAAc,GACdtB,IAIMI,KAAMC,GAAgBG,EAC5B,gBACA,CAAEC,GAAIT,GACN,CAAEU,UAAWV,IAIf,IAAKiC,GAAe3B,EAClB,OAAO,KAIT,MAAMwG,EAAkB9E,EACrBO,IAAKwE,GAAM,GAAGA,EAAE5E,QAAQ6E,cAAcD,EAAE5E,QAAQ8E,YAAY/H,QAC5DwC,OAAOwF,SAEJC,EAAwBvJ,EAAA,KAC5B,MAAMwJ,EAAmBP,EAAU,gBAAkB,GAC/CQ,EAAgB,IAAIC,IAAItF,EAAmBO,IAAKwE,GAAMzE,OAAOyE,EAAE5E,QAAQ1B,MACvE8G,EAAgBH,EAAgB1F,OAAQjB,IAAQ4G,EAAcG,IAAIlF,OAAO7B,KAC/EX,EAAS,cAAeyH,GACxBX,OAL4B,yBAQ9B,SACExI,KAACqJ,GAAA,CAAM5J,UAAU,2CACfI,SAAA,GAAAH,IAAC4J,EAAA,CAAc7J,UAAU,yBACzBC,EAAAA,IAAC6J,GAAA,CAAW9J,UAAU,sBAAsBI,SAAA,oCAC5CG,KAACwJ,GAAA,CAAiB/J,UAAU,eAC1BI,SAAA,CAAAH,EAAAA,IAAC,KAAED,UAAU,OACVI,SAA8B,IAA9B+D,EAAmB3C,OAClBjB,EAAAA,KAAAyJ,EAAAA,SAAA,CACE5J,SAAA,CAAAH,EAAAA,IAAC,SAAA,CAAQG,SAAA6I,EAAgB,KAAY,kEAEpCzG,GAAaZ,MACZrB,EAAAA,KAAAyJ,EAAAA,SAAA,CACG5J,SAAA,CAAA,IAAI,MACJH,IAAC,SAAA,CAAQG,SAAAoC,EAAYZ,OAAc,OAEtC,OAIJrB,EAAAA,KAAAyJ,EAAAA,SAAA,CACE5J,SAAA,CAAAG,OAAC,SAAA,CAAQH,SAAA,CAAA+D,EAAmB3C,OAAO,eAAkB,KACpDyH,EAAgBgB,MAAM,EAAG,GAAGpI,KAAK,MACjCoH,EAAgBzH,OAAS,GAAK,MAAMyH,EAAgBzH,OAAS,SAAS,iEAEtEgB,GAAaZ,MACZrB,EAAAA,KAAAyJ,EAAAA,SAAA,CACG5J,SAAA,CAAA,IAAI,MACJH,IAAC,SAAA,CAAQG,SAAAoC,EAAYZ,OAAc,OAEtC,WAMRrB,KAAC,MAAA,CAAIP,UAAU,kBACbI,SAAA,CAAAG,OAAC2J,GAAA,CACC9J,SAAA,GAAAH,IAACkK,GAAA,CAAmBvC,SAAO,EACzBxH,SAAAH,EAAAA,IAAC4H,EAAA,CACChB,QAAQ,UACRC,KAAK,KACL9G,UAAU,sDACXI,SAAA,yBAIFgK,GAAA,CACChK,SAAA,CAAAG,OAAC8J,GAAA,CACCjK,SAAA,GAAAH,IAACqK,IAAiBlK,SAAA,qCACjBmK,GAAA,CACCnK,SAAA,CAAAH,EAAAA,IAAC,IAAA,CAAED,UAAU,OAAOI,SAAA,8FAIpBH,EAAAA,IAAC,KAAA,CAAGD,UAAU,6CACXI,WAAgBsE,IAAI,CAAC9C,EAAM4I,IAC1BvK,EAAAA,IAAC,KAAA,CAAcG,SAAAwB,GAAN4I,QAGbvK,IAAC,KAAEG,SAAA,mIAMNqK,GAAA,CACCrK,SAAA,GAAAH,IAACyK,IAAkBtK,SAAA,YACnBH,EAAAA,IAAC0K,GAAA,CAAkB3K,UAAU,qCAAqCI,SAAA,sCAOxEH,EAAAA,IAAC4H,GAAOhB,QAAQ,cAAcC,KAAK,KAAK8B,QAASU,EAAuBlJ,SAAA,8BAOlF,CC3HO,SAASwK,KAEd,MAAMhG,EAAcxC,EAAS,CAAER,KAAM,8BAC/BiD,EAAgBzC,EAAS,CAAER,KAAM,iCAGjC+D,aACJA,EAAAC,uBACAA,EAAAC,UACAA,EAAAf,gBACAA,EAAArC,UACAA,EAAAsD,gBACAA,EAAA9E,cACAA,GACE0D,GAA4BC,EAAaC,GAM7C,IAAKC,GAAmBrC,GAAakD,EACnC,OAAO,KAIT,MAiEMkF,EAjEoB9K,EAAA,IACpB8F,EACK,CACLiF,KAAM7K,EAAAA,IAAC8K,EAAA,CAAM/K,UAAU,yBACvB2G,MAAO,wBACPqE,QACEzK,EAAAA,KAAAyJ,WAAA,CACE5J,SAAA,GAAAH,IAAC,SAAA,CAAQG,YAAmB,qBAA4B,4BAA+B,MACvFH,IAAC,SAAA,CAAQG,SAAAa,GAAiB,mBAA0B,8BAGxDgK,YAAa,sCACbC,kBACE3K,EAAAA,KAAAyJ,WAAA,CAAE5J,SAAA,CAAA,2BACsBH,IAAC,UAAQG,SAAA2F,IAAyB,iBAAe,MACvE9F,IAAC,UAAQG,SAAAa,IAAuB,2IAOpC2E,EAEK,CACLkF,KAAM7K,EAAAA,IAACkL,EAAA,CAAYnL,UAAU,yBAC7B2G,MAAO,yBACPqE,QACEzK,EAAAA,KAAAyJ,WAAA,CACE5J,SAAA,GAAAH,IAAC,SAAA,CAAQG,YAAmB,qBAA4B,+CAC7CH,IAAC,SAAA,CAAQG,SAAAa,GAAiB,mBAA0B,kBAGnEgK,YAAa,uCACbC,kBACE3K,EAAAA,KAAAyJ,WAAA,CACE5J,SAAA,GAAAH,IAAC,UAAQG,SAAA2F,IAAyB,mCAAiC,MACnE9F,IAAC,UAAQG,SAAAa,IAAuB,iIAQjC,CACL6J,KAAM7K,EAAAA,IAAC4J,EAAA,CAAc7J,UAAU,yBAC/B2G,MAAO,6BACPqE,QACEzK,EAAAA,KAAAyJ,WAAA,CACE5J,SAAA,GAAAH,IAAC,SAAA,CAAQG,YAAmB,qBAA4B,2CAClDH,IAAC,SAAA,CAAQG,SAAAa,GAAiB,mBAA0B,kBAG9DgK,YAAa,iCACbC,kBACE3K,EAAAA,KAAAyJ,WAAA,CAAE5J,SAAA,CAAA,4CACuCH,IAAC,UAAQG,SAAA2F,IAAyB,OAAK,MAC9E9F,IAAC,UAAQG,SAAAa,IAAuB,yIA1Dd,oBAiEVmK,GAEhB,SACE7K,KAACqJ,GAAA,CAAM5J,UAAU,2CACdI,SAAA,CAAAyK,EAAQC,KACT7K,EAAAA,IAAC6J,GAAA,CAAW9J,UAAU,sBAAuBI,WAAQuG,UACrDpG,KAACwJ,GAAA,CAAiB/J,UAAU,eAC1BI,SAAA,CAAAH,EAAAA,IAAC,IAAA,CAAED,UAAU,OAAQI,SAAAyK,EAAQG,UAC7B/K,EAAAA,IAAC,IAAA,CAAED,UAAU,eAAeI,SAAA,uHAK3B8J,GAAA,CACC9J,SAAA,GAAAH,IAACkK,GAAA,CAAmBvC,SAAO,EACzBxH,SAAAH,EAAAA,IAAC4H,EAAA,CACChB,QAAQ,UACRC,KAAK,KACL9G,UAAU,sDACXI,SAAA,oCAIFgK,GAAA,CACChK,SAAA,CAAAG,OAAC8J,GAAA,CACCjK,SAAA,GAAAH,IAACqK,GAAA,CAAkBlK,WAAQ6K,oBAC1BV,GAAA,CAAuB3C,SAAO,EAC7BxH,SAAAG,EAAAA,KAAC,MAAA,CAAIP,UAAU,YACbI,SAAA,GAAAH,IAAC,IAAA,CAAGG,WAAQ8K,sBACZ3K,KAAC,MAAA,CAAIP,UAAU,0BACbI,SAAA,CAAAH,EAAAA,IAAC,IAAA,CAAED,UAAU,2CAA2CI,SAAA,gBACxDG,KAAC,KAAA,CAAGP,UAAU,0CACZI,SAAA,GAAAH,IAAC,MAAGG,SAAA,8DACJH,IAAC,MAAGG,SAAA,mDACJH,IAAC,MAAGG,SAAA,uFAMbqK,GAAA,CACCrK,SAAA,GAAAH,IAACyK,IAAkBtK,SAAA,YACnBH,EAAAA,IAAC0K,GAAA,CAAkB3K,UAAU,qCAAqCI,SAAA,qCAShF,CDzIgBL,EAAA+I,GAAA,6BCJA/I,EAAA6K,GAAA,mCCvBT,MAAMS,GAAiCtL,EAAA,KAC5C,MAAOuL,EAAQC,GAAaC,EAAAA,UAAe,GAE3C,OACEjL,EAAAA,KAACkL,GAAA,CAAY1E,KAAMuE,EAAQ5D,aAAc6D,EACvCnL,SAAA,GAAAH,IAACyL,GAAA,CAAmB9D,SAAO,EACzBxH,SAAAG,EAAAA,KAACsH,EAAA,CACCL,KAAK,SACLX,QAAQ,QACRC,KAAK,KACL9G,UAAU,mFAEVI,SAAA,GAAAH,IAAC0L,EAAA,CAAU3L,UAAU,YACpBsL,EAAS,mBAAqB,mBAC9BA,QAAUM,EAAA,CAAU5L,UAAU,kBAAgB6L,EAAA,CAAY7L,UAAU,uBAGxE8L,GAAA,CAAmB9L,UAAU,OAC5BI,SAAAG,EAAAA,KAAC,MAAA,CAAIP,UAAU,oEACbI,SAAA,CAAAG,OAAC,MAAA,CACCH,SAAA,CAAAH,EAAAA,IAAC,IAAA,CAAED,UAAU,mCAAmCI,SAAA,8BAChDH,EAAAA,IAAC,IAAA,CAAED,UAAU,wCAAwCI,SAAA,oMAOtD,MAAA,CACCA,SAAA,CAAAH,EAAAA,IAAC,IAAA,CAAED,UAAU,mCAAmCI,SAAA,wCAChDG,KAAC,KAAA,CAAGP,UAAU,6DACZI,SAAA,CAAAH,EAAAA,IAAC,MACCG,SAAAH,EAAAA,IAAC,OAAA,CAAKD,UAAU,8CAA8CI,wDAIhEH,EAAAA,IAAC,KAAA,CAAGD,UAAU,iBAAiBI,SAAA,gEAIlC,MAAA,CACCA,SAAA,CAAAH,EAAAA,IAAC,IAAA,CAAED,UAAU,mCAAmCI,SAAA,4BAChDG,KAAC,KAAA,CAAGP,UAAU,6DACZI,SAAA,GAAAG,KAAC,KAAA,CAAGP,UAAU,UACZI,SAAA,CAAAH,EAAAA,IAAC,SAAA,CAAOD,UAAU,kBAAkBI,SAAA,kBAAsB,wCAG5DG,KAAC,KAAA,CAAGP,UAAU,UACZI,SAAA,CAAAH,EAAAA,IAAC,SAAA,CAAOD,UAAU,kBAAkBI,SAAA,sBAA0B,2DAGhEG,KAAC,KAAA,CAAGP,UAAU,UACZI,SAAA,CAAAH,EAAAA,IAAC,SAAA,CAAOD,UAAU,kBAAkBI,SAAA,sBAA0B,0CAGhEG,KAAC,KAAA,CAAGP,UAAU,UACZI,SAAA,CAAAH,EAAAA,IAAC,SAAA,CAAOD,UAAU,kBAAkBI,SAAA,uBAA2B,8DAMpE,MAAA,CAAIJ,UAAU,8BACbI,SAAAG,EAAAA,KAAC,IAAA,CAAEP,UAAU,gCACXI,SAAA,CAAAH,EAAAA,IAAC,SAAA,CAAOD,UAAU,kBAAkBI,SAAA,SAAa,oIAhEjB,wBCPjC2L,GAAqB,uCC4B5BC,GAAkB,CACtB,CAAEpJ,GAAI,MAAOhB,KAAM,OACnB,CAAEgB,GAAI,SAAUhB,KAAM,UACtB,CAAEgB,GAAI,OAAQhB,KAAM,QACpB,CAAEgB,GAAI,WAAYhB,KAAM,aAGpBqK,GAAuBC,EAAmBC,UAAUC,MAAM,CAAA,GAC1DC,GAAkBC,EAAkBH,UAAUC,MAAM,CAAA,GAM7CG,GAAyBxM,EAAA,EAAGiC,OAAO,aAC9C,MAAQO,KAAMiK,GAAaC,KACrBxK,SAAEA,EAAA+G,UAAUA,GAAc9G,KAC1BiB,WAAEA,EAAAV,UAAYA,EAAAO,YAAWA,GAAgBjB,GAAoBC,GAE7D0B,EAAyBtB,EAAS,CAAER,KAAM,6BAC1C8K,EAA0BtK,EAAS,CAAER,KAAM,8BAE3C+K,EAAgB/I,EAAAA,QACpB,IAAOF,EAAyB,CAAEc,gBAAiBd,GAA2B,CAAA,EAC9E,CAACA,IAGGkJ,EAAgBhJ,EAAAA,QACpB,IAAO8I,EAA0B,CAAExH,aAAcwH,GAA4B,CAAA,EAC7E,CAACA,IAEH,SACEnM,KAAC,MAAA,CAAIP,UAAU,YAEbI,SAAA,GAAAG,KAAC,MAAA,CAAIP,UAAU,WACbI,SAAA,GAAAH,IAAC,MAAA,CAAI,gBAAc,WACjBG,SAAAH,EAAAA,IAAC4M,EAAA,CACCC,OAAO,OACPtG,MAAM,qBACNuG,YAAY,EACZC,WACW,SAAThL,EACI,CACEiL,aACEhN,EAAAA,IAACiN,EAAA,CACC9M,SAAAG,OAAC4M,EAAA,CACC/M,SAAA,GAAAH,IAACmN,EAAA,CAAexF,SAAO,EACrBxH,SAAAH,EAAAA,IAAC4H,EAAA,CACCL,KAAK,SACLX,QAAQ,QACRC,KAAK,KACL8B,QAASzF,EACTkK,UAAWrK,GAAeP,EAE1BrC,SAAAH,EAAAA,IAACqN,EAAA,CAAUtN,UAAU,gBAGzBC,MAACsN,EAAA,CACCnN,SAAAH,EAAAA,IAAC,IAAA,CAAEG,oEAMb,YAIT,MAAA,CAAIJ,UAAU,OACbI,SAAAH,EAAAA,IAACoL,mBAKJmC,EAAA,CACCpN,SAAA,CAAAH,EAAAA,IAACE,GAAA,CACCE,OACEJ,EAAAA,IAACoG,GAAA,CACCC,SAAS,gBACTE,MAAM,eACNG,MAAM,mCACNC,YAAY,iEACZL,cAAe,IACV0F,GACHwB,kBAAmB,WACnBC,SAAUlB,GAAU5J,GACpB+K,WAAY5B,IAEdtF,SAASmH,IACP3L,EAAS,2BAA4B2L,EAAOhL,KADtC,UAGR8D,YAAYmH,IACNA,EAAOC,UAAYD,EAAOC,QAAQC,WAAW,UAC/CF,EAAOC,QAAU,WAAWD,EAAOC,WAE9BD,GAJE,aAOXzN,eAAC4N,EAAA,CAAA,KAIL5N,WAAAH,IAAC,MAAA,CAAI,gBAAc,eACjBG,SAAAH,EAAAA,IAACgO,EAAA,CACCnB,OAAO,2BACPoB,UAAU,gBACVrK,OAAQ,CAAE,uBAAwB,uBAElCzD,SAAAH,EAAAA,IAACkO,EAAA,CACC3H,MAAM,0BACN4H,iBAAiB,mBAKzBnO,EAAAA,IAACE,GAAA,CACCE,OACEJ,EAAAA,IAACoG,GAAA,CACCC,SAAS,gBACTE,MAAM,gBACNG,MAAM,oCACNC,YAAY,kEACZL,cAAe,IACV0F,GACHwB,kBAAmB,YACnBC,SAAUlB,GAAU5J,GACpB+K,WAAY5B,IAEdtF,SAASmH,IACP3L,EAAS,4BAA6B2L,EAAOhL,KADvC,UAGR8D,YAAYmH,IACNA,EAAOC,UAAYD,EAAOC,QAAQC,WAAW,UAC/CF,EAAOC,QAAU,WAAWD,EAAOC,WAE9BD,GAJE,aAOXzN,eAAC4N,EAAA,CAAA,KAIL5N,WAAAH,IAAC,MAAA,CAAI,gBAAc,gBACjBG,SAAAH,EAAAA,IAACgO,EAAA,CACCnB,OAAO,4BACPoB,UAAU,gBACVrK,OAAQ,CAAE4J,kBAAmB,aAE7BrN,SAAAH,EAAAA,IAACkO,EAAA,CACC3H,MAAM,2BACN4H,iBAAiB,yBAQ3B7N,KAACiN,EAAA,CAAea,QAAQ,iBACtBjO,SAAA,GAAAH,IAAC,MAAA,CAAI,gBAAc,YACjBG,SAAAH,EAAAA,IAACqO,EAAA,CACCxB,OAAO,QACPtG,MAAM,UACN+H,QAASC,GACTzB,YAAY,QAGhB9M,IAAC,MAAA,CAAI,gBAAc,eACjBG,SAAAH,EAAAA,IAACqO,EAAA,CACCxB,OAAO,WACPtG,MAAM,aACN+H,QAASvC,GACTe,YAAY,QAGhB9M,IAAC,MAAA,CAAI,gBAAc,iBACjBG,SAAAH,EAAAA,IAAC4M,EAAA,CACCC,OAAO,uBACPtG,MAAM,oBACNuG,YAAY,EACZvF,KAAK,qBAMVgG,EAAA,CACCpN,SAAA,CAAAH,MAACE,GAAA,CAECC,SAAAH,EAAAA,IAAC,MAAA,CAAI,gBAAc,sBACjBG,SAAAH,EAAAA,IAACgO,EAAA,CACCnB,OAAO,qBACPoB,UAAU,QACVO,KAAM,CAAEC,MAAO,YAAaC,MAAO,OACnC9K,OAAQ,CAAE,gBAAgB,GAE1BzD,SAAAH,EAAAA,IAACqO,EAAA,CACC9H,MAAM,kBACNoI,WAAYC,EACZ9B,YAAY,UAKpB9M,EAAAA,IAACE,GAAA,CACCE,OACEJ,EAAAA,IAACoG,GAAA,CACCC,SAAS,gBACTE,MAAM,kBACNG,MAAM,sCACNC,YAAY,oEACZL,cAAe,IACV0F,GACHwB,kBAAmB,cACnBC,SAAUlB,GAAU5J,GACpB+K,WAAY5B,IAEdtF,SAASmH,IACP3L,EAAS,8BAA+B2L,EAAOhL,KADzC,UAGR8D,YAAYmH,IACNA,EAAOC,UAAYD,EAAOC,QAAQC,WAAW,UAC/CF,EAAOC,QAAU,WAAWD,EAAOC,WAE9BD,GAJE,aAOXzN,eAAC4N,EAAA,CAAA,KAGL1N,aAASsK,GAAA,IAETxK,WAAAH,IAAC,MAAA,CAAI,gBAAc,kBACjBG,SAAAH,EAAAA,IAACgO,EAAA,CACCnB,OAAO,8BACPoB,UAAU,gBACVrK,OAAQ,CAAE4J,kBAAmB,eAE7BrN,SAAAH,EAAAA,IAACkO,EAAA,CACC3H,MAAM,2BACN4H,iBAAiB,yBAQ3BnO,EAAAA,IAAC6O,GAAmBnI,MAAM,sBAAsBoI,aAAW,EACzD3O,WAAAG,KAAC,MAAA,CAAIP,UAAU,YAEbI,SAAA,CAAAG,OAAC,MAAA,CACCH,SAAA,GAAAG,KAAC,MAAA,CAAIP,UAAU,wCACbI,SAAA,CAAAG,OAAC,MAAA,CACCH,SAAA,CAAAH,EAAAA,IAAC,KAAA,CAAGD,UAAU,sBAAsBI,SAAA,qBACnC,IAAA,CAAEJ,UAAU,gCACVI,SAAAsD,EACG,mCACA,mDAGPA,GACCzD,EAAAA,IAACoG,GAAA,CACCC,SAAS,WACTE,MAAM,cACNG,MAAM,qBACNC,YAAY,8DACZL,cAAe,IACV8F,GACH7H,gBAAiBd,EACjBgK,SAAUlB,GAAU5J,GACpBoM,YAAA,IAAgB9N,MAAO+E,cACvBgJ,WAAA,IAAe/N,MAAO+E,eAExBQ,SAASmH,IACP,MAAMrE,EAAkBP,EAAU,gBAAkB,GACpD/G,EAAS,cAAe,IAAIsH,EAAiBqE,EAAOhL,MAF9C,UAKRxC,eAAC8O,EAAA,CAAA,QAIPjP,EAAAA,IAAC,MAAA,CAAI,gBAAc,eAChBG,SAAAsD,EACCzD,EAAAA,IAACkP,EAAA,CACCrC,OAAO,cACPoB,UAAU,mBACVrK,OAAQ8I,EAERvM,SAAAH,EAAAA,IAACmP,EAAA,CACC5I,OAAO,EACPoI,WAAYS,EACZtC,YAAY,MAIhB9M,EAAAA,IAACmP,EAAA,CACCtC,OAAO,cACPtG,OAAO,EACPoI,WAAYS,EACZtC,YAAY,EACZM,UAAQ,EACRiC,YAAY,qCACZf,QAAS,aAIdzF,GAAA,CAAA,aAIF,MAAA,CACC1I,SAAA,GAAAG,KAAC,MAAA,CAAIP,UAAU,OACbI,SAAA,CAAAH,EAAAA,IAAC,KAAA,CAAGD,UAAU,sBAAsBI,SAAA,qBACnC,IAAA,CAAEJ,UAAU,gCACVI,SAAAsM,EACG,oEACA,kFAGRzM,MAAC,MAAA,CAAI,gBAAc,eACjBG,eAACmP,EAAA,CAAWzC,OAAO,mBAAmBtG,OAAO,EAC3CpG,SAAAG,EAAAA,KAACiP,EAAA,CAAmBC,QAAM,EAACC,mBAAiB,EAC1CtP,SAAA,CAAAH,EAAAA,IAACgO,EAAA,CACCnB,OAAO,uBACPoB,UAAU,WACVrK,OAAQ+I,EAERxM,SAAAH,EAAAA,IAACqO,EAAA,CACCM,WAAW,OACXpI,MAAM,UACNuG,YAAY,EACZ/M,UAAU,aAGdC,EAAAA,IAAC4M,EAAA,CACCC,OAAO,QACPtG,MAAM,QACNuG,YAAY,EACZuC,YAAY,iBACZtP,UAAU,0BAUxBC,EAAAA,IAAC6O,GAAmBnI,MAAM,iBAAiB,gBAAc,6BACvDvG,WAAAG,KAAC,MAAA,CAAIP,UAAU,YACbI,SAAA,CAAAG,OAACiN,EAAA,CACCpN,SAAA,GAAAH,IAAC,MAAA,CAAI,gBAAc,kBACjBG,SAAAH,EAAAA,IAAC4M,EAAA,CAAUC,OAAO,cAActG,MAAM,cAAcuG,YAAY,QAElE9M,IAAC,MAAA,CAAI,gBAAc,eACjBG,SAAAH,EAAAA,IAAC4M,EAAA,CACCC,OAAO,WACPtG,MAAM,WACNuG,YAAY,EACZuC,YAAY,kCAIlBrP,EAAAA,IAACsP,GAAWzC,OAAO,OAAOtG,MAAM,OAC9BpG,WAAAH,IAACuP,EAAA,CAAmBC,QAAM,EAACC,mBAAiB,EAC1CtP,SAAAH,EAAAA,IAAC4M,EAAA,CAAUC,OAAO,GAAGtG,OAAO,EAAOuG,YAAY,EAAOuC,YAAY,qBAO1ErP,EAAAA,IAAC6O,GAAmBnI,MAAM,qBAAqB,gBAAc,sBAC3DvG,WAAAG,KAAC,MAAA,CAAIP,UAAU,YACbI,SAAA,GAAAH,IAAC,MAAA,CAAI,gBAAc,kBACjBG,SAAAH,EAAAA,IAAC4M,EAAA,CACCC,OAAO,cACPtG,MAAM,cACNmJ,WAAS,EACTC,KAAM,EACN7C,YAAY,aAGfS,EAAA,CACCpN,SAAA,GAAAH,IAAC,MAAA,CAAI,gBAAc,kBACjBG,SAAAH,EAAAA,IAAC4M,EAAA,CACCC,OAAO,cACPtG,MAAM,cACNuG,YAAY,EACZuC,YAAY,4CAGhBrP,IAAC,MAAA,CAAI,gBAAc,uBACjBG,SAAAH,EAAAA,IAAC4M,EAAA,CACCC,OAAO,mBACPtG,MAAM,mBACNuG,YAAY,EACZvF,KAAK,cAIXvH,EAAAA,IAAC4M,EAAA,CACCC,OAAO,oBACPtG,MAAM,oBACNmJ,WAAS,EACTC,KAAM,EACN7C,YAAY,EACZuC,YAAY,4CAEJ,SAATtN,GACC/B,EAAAA,IAACgO,EAAA,CAAenB,OAAO,yBAAyBoB,UAAU,gBACxD9N,WAAAH,IAACqO,EAAA,CAAYM,WAAW,OAAOpI,MAAM,sBAAsBuG,YAAY,MAG3E9M,EAAAA,IAAC4M,EAAA,CACCC,OAAO,QACPtG,MAAM,QACNmJ,WAAS,EACTC,KAAM,EACN7C,YAAY,EACZuC,YAAY,iFAzZc"}