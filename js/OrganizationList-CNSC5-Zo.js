var e=Object.defineProperty,t=(t,a)=>e(t,"name",{value:a,configurable:!0});import{l as a,H as s,a6 as r,a7 as n,a8 as i,a9 as o,aa as l,ab as c,ac as d,j as m,$ as u,ad as p,ae as x,af as h,ag as f,ah as g,ai as j,aj as b,ak as y,u as v,w as N,P as O,U as _,i as k,al as w,W as z,J as C,Q as S,am as E,an as P}from"./chunk-ByJg_QQB.js";import{B as R,a as T,b as I}from"./chunk-BndLoydo.js";import{r as A}from"./chunk-1NZFT-6z.js";import{d as B,B as $,D as L,e as F,f as D,g as M,h as W,i as U,j as V,k as q,m as H,n as Q,o as G,p as Y,P as Z,O as J,T as K,C as X,a as ee,q as te,S as ae}from"../assets/index-BoLku8RR.js";import{Q as se,W as re,Y as ne,_ as ie,$ as oe,U as le,a0 as ce,a1 as de,a2 as me,a3 as ue,a4 as pe,O as xe}from"./chunk-Bc6KM1xM.js";import{S as he,C as fe,L as ge,E as je}from"./chunk-BBQ6yJWi.js";import{v as be,S as ye,F as ve}from"./chunk-A2EVsQEK.js";import{P as Ne}from"./chunk-CKWniV73.js";import{S as Oe}from"./chunk-DDhuYt5_.js";import{O as _e,u as ke,a as we,F as ze,b as Ce}from"./chunk-C8K6x_Yi.js";import{R as Se,u as Ee}from"./chunk-a4jA-31v.js";import{g as Pe}from"./chunk-CFj7NhUg.js";import{F as Re,T as Te}from"./chunk-C6dCzd_-.js";import{O as Ie,P as Ae,a as Be,b as $e,M as Le,D as Fe}from"./chunk-B0BZInrb.js";import{S as De}from"./chunk-C5fZsuMg.js";import{R as Me}from"./chunk-BLkgKceb.js";import{A as We}from"./chunk-DRZQUu5H.js";import{A as Ue}from"./chunk-BY7AmvEs.js";import"./chunk-CRKBdUTG.js";import{c as Ve}from"./chunk-DwAffUXc.js";import{u as qe}from"./chunk-JxeXaC9i.js";import{L as He,R as Qe}from"./chunk-CDUI2JrL.js";import{I as Ge}from"./chunk-DnMAHdte.js";import{I as Ye,u as Ze,s as Je,T as Ke,a as Xe,c as et}from"./chunk-UKb2nn92.js";import{S as tt}from"./chunk-71kOq0yU.js";import{I as at,F as st,a as rt}from"./chunk-BhXlBuf0.js";import{R as nt}from"./chunk-CycMx1Ac.js";import{T as it,C as ot}from"./chunk-DHnjrG--.js";import{R as lt}from"./chunk-Sp4WOLwD.js";import{N as ct}from"./chunk-D2aCv_Ah.js";import{A as dt}from"./chunk-sbYpr125.js";import{u as mt}from"./chunk-CfuGOU5i.js";import{T as ut}from"./chunk-BtJ7Qrct.js";import{P as pt,F as xt}from"./chunk-Nds5IV03.js";import{T as ht}from"./chunk-DmTQjO0R.js";import"./chunk-knA4lag3.js";import"./chunk-Tyyhsnez.js";import"./chunk-XoqkUGE_.js";import"./chunk-Dc4zIuSl.js";import"./chunk-B1s-jt27.js";import"./chunk-DA1DYucv.js";import"./chunk-B5Y5c6gs.js";import"./chunk-CMQLDEz_.js";import"./chunk-DbeoRBEW.js";import"./chunk-sKlZvX2D.js";import"./chunk-B9H_70fs.js";import"./chunk-j7Lqvg-1.js";import"./chunk-DpghI3EP.js";import"./chunk-D62ZQQIe.js";import"./chunk-DsNwAyt-.js";var ft,gt=function(){return gt=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},gt.apply(this,arguments)},jt=t(function(e){var s=e.label,r=e.onClick,n=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(a[s[r]]=e[s[r]])}return a}(e,["label","onClick"]),i=a(),o=A.useState(!1),l=o[0],c=o[1],d=t(function(){c(!1)},"handleClose"),m=t(function(){c(!0)},"handleOpen"),u=s;"string"==typeof s&&(u=i(s,{_:s}));var p=t(function(e){d(),r&&r(e)},"handleClick");return A.createElement(it,{title:u,open:l,onOpen:m,onClose:d},A.createElement(Ye,gt({"aria-label":"string"==typeof u?u:void 0,onClick:p},n)))},"IconButtonWithTooltip"),bt=function(){return bt=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},bt.apply(this,arguments)},yt=t(function(e){var a,r,n,i=Ze({props:e,name:vt}),o=i.children,l=i.className,c=void 0===l?"":l,d=i.color,m=i.component,u=void 0===m?"span":m,p=i.fullWidth,x=i.isRequired,h=i.label,f=i.resource,g=i.source,j=i.TypographyProps,b=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(a[s[r]]=e[s[r]])}return a}(i,["children","className","color","component","fullWidth","isRequired","label","resource","source","TypographyProps"]);return A.createElement(Ot,bt({component:u,className:Ve(c,(a={},a[Nt.fullWidth]=p,a))},b),!1!==h&&!1!==o.props.label&&"string"!=typeof o.type&&"Labeled"!==(null===(r=o.type)||void 0===r?void 0:r.displayName)&&"Labeled"!==(null===(n=o.type)||void 0===n?void 0:n.displayName)?A.createElement(Ke,bt({sx:d?{color:d}:{color:t(function(e){return(e.vars||e).palette.text.secondary},"color")},className:Nt.label},j),A.createElement(s,{label:h||o.props.label,source:g||o.props.source,resource:f,isRequired:x})):null,o)},"Labeled");yt.displayName="Labeled";var vt="RaLabeled",Nt={label:"".concat(vt,"-label"),fullWidth:"".concat(vt,"-fullWidth")},Ot=Je(tt,{name:vt,overridesResolver:t(function(e,t){return t.root},"overridesResolver")})(((ft={display:"inline-flex",marginBottom:"0.2em"})["&.".concat(Nt.fullWidth)]={width:"100%"},ft["& .".concat(Nt.label)]={fontSize:"0.75em",marginBottom:"0.2em"},ft)),_t=function(){return _t=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},_t.apply(this,arguments)},kt=t(function(e){var a,c,d=Xe({props:e,name:wt}),m=d.className,u=d.defaultValue,p=void 0===u?[]:u,x=d.label,h=d.children,f=d.helperText,g=d.isPending,j=d.resource,b=d.source,y=d.validate;d.variant;var v=d.margin,N=void 0===v?"dense":v,O=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(a[s[r]]=e[s[r]])}return a}(d,["className","defaultValue","label","children","helperText","isPending","resource","source","validate","variant","margin"]),_=r().getSource(b),k=qe().subscribe,w=A.useState(),z=w[0],C=w[1];A.useEffect(function(){return k({formState:{errors:!0},callback:t(function(e){var t=e.errors,a=n(null!=t?t:{},_);C(a)},"callback")})},[_,k]);var S=!1!==f||!!z;return g?A.createElement(yt,{label:x,className:m},A.createElement(He,null)):A.createElement(Ct,_t({fullWidth:!0,margin:N,className:Ve("ra-input","ra-input-".concat(_),zt.root,m),error:!!z},i(O)),A.createElement(at,{component:"span",className:zt.label,shrink:!0,error:!!z},A.createElement(s,{label:x,source:b,resource:j,isRequired:o(y)})),A.createElement(l,_t({},d,{defaultValue:p}),h),S?A.createElement(st,{error:!!z},A.createElement(Ge,{error:null!==(c=null===(a=null==z?void 0:z.root)||void 0===a?void 0:a.message)&&void 0!==c?c:null==z?void 0:z.message,helperText:f})):null)},"ArrayInput"),wt="RaArrayInput",zt={root:"".concat(wt,"-root"),label:"".concat(wt,"-label")},Ct=Je(rt,{name:wt,overridesResolver:t(function(e,t){return t.root},"overridesResolver")})(function(e){var t,a=e.theme;return(t={marginTop:0})["& .".concat(zt.label)]={position:"relative",top:a.spacing(.5),left:a.spacing(-1.5)},t["& .".concat(zt.root)]={paddingLeft:a.spacing(2)},t}),St="RaSimpleFormIterator",Et={action:"".concat(St,"-action"),add:"".concat(St,"-add"),clear:"".concat(St,"-clear"),form:"".concat(St,"-form"),index:"".concat(St,"-index"),inline:"".concat(St,"-inline"),line:"".concat(St,"-line"),list:"".concat(St,"-list"),buttons:"".concat(St,"-buttons")},Pt=function(){return Pt=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Pt.apply(this,arguments)},Rt=t(function(e){var a=c(),s=a.remove,r=a.index,n=d().source,i=e.className,o=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(a[s[r]]=e[s[r]])}return a}(e,["className"]);return A.createElement(jt,Pt({label:"ra.action.remove",size:"small",onClick:t(function(){return s()},"onClick"),color:"warning",className:Ve("button-remove button-remove-".concat(n,"-").concat(r),i)},o),A.createElement(nt,{fontSize:"small"}))},"RemoveItemButton");const Tt=et(m.jsx("path",{d:"M12 20c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0 2c5.52 0 10-4.48 10-10S17.52 2 12 2 2 6.48 2 12s4.48 10 10 10m-1-10v4h2v-4h3l-4-4-4 4z"})),It=et(m.jsx("path",{d:"M12 4c4.41 0 8 3.59 8 8s-3.59 8-8 8-8-3.59-8-8 3.59-8 8-8m0-2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 10V8h-2v4H8l4 4 4-4z"}));var At=t(function(e){var a=e.className,s=c(),r=s.index,n=s.total,i=s.reOrder,o=d().source;return A.createElement("span",{className:Ve("button-reorder button-reorder-".concat(o,"-").concat(r),a)},A.createElement(jt,{label:"ra.action.move_up",size:"small",onClick:t(function(){return i(r-1)},"onClick"),disabled:r<=0,color:"primary"},A.createElement(Tt,{fontSize:"small"})),A.createElement(jt,{label:"ra.action.move_down",size:"small",onClick:t(function(){return i(r+1)},"onClick"),disabled:null==n||r>=n-1,color:"primary"},A.createElement(It,{fontSize:"small"})))},"ReOrderButtons"),Bt=function(){return Bt=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Bt.apply(this,arguments)},$t=A.memo(A.forwardRef(t(function(e,a){var s=e.children,r=e.disabled,n=e.disableReordering,i=e.disableRemove,o=e.getItemLabel,l=e.index,c=e.inline,d=e.removeButton,m=void 0===d?A.createElement(Rt,null):d,x=e.reOrderButtons,h=void 0===x?A.createElement(At,null):x,f=u(e);if(!f)throw new Error("SimpleFormIteratorItem must be used in a RecordContextProvider.");var g=t(function(e){return"boolean"==typeof i?i:i&&i(e)},"disableRemoveField"),j="function"==typeof o?o(l):o;return A.createElement(p,Bt({},e),A.createElement("li",{className:Et.line,ref:a},null!=j&&!1!==j&&A.createElement(Ke,{variant:"body2",className:Et.index},j),A.createElement(tt,{className:Ve(Et.form),direction:c?{xs:"column",sm:"row"}:"column",sx:{gap:c?2:0}},s),!r&&A.createElement("span",{className:Et.action},!n&&h,!g(f)&&m)))},"SimpleFormIteratorItem")));const Lt=et(m.jsx("path",{d:"M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4zm-1-5C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}));var Ft=function(){return Ft=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Ft.apply(this,arguments)},Dt=t(function(e){var a=d(),s=a.add,r=a.source,n=e.className,i=function(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(a[s[r]]=e[s[r]])}return a}(e,["className"]);return A.createElement(jt,Ft({label:"ra.action.add",size:"small",onClick:t(function(){return s()},"onClick"),color:"primary",className:Ve("button-add button-add-".concat(r),n)},i),A.createElement(Lt,{fontSize:"small"}))},"AddItemButton");const Mt=et(m.jsx("path",{d:"M14.59 8 12 10.59 9.41 8 8 9.41 10.59 12 8 14.59 9.41 16 12 13.41 14.59 16 16 14.59 13.41 12 16 9.41zM12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}));var Wt=function(){return Wt=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},Wt.apply(this,arguments)},Ut=t(function(e){return A.createElement(jt,Wt({label:"ra.action.clear_array_input",size:"small",color:"warning"},e),A.createElement(Mt,{fontSize:"small"}))},"ClearArrayButton"),Vt=t(function(e){var s=e.className,r=e.disableClear,n=e.disableRemove,i=a(),o=A.useState(!1),l=o[0],c=o[1],m=d(),u=m.clear,p=m.total,h=x(function(){u(),c(!1)});return 0===p||!0===r||!0===n?null:A.createElement(A.Fragment,null,A.createElement(ot,{isOpen:l,title:i("ra.action.clear_array_input"),content:i("ra.message.clear_array_input"),onConfirm:h,onClose:t(function(){return c(!1)},"onClose")}),A.createElement(Ut,{className:s,onClick:t(function(){return c(!0)},"onClick")}))},"SimpleFormIteratorClearButton"),qt=function(){return qt=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++)for(var r in t=arguments[a])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},qt.apply(this,arguments)},Ht=t(function(e){var t=Xe({props:e,name:St}),a=t.addButton,s=void 0===a?A.createElement(Dt,null):a,r=t.removeButton,i=t.reOrderButtons,o=t.children,l=t.className,c=t.disabled,d=t.disableAdd,m=void 0!==d&&d,p=t.disableClear,y=t.disableRemove,v=void 0!==y&&y,N=t.disableReordering,O=t.inline,_=t.getItemLabel,k=void 0!==_&&_,w=t.fullWidth,z=t.sx,C=h("");if(!C)throw new Error("SimpleFormIterator can only be called within an iterator input like ArrayInput");var S=f(t).fields,E=u(t),P=n(E,C),R=g(S),T=x(function(e){return void 0===e&&(e=void 0),null!=e?e:R(o)});return A.createElement(j,qt({getItemDefaults:T},t),A.createElement(Qt,{className:Ve(l,w&&"fullwidth",c&&"disabled"),sx:z},A.createElement("ul",{className:Et.list},S.map(function(e,a){return A.createElement(b,{key:e.id,value:P&&P[a]||{}},A.createElement($t,{index:a,fields:S,resource:t.resource,disabled:c,disableRemove:v,disableReordering:N,getItemLabel:k,removeButton:r,reOrderButtons:i,inline:O},o))})),!c&&!(m&&(p||v))&&A.createElement("div",{className:Et.buttons},!m&&A.createElement("div",{className:Et.add},s),A.createElement("div",{className:Et.clear},A.createElement(Vt,{disableClear:p,disableRemove:v})))))},"SimpleFormIterator"),Qt=Je("div",{name:St,overridesResolver:t(function(e,t){return t.root},"overridesResolver")})(function(e){var t,a,s,r=e.theme;return(t={"& > ul":{padding:0,marginTop:0,marginBottom:0},"& > ul > li:last-child":{borderBottom:"none"}})["& .".concat(Et.line)]=((a={display:"flex",listStyleType:"none",borderBottom:"solid 1px ".concat((r.vars||r).palette.divider)})[r.breakpoints.down("sm")]={display:"block"},a),t["& .".concat(Et.index)]=((s={display:"flex",alignItems:"top",marginRight:r.spacing(1),marginTop:r.spacing(1)})[r.breakpoints.down("md")]={display:"none"},s),t["& .".concat(Et.form)]={minWidth:0},t["&.fullwidth > ul > li > .".concat(Et.form)]={flex:2},t["& .".concat(Et.inline)]={flexDirection:"row",columnGap:"1em"},t["& .".concat(Et.action)]={marginTop:r.spacing(.5),visibility:"hidden","@media(hover:none)":{visibility:"visible"}},t["& .".concat(Et.buttons)]={display:"flex"},t["& .".concat(Et.add)]={borderBottom:"none"},t["& .".concat(Et.clear)]={borderBottom:"none"},t["& .".concat(Et.line,":hover > .").concat(Et.action)]={visibility:"visible"},t});function Gt({type:e}){const t=Ie[e]||"tag-gray";return m.jsx(B,{className:`text-xs px-2 py-1 ${t}`,children:e.charAt(0).toUpperCase()+e.slice(1)})}function Yt({priority:e}){const t=Be[e]||"default",a=Ae.find(t=>t.id===e)?.name||e;return m.jsx(B,{variant:t,className:"text-xs px-2 py-1",children:a})}t(Gt,"OrganizationTypeBadge$1"),t(Yt,"PriorityBadge$1");const Zt=t(({onSuccess:e})=>{const[a,s]=A.useState(!1),[r,n]=A.useState(""),[i,o]=A.useState(!1),{selectedIds:l,data:c,onUnselectItems:d}=y(),u=v(),p=N(),x=O(),{data:h,isPending:f}=_("sales",{pagination:{page:1,perPage:100},sort:{field:"last_name",order:"ASC"},filter:{"disabled@neq":!0,"user_id@not.is":null}}),g=c?.filter(e=>l?.includes(e.id))??[],j=t(()=>{s(!0),n("")},"handleOpenDialog"),b=t(()=>{s(!1),n("")},"handleCloseDialog"),k=t(async()=>{if(!r||!l?.length)return;o(!0);let t=0,a=0;try{for(const e of l)try{await x.update("organizations",{id:e,data:{sales_id:parseInt(r)},previousData:c?.find(t=>t.id===e)}),t++}catch(s){a++}if(t>0){const e=h?.find(e=>String(e.id)===r),a=e?G(e.first_name,e.last_name):"selected rep";u(`Successfully reassigned ${t} organization${1===t?"":"s"} to ${a}`,{type:"success"})}a>0&&u(`Failed to reassign ${a} organization${1===a?"":"s"}`,{type:"error"}),p(),e?e():d(),b()}catch(s){u("Bulk reassignment failed",{type:"error"})}finally{o(!1)}},"handleExecuteReassign");return l?.length?m.jsxs(m.Fragment,{children:[m.jsxs($,{variant:"outline",onClick:j,className:"h-11 gap-2 touch-manipulation","aria-label":"Reassign selected organizations",children:[m.jsx(se,{className:"h-4 w-4"}),"Reassign"]}),m.jsx(L,{open:a,onOpenChange:t(e=>!e&&b(),"onOpenChange"),children:m.jsxs(F,{children:[m.jsxs(D,{children:[m.jsx(M,{children:"Reassign Organizations"}),m.jsxs(W,{children:["Reassign ",l.length," organization",1===l.length?"":"s"," to a different sales representative"]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"rounded-lg border border-border bg-muted/50 p-3 max-h-40 overflow-y-auto",children:[m.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Organizations to reassign:"}),m.jsx("div",{className:"space-y-1",children:g.map(e=>m.jsxs("div",{className:"text-sm flex items-center justify-between",children:[m.jsx("span",{className:"truncate",children:e.name}),m.jsx("span",{className:"ml-2 text-xs text-muted-foreground shrink-0",children:e.organization_type})]},e.id))})]}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("label",{htmlFor:"bulk-reassign-select",className:"text-sm font-medium",children:"New Sales Representative"}),m.jsxs(U,{value:r,onValueChange:n,disabled:f,children:[m.jsx(V,{id:"bulk-reassign-select",className:"h-11",children:m.jsx(q,{placeholder:f?"Loading...":"Select a sales rep"})}),m.jsx(H,{children:h?.map(e=>m.jsx(Q,{value:String(e.id),children:G(e.first_name,e.last_name)},e.id))})]})]})]}),m.jsxs(Y,{children:[m.jsx($,{variant:"outline",onClick:b,disabled:i,children:"Cancel"}),m.jsx($,{onClick:k,disabled:!r||i,children:i?"Reassigning...":`Reassign ${l.length} Organization${1===l.length?"":"s"}`})]})]})})]}):null},"BulkReassignButton"),Jt=t(()=>m.jsxs(R,{children:[m.jsx(Zt,{}),m.jsx(T,{}),m.jsx(I,{})]}),"OrganizationBulkActionsToolbar"),Kt=t(()=>{const{data:e}=k(),{filterValues:t}=y(),a=t?.organization_type,s=!a||(Array.isArray(a)?a.includes("distributor")||a.includes("principal"):"distributor"===a||"principal"===a),r=!a||(Array.isArray(a)?a.includes("customer")||a.includes("prospect"):"customer"===a||"prospect"===a);return m.jsxs("div",{className:"flex flex-col gap-4","data-tutorial":"org-filters",children:[m.jsx(w,{children:m.jsx(he,{source:"q",placeholder:"Search organizations..."})}),m.jsxs("div",{className:"flex flex-col gap-2",children:[m.jsx(Re,{icon:m.jsx(re,{className:"h-4 w-4"}),label:"Organization Type",children:$e.map(e=>{const t=Ie[e.id]||"tag-gray";return m.jsx(Te,{multiselect:!0,className:"w-full justify-between",label:m.jsx(B,{className:`text-xs px-3 py-2 min-h-[44px] flex items-center ${t}`,children:e.name}),value:{organization_type:e.id}},e.id)})}),m.jsx(Re,{icon:m.jsx(ne,{className:"h-4 w-4"}),label:"Priority",children:Ae.map(e=>m.jsx(Te,{multiselect:!0,className:"w-full justify-between",label:m.jsx(B,{variant:Be[e.id],className:"text-xs px-3 py-2 min-h-[44px] flex items-center",children:e.name}),value:{priority:e.id}},e.id))}),s&&m.jsx(Re,{icon:m.jsx(ie,{className:"h-4 w-4"}),label:"Playbook Category",children:Z.map(e=>m.jsx(Te,{multiselect:!0,className:"w-full justify-between",label:m.jsx(B,{className:"text-xs px-3 py-2 min-h-[44px] flex items-center tag-teal",children:e.name}),value:{segment_id:e.id}},e.id))}),r&&m.jsx(Re,{icon:m.jsx(oe,{className:"h-4 w-4"}),label:"Operator Segment",children:J.map(e=>m.jsx(Te,{multiselect:!0,className:"w-full justify-between",label:m.jsx(B,{className:"text-xs px-3 py-2 min-h-[44px] flex items-center tag-sage",children:e.name}),value:{segment_id:e.id}},e.id))}),m.jsx(Re,{icon:m.jsx(le,{className:"h-4 w-4"}),label:"Account Manager",children:m.jsx(Te,{className:"w-full justify-between",label:"Me",value:{sales_id:e?.id}})})]})]})},"OrganizationListFilter");function Xt({record:e,mode:a,onModeToggle:s}){const[r]=z(),n=v(),i=t(async t=>{try{await r("organizations",{id:e.id,data:t,previousData:e}),n("Organization updated successfully",{type:"success"}),s?.()}catch(a){n("Error updating organization",{type:"error"})}},"handleSave");return"edit"===a?m.jsx(b,{value:e,children:m.jsx(C,{id:"slide-over-edit-form",onSubmit:i,record:e,children:m.jsx("div",{className:"space-y-6",children:m.jsxs("div",{className:"space-y-4",children:[m.jsx(K,{source:"name",label:"Organization Name"}),m.jsx(De,{source:"organization_type",label:"Type",choices:$e}),m.jsx(De,{source:"priority",label:"Priority",choices:Ae}),m.jsx(K,{source:"email",label:"Email",type:"email"}),m.jsx(K,{source:"phone",label:"Phone"}),m.jsx(K,{source:"website",label:"Website"}),m.jsx(K,{source:"address",label:"Street Address"}),m.jsx(K,{source:"city",label:"City"}),m.jsx(K,{source:"state",label:"State"}),m.jsx(K,{source:"postal_code",label:"ZIP Code"}),m.jsx(Me,{source:"tags",reference:"tags",label:"Tags",children:m.jsx(We,{optionText:"name"})}),m.jsx(kt,{source:"context_links",label:"Context Links",children:m.jsxs(Ht,{inline:!0,children:[m.jsx(K,{source:"name",label:"Name"}),m.jsx(K,{source:"url",label:"URL"})]})})]})})})}):m.jsx(b,{value:e,children:m.jsx("div",{className:"space-y-6",children:m.jsx(Ue,{title:"Organization Details",children:m.jsx(X,{children:m.jsxs(ee,{className:"p-4 space-y-3",children:[m.jsx("div",{children:m.jsx("h3",{className:"text-lg font-semibold",children:e.name})}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm text-muted-foreground",children:"Type:"}),m.jsx(ea,{type:e.organization_type})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm text-muted-foreground",children:"Priority:"}),m.jsx(ta,{priority:e.priority})]}),e.email&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm text-muted-foreground",children:"Email:"}),m.jsx("a",{href:`mailto:${e.email}`,className:"text-sm text-primary hover:underline",children:e.email})]}),(e.phone||e.website)&&m.jsxs("div",{className:"space-y-2",children:[e.phone&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm text-muted-foreground",children:"Phone:"}),m.jsx("a",{href:`tel:${e.phone}`,className:"text-sm text-primary hover:underline",children:e.phone})]}),e.website&&m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-sm text-muted-foreground",children:"Website:"}),m.jsx("a",{href:e.website,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline",children:e.website.replace(/^https?:\/\//,"")})]})]}),(e.address||e.city||e.state||e.postal_code)&&m.jsxs("div",{className:"space-y-1",children:[m.jsx("span",{className:"text-sm text-muted-foreground",children:"Address:"}),m.jsxs("div",{className:"text-sm",children:[e.address&&m.jsx("div",{children:e.address}),(e.city||e.state||e.postal_code)&&m.jsx("div",{children:[e.city,e.state,e.postal_code].filter(Boolean).join(", ")})]})]}),e.tags&&e.tags.length>0&&m.jsxs("div",{children:[m.jsx("span",{className:"text-sm text-muted-foreground block mb-2",children:"Tags:"}),m.jsx("div",{className:"flex flex-wrap gap-2",children:e.tags.map(e=>m.jsxs(B,{variant:"outline",className:"text-xs",children:["Tag #",e]},e))})]}),e.context_links&&Array.isArray(e.context_links)&&e.context_links.length>0&&m.jsxs("div",{children:[m.jsx("span",{className:"text-sm text-muted-foreground block mb-2",children:"Context Links:"}),m.jsx("div",{className:"space-y-1",children:e.context_links.map((e,t)=>m.jsx("div",{children:m.jsx("a",{href:"string"==typeof e?e:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline",children:"string"==typeof e?e:e.label||e.url})},t))})]}),e.created_at&&m.jsx("div",{className:"pt-2 border-t border-border",children:m.jsxs("span",{className:"text-xs text-muted-foreground",children:["Created: ",te(e.created_at)?.toLocaleDateString()??"N/A"]})}),e.updated_at&&m.jsx("div",{children:m.jsxs("span",{className:"text-xs text-muted-foreground",children:["Updated: ",te(e.updated_at)?.toLocaleDateString()??"N/A"]})})]})})})})})}function ea({type:e}){const t=Ie[e]||"tag-gray";return m.jsx(B,{className:`text-xs px-3 py-2 min-h-[44px] flex items-center ${t}`,children:e.charAt(0).toUpperCase()+e.slice(1)})}function ta({priority:e}){const t=Be[e]||"default",a=Ae.find(t=>t.id===e)?.name||e;return m.jsx(B,{variant:t,className:"text-xs px-3 py-2 min-h-[44px] flex items-center",children:a})}function aa(e){const t=e.first_name?.trim(),a=e.last_name?.trim();return t||a?[t,a].filter(Boolean).join(" "):e.name?.trim()||"Unknown Contact"}function sa(e){const t=e.first_name?.trim(),a=e.last_name?.trim();if(t||a)return`${t?.[0]||""}${a?.[0]||""}`;const s=e.name?.trim().split(" ")||[];return s.length>=2?`${s[0]?.[0]||""}${s[1]?.[0]||""}`:s[0]?.[0]||"?"}function ra({record:e}){const{data:a=[],isLoading:s,error:r}=_("contacts",{filter:{organization_id:e.id},pagination:{page:1,perPage:Le},sort:{field:"last_name",order:"ASC"}},{staleTime:3e5}),n=r?String(r):null;return s?m.jsxs("div",{className:"space-y-4",children:[m.jsx(ae,{className:"h-11 w-full"}),m.jsx(ae,{className:"h-11 w-full"}),m.jsx(ae,{className:"h-11 w-full"})]}):n?m.jsx(X,{children:m.jsx(ee,{className:"p-4",children:m.jsx("p",{className:"text-sm text-destructive",children:n})})}):0===a.length?m.jsx(b,{value:e,children:m.jsx(Ue,{title:"Contacts",children:m.jsx(X,{children:m.jsxs(ee,{className:"p-8 text-center",children:[m.jsx(le,{className:"size-11 mx-auto text-muted-foreground mb-4"}),m.jsx("p",{className:"text-muted-foreground",children:"No contacts yet."}),m.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Add contacts to this organization from the Contacts module."})]})})})}):m.jsx(b,{value:e,children:m.jsx("div",{className:"space-y-6",children:m.jsx(Ue,{title:`Contacts (${a.length})`,children:m.jsx(X,{children:m.jsx(ee,{className:"p-4",children:m.jsx("div",{className:"space-y-3",children:a.map(e=>m.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg hover:bg-accent/5 transition-colors",children:[e.avatar?.src?m.jsx("img",{src:e.avatar.src,alt:aa(e),className:"size-10 rounded-full object-cover"}):m.jsx("div",{className:"size-10 rounded-full bg-primary/10 flex items-center justify-center",children:m.jsx("span",{className:"text-sm font-semibold text-primary",children:sa(e)})}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("a",{href:`/contacts?view=${e.id}`,onClick:t(t=>{t.preventDefault(),window.location.href=`/contacts?view=${e.id}`},"onClick"),className:"text-sm font-medium text-primary hover:underline block truncate",children:aa(e)}),e.title&&m.jsx("p",{className:"text-xs text-muted-foreground truncate",children:e.title}),e.email&&Array.isArray(e.email)&&e.email.length>0&&m.jsx("p",{className:"text-xs text-muted-foreground truncate",children:e.email[0]?.value||""})]})]},e.id))})})})})})})}function na({record:e}){const{data:a=[],isLoading:s,error:r}=_("opportunities",{filter:{$or:[{customer_organization_id:e.id},{principal_organization_id:e.id},{distributor_organization_id:e.id}]},pagination:{page:1,perPage:Le},sort:{field:"created_at",order:"DESC"}},{staleTime:3e5}),n=r?String(r):null;return s?m.jsxs("div",{className:"space-y-4",children:[m.jsx(ae,{className:"h-11 w-full"}),m.jsx(ae,{className:"h-11 w-full"}),m.jsx(ae,{className:"h-11 w-full"})]}):n?m.jsx(X,{children:m.jsx(ee,{className:"p-4",children:m.jsx("p",{className:"text-sm text-destructive",children:n})})}):0===a.length?m.jsx(b,{value:e,children:m.jsx(Ue,{title:"Opportunities",children:m.jsx(X,{children:m.jsxs(ee,{className:"p-8 text-center",children:[m.jsx(ce,{className:"size-11 mx-auto text-muted-foreground mb-4"}),m.jsx("p",{className:"text-muted-foreground",children:"No opportunities yet."}),m.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Create opportunities from the Opportunities module."})]})})})}):m.jsx(b,{value:e,children:m.jsx("div",{className:"space-y-6",children:m.jsx(Ue,{title:`Opportunities (${a.length})`,children:m.jsx(X,{children:m.jsx(ee,{className:"p-4",children:m.jsx("div",{className:"space-y-3",children:a.map(e=>m.jsxs("div",{className:"p-3 rounded-lg hover:bg-accent/5 transition-colors border border-border",children:[m.jsxs("div",{className:"flex items-start justify-between mb-2",children:[m.jsx("a",{href:`/opportunities?view=${e.id}`,onClick:t(t=>{t.preventDefault(),window.location.href=`/opportunities?view=${e.id}`},"onClick"),className:"text-sm font-medium text-primary hover:underline",children:e.name}),m.jsx(ia,{stage:e.stage})]}),m.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[e.estimated_value&&m.jsxs("span",{children:["$",e.estimated_value.toLocaleString()]}),e.estimated_close_date&&m.jsxs("span",{children:["Close:"," ",te(e.estimated_close_date)?.toLocaleDateString()??"N/A"]}),e.status&&m.jsx(B,{variant:"outline",className:"text-xs",children:e.status})]})]},e.id))})})})})})})}function ia({stage:e}){const t={new_lead:"outline",initial_outreach:"secondary",sample_visit_offered:"secondary",feedback_logged:"secondary",demo_scheduled:"default",closed_won:"default",closed_lost:"destructive"}[e]||"outline";return m.jsx(B,{variant:t,className:"text-xs",children:Pe(e)})}function oa({record:e,mode:t}){return m.jsx(b,{value:e,children:m.jsxs("div",{className:"space-y-4",children:[m.jsx(lt,{target:"organization_id",reference:"organizationNotes",sort:{field:"created_at",order:"DESC"},children:m.jsx(ct,{reference:"organizations"})}),m.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"view"===t?"Notes are visible to all team members":"Add notes to track important information about this organization"})]})})}function la({recordId:e,isOpen:a,onClose:s,mode:r,onModeToggle:n}){const{data:i}=S("organizations",{id:e},{enabled:!!e&&a}),o="distributor"===i?.organization_type,l=[{key:"details",label:"Details",component:Xt,icon:de},{key:"contacts",label:"Contacts",component:ra,icon:le,countFromRecord:t(e=>e.nb_contacts,"countFromRecord")},{key:"opportunities",label:"Opportunities",component:na,icon:ce,countFromRecord:t(e=>e.nb_opportunities,"countFromRecord")},{key:"notes",label:"Notes",component:oa,icon:me,countFromRecord:t(e=>e.nb_notes,"countFromRecord")}],c=o?[...l.slice(0,1),{key:"authorizations",label:"Authorizations",component:dt,icon:ue},...l.slice(1)]:l,d=t(e=>e.name||`Organization #${e.id}`,"recordRepresentation");return m.jsx(Se,{resource:"organizations",recordId:e,isOpen:a,onClose:s,mode:r,onModeToggle:n,tabs:c,recordRepresentation:d,loadingSkeleton:_e})}t(Xt,"OrganizationDetailsTab"),t(ea,"OrganizationTypeBadge"),t(ta,"PriorityBadge"),t(aa,"getContactDisplayName"),t(sa,"getContactInitials"),t(ra,"OrganizationContactsTab"),t(na,"OrganizationOpportunitiesTab"),t(ia,"StageBadge"),t(oa,"OrganizationNotesTab"),t(la,"OrganizationSlideOver");const ca=t(()=>{const e=mt();return m.jsxs("div",{className:"flex flex-col justify-center items-center gap-section",style:{height:`calc(100dvh - ${e}px)`},children:[m.jsx("div",{className:"flex items-center justify-center w-24 h-24 rounded-full bg-muted",children:m.jsx(pe,{className:"h-12 w-12 text-muted-foreground"})}),m.jsxs("div",{className:"flex flex-col gap-compact items-center max-w-md",children:[m.jsx("h2",{className:"text-lg font-bold text-foreground",children:"No organizations yet"}),m.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Start building your network by adding organizations like customers, prospects, principals, and distributors."})]}),m.jsxs("div",{className:"flex flex-col lg:flex-row gap-content max-w-3xl w-full px-content lg:px-0",children:[m.jsxs("div",{className:"flex flex-col gap-compact items-center lg:items-start text-center lg:text-left flex-1 p-content bg-card rounded-lg border border-border",children:[m.jsx("div",{className:"flex items-center justify-center w-11 h-11 rounded-full bg-primary/10",children:m.jsx(le,{className:"h-6 w-6 text-primary"})}),m.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Track relationships"}),m.jsx("p",{className:"text-xs text-muted-foreground",children:"Manage contacts, opportunities, and activities for each organization."})]}),m.jsxs("div",{className:"flex flex-col gap-compact items-center lg:items-start text-center lg:text-left flex-1 p-content bg-card rounded-lg border border-border",children:[m.jsx("div",{className:"flex items-center justify-center w-11 h-11 rounded-full bg-primary/10",children:m.jsx(pe,{className:"h-6 w-6 text-primary"})}),m.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Organize hierarchies"}),m.jsx("p",{className:"text-xs text-muted-foreground",children:"Set up parent-child relationships and track branch locations."})]}),m.jsxs("div",{className:"flex flex-col gap-compact items-center lg:items-start text-center lg:text-left flex-1 p-content bg-card rounded-lg border border-border",children:[m.jsx("div",{className:"flex items-center justify-center w-11 h-11 rounded-full bg-primary/10",children:m.jsx(xe,{className:"h-6 w-6 text-primary"})}),m.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Prioritize accounts"}),m.jsx("p",{className:"text-xs text-muted-foreground",children:"Assign priority levels and segments to focus on high-value accounts."})]})]}),m.jsxs("div",{className:"flex flex-col items-center gap-compact",children:[m.jsx(fe,{label:"Create Organization"}),m.jsx("p",{className:"text-xs text-muted-foreground",children:"Get started by adding your first organization"})]})]})},"OrganizationEmpty"),da=be([{key:"organization_type",label:"Type",type:"multiselect",choices:[...$e]},{key:"priority",label:"Priority",type:"multiselect",choices:[...Ae]},{key:"segment_id",label:"Playbook",type:"reference",reference:"segments"},{key:"sales_id",label:"Owner",type:"reference",reference:"sales"}]),ma=t(()=>m.jsxs(ut,{children:[m.jsx("span",{"data-tutorial":"org-sort-btn",children:m.jsx(Oe,{fields:["name","organization_type","priority"]})}),m.jsx("span",{"data-tutorial":"org-export-btn",children:m.jsx(je,{exporter:ua})}),m.jsx("span",{"data-tutorial":"create-organization-btn",children:m.jsx(fe,{})})]}),"OrganizationListActions"),ua=t(async(e,t)=>{const a=await t(e,"sales_id","sales"),s=await t(e,"segment_id","segments"),r=Array.from(new Set(e.map(e=>e.parent_organization_id).filter(Boolean))),n=r.length>0?await t(r.map(e=>({id:e,parent_organization_id:e})),"parent_organization_id","organizations"):{},i=e.map(e=>({id:e.id,name:e.name,organization_type:e.organization_type,priority:e.priority,parent_organization:e.parent_organization_id?n[e.parent_organization_id]?.name:void 0,segment:e.segment_id?s[e.segment_id]?.name:void 0,sales_rep:e.sales_id?`${a[e.sales_id]?.first_name} ${a[e.sales_id]?.last_name}`:void 0,website:e.website,phone:e.phone,email:e.email,address:e.address,city:e.city,state:e.state,postal_code:e.postal_code,nb_contacts:e.nb_contacts||0,nb_opportunities:e.nb_opportunities||0,created_at:e.created_at,sales_id:e.sales_id,segment_id:e.segment_id,parent_organization_id:e.parent_organization_id}));return E(i,{},(e,t)=>{P(t,"organizations")})},"exporter"),pa=t(({openSlideOver:e,isSlideOverOpen:a})=>{const{data:s,isPending:r,filterValues:n}=y(),{data:i,isPending:o}=k(),{focusedIndex:l}=Ce({onSelect:t(t=>e(Number(t),"view"),"onSelect"),enabled:!a}),c=n&&Object.keys(n).length>0;return r||o?m.jsx(ye,{resource:"organizations",filterComponent:m.jsx(Kt,{}),children:m.jsx(we,{})}):i?s?.length||c?m.jsxs(m.Fragment,{children:[m.jsxs(ye,{resource:"organizations",filterComponent:m.jsx(Kt,{}),children:[m.jsx(ve,{filterConfig:da}),m.jsxs(Ne,{onRowClick:t(t=>e(Number(t),"view"),"onRowClick"),focusedIndex:l,children:[m.jsx(ht,{source:"name",label:"Organization Name",sortable:!0}),m.jsx(xt,{label:"Type",sortBy:"organization_type",render:t(e=>m.jsx(Gt,{type:e.organization_type}),"render")}),m.jsx(xt,{label:"Priority",sortBy:"priority",render:t(e=>m.jsx(Yt,{priority:e.priority}),"render")}),m.jsx(Qe,{source:"parent_organization_id",reference:"organizations",label:"Parent",link:!1,emptyText:"-",sortable:!0,cellClassName:"hidden lg:table-cell",headerClassName:"hidden lg:table-cell",children:m.jsx(ht,{source:"name"})}),m.jsx(xt,{label:"Contacts",sortable:!1,render:t(e=>e.nb_contacts||0,"render"),textAlign:"center",cellClassName:"hidden md:table-cell",headerClassName:"hidden md:table-cell"}),m.jsx(xt,{label:"Opportunities",sortable:!1,render:t(e=>e.nb_opportunities||0,"render"),textAlign:"center",cellClassName:"hidden md:table-cell",headerClassName:"hidden md:table-cell"})]})]}),m.jsx(Jt,{})]}):m.jsx(ca,{}):null},"OrganizationListLayout"),xa=t(()=>{const{data:e,isPending:t}=k(),{slideOverId:a,isOpen:s,mode:r,openSlideOver:n,closeSlideOver:i,toggleMode:o}=Ee();return ke("organizations"),t?m.jsx(we,{}):e?m.jsxs(m.Fragment,{children:[m.jsx("div",{"data-tutorial":"organizations-list",children:m.jsxs(ge,{title:!1,actions:m.jsx(ma,{}),perPage:Fe,sort:{field:"name",order:"ASC"},exporter:ua,children:[m.jsx(pa,{openSlideOver:n,isSlideOverOpen:s}),m.jsx(ze,{})]})}),m.jsx(la,{recordId:a,isOpen:s,mode:r,onClose:i,onModeToggle:o}),m.jsx(pt,{chapter:"organizations",position:"bottom-left"})]}):null},"OrganizationList");export{xa as OrganizationList,xa as default};
