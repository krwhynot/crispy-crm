{"version":3,"file":"CampaignActivityReport-q_DnILJE.js","sources":["../../src/atomic-crm/reports/CampaignActivity/ActivityTypeCard.tsx","../../src/atomic-crm/reports/CampaignActivity/StaleLeadsView.tsx","../../src/atomic-crm/reports/CampaignActivity/CampaignActivityReport.tsx"],"sourcesContent":["import React from \"react\";\nimport { ChevronRight, ChevronDown } from \"lucide-react\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport type { ActivityGroup } from \"../types\";\nimport { parseDateSafely } from \"@/lib/date-utils\";\n\ninterface ActivityTypeCardProps {\n  group: ActivityGroup;\n  isExpanded: boolean;\n  onToggle: () => void;\n  salesMap: Map<number, string>;\n}\n\nconst ACTIVITY_ICONS: Record<string, string> = {\n  call: \"üìû\",\n  email: \"‚úâÔ∏è\",\n  meeting: \"ü§ù\",\n  note: \"üìù\",\n  demo: \"üéØ\",\n  proposal: \"üìã\",\n  \"follow-up\": \"üîÑ\",\n  \"trade-show\": \"üé™\",\n  \"site-visit\": \"üè¢\",\n  \"contract-review\": \"üìÑ\",\n  \"check-in\": \"‚úîÔ∏è\",\n  social: \"üí¨\",\n};\n\nconst getActivityTypeLabel = (type: string): string => {\n  return type\n    .split(\"-\")\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(\" \");\n};\n\nexport const ActivityTypeCard: React.FC<ActivityTypeCardProps> = ({\n  group,\n  isExpanded,\n  onToggle,\n  salesMap,\n}) => {\n  const icon = ACTIVITY_ICONS[group.type.toLowerCase()] || \"üìå\";\n  const label = getActivityTypeLabel(group.type);\n\n  // Use percentage from parent - parent always provides this value\n  const percentage = group.percentage ?? 0;\n\n  // Use provided most active org data if available, otherwise calculate\n  let mostActiveOrgDisplay: string;\n  let mostActiveOrgCount: number;\n\n  if (group.mostActiveOrg && group.mostActiveCount !== undefined) {\n    mostActiveOrgDisplay = group.mostActiveOrg;\n    mostActiveOrgCount = group.mostActiveCount;\n  } else {\n    // Fallback calculation for backwards compatibility\n    const orgCounts = new Map<number, number>();\n    group.activities.forEach((activity) => {\n      orgCounts.set(activity.organization_id, (orgCounts.get(activity.organization_id) || 0) + 1);\n    });\n\n    const sortedOrgCounts = Array.from(orgCounts.entries()).sort((a, b) => b[1] - a[1]);\n    const mostActiveOrgId = sortedOrgCounts[0]?.[0];\n    mostActiveOrgCount = orgCounts.get(mostActiveOrgId || 0) || 0;\n    mostActiveOrgDisplay = `Organization ${mostActiveOrgId}`;\n  }\n\n  return (\n    <Card className=\"mb-4\">\n      <CardHeader className=\"pb-3\">\n        <button\n          onClick={onToggle}\n          className=\"w-full text-left cursor-pointer hover:opacity-80 transition-opacity\"\n          aria-expanded={isExpanded}\n          aria-label={`${isExpanded ? \"Collapse\" : \"Expand\"} ${label} section with ${group.totalCount} activities`}\n        >\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <span className=\"text-2xl\" aria-hidden=\"true\">\n                {icon}\n              </span>\n              <div>\n                <h3 className=\"font-semibold text-base\">{label}</h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  {group.totalCount} activities ‚Ä¢ {group.uniqueOrgs} unique orgs ‚Ä¢ {percentage}%\n                </p>\n              </div>\n            </div>\n            {isExpanded ? (\n              <ChevronDown className=\"h-5 w-5\" aria-hidden=\"true\" />\n            ) : (\n              <ChevronRight className=\"h-5 w-5\" aria-hidden=\"true\" />\n            )}\n          </div>\n        </button>\n      </CardHeader>\n\n      {!isExpanded && (\n        <CardContent className=\"pt-0\">\n          <p className=\"text-sm text-muted-foreground\">\n            Most active:{\" \"}\n            <span className=\"font-medium\">\n              {mostActiveOrgDisplay} ({mostActiveOrgCount} {group.type}\n              {mostActiveOrgCount !== 1 ? \"s\" : \"\"})\n            </span>\n          </p>\n        </CardContent>\n      )}\n\n      {isExpanded && (\n        <CardContent className=\"pt-0\">\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full text-sm\">\n              <thead>\n                <tr className=\"border-b\">\n                  <th\n                    scope=\"col\"\n                    className=\"text-left py-2 px-3 font-semibold sticky left-0 bg-card\"\n                  >\n                    Organization\n                  </th>\n                  <th scope=\"col\" className=\"text-left py-2 px-3 font-semibold\">\n                    Contact\n                  </th>\n                  <th scope=\"col\" className=\"text-left py-2 px-3 font-semibold\">\n                    Date\n                  </th>\n                  <th scope=\"col\" className=\"text-left py-2 px-3 font-semibold\">\n                    Rep\n                  </th>\n                  <th scope=\"col\" className=\"text-left py-2 px-3 font-semibold\">\n                    Subject\n                  </th>\n                  <th scope=\"col\" className=\"text-center py-2 px-3 font-semibold\">\n                    Action\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                {group.activities.map((activity) => (\n                  <tr key={activity.id} className=\"border-b hover:bg-muted/50\">\n                    <td className=\"py-2 px-3 truncate max-w-xs sticky left-0 bg-card\">\n                      {activity.organization_name || `Organization ${activity.organization_id}`}\n                    </td>\n                    <td className=\"py-2 px-3 truncate max-w-xs\">\n                      {activity.contact_name ? activity.contact_name : \"‚Äî\"}\n                    </td>\n                    <td className=\"py-2 px-3 whitespace-nowrap\">\n                      {parseDateSafely(activity.created_at)?.toLocaleDateString() || \"‚Äî\"}\n                    </td>\n                    <td className=\"py-2 px-3 whitespace-nowrap\">\n                      {salesMap.get(activity.created_by) || \"Unassigned\"}\n                    </td>\n                    <td className=\"py-2 px-3 truncate max-w-xs\">{activity.subject}</td>\n                    <td className=\"py-2 px-3 text-center\">\n                      <button className=\"text-primary hover:underline min-w-[44px] min-h-[44px] inline-flex items-center justify-center\">\n                        View\n                      </button>\n                    </td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </div>\n        </CardContent>\n      )}\n    </Card>\n  );\n};\n","import React from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useNavigate } from \"react-router-dom\";\nimport { format } from \"date-fns\";\nimport { STAGE_STALE_THRESHOLDS } from \"@/atomic-crm/utils/stalenessCalculation\";\nimport { parseDateSafely } from \"@/lib/date-utils\";\n\n/**\n * Stale opportunity with per-stage threshold info\n * Used by StaleLeadsView to display opportunities exceeding their stage-specific thresholds\n */\ninterface StaleOpportunity {\n  id: number;\n  name: string;\n  stage?: string;\n  customer_organization_name?: string;\n  lastActivityDate: string | null;\n  daysInactive: number;\n  /** Per-stage threshold in days (undefined for closed stages) */\n  stageThreshold?: number;\n  /** Whether this opportunity is stale per its stage threshold */\n  isStale: boolean;\n}\n\ninterface StaleLeadsViewProps {\n  campaignName: string;\n  staleOpportunities: StaleOpportunity[];\n}\n\nexport const StaleLeadsView: React.FC<StaleLeadsViewProps> = ({\n  campaignName,\n  staleOpportunities,\n}) => {\n  const navigate = useNavigate();\n\n  const formatLastActivity = (date: string | null): string => {\n    if (!date) return \"Never\";\n    const dateObj = parseDateSafely(date);\n    if (!dateObj) return \"Never\";\n    return format(dateObj, \"MMM d, yyyy\");\n  };\n\n  /** Format stage name for display (e.g., \"new_lead\" -> \"New Lead\") */\n  const formatStageName = (stage: string | undefined): string => {\n    if (!stage) return \"Unknown\";\n    return stage\n      .split(\"_\")\n      .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n      .join(\" \");\n  };\n\n  /** Get days over threshold for urgency display */\n  const getDaysOverThreshold = (opp: StaleOpportunity): number => {\n    if (!opp.stageThreshold) return 0;\n    return Math.max(0, opp.daysInactive - opp.stageThreshold);\n  };\n\n  return (\n    <div>\n      <div className=\"mb-4\">\n        <h3 className=\"text-lg font-semibold\">Stale Leads Report: {campaignName}</h3>\n        <p className=\"text-sm text-muted-foreground\">\n          Showing {staleOpportunities.length}{\" \"}\n          {staleOpportunities.length === 1 ? \"opportunity\" : \"opportunities\"} exceeding per-stage\n          activity thresholds (PRD Section 6.3)\n        </p>\n        <p className=\"text-xs text-muted-foreground mt-1\">\n          Thresholds: New Lead {STAGE_STALE_THRESHOLDS.new_lead}d ‚Ä¢ Outreach/Sample/Demo{\" \"}\n          {STAGE_STALE_THRESHOLDS.initial_outreach}d ‚Ä¢ Feedback{\" \"}\n          {STAGE_STALE_THRESHOLDS.feedback_logged}d ‚Ä¢ Closed stages excluded\n        </p>\n      </div>\n\n      {staleOpportunities.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-8 text-center\">\n            <p className=\"text-muted-foreground\">\n              No stale leads found! All open opportunities are within their stage-specific activity\n              thresholds.\n            </p>\n          </CardContent>\n        </Card>\n      ) : (\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-base\">Opportunities Requiring Follow-up</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full text-sm\">\n                <thead>\n                  <tr className=\"border-b\">\n                    <th\n                      scope=\"col\"\n                      className=\"text-left py-3 px-3 font-semibold sticky left-0 bg-card\"\n                    >\n                      Opportunity\n                    </th>\n                    <th scope=\"col\" className=\"text-left py-3 px-3 font-semibold\">\n                      Organization\n                    </th>\n                    <th scope=\"col\" className=\"text-left py-3 px-3 font-semibold\">\n                      Stage\n                    </th>\n                    <th scope=\"col\" className=\"text-left py-3 px-3 font-semibold\">\n                      Last Activity\n                    </th>\n                    <th scope=\"col\" className=\"text-left py-3 px-3 font-semibold\">\n                      Days Over Threshold\n                    </th>\n                    <th scope=\"col\" className=\"text-center py-3 px-3 font-semibold\">\n                      Action\n                    </th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {staleOpportunities.map((opp) => {\n                    const daysOver = getDaysOverThreshold(opp);\n                    return (\n                      <tr key={opp.id} className=\"border-b hover:bg-muted/50\">\n                        <td className=\"py-3 px-3 truncate max-w-xs sticky left-0 bg-card\">\n                          {opp.name || `Opportunity ${opp.id}`}\n                        </td>\n                        <td className=\"py-3 px-3 truncate max-w-xs\">\n                          {opp.customer_organization_name || \"‚Äî\"}\n                        </td>\n                        <td className=\"py-3 px-3 whitespace-nowrap\">\n                          <Badge variant=\"outline\" className=\"text-xs\">\n                            {formatStageName(opp.stage)}\n                          </Badge>\n                          <span className=\"text-xs text-muted-foreground ml-1\">\n                            ({opp.stageThreshold}d threshold)\n                          </span>\n                        </td>\n                        <td className=\"py-3 px-3 whitespace-nowrap\">\n                          {formatLastActivity(opp.lastActivityDate)}\n                        </td>\n                        <td className=\"py-3 px-3 whitespace-nowrap\">\n                          <span\n                            className={\n                              opp.daysInactive >= 999999\n                                ? \"text-destructive font-semibold\"\n                                : daysOver >= (opp.stageThreshold || 7)\n                                  ? \"text-destructive font-semibold\"\n                                  : daysOver >= Math.floor((opp.stageThreshold || 7) / 2)\n                                    ? \"text-warning font-semibold\"\n                                    : \"text-muted-foreground\"\n                            }\n                          >\n                            {opp.daysInactive >= 999999\n                              ? \"Never contacted\"\n                              : `+${daysOver}d over (${opp.daysInactive}d inactive)`}\n                          </span>\n                        </td>\n                        <td className=\"py-3 px-3 text-center\">\n                          <Button\n                            variant=\"link\"\n                            size=\"sm\"\n                            onClick={() => navigate(`/opportunities/${opp.id}/show`)}\n                            className=\"h-auto p-0 min-w-[44px] min-h-[44px]\"\n                            aria-label={`View opportunity ${opp.name || opp.id}`}\n                          >\n                            View Opportunity\n                          </Button>\n                        </td>\n                      </tr>\n                    );\n                  })}\n                </tbody>\n              </table>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n};\n","import React, { useMemo, useState } from \"react\";\nimport { useGetList, useNotify, downloadCSV } from \"ra-core\";\nimport jsonExport from \"jsonexport/dist\";\nimport { ReportLayout } from \"@/atomic-crm/reports/ReportLayout\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ActivityTypeCard } from \"./ActivityTypeCard\";\nimport { StaleLeadsView } from \"./StaleLeadsView\";\nimport { INTERACTION_TYPE_OPTIONS } from \"@/atomic-crm/validation/activities\";\nimport { sanitizeCsvValue } from \"@/atomic-crm/utils/csvUploadValidator\";\nimport {\n  STAGE_STALE_THRESHOLDS,\n  isOpportunityStale,\n  getStaleThreshold,\n} from \"@/atomic-crm/utils/stalenessCalculation\";\nimport { format, subDays, startOfMonth } from \"date-fns\";\nimport { parseDateSafely } from \"@/lib/date-utils\";\nimport type { Sale, Activity as BaseActivity, ActivityGroup } from \"../types\";\n\n/** Extended activity with required organization_name for campaign reporting */\ninterface CampaignActivity extends Omit<BaseActivity, \"organization_name\"> {\n  organization_name: string; // Required for campaign reports\n}\n\n/** Campaign-specific opportunity data */\ninterface CampaignOpportunity {\n  id: number;\n  name: string;\n  campaign: string | null;\n  customer_organization_name?: string;\n  stage?: string;\n}\n\n/** Extended ActivityGroup with required percentage for campaign reports */\ninterface CampaignActivityGroup\n  extends Omit<ActivityGroup, \"percentage\" | \"mostActiveOrg\" | \"mostActiveCount\" | \"activities\"> {\n  activities: CampaignActivity[];\n  percentage: number;\n  mostActiveOrg: string;\n  mostActiveCount: number;\n}\n\nexport default function CampaignActivityReport() {\n  const notify = useNotify();\n  const [expandedTypes, setExpandedTypes] = useState<Set<string>>(new Set());\n  const [selectedCampaign, setSelectedCampaign] = useState<string>(\"Grand Rapids Trade Show\");\n\n  // Filter state\n  const [dateRange, setDateRange] = useState<{ start: string; end: string } | null>(null);\n  const [selectedActivityTypes, setSelectedActivityTypes] = useState<string[]>(\n    INTERACTION_TYPE_OPTIONS.map((opt) => opt.value)\n  );\n  const [datePreset, setDatePreset] = useState<string>(\"allTime\");\n  const [selectedSalesRep, setSelectedSalesRep] = useState<number | null>(null);\n  const [showStaleLeads, setShowStaleLeads] = useState<boolean>(false);\n  // Per-stage thresholds from PRD Section 6.3 - no longer using a fixed threshold\n  // Thresholds: new_lead=7d, initial_outreach=14d, sample_visit_offered=14d, feedback_logged=21d, demo_scheduled=14d\n  // Closed stages (closed_won, closed_lost) are excluded from staleness calculations\n  const [ariaLiveMessage, setAriaLiveMessage] = useState<string>(\"\");\n\n  // Track if initial expansion has happened (prevents re-expansion on re-renders)\n  const hasInitialized = React.useRef(false);\n\n  // Fetch all opportunities to get available campaigns\n  const { data: allOpportunities = [], isPending: opportunitiesPending } =\n    useGetList<CampaignOpportunity>(\"opportunities\", {\n      pagination: { page: 1, perPage: 10000 },\n      filter: {\n        \"deleted_at@is\": null,\n      },\n    });\n\n  // Get distinct campaigns with opportunity counts\n  const campaignOptions = useMemo(() => {\n    const campaigns = new Map<string, number>();\n\n    allOpportunities.forEach((opp) => {\n      if (opp.campaign) {\n        campaigns.set(opp.campaign, (campaigns.get(opp.campaign) || 0) + 1);\n      }\n    });\n\n    return Array.from(campaigns.entries())\n      .map(([name, count]) => ({ name, count }))\n      .sort((a, b) => b.count - a.count);\n  }, [allOpportunities]);\n\n  // Fetch ALL activities for the selected campaign (unfiltered, for counts)\n  const { data: allCampaignActivities = [], isPending: allActivitiesPending } =\n    useGetList<CampaignActivity>(\"activities\", {\n      pagination: { page: 1, perPage: 10000 },\n      filter: {\n        \"opportunities.campaign\": selectedCampaign,\n        \"opportunities.deleted_at@is\": null,\n      },\n      sort: { field: \"created_at\", order: \"DESC\" },\n    });\n\n  // Fetch activities for the selected campaign (with filters applied)\n  const { data: activities = [], isPending: activitiesPending } = useGetList<CampaignActivity>(\n    \"activities\",\n    {\n      pagination: { page: 1, perPage: 10000 },\n      filter: {\n        \"opportunities.campaign\": selectedCampaign,\n        \"opportunities.deleted_at@is\": null,\n        ...(dateRange?.start && { \"created_at@gte\": dateRange.start }),\n        ...(dateRange?.end && { \"created_at@lte\": dateRange.end }),\n        ...(selectedActivityTypes.length > 0 &&\n          selectedActivityTypes.length < INTERACTION_TYPE_OPTIONS.length && {\n            type: selectedActivityTypes,\n          }),\n        ...(selectedSalesRep !== null && { created_by: selectedSalesRep }),\n      },\n      sort: { field: \"created_at\", order: \"DESC\" },\n    }\n  );\n\n  // Get sales rep names for created_by lookup\n  const ownerIds = useMemo(\n    () => Array.from(new Set((activities || []).map((a) => a.created_by).filter(Boolean))),\n    [activities]\n  );\n\n  const { data: salesReps = [] } = useGetList<Sale>(\"sales\", {\n    filter: ownerIds.length > 0 ? { id: ownerIds } : undefined,\n    pagination: { page: 1, perPage: 100 },\n  });\n\n  const salesMap = useMemo(\n    () => new Map((salesReps || []).map((s) => [s.id, `${s.first_name} ${s.last_name}`])),\n    [salesReps]\n  );\n\n  // Create opportunity map for looking up opportunity details\n  const opportunityMap = useMemo(\n    () => new Map((allOpportunities || []).map((o) => [o.id, o])),\n    [allOpportunities]\n  );\n\n  // Calculate sales rep options with activity counts from ALL activities (unfiltered)\n  const salesRepOptions = useMemo(() => {\n    const repCounts = new Map<number, number>();\n\n    allCampaignActivities.forEach((activity) => {\n      if (activity.created_by) {\n        repCounts.set(activity.created_by, (repCounts.get(activity.created_by) || 0) + 1);\n      }\n    });\n\n    return Array.from(repCounts.entries())\n      .map(([id, count]) => ({\n        id,\n        name: salesMap.get(id) || `Rep ${id}`,\n        count,\n      }))\n      .sort((a, b) => b.count - a.count);\n  }, [allCampaignActivities, salesMap]);\n\n  // Group activities by type\n  const activityGroups = useMemo(() => {\n    if (!activities || activities.length === 0) return [];\n\n    const grouped = new Map<string, CampaignActivityGroup>();\n    const totalActivities = activities.length;\n\n    activities.forEach((activity) => {\n      const type = activity.type || \"Unknown\";\n\n      if (!grouped.has(type)) {\n        grouped.set(type, {\n          type,\n          activities: [],\n          totalCount: 0,\n          uniqueOrgs: 0,\n          percentage: 0,\n          mostActiveOrg: \"\",\n          mostActiveCount: 0,\n        });\n      }\n\n      const group = grouped.get(type)!;\n      group.activities.push(activity);\n      group.totalCount += 1;\n    });\n\n    // Calculate metrics for each group\n    const result = Array.from(grouped.values()).map((group) => {\n      const orgCounts = new Map<number, { name: string; count: number }>();\n\n      group.activities.forEach((activity) => {\n        const orgId = activity.organization_id;\n        if (!orgCounts.has(orgId)) {\n          orgCounts.set(orgId, {\n            name: activity.organization_name || `Organization ${orgId}`,\n            count: 0,\n          });\n        }\n        orgCounts.get(orgId)!.count += 1;\n      });\n\n      const uniqueOrgs = orgCounts.size;\n      const sortedOrgs = Array.from(orgCounts.entries()).sort((a, b) => b[1].count - a[1].count);\n      const [, mostActiveData] = sortedOrgs[0] || [null, { name: \"N/A\", count: 0 }];\n\n      return {\n        ...group,\n        uniqueOrgs,\n        percentage: Math.round((group.totalCount / totalActivities) * 100),\n        mostActiveOrg: mostActiveData.name,\n        mostActiveCount: mostActiveData.count,\n      };\n    });\n\n    return result.sort((a, b) => b.totalCount - a.totalCount);\n  }, [activities]);\n\n  // Helper function: Get last activity date for an opportunity\n  const getLastActivityForOpportunity = (\n    oppId: number,\n    activities: CampaignActivity[]\n  ): string | null => {\n    const oppActivities = activities.filter((a) => a.opportunity_id === oppId);\n    if (oppActivities.length === 0) return null;\n\n    const sortedActivities = oppActivities.sort((a, b) => {\n      const dateA = parseDateSafely(a.created_at);\n      const dateB = parseDateSafely(b.created_at);\n      if (!dateA || !dateB) return 0;\n      return dateB.getTime() - dateA.getTime();\n    });\n\n    return sortedActivities[0].created_at;\n  };\n\n  // Calculate stale opportunities using per-stage thresholds (PRD Section 6.3)\n  // Closed stages (closed_won, closed_lost) are excluded from staleness calculations\n  const staleOpportunities = useMemo(() => {\n    if (!showStaleLeads || !allOpportunities) return [];\n\n    const opportunitiesForCampaign = allOpportunities.filter(\n      (o) => o.campaign === selectedCampaign\n    );\n    const now = new Date();\n\n    return (\n      opportunitiesForCampaign\n        .map((opp) => {\n          const lastActivityDate = getLastActivityForOpportunity(opp.id, allCampaignActivities);\n          const lastActivityDateObj = lastActivityDate ? parseDateSafely(lastActivityDate) : null;\n          const daysInactive = lastActivityDateObj\n            ? Math.floor((now.getTime() - lastActivityDateObj.getTime()) / (1000 * 60 * 60 * 24))\n            : 999999; // Never had activity - sort to end\n\n          // Get per-stage threshold (undefined for closed stages)\n          const stage = opp.stage || \"new_lead\";\n          const stageThreshold = getStaleThreshold(stage);\n\n          return {\n            ...opp,\n            lastActivityDate,\n            daysInactive,\n            stageThreshold, // Include threshold for display\n            isStale: isOpportunityStale(stage, lastActivityDate, now),\n          };\n        })\n        // Exclude closed stages (stageThreshold is undefined for them)\n        // Only include opportunities that are actually stale per their stage threshold\n        .filter((opp) => opp.isStale && opp.stageThreshold !== undefined)\n        .sort((a, b) => {\n          // Sort by \"days over threshold\" (most urgent first)\n          const aOverage = a.daysInactive - (a.stageThreshold || 0);\n          const bOverage = b.daysInactive - (b.stageThreshold || 0);\n          return bOverage - aOverage;\n        })\n    );\n  }, [showStaleLeads, allOpportunities, selectedCampaign, allCampaignActivities]);\n\n  // Auto-expand top 3 activity types on load\n  React.useEffect(() => {\n    if (activityGroups.length > 0 && !hasInitialized.current) {\n      const topThreeTypes = new Set(activityGroups.slice(0, 3).map((g) => g.type));\n      setExpandedTypes(topThreeTypes);\n      hasInitialized.current = true;\n    }\n  }, [activityGroups]);\n\n  // Announce view changes to screen readers\n  React.useEffect(() => {\n    if (showStaleLeads) {\n      setAriaLiveMessage(\n        `Switched to stale leads view. Showing ${staleOpportunities.length} opportunities exceeding their per-stage activity thresholds.`\n      );\n    } else {\n      setAriaLiveMessage(\n        `Switched to activity breakdown view. Showing ${activityGroups.length} activity types.`\n      );\n    }\n    // Clear message after announcement\n    const timer = setTimeout(() => setAriaLiveMessage(\"\"), 1000);\n    return () => clearTimeout(timer);\n  }, [showStaleLeads, staleOpportunities.length, activityGroups.length]);\n\n  // Calculate summary metrics\n  const totalActivities = activities.length;\n  const uniqueOrgs = new Set(activities.map((a) => a.organization_id)).size;\n  const totalOpportunities =\n    allOpportunities.filter((opp) => opp.campaign === selectedCampaign).length || 1;\n  const coverageRate =\n    totalOpportunities > 0 ? Math.round((uniqueOrgs / totalOpportunities) * 100) : 0;\n  const avgActivitiesPerLead =\n    totalOpportunities > 0 ? (totalActivities / totalOpportunities).toFixed(1) : \"0.0\";\n\n  const handleToggle = (type: string) => {\n    const newExpanded = new Set(expandedTypes);\n    if (newExpanded.has(type)) {\n      newExpanded.delete(type);\n    } else {\n      newExpanded.add(type);\n    }\n    setExpandedTypes(newExpanded);\n  };\n\n  // Date preset handlers\n  const setDatePresetHandler = (preset: string) => {\n    setDatePreset(preset);\n    const today = new Date();\n    switch (preset) {\n      case \"last7\":\n        setDateRange({\n          start: format(subDays(today, 7), \"yyyy-MM-dd\"),\n          end: format(today, \"yyyy-MM-dd\"),\n        });\n        break;\n      case \"last30\":\n        setDateRange({\n          start: format(subDays(today, 30), \"yyyy-MM-dd\"),\n          end: format(today, \"yyyy-MM-dd\"),\n        });\n        break;\n      case \"thisMonth\":\n        setDateRange({\n          start: format(startOfMonth(today), \"yyyy-MM-dd\"),\n          end: format(today, \"yyyy-MM-dd\"),\n        });\n        break;\n      case \"allTime\":\n      default:\n        setDateRange(null);\n        break;\n    }\n  };\n\n  // Activity type toggle handler\n  const toggleActivityType = (type: string) => {\n    if (selectedActivityTypes.includes(type)) {\n      // Don't allow deselecting if it's the last one\n      if (selectedActivityTypes.length > 1) {\n        setSelectedActivityTypes(selectedActivityTypes.filter((t) => t !== type));\n      }\n    } else {\n      setSelectedActivityTypes([...selectedActivityTypes, type]);\n    }\n  };\n\n  // Select/deselect all activity types\n  const toggleAllActivityTypes = () => {\n    if (selectedActivityTypes.length === INTERACTION_TYPE_OPTIONS.length) {\n      setSelectedActivityTypes([]);\n    } else {\n      setSelectedActivityTypes(INTERACTION_TYPE_OPTIONS.map((opt) => opt.value));\n    }\n  };\n\n  // Clear all filters (keeps campaign selected)\n  const clearFilters = () => {\n    setDateRange(null);\n    setSelectedActivityTypes(INTERACTION_TYPE_OPTIONS.map((opt) => opt.value));\n    setDatePreset(\"allTime\");\n    setSelectedSalesRep(null);\n    setShowStaleLeads(false);\n  };\n\n  // Check if any filters are active\n  const hasActiveFilters =\n    dateRange !== null ||\n    selectedActivityTypes.length < INTERACTION_TYPE_OPTIONS.length ||\n    selectedSalesRep !== null ||\n    showStaleLeads;\n\n  // Check if data is loading\n  const isLoadingCampaigns = opportunitiesPending;\n  const isLoadingActivities = activitiesPending || allActivitiesPending;\n\n  // Calculate activity counts by type for all activities (unfiltered)\n  const activityTypeCounts = useMemo(() => {\n    const counts = new Map<string, number>();\n    allCampaignActivities.forEach((activity) => {\n      const type = activity.type || \"Unknown\";\n      counts.set(type, (counts.get(type) || 0) + 1);\n    });\n    return counts;\n  }, [allCampaignActivities]);\n\n  // CSV Export Function\n  const handleExport = () => {\n    if (showStaleLeads) {\n      // Export stale leads\n      if (staleOpportunities.length === 0) {\n        notify(\"No stale leads to export\", { type: \"warning\" });\n        return;\n      }\n\n      const exportData = staleOpportunities.map((opp) => {\n        const lastActivityDateObj = opp.lastActivityDate\n          ? parseDateSafely(opp.lastActivityDate)\n          : null;\n        return {\n          campaign: sanitizeCsvValue(selectedCampaign),\n          opportunity_name: sanitizeCsvValue(opp.name),\n          organization: sanitizeCsvValue(opp.customer_organization_name || \"\"),\n          last_activity_date: lastActivityDateObj\n            ? format(lastActivityDateObj, \"yyyy-MM-dd\")\n            : \"Never\",\n          days_inactive:\n            opp.daysInactive >= 999999 ? \"Never contacted\" : opp.daysInactive.toString(),\n          notes: \"\", // Not available in current data structure\n        };\n      });\n\n      jsonExport(exportData, (err, csv) => {\n        if (err) {\n          console.error(\"Export error:\", err);\n          notify(\"Export failed. Please try again.\", { type: \"error\" });\n          return;\n        }\n        const campaignSlug = selectedCampaign\n          .toLowerCase()\n          .replace(/\\s+/g, \"-\")\n          .replace(/[^\\w-]/g, \"\");\n        const dateStr = format(new Date(), \"yyyy-MM-dd\");\n        downloadCSV(csv, `campaign-stale-leads-${campaignSlug}-${dateStr}`);\n        notify(`${staleOpportunities.length} stale leads exported successfully`, {\n          type: \"success\",\n        });\n      });\n    } else {\n      // Export activities\n      if (activityGroups.length === 0 || activities.length === 0) {\n        notify(\"No activities to export\", { type: \"warning\" });\n        return;\n      }\n\n      const exportData = activityGroups.flatMap((group) =>\n        group.activities.map((activity) => {\n          const opportunity = activity.opportunity_id\n            ? opportunityMap.get(activity.opportunity_id)\n            : null;\n          const createdAtDate = parseDateSafely(activity.created_at);\n          const daysSinceActivity = createdAtDate\n            ? Math.floor((Date.now() - createdAtDate.getTime()) / (1000 * 60 * 60 * 24))\n            : 0;\n\n          return {\n            campaign: sanitizeCsvValue(selectedCampaign),\n            activity_type: sanitizeCsvValue(activity.type),\n            activity_category: sanitizeCsvValue(activity.type), // Same as activity_type for now\n            subject: sanitizeCsvValue(activity.subject),\n            organization: sanitizeCsvValue(activity.organization_name),\n            contact_name: sanitizeCsvValue(activity.contact_name || \"\"),\n            date: createdAtDate ? format(createdAtDate, \"yyyy-MM-dd\") : \"\",\n            sales_rep: sanitizeCsvValue(salesMap.get(activity.created_by!) || \"Unassigned\"),\n            days_since_activity: daysSinceActivity,\n            opportunity_name: sanitizeCsvValue(opportunity?.name || \"\"),\n            opportunity_stage: sanitizeCsvValue(opportunity?.stage || \"\"),\n          };\n        })\n      );\n\n      jsonExport(exportData, (err, csv) => {\n        if (err) {\n          console.error(\"Export error:\", err);\n          notify(\"Export failed. Please try again.\", { type: \"error\" });\n          return;\n        }\n        const campaignSlug = selectedCampaign\n          .toLowerCase()\n          .replace(/\\s+/g, \"-\")\n          .replace(/[^\\w-]/g, \"\");\n        const dateStr = format(new Date(), \"yyyy-MM-dd\");\n        downloadCSV(csv, `campaign-activity-${campaignSlug}-${dateStr}`);\n        notify(`${exportData.length} activities exported successfully`, { type: \"success\" });\n      });\n    }\n  };\n\n  return (\n    <ReportLayout title=\"Campaign Activity Report\">\n      {/* Screen reader announcements */}\n      <div className=\"sr-only\" role=\"status\" aria-live=\"polite\" aria-atomic=\"true\">\n        {ariaLiveMessage}\n      </div>\n\n      {/* Campaign Selector and Filters */}\n      <div className=\"mb-section\">\n        <div className=\"flex flex-col sm:flex-row sm:items-end gap-4 mb-4\">\n          <div className=\"flex-1 sm:max-w-xs\">\n            <Label htmlFor=\"campaign-select\" className=\"block text-sm font-medium mb-2\">\n              Select Campaign\n            </Label>\n            {isLoadingCampaigns ? (\n              <div\n                className=\"h-10 bg-muted animate-pulse rounded-md\"\n                role=\"status\"\n                aria-label=\"Loading campaigns\"\n              />\n            ) : (\n              <Select value={selectedCampaign} onValueChange={setSelectedCampaign}>\n                <SelectTrigger id=\"campaign-select\">\n                  <SelectValue placeholder=\"Choose a campaign\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {campaignOptions.map((campaign) => (\n                    <SelectItem key={campaign.name} value={campaign.name}>\n                      {campaign.name} ({campaign.count} opportunities)\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            )}\n          </div>\n          <div className=\"flex flex-col sm:flex-row gap-2 w-full sm:w-auto\">\n            {hasActiveFilters && (\n              <Button variant=\"outline\" onClick={clearFilters} className=\"w-full sm:w-auto\">\n                Clear Filters\n              </Button>\n            )}\n            <Button\n              variant=\"default\"\n              onClick={handleExport}\n              disabled={\n                isLoadingActivities ||\n                (showStaleLeads ? staleOpportunities.length === 0 : activities.length === 0)\n              }\n              className=\"w-full sm:w-auto\"\n            >\n              Export to CSV\n            </Button>\n          </div>\n        </div>\n\n        {/* Filter Panel */}\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-section\">\n              {/* Date Range Filter */}\n              <div>\n                <h4 className=\"text-sm font-medium mb-3\">Date Range</h4>\n                <div className=\"space-y-3\">\n                  <div className=\"flex gap-2 flex-wrap\">\n                    <Button\n                      variant={datePreset === \"allTime\" ? \"default\" : \"outline\"}\n                      size=\"sm\"\n                      onClick={() => setDatePresetHandler(\"allTime\")}\n                    >\n                      All time\n                    </Button>\n                    <Button\n                      variant={datePreset === \"last7\" ? \"default\" : \"outline\"}\n                      size=\"sm\"\n                      onClick={() => setDatePresetHandler(\"last7\")}\n                    >\n                      Last 7 days\n                    </Button>\n                    <Button\n                      variant={datePreset === \"last30\" ? \"default\" : \"outline\"}\n                      size=\"sm\"\n                      onClick={() => setDatePresetHandler(\"last30\")}\n                    >\n                      Last 30 days\n                    </Button>\n                    <Button\n                      variant={datePreset === \"thisMonth\" ? \"default\" : \"outline\"}\n                      size=\"sm\"\n                      onClick={() => setDatePresetHandler(\"thisMonth\")}\n                    >\n                      This month\n                    </Button>\n                  </div>\n                  <div className=\"flex gap-2 items-center\">\n                    <div className=\"flex-1\">\n                      <Label htmlFor=\"start-date\" className=\"text-xs\">\n                        Start Date\n                      </Label>\n                      <input\n                        id=\"start-date\"\n                        type=\"date\"\n                        value={dateRange?.start || \"\"}\n                        onChange={(e) => {\n                          const newStart = e.target.value;\n                          setDatePreset(\"\"); // Clear preset when manual input\n                          const endDate = dateRange?.end || format(new Date(), \"yyyy-MM-dd\");\n                          // Only update if start <= end\n                          if (newStart <= endDate) {\n                            setDateRange({ start: newStart, end: endDate });\n                          }\n                        }}\n                        className=\"w-full mt-1 px-3 py-2 border rounded-md text-sm\"\n                      />\n                    </div>\n                    <div className=\"flex-1\">\n                      <Label htmlFor=\"end-date\" className=\"text-xs\">\n                        End Date\n                      </Label>\n                      <input\n                        id=\"end-date\"\n                        type=\"date\"\n                        value={dateRange?.end || \"\"}\n                        onChange={(e) => {\n                          const newEnd = e.target.value;\n                          setDatePreset(\"\"); // Clear preset when manual input\n                          const startDate = dateRange?.start || format(new Date(), \"yyyy-MM-dd\");\n                          // Only update if start <= end\n                          if (startDate <= newEnd) {\n                            setDateRange({ start: startDate, end: newEnd });\n                          }\n                        }}\n                        className=\"w-full mt-1 px-3 py-2 border rounded-md text-sm\"\n                      />\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Activity Type Filter */}\n              <div>\n                <div className=\"flex items-center justify-between mb-3\">\n                  <h4 className=\"text-sm font-medium\">Activity Type</h4>\n                  <Button\n                    variant=\"link\"\n                    size=\"sm\"\n                    onClick={toggleAllActivityTypes}\n                    className=\"h-auto p-0 text-xs\"\n                  >\n                    {selectedActivityTypes.length === INTERACTION_TYPE_OPTIONS.length\n                      ? \"Deselect All\"\n                      : \"Select All\"}\n                  </Button>\n                </div>\n                <div className=\"grid grid-cols-2 gap-2 max-h-64 overflow-y-auto\">\n                  {INTERACTION_TYPE_OPTIONS.map((option) => {\n                    const count = activityTypeCounts.get(option.value) || 0;\n                    return (\n                      <div key={option.value} className=\"flex items-center space-x-2\">\n                        <Checkbox\n                          id={`activity-type-${option.value}`}\n                          checked={selectedActivityTypes.includes(option.value)}\n                          onCheckedChange={() => toggleActivityType(option.value)}\n                        />\n                        <Label\n                          htmlFor={`activity-type-${option.value}`}\n                          className=\"text-sm font-normal cursor-pointer flex-1\"\n                        >\n                          {option.label} ({count})\n                        </Label>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n\n              {/* Sales Rep Filter */}\n              <div>\n                <h4 className=\"text-sm font-medium mb-3\">Sales Rep</h4>\n                <Select\n                  value={selectedSalesRep?.toString() || \"all\"}\n                  onValueChange={(value) =>\n                    setSelectedSalesRep(value === \"all\" ? null : parseInt(value, 10))\n                  }\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"All Reps\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Reps ({allCampaignActivities.length})</SelectItem>\n                    {salesRepOptions.map((rep) => (\n                      <SelectItem key={rep.id} value={rep.id.toString()}>\n                        {rep.name} ({rep.count})\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n\n              {/* Stale Leads Filter - Using Per-Stage Thresholds (PRD Section 6.3) */}\n              <div>\n                <h4 className=\"text-sm font-medium mb-3\">Stale Leads</h4>\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id=\"show-stale-leads\"\n                      checked={showStaleLeads}\n                      onCheckedChange={(checked) => setShowStaleLeads(checked === true)}\n                    />\n                    <Label\n                      htmlFor=\"show-stale-leads\"\n                      className=\"text-sm font-normal cursor-pointer\"\n                    >\n                      Show stale leads (per-stage thresholds)\n                    </Label>\n                  </div>\n                  {/* Per-stage threshold info */}\n                  <div className=\"text-xs text-muted-foreground space-y-0.5\">\n                    <p>Thresholds by stage:</p>\n                    <p className=\"pl-2\">‚Ä¢ New Lead: {STAGE_STALE_THRESHOLDS.new_lead}d</p>\n                    <p className=\"pl-2\">\n                      ‚Ä¢ Outreach/Sample/Demo: {STAGE_STALE_THRESHOLDS.initial_outreach}d\n                    </p>\n                    <p className=\"pl-2\">‚Ä¢ Feedback: {STAGE_STALE_THRESHOLDS.feedback_logged}d</p>\n                    <p className=\"pl-2 italic\">Closed stages excluded</p>\n                  </div>\n                  {showStaleLeads && staleOpportunities.length > 0 && (\n                    <div className=\"text-xs font-medium text-warning bg-warning/10 px-2 py-1 rounded\">\n                      ‚ö†Ô∏è {staleOpportunities.length}{\" \"}\n                      {staleOpportunities.length === 1 ? \"lead needs\" : \"leads need\"} follow-up\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-4 gap-content mb-section\">\n        {isLoadingActivities ? (\n          <>\n            {[1, 2, 3, 4].map((i) => (\n              <Card key={i}>\n                <CardHeader className=\"pb-2\">\n                  <div className=\"h-4 bg-muted animate-pulse rounded w-3/4\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"h-8 bg-muted animate-pulse rounded w-1/2\" />\n                </CardContent>\n              </Card>\n            ))}\n          </>\n        ) : (\n          <>\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  Total Activities\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{totalActivities}</div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  Organizations Contacted\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{uniqueOrgs}</div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  Coverage Rate\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{coverageRate}%</div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  Avg Activities per Lead\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{avgActivitiesPerLead}</div>\n              </CardContent>\n            </Card>\n          </>\n        )}\n      </div>\n\n      {/* Conditional Rendering: Stale Leads View or Activity Type Breakdown */}\n      {isLoadingActivities ? (\n        <div className=\"space-y-4\" role=\"status\" aria-label=\"Loading campaign activities\">\n          <div className=\"h-6 bg-muted animate-pulse rounded w-48 mb-4\" />\n          {[1, 2, 3].map((i) => (\n            <Card key={i}>\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"h-8 w-8 bg-muted animate-pulse rounded\" />\n                  <div className=\"flex-1\">\n                    <div className=\"h-5 bg-muted animate-pulse rounded w-32 mb-2\" />\n                    <div className=\"h-4 bg-muted animate-pulse rounded w-64\" />\n                  </div>\n                </div>\n              </CardHeader>\n            </Card>\n          ))}\n        </div>\n      ) : showStaleLeads ? (\n        <StaleLeadsView campaignName={selectedCampaign} staleOpportunities={staleOpportunities} />\n      ) : activityGroups.length > 0 ? (\n        <div>\n          <h3 className=\"text-lg font-semibold mb-4\">Activity Type Breakdown</h3>\n          {activityGroups.map((group) => (\n            <ActivityTypeCard\n              key={group.type}\n              group={group}\n              isExpanded={expandedTypes.has(group.type)}\n              onToggle={() => handleToggle(group.type)}\n              salesMap={salesMap}\n            />\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <div className=\"mb-4 text-4xl\">üì≠</div>\n            {hasActiveFilters ? (\n              <>\n                <p className=\"text-lg font-medium text-muted-foreground mb-2\">\n                  No activities match the current filters\n                </p>\n                <p className=\"text-sm text-muted-foreground mb-4\">\n                  Try adjusting your filters to see more results\n                </p>\n                <div className=\"flex flex-wrap gap-2 justify-center mb-4\">\n                  {dateRange && (\n                    <Badge variant=\"secondary\">\n                      Date Range: {dateRange.start} to {dateRange.end}\n                    </Badge>\n                  )}\n                  {selectedActivityTypes.length < INTERACTION_TYPE_OPTIONS.length && (\n                    <Badge variant=\"secondary\">\n                      {selectedActivityTypes.length} Activity{\" \"}\n                      {selectedActivityTypes.length === 1 ? \"Type\" : \"Types\"} Selected\n                    </Badge>\n                  )}\n                  {selectedSalesRep && (\n                    <Badge variant=\"secondary\">\n                      Sales Rep: {salesMap.get(selectedSalesRep) || \"Unknown\"}\n                    </Badge>\n                  )}\n                </div>\n                <Button variant=\"outline\" onClick={clearFilters} size=\"sm\">\n                  Clear All Filters\n                </Button>\n              </>\n            ) : totalOpportunities === 0 ? (\n              <>\n                <p className=\"text-lg font-medium text-muted-foreground mb-2\">\n                  This campaign has no opportunities yet\n                </p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Add opportunities to this campaign to start tracking activities\n                </p>\n              </>\n            ) : (\n              <>\n                <p className=\"text-lg font-medium text-muted-foreground mb-2\">\n                  No activities found for this campaign\n                </p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Activities will appear here once your team starts engaging with leads\n                </p>\n              </>\n            )}\n          </CardContent>\n        </Card>\n      )}\n    </ReportLayout>\n  );\n}\n"],"names":["ACTIVITY_ICONS","call","email","meeting","note","demo","proposal","social","getActivityTypeLabel","type","split","map","word","charAt","toUpperCase","slice","join","ActivityTypeCard","__name","group","isExpanded","onToggle","salesMap","icon","toLowerCase","label","percentage","mostActiveOrgDisplay","mostActiveOrgCount","mostActiveOrg","mostActiveCount","orgCounts","Map","activities","forEach","activity","set","organization_id","get","sortedOrgCounts","Array","from","entries","sort","a","b","mostActiveOrgId","jsxs","Card","className","children","jsx","CardHeader","onClick","totalCount","uniqueOrgs","ChevronDown","ChevronRight","CardContent","scope","organization_name","contact_name","parseDateSafely","created_at","toLocaleDateString","created_by","subject","id","StaleLeadsView","campaignName","staleOpportunities","navigate","useNavigate","formatLastActivity","date","dateObj","format","formatStageName","stage","getDaysOverThreshold","opp","stageThreshold","Math","max","daysInactive","length","STAGE_STALE_THRESHOLDS","new_lead","initial_outreach","feedback_logged","CardTitle","daysOver","name","customer_organization_name","Badge","variant","lastActivityDate","floor","Button","size","CampaignActivityReport","notify","useNotify","expandedTypes","setExpandedTypes","useState","Set","selectedCampaign","setSelectedCampaign","dateRange","setDateRange","selectedActivityTypes","setSelectedActivityTypes","INTERACTION_TYPE_OPTIONS","opt","value","datePreset","setDatePreset","selectedSalesRep","setSelectedSalesRep","showStaleLeads","setShowStaleLeads","ariaLiveMessage","setAriaLiveMessage","hasInitialized","React","useRef","data","allOpportunities","isPending","opportunitiesPending","useGetList","pagination","page","perPage","filter","campaignOptions","useMemo","campaigns","campaign","count","allCampaignActivities","allActivitiesPending","field","order","activitiesPending","start","end","ownerIds","Boolean","salesReps","s","first_name","last_name","opportunityMap","o","salesRepOptions","repCounts","activityGroups","grouped","totalActivities","has","push","values","orgId","sortedOrgs","mostActiveData","round","getLastActivityForOpportunity","oppId","oppActivities","opportunity_id","dateA","dateB","getTime","opportunitiesForCampaign","now","Date","lastActivityDateObj","getStaleThreshold","isStale","isOpportunityStale","aOverage","useEffect","current","topThreeTypes","g","timer","setTimeout","clearTimeout","totalOpportunities","coverageRate","avgActivitiesPerLead","toFixed","handleToggle","newExpanded","delete","add","setDatePresetHandler","preset","today","subDays","startOfMonth","toggleActivityType","includes","t","toggleAllActivityTypes","clearFilters","hasActiveFilters","isLoadingCampaigns","isLoadingActivities","activityTypeCounts","counts","handleExport","exportData","sanitizeCsvValue","opportunity_name","organization","last_activity_date","days_inactive","toString","notes","jsonExport","err","csv","campaignSlug","replace","dateStr","downloadCSV","flatMap","opportunity","createdAtDate","daysSinceActivity","activity_type","activity_category","sales_rep","days_since_activity","opportunity_stage","ReportLayout","title","role","Label","htmlFor","Select","onValueChange","SelectTrigger","SelectValue","placeholder","SelectContent","SelectItem","disabled","onChange","e","newStart","target","endDate","newEnd","startDate","option","Checkbox","checked","onCheckedChange","parseInt","rep","i","Fragment"],"mappings":"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"}