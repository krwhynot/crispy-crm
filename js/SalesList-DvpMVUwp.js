var e=Object.defineProperty,s=(s,a)=>e(s,"name",{value:a,configurable:!0});import{_ as a,l as r,b9 as t,W as n,u as l,j as i,c as o,w as d,i as c,ak as m,$ as u}from"./chunk-ByJg_QQB.js";import{L as h,S as x,E as j,C as p}from"./chunk-BBQ6yJWi.js";import{P as v}from"./chunk-CKWniV73.js";import{S as g,ay as f,az as b,aA as N,L as y,a4 as w,i as _,j as k,k as S,m as C,n as O,aZ as F,d as A,B as R,b8 as P}from"../assets/index-BoLku8RR.js";import{u as E,S as T,F as D,b as L}from"./chunk-C8K6x_Yi.js";import{T as I}from"./chunk-BtJ7Qrct.js";import{R as M,u as U}from"./chunk-a4jA-31v.js";import{C as V}from"./chunk-C0a-ooKP.js";import{r as $}from"./chunk-1NZFT-6z.js";import{A as B,h as z,a as Y,b as W,c as Z,d as q,e as Q,f as G,g as H}from"./chunk-D62ZQQIe.js";import{a7 as J,F as K,a3 as X}from"./chunk-Bc6KM1xM.js";import{g as ee,L as se,T as ae}from"./chunk-DmTQjO0R.js";import{a as re,T as te,s as ne}from"./chunk-UKb2nn92.js";import"./chunk-JxeXaC9i.js";import"./chunk-Dc4zIuSl.js";import"./chunk-B1s-jt27.js";import"./chunk-knA4lag3.js";import"./chunk-Tyyhsnez.js";import"./chunk-DA1DYucv.js";import"./chunk-DwAffUXc.js";import"./chunk-DHnjrG--.js";import"./chunk-XoqkUGE_.js";import"./chunk-CRKBdUTG.js";import"./chunk-B5Y5c6gs.js";var le=function(){return le=Object.assign||function(e){for(var s,a=1,r=arguments.length;a<r;a++)for(var t in s=arguments[a])Object.prototype.hasOwnProperty.call(s,t)&&(e[t]=s[t]);return e},le.apply(this,arguments)},ie=s(function(e){var s=re({props:e,name:ce}),n=s.className,l=s.emptyText,i=function(e,s){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&s.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var t=0;for(r=Object.getOwnPropertySymbols(e);t<r.length;t++)s.indexOf(r[t])<0&&Object.prototype.propertyIsEnumerable.call(e,r[t])&&(a[r[t]]=e[r[t]])}return a}(s,["className","emptyText"]),o=a(s),d=r();return null==o?l?$.createElement(te,le({component:"span",variant:"body2",className:n},t(i)),l&&d(l,{_:l})):null:$.createElement(me,le({className:n,href:"mailto:".concat(o),onClick:de,variant:"body2"},t(i)),o)},"EmailFieldImpl");ie.displayName="EmailFieldImpl";var oe=ee(ie),de=s(function(e){return e.stopPropagation()},"stopPropagation"),ce="RaEmailField",me=ne(se,{name:ce,overridesResolver:s(function(e,s){return s.root},"overridesResolver")})({});function ue({record:e,mode:a,onModeToggle:r}){const[t,{isLoading:o}]=n(),d=l(),[c,m]=$.useState({first_name:e?.first_name||"",last_name:e?.last_name||"",email:e?.email||"",phone:e?.phone||"",avatar_url:e?.avatar_url||""}),[u,h]=$.useState({}),x=s((e,s)=>{m(a=>({...a,[e]:s})),u[e]&&h(s=>{const a={...s};return delete a[e],a})},"handleChange"),j=s(async()=>{try{await t("sales",{id:e.id,data:c,previousData:e},{onSuccess:s(()=>{d("Profile updated successfully",{type:"success"}),r&&r()},"onSuccess"),onError:s(e=>{d(e.message||"Failed to update profile",{type:"error"}),e.errors&&h(e.errors)},"onError")})}catch(a){a.errors?(h(a.errors),d("Validation failed. Please check the form.",{type:"warning"})):d("An error occurred",{type:"error"})}},"handleSave"),p=s(()=>{const s="edit"===a?c.first_name:e?.first_name,r="edit"===a?c.last_name:e?.last_name;return`${s?.[0]||""}${r?.[0]||""}`.toUpperCase()},"getInitials");if(!e)return i.jsxs("div",{className:"space-y-4",children:[i.jsx(g,{className:"h-11 w-full"}),i.jsx(g,{className:"h-11 w-full"}),i.jsx(g,{className:"h-11 w-full"})]});const v=s(e=>{e.preventDefault(),j()},"handleFormSubmit"),_=i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"flex flex-col items-center gap-4",children:[i.jsxs(f,{className:"size-20",children:[i.jsx(b,{src:"edit"===a?c.avatar_url:e.avatar_url,alt:`${e.first_name} ${e.last_name}`}),i.jsx(N,{children:p()})]}),"edit"===a&&i.jsxs("div",{className:"w-full",children:[i.jsx(y,{htmlFor:"avatar_url",children:"Avatar URL"}),i.jsx(w,{id:"avatar_url",type:"url",value:c.avatar_url,onChange:s(e=>x("avatar_url",e.target.value),"onChange"),placeholder:"https://example.com/avatar.jpg",className:u.avatar_url?"border-destructive":""}),u.avatar_url&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:u.avatar_url})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(y,{htmlFor:"first_name",children:"First Name"}),"view"===a?i.jsx("p",{className:"text-sm text-foreground mt-1",children:e.first_name}):i.jsxs(i.Fragment,{children:[i.jsx(w,{id:"first_name",value:c.first_name,onChange:s(e=>x("first_name",e.target.value),"onChange"),className:u.first_name?"border-destructive":"",disabled:o}),u.first_name&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:u.first_name})]})]}),i.jsxs("div",{children:[i.jsx(y,{htmlFor:"last_name",children:"Last Name"}),"view"===a?i.jsx("p",{className:"text-sm text-foreground mt-1",children:e.last_name}):i.jsxs(i.Fragment,{children:[i.jsx(w,{id:"last_name",value:c.last_name,onChange:s(e=>x("last_name",e.target.value),"onChange"),className:u.last_name?"border-destructive":"",disabled:o}),u.last_name&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:u.last_name})]})]})]}),i.jsxs("div",{children:[i.jsx(y,{htmlFor:"email",children:"Email"}),"view"===a?i.jsx("p",{className:"text-sm text-foreground mt-1",children:e.email}):i.jsxs(i.Fragment,{children:[i.jsx(w,{id:"email",type:"email",value:c.email,onChange:s(e=>x("email",e.target.value),"onChange"),className:u.email?"border-destructive":"",disabled:o}),u.email&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:u.email})]})]}),i.jsxs("div",{children:[i.jsx(y,{htmlFor:"phone",children:"Phone"}),"view"===a?i.jsx("p",{className:"text-sm text-foreground mt-1",children:e.phone||"Not provided"}):i.jsxs(i.Fragment,{children:[i.jsx(w,{id:"phone",type:"tel",value:c.phone,onChange:s(e=>x("phone",e.target.value),"onChange"),className:u.phone?"border-destructive":"",disabled:o,placeholder:"Optional"}),u.phone&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:u.phone})]})]})]});return"edit"===a?i.jsx("form",{id:"slide-over-edit-form",onSubmit:v,children:_}):_}function he({record:e,mode:a,onModeToggle:r}){const[t,{isLoading:m}]=n(),u=l(),h=o(),x=d(),{data:j}=c(),[p,v]=$.useState(!1),[f,b]=$.useState({role:e?.role||"rep",disabled:e?.disabled||!1}),[N,w]=$.useState({}),E=e?.id===j?.id,T=s(async()=>{if(E)u("You cannot remove your own account",{type:"warning"});else{v(!0);try{await t("sales",{id:e.id,data:{deleted_at:(new Date).toISOString()},previousData:e},{onSuccess:s(()=>{u("User removed successfully",{type:"success"}),x(),h("/sales")},"onSuccess"),onError:s(e=>{u(e.message||"Failed to remove user",{type:"error"})},"onError")})}finally{v(!1)}}},"handleRemoveUser"),D=s((e,s)=>{b(a=>({...a,[e]:s})),N[e]&&w(s=>{const a={...s};return delete a[e],a})},"handleChange"),L=s(async()=>{try{await t("sales",{id:e.id,data:f,previousData:e},{onSuccess:s(()=>{f.role!==e.role&&P(),u("Permissions updated successfully",{type:"success"}),r&&r()},"onSuccess"),onError:s(e=>{u(e.message||"Failed to update permissions",{type:"error"}),e.errors&&w(e.errors)},"onError")})}catch(a){a.errors?(w(a.errors),u("Validation failed. Please check the form.",{type:"warning"})):u("An error occurred",{type:"error"})}},"handleSave"),I=s(e=>{switch(e){case"admin":return i.jsx(A,{variant:"outline",className:"border-primary text-primary",children:"Admin"});case"manager":return i.jsx(A,{variant:"outline",className:"border-success text-success",children:"Manager"});case"rep":return i.jsx(A,{variant:"outline",className:"border-muted-foreground text-muted-foreground",children:"Rep"});default:return null}},"getRoleBadge"),M=s(e=>{e.preventDefault(),E||L()},"handleFormSubmit");if(!e)return i.jsxs("div",{className:"space-y-4",children:[i.jsx(g,{className:"h-11 w-full"}),i.jsx(g,{className:"h-11 w-full"}),i.jsx(g,{className:"h-11 w-full"})]});const U=i.jsxs("div",{className:"space-y-6",children:[E&&"edit"===a&&i.jsx("div",{className:"p-3 border border-warning bg-warning/10 rounded-md",children:i.jsxs("p",{className:"text-sm text-warning-foreground",children:[i.jsx("strong",{children:"Note:"})," You cannot modify your own permissions."]})}),i.jsxs("div",{children:[i.jsx(y,{htmlFor:"role",children:"Role"}),"view"===a?i.jsx("div",{className:"mt-2",children:I(e.role)}):i.jsxs(i.Fragment,{children:[i.jsxs(_,{value:f.role,onValueChange:s(e=>D("role",e),"onValueChange"),disabled:m||E,children:[i.jsx(k,{id:"role",className:N.role?"border-destructive":"",children:i.jsx(S,{placeholder:"Select role"})}),i.jsxs(C,{children:[i.jsx(O,{value:"rep",children:"Rep"}),i.jsx(O,{value:"manager",children:"Manager"}),i.jsx(O,{value:"admin",children:"Admin"})]})]}),N.role&&i.jsx("p",{className:"text-sm text-destructive mt-1",children:N.role}),i.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Rep: Edit own records. Manager: Edit all records. Admin: Full system access."})]})]}),i.jsxs("div",{children:[i.jsx(y,{htmlFor:"administrator",children:"Administrator Access"}),"view"===a?i.jsx("p",{className:"text-sm text-foreground mt-1",children:e.administrator||"admin"===e.role?"Yes":"No"}):i.jsx("div",{className:"mt-2",children:i.jsxs("div",{className:"flex items-center gap-3 p-3 border border-border rounded-md bg-muted/20",children:[i.jsx(F,{id:"administrator",checked:"admin"===f.role,onCheckedChange:s(e=>D("role",e?"admin":"rep"),"onCheckedChange"),disabled:m||E}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium",children:"admin"===f.role?"Enabled":"Disabled"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Administrator access is automatically granted to users with Admin role"})]})]})})]}),i.jsxs("div",{children:[i.jsx(y,{htmlFor:"disabled",children:"Account Status"}),"view"===a?i.jsx("div",{className:"mt-2",children:e.disabled?i.jsx(A,{variant:"outline",className:"border-warning text-warning",children:"Disabled"}):i.jsx(A,{variant:"outline",className:"border-success text-success",children:"Active"})}):i.jsx("div",{className:"mt-2",children:i.jsxs("div",{className:"flex items-center gap-3 p-3 border border-border rounded-md bg-muted/20",children:[i.jsx(F,{id:"disabled",checked:f.disabled,onCheckedChange:s(e=>D("disabled",e),"onCheckedChange"),disabled:m||E}),i.jsxs("div",{className:"flex-1",children:[i.jsx("p",{className:"text-sm font-medium",children:f.disabled?"Account Disabled":"Account Active"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Disabled accounts cannot log in or access the system"})]})]})})]}),"edit"===a&&f.disabled&&!E&&i.jsx("div",{className:"p-3 border border-warning bg-warning/10 rounded-md",children:i.jsxs("p",{className:"text-sm text-warning-foreground",children:[i.jsx("strong",{children:"Warning:"})," Disabling this account will prevent the user from logging in."]})}),!E&&"admin"===j?.role&&i.jsx("div",{className:"mt-8 pt-6 border-t border-destructive/30",children:i.jsxs("div",{className:"p-4 border border-destructive/30 rounded-lg bg-destructive/5",children:[i.jsx("h3",{className:"text-sm font-semibold text-destructive mb-2",children:"Danger Zone"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Removing a user will prevent them from accessing the system. This action can be undone by an administrator."}),i.jsxs(B,{children:[i.jsx(z,{asChild:!0,children:i.jsxs(R,{variant:"destructive",size:"sm",disabled:p,className:"gap-2",children:[i.jsx(J,{className:"h-4 w-4"}),p?"Removing...":"Remove User"]})}),i.jsxs(Y,{children:[i.jsxs(W,{children:[i.jsx(Z,{children:"Remove User"}),i.jsxs(q,{children:["Are you sure you want to remove"," ",i.jsxs("strong",{children:[e?.first_name," ",e?.last_name]})," ","(",e?.email,")?",i.jsx("br",{}),i.jsx("br",{}),"They will no longer be able to log in or access the system. This can be undone later if needed."]})]}),i.jsxs(Q,{children:[i.jsx(G,{children:"Cancel"}),i.jsx(H,{onClick:T,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Remove User"})]})]})]})]})})]});return"edit"===a?i.jsx("form",{id:"slide-over-edit-form",onSubmit:M,children:U}):U}function xe({recordId:e,isOpen:a,onClose:r,mode:t,onModeToggle:n}){const l=[{key:"profile",label:"Profile",component:ue,icon:K},{key:"permissions",label:"Permissions",component:he,icon:X}],o=s(e=>`${e?.first_name||""} ${e?.last_name||""}`.trim()||"User","recordRepresentation");return i.jsx(M,{resource:"sales",recordId:e,isOpen:a,onClose:r,mode:t,onModeToggle:n,tabs:l,recordRepresentation:o})}function je(){const{data:e,isPending:s}=c(),{slideOverId:a,isOpen:r,mode:t,openSlideOver:n,closeSlideOver:l,toggleMode:o}=U();return E("sales"),s?i.jsx(T,{}):e?i.jsxs(i.Fragment,{children:[i.jsxs(h,{title:!1,filters:pe,actions:i.jsx(ge,{}),sort:{field:"first_name",order:"ASC"},children:[i.jsx(ve,{openSlideOver:n,isSlideOverOpen:r}),i.jsx(D,{})]}),i.jsx(xe,{recordId:a,isOpen:r,onClose:l,mode:t,onModeToggle:o})]}):null}s(ue,"SalesProfileTab"),s(he,"SalesPermissionsTab"),s(xe,"SalesSlideOver"),s(je,"SalesList");const pe=[i.jsx(x,{source:"q",alwaysOn:!0},"search")],ve=s(({openSlideOver:e,isSlideOverOpen:a})=>{const{data:r,isPending:t,filterValues:n}=m(),{focusedIndex:l}=L({onSelect:s(s=>e(Number(s),"view"),"onSelect"),enabled:!a}),o=n&&Object.keys(n).length>0;return t?i.jsx("div",{className:"card-container",children:i.jsx(T,{})}):r?.length||o?i.jsx("div",{className:"card-container",children:i.jsxs(v,{onRowClick:s(s=>e(Number(s),"view"),"onRowClick"),focusedIndex:l,bulkActionButtons:!1,children:[i.jsx(ae,{source:"first_name",label:"First Name",...V.alwaysVisible}),i.jsx(ae,{source:"last_name",label:"Last Name",...V.alwaysVisible}),i.jsx(oe,{source:"email",label:"Email",...V.desktopOnly}),i.jsx(fe,{label:"Role",...V.alwaysVisible}),i.jsx(be,{label:"Status",...V.desktopOnly})]})}):i.jsx("div",{className:"card-container",children:i.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[i.jsx("p",{className:"text-muted-foreground",children:"No team members found."}),i.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Add team members to manage CRM access and permissions."})]})})},"SalesListLayout"),ge=s(()=>i.jsxs(I,{children:[i.jsx(j,{}),i.jsx(p,{label:"New user"})]}),"SalesListActions"),fe=s(({label:e,...s})=>{const a=u();if(!a)return null;let r=null;switch(a.role){case"admin":r=i.jsx(A,{variant:"outline",className:"border-primary text-primary",children:"Admin"});break;case"manager":r=i.jsx(A,{variant:"outline",className:"border-success text-success",children:"Manager"});break;case"rep":r=i.jsx(A,{variant:"outline",className:"border-muted-foreground text-muted-foreground",children:"Rep"})}return i.jsx("div",{className:"flex flex-row gap-1",children:r})},"RoleBadgeField"),be=s(({label:e,...s})=>{const a=u();return a?i.jsx("div",{className:"flex flex-row gap-1",children:a.disabled?i.jsx(A,{variant:"outline",className:"border-warning text-warning",children:"Disabled"}):i.jsx(A,{variant:"outline",className:"border-success text-success",children:"Active"})}):null},"StatusField");export{je as default};
