var s=Object.defineProperty,e=(e,a)=>s(e,"name",{value:a,configurable:!0});import{Z as a,az as t,u as i,c as r,aS as n,aB as o,j as d,aM as c,an as p}from"./chunk-DWisBx5Y.js";import{ao as u,a as l,d as m,e as j,f as h}from"../assets/index-BMLg8LT4.js";import{F as x}from"./chunk-DJlpmdvB.js";import{O as f}from"./chunk-DzHhiDUS.js";import"./chunk-CPNr-gD1.js";import"./chunk-DAbVPE3R.js";import"./chunk-DOHniRee.js";import"./chunk-CLB8yy76.js";import"./chunk-BePsjq0D.js";import"./chunk-8CWr9u5d.js";import"./chunk-DBZxM7AY.js";import"./chunk-CL328sMP.js";import"./chunk-DlK383r0.js";const k=e(()=>{const{identity:s}=a(),k=t(),y=i(),g=r(),O=n(),{data:v}=o("opportunities",{pagination:{page:1,perPage:1e3},filter:{"deleted_at@is":null}}),_=e(async s=>{if(v){const e=v.filter(e=>e.stage===s.stage&&e.id!==s.id);await Promise.all(e.map(async s=>k.update("opportunities",{id:s.id,data:{index:s.index+1},previousData:s})));const a=e.reduce((s,e)=>({...s,[e.id]:{...e,index:e.index+1}}),{}),t=Date.now();O.setQueriesData({queryKey:["opportunities","getList"]},s=>s?{...s,data:s.data.map(s=>a[s.id]||s)}:s,{updatedAt:t})}y("Opportunity created successfully"),g(`/opportunities/${s.id}/show`)},"onSuccess"),w={...u.partial().parse({}),opportunity_owner_id:s?.id,account_manager_id:s?.id,contact_ids:[]};return d.jsx(c,{mutationOptions:{onSuccess:_},redirect:!1,mutationMode:"pessimistic",children:d.jsx("div",{className:"mt-2 flex lg:mr-72",children:d.jsx("div",{className:"flex-1",children:d.jsx(p,{defaultValues:w,children:d.jsx(l,{children:d.jsxs(m,{children:[d.jsx(f,{mode:"create"}),d.jsx(x,{children:d.jsxs("div",{className:"flex flex-row gap-2 justify-end",children:[d.jsx(j,{}),d.jsx(h,{label:"Create Opportunity"})]})})]})})})})})})},"OpportunityCreate");export{k as OpportunityCreate,k as default};
