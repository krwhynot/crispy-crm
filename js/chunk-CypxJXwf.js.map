{"version":3,"file":"chunk-CypxJXwf.js","sources":["../../src/atomic-crm/organizations/ParentOrganizationInput.tsx","../../src/components/admin/SegmentComboboxInput.tsx","../../src/components/admin/state-combobox-input.tsx","../../src/atomic-crm/organizations/OrganizationHierarchySection.tsx","../../src/atomic-crm/organizations/OrganizationAddressSection.tsx","../../src/atomic-crm/organizations/OrganizationCompactForm.tsx","../../src/atomic-crm/organizations/OrganizationInputs.tsx"],"sourcesContent":["import { ReferenceInput } from \"@/components/admin/reference-input\";\nimport { useRecordContext } from \"ra-core\";\nimport { AutocompleteInput } from \"@/components/admin/autocomplete-input\";\n\n/**\n * Simple parent organization input without branch management features\n * Allows selecting a parent organization from existing organizations\n */\nexport const ParentOrganizationInput = () => {\n  const record = useRecordContext<{ id?: number; parent_organization_id?: number }>();\n\n  return (\n    <ReferenceInput\n      source=\"parent_organization_id\"\n      reference=\"organizations\"\n      filter={record?.id ? { \"id@neq\": record.id } : {}} // Exclude self\n    >\n      <AutocompleteInput\n        label=\"Parent Organization\"\n        emptyText=\"No parent organization\"\n        helperText=\"Select a parent organization if this is a branch location\"\n        optionText=\"name\"\n        filterToQuery={(searchText) => ({ \"name@ilike\": `%${searchText}%` })}\n      />\n    </ReferenceInput>\n  );\n};\n","import { useWatch } from \"react-hook-form\";\nimport { SelectInput } from \"@/components/admin/select-input\";\nimport { PLAYBOOK_CATEGORY_CHOICES } from \"@/atomic-crm/validation/segments\";\nimport { OPERATOR_SEGMENT_CHOICES } from \"@/atomic-crm/validation/operatorSegments\";\n\ninterface SegmentSelectInputProps {\n  source: string;\n  label?: string;\n  helperText?: string | false;\n  className?: string;\n}\n\n/**\n * Segment selection input with conditional display based on organization type\n *\n * - Distributors/Principals: Uses 9 fixed Playbook categories (Major Broadline, Specialty/Regional, etc.)\n * - Customers/Prospects/Unknown: Uses Operator segments (FSR, LSR, Hotels, etc.)\n *\n * Watches organization_type field to determine which segment choices to display.\n */\nexport const SegmentSelectInput = (props: SegmentSelectInputProps) => {\n  // Watch organization_type to determine which segments to show\n  const organizationType = useWatch({ name: \"organization_type\" });\n\n  // Distributors/Principals use Playbook categories\n  // Customers/Prospects/Unknown use Operator segments\n  const usePlaybookCategories =\n    organizationType === \"distributor\" || organizationType === \"principal\";\n\n  const choices = usePlaybookCategories ? PLAYBOOK_CATEGORY_CHOICES : OPERATOR_SEGMENT_CHOICES;\n\n  const defaultLabel = usePlaybookCategories ? \"Playbook Category\" : \"Operator Segment\";\n\n  return (\n    <SelectInput\n      source={props.source}\n      label={props.label ?? defaultLabel}\n      choices={choices}\n      helperText={props.helperText}\n      className={props.className}\n      emptyText={`Select ${defaultLabel.toLowerCase()}...`}\n      parse={(value: string) => (value === \"\" ? null : value)}\n    />\n  );\n};\n\n// Keep backward compatible exports\nexport const SegmentComboboxInput = SegmentSelectInput;\nexport const PlaybookCategoryInput = SegmentSelectInput;\n","import { useState } from \"react\";\nimport { useInput } from \"ra-core\";\nimport {\n  Command,\n  CommandInput,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandList,\n} from \"@/components/ui/command\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\nimport { Button } from \"@/components/ui/button\";\nimport { Check, ChevronsUpDown } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { US_STATES } from \"@/atomic-crm/organizations/constants\";\n\ninterface StateComboboxInputProps {\n  source: string;\n  label?: string;\n}\n\nexport function StateComboboxInput({ source, label = \"State\" }: StateComboboxInputProps) {\n  const [open, setOpen] = useState(false);\n  const { field } = useInput({ source });\n\n  const selectedState = US_STATES.find((s) => s.id === field.value);\n\n  return (\n    <div className=\"space-y-2\">\n      {label && (\n        <label className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\">\n          {label}\n        </label>\n      )}\n      <Popover open={open} onOpenChange={setOpen}>\n        <PopoverTrigger asChild>\n          <Button\n            variant=\"outline\"\n            role=\"combobox\"\n            aria-expanded={open}\n            className=\"w-full justify-between min-h-[44px]\"\n          >\n            {selectedState?.name || \"Select state...\"}\n            <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n          </Button>\n        </PopoverTrigger>\n        <PopoverContent className=\"w-[300px] p-0\" align=\"start\">\n          <Command>\n            <CommandInput placeholder=\"Search states...\" />\n            <CommandList>\n              <CommandEmpty>No state found.</CommandEmpty>\n              <CommandGroup className=\"max-h-64 overflow-auto\">\n                {US_STATES.map((state) => (\n                  <CommandItem\n                    key={state.id}\n                    value={state.name}\n                    onSelect={() => {\n                      field.onChange(state.id);\n                      setOpen(false);\n                    }}\n                  >\n                    <Check\n                      className={cn(\n                        \"mr-2 h-4 w-4\",\n                        field.value === state.id ? \"opacity-100\" : \"opacity-0\"\n                      )}\n                    />\n                    {state.name} ({state.id})\n                  </CommandItem>\n                ))}\n              </CommandGroup>\n            </CommandList>\n          </Command>\n        </PopoverContent>\n      </Popover>\n    </div>\n  );\n}\n","import { SelectInput } from \"@/components/admin/select-input\";\nimport { BooleanInput } from \"@/components/admin/boolean-input\";\nimport { CollapsibleSection, CompactFormRow } from \"@/components/admin/form\";\nimport { ParentOrganizationInput } from \"./ParentOrganizationInput\";\nimport { ORG_SCOPE_CHOICES } from \"./constants\";\n\nexport const OrganizationHierarchySection = () => {\n  return (\n    <CollapsibleSection title=\"Organization Hierarchy\">\n      <div className=\"space-y-4\">\n        <ParentOrganizationInput />\n        <CompactFormRow>\n          <SelectInput\n            source=\"org_scope\"\n            label=\"Scope\"\n            choices={ORG_SCOPE_CHOICES}\n            helperText=\"National = brand/HQ, Regional = operating company\"\n            emptyText=\"Select scope\"\n          />\n          <div className=\"space-y-1\">\n            <BooleanInput\n              source=\"is_operating_entity\"\n              label=\"This location processes orders\"\n              helperText={false}\n            />\n            <p className=\"text-sm text-muted-foreground ml-11\">\n              <strong>ON:</strong> Orders and invoices happen here (e.g., Sysco Chicago)\n              <br />\n              <strong>OFF:</strong> Corporate brand or holding company only (e.g., Sysco Corporation)\n            </p>\n          </div>\n        </CompactFormRow>\n      </div>\n    </CollapsibleSection>\n  );\n};\n","import { TextInput } from \"@/components/admin/text-input\";\nimport { CollapsibleSection, CompactFormRow } from \"@/components/admin/form\";\nimport { StateComboboxInput } from \"@/components/admin/state-combobox-input\";\n\nexport const OrganizationAddressSection = () => {\n  return (\n    <CollapsibleSection title=\"Address\">\n      <div className=\"space-y-4\">\n        <TextInput source=\"shipping_street\" label=\"Street\" helperText={false} />\n        <CompactFormRow>\n          <TextInput source=\"shipping_city\" label=\"City\" helperText={false} />\n          <StateComboboxInput source=\"shipping_state\" label=\"State\" />\n        </CompactFormRow>\n        <TextInput source=\"shipping_postal_code\" label=\"ZIP Code\" helperText={false} />\n      </div>\n    </CollapsibleSection>\n  );\n};\n","import { TextInput } from \"@/components/admin/text-input\";\nimport { ReferenceInput } from \"@/components/admin/reference-input\";\nimport { SelectInput } from \"@/components/admin/select-input\";\nimport { CompactFormRow, CollapsibleSection } from \"@/components/admin/form\";\nimport { SegmentComboboxInput } from \"@/components/admin/SegmentComboboxInput\";\nimport { StateComboboxInput } from \"@/components/admin/state-combobox-input\";\nimport { ORGANIZATION_TYPE_CHOICES, PRIORITY_CHOICES } from \"./constants\";\nimport { saleOptionRenderer } from \"../utils/saleOptionRenderer\";\nimport { OrganizationHierarchySection } from \"./OrganizationHierarchySection\";\nimport { OrganizationAddressSection } from \"./OrganizationAddressSection\";\n\nexport const OrganizationCompactForm = () => {\n  return (\n    <div className=\"space-y-4\">\n      <CompactFormRow>\n        <div data-tutorial=\"org-name\">\n          <TextInput\n            source=\"name\"\n            label=\"Organization Name *\"\n            helperText={false}\n            placeholder=\"Organization name\"\n          />\n        </div>\n        <div data-tutorial=\"org-type\">\n          <SelectInput\n            source=\"organization_type\"\n            label=\"Type\"\n            choices={ORGANIZATION_TYPE_CHOICES}\n            helperText={false}\n            emptyText=\"Select organization type\"\n          />\n        </div>\n      </CompactFormRow>\n\n      <CompactFormRow>\n        <SelectInput\n          source=\"priority\"\n          label=\"Priority\"\n          choices={PRIORITY_CHOICES}\n          helperText={false}\n          emptyText=\"Select priority\"\n        />\n        <ReferenceInput\n          reference=\"sales\"\n          source=\"sales_id\"\n          sort={{ field: \"last_name\", order: \"ASC\" }}\n          filter={{ \"disabled@neq\": true, \"user_id@not.is\": null }}\n        >\n          <SelectInput helperText={false} label=\"Account Manager\" optionText={saleOptionRenderer} />\n        </ReferenceInput>\n        <SegmentComboboxInput source=\"segment_id\" label=\"Segment\" helperText={false} />\n      </CompactFormRow>\n\n      <CompactFormRow>\n        <TextInput source=\"address\" label=\"Street\" helperText={false} />\n        <TextInput source=\"city\" label=\"City\" helperText={false} />\n      </CompactFormRow>\n\n      <CompactFormRow>\n        <StateComboboxInput source=\"state\" label=\"State\" />\n        <TextInput source=\"postal_code\" label=\"Zip Code\" helperText={false} />\n      </CompactFormRow>\n\n      <CollapsibleSection title=\"Additional Details\">\n        <div className=\"space-y-4\">\n          <div data-tutorial=\"org-website\">\n            <TextInput source=\"website\" label=\"Website\" helperText=\"Format: https://example.com\" />\n          </div>\n          <TextInput source=\"phone\" label=\"Phone\" helperText=\"Format: (555) 123-4567\" />\n          <TextInput\n            source=\"linkedin_url\"\n            label=\"LinkedIn URL\"\n            helperText=\"Format: https://linkedin.com/company/name\"\n          />\n          <TextInput\n            source=\"description\"\n            label=\"Description\"\n            multiline\n            rows={3}\n            helperText={false}\n          />\n        </div>\n      </CollapsibleSection>\n\n      <OrganizationHierarchySection />\n      <OrganizationAddressSection />\n      {/* Status & Payment fields hidden per user feedback - defaults: status='active' */}\n    </div>\n  );\n};\n","import { useFormState } from \"react-hook-form\";\nimport { FormErrorSummary } from \"@/components/admin/FormErrorSummary\";\nimport { OrganizationCompactForm } from \"./OrganizationCompactForm\";\n\nconst ORGANIZATION_FIELD_LABELS: Record<string, string> = {\n  name: \"Organization Name\",\n  organization_type: \"Type\",\n  sales_id: \"Account Manager\",\n  segment_id: \"Segment\",\n  address: \"Street\",\n  city: \"City\",\n  state: \"State\",\n  postal_code: \"Zip Code\",\n  website: \"Website\",\n  linkedin_url: \"LinkedIn URL\",\n  parent_organization_id: \"Parent Organization\",\n  description: \"Description\",\n  phone: \"Phone\",\n};\n\nexport const OrganizationInputs = () => {\n  const { errors } = useFormState();\n  const hasErrors = Object.keys(errors || {}).length > 0;\n\n  return (\n    <div className=\"flex flex-col gap-4\">\n      {hasErrors && (\n        <FormErrorSummary\n          errors={errors}\n          fieldLabels={ORGANIZATION_FIELD_LABELS}\n          defaultExpanded={Object.keys(errors).length <= 3}\n        />\n      )}\n      <OrganizationCompactForm />\n    </div>\n  );\n};\n"],"names":["ParentOrganizationInput","__name","record","useRecordContext","jsx","ReferenceInput","source","reference","filter","id","children","AutocompleteInput","label","emptyText","helperText","optionText","filterToQuery","searchText","SegmentComboboxInput","props","organizationType","useWatch","name","usePlaybookCategories","choices","PLAYBOOK_CATEGORY_CHOICES","OPERATOR_SEGMENT_CHOICES","defaultLabel","SelectInput","className","toLowerCase","parse","value","StateComboboxInput","open","setOpen","useState","field","useInput","selectedState","US_STATES","find","s","jsxs","Popover","onOpenChange","PopoverTrigger","asChild","Button","variant","role","ChevronsUpDown","PopoverContent","align","Command","CommandInput","placeholder","CommandList","CommandEmpty","CommandGroup","map","state","CommandItem","onSelect","onChange","Check","cn","OrganizationHierarchySection","CollapsibleSection","title","CompactFormRow","ORG_SCOPE_CHOICES","BooleanInput","OrganizationAddressSection","TextInput","OrganizationCompactForm","ORGANIZATION_TYPE_CHOICES","PRIORITY_CHOICES","sort","order","saleOptionRenderer","multiline","rows","ORGANIZATION_FIELD_LABELS","organization_type","sales_id","segment_id","address","city","postal_code","website","linkedin_url","parent_organization_id","description","phone","OrganizationInputs","errors","useFormState","hasErrors","Object","keys","length","FormErrorSummary","fieldLabels","defaultExpanded"],"mappings":"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"}