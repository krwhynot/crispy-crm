var e=Object.defineProperty,s=(s,t)=>e(s,"name",{value:t,configurable:!0});import{j as t,F as a,$ as r,i as n,at as i,J as o,W as c,u as l,ak as d,as as u,aA as m}from"./chunk-ByJg_QQB.js";import{r as h}from"./chunk-1NZFT-6z.js";import{S as x}from"./chunk-B1s-jt27.js";import{T as j,B as p,aw as f,s as N,ax as g,w as v,U as k,V as y,W as b,X as S}from"../assets/index-BoLku8RR.js";import{R as z}from"./chunk-DbeoRBEW.js";import{O as C,R as _}from"./chunk-sKlZvX2D.js";import{A as w}from"./chunk-B9H_70fs.js";import"./chunk-CRKBdUTG.js";import{S as D}from"./chunk-j7Lqvg-1.js";import{u as E,c as M}from"./chunk-JxeXaC9i.js";import{al as A,a7 as F,x as O,g as T}from"./chunk-Bc6KM1xM.js";import{F as V}from"./chunk-DpghI3EP.js";const I=s(()=>{const[e,a]=h.useState(!1),{setValue:r}=E();return t.jsxs("div",{className:"space-y-2",children:[t.jsx(j,{source:"text",label:!1,multiline:!0,helperText:!1,placeholder:"Add a note"}),!e&&t.jsxs("div",{className:"flex justify-end items-center gap-2",children:[t.jsx(p,{variant:"link",size:"sm",onClick:s(()=>{a(!e),r("date",f())},"onClick"),className:"text-sm text-muted-foreground underline hover:no-underline p-0 h-auto cursor-pointer",children:"Show options"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:"(change date/time)"})]}),t.jsx("div",{className:N("space-y-3 mt-3 overflow-hidden transition-transform ease-in-out duration-300 origin-top",e?"scale-y-100":"scale-y-0 max-h-0 h-0"),children:t.jsx(j,{source:"date",label:"Date & Time",helperText:!1,type:"datetime-local",className:"text-primary"})})]})},"NoteInputs"),L={contacts:"contact_id",opportunities:"opportunity_id",organizations:"organization_id"},P=s(({reference:e})=>{const s=a(),c=r(),{data:l}=n();if(!c||!l)return null;const d={...g.partial().parse({})};return t.jsx(i,{resource:s,redirect:!1,children:t.jsx(o,{defaultValues:d,children:t.jsx("div",{className:"space-y-3",children:t.jsx(U,{reference:e,record:c})})})})},"NoteCreate"),U=s(({reference:e,record:s})=>{const{errors:a}=M();return t.jsxs(t.Fragment,{children:[t.jsx(V,{errors:a}),t.jsx(I,{}),t.jsx(B,{reference:e,record:s})]})},"NoteFormContent"),B=s(({reference:e,record:a})=>{const[r]=c(),i=l(),{data:o}=n(),{reset:u}=E(),{refetch:m}=d();if(!a||!o)return null;const h=s(()=>{u(g.partial().parse({}),{keepValues:!1}),m(),"contacts"===e&&r(e,{id:a&&a.id,data:{last_seen:(new Date).toISOString()},previousData:a}),i("Note added")},"handleSuccess");return t.jsx("div",{className:"flex justify-end",children:t.jsx(v,{type:"button",label:"Add this note",transform:s(s=>({...s,[L[e]]:a.id,sales_id:o.id,date:s.date||f()}),"transform"),mutationOptions:{onSuccess:h},children:"Add this note"})})},"NoteCreateButton"),R=s(({note:e})=>{const[r,n]=h.useState(!1),[i,d]=h.useState(!1),x=a(),j=l(),[f,{isPending:N}]=c(),[g]=u(x,{id:e.id,previousData:e},{mutationMode:"undoable",onSuccess:s(()=>{j("Note deleted",{type:"info",undoable:!0})},"onSuccess")}),v=s(()=>{g()},"handleDelete"),E=s(()=>{d(!i)},"handleEnterEditMode"),M=s(()=>{d(!1),n(!1)},"handleCancelEdit"),V=s(t=>{f(x,{id:e.id,data:t,previousData:e},{onSuccess:s(()=>{d(!1),n(!1)},"onSuccess")})},"handleNoteUpdate");return t.jsxs("div",{onMouseEnter:s(()=>n(!0),"onMouseEnter"),onMouseLeave:s(()=>n(!1),"onMouseLeave"),children:[t.jsxs("div",{className:"flex items-center space-x-4 w-full",children:["contactNotes"===x?t.jsx(w,{width:20,height:20}):"opportunityNotes"===x?t.jsx(z,{source:"opportunity_id",reference:"opportunities",record:e,link:!1,children:t.jsx(z,{source:"customer_organization_id",reference:"organizations",link:"show",children:t.jsx(C,{width:20,height:20})})}):"organizationNotes"===x?t.jsx(z,{source:"organization_id",reference:"organizations",record:e,link:!1,children:t.jsx(C,{width:20,height:20})}):null,t.jsxs("div",{className:"inline-flex h-full items-center text-sm text-muted-foreground",children:[t.jsx(z,{record:e,resource:x,source:"sales_id",reference:"sales",link:!1,children:t.jsx(m,{render:s(e=>t.jsx(D,{sale:e}),"render")})})," ","added a note"]}),t.jsxs("span",{className:""+(r?"visible":"invisible"),children:[t.jsx(k,{children:t.jsxs(y,{children:[t.jsx(b,{asChild:!0,children:t.jsx(p,{variant:"ghost",size:"icon",onClick:E,className:"cursor-pointer","aria-label":"Edit note",children:t.jsx(A,{className:"size-4"})})}),t.jsx(S,{children:t.jsx("p",{children:"Edit note"})})]})}),t.jsx(k,{children:t.jsxs(y,{children:[t.jsx(b,{asChild:!0,children:t.jsx(p,{variant:"ghost",size:"icon",onClick:v,className:"cursor-pointer","aria-label":"Delete note",children:t.jsx(F,{className:"size-4"})})}),t.jsx(S,{children:t.jsx("p",{children:"Delete note"})})]})})]}),t.jsx("div",{className:"flex-1"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:t.jsx(_,{date:e.created_at})})]}),i?t.jsxs(o,{onSubmit:V,record:e,children:[t.jsx(I,{}),t.jsxs("div",{className:"flex justify-end mt-4 space-x-4",children:[t.jsxs(p,{variant:"ghost",onClick:M,type:"button",className:"cursor-pointer",children:[t.jsx(O,{className:"size-4"}),"Cancel"]}),t.jsxs(p,{type:"submit",disabled:N,className:"flex items-center gap-2 cursor-pointer",children:[t.jsx(T,{className:"size-4"}),"Update note"]})]})]}):t.jsx("div",{className:"pt-2 [&_p:empty]:min-h-[0.75em]",children:e.text?.split("\n").map((e,s)=>t.jsx("p",{className:"text-sm leading-6 m-0",children:e},s))})]})},"Note"),W=s(({reference:e})=>{const{data:s,error:a,isPending:r}=d();return r||a?null:t.jsxs("div",{className:"mt-4",children:[t.jsx(P,{reference:e}),s&&t.jsx("div",{className:"mt-4 space-y-4",children:s.map((e,a)=>t.jsxs(h.Fragment,{children:[t.jsx(R,{note:e,isLast:a===s.length-1},a),a<s.length-1&&t.jsx(x,{})]},a))})]})},"NotesIterator");export{W as N};
