{"version":3,"file":"chunk-A2EVsQEK.js","sources":["../../src/components/layouts/StandardListLayout.tsx","../../src/atomic-crm/filters/FilterChip.tsx","../../src/atomic-crm/filters/hooks/useResourceNamesBase.ts","../../src/atomic-crm/filters/types/resourceTypes.ts","../../src/atomic-crm/filters/useOrganizationNames.ts","../../src/atomic-crm/filters/useSalesNames.ts","../../src/atomic-crm/filters/useTagNames.ts","../../src/atomic-crm/filters/useSegmentNames.ts","../../src/atomic-crm/filters/useCategoryNames.ts","../../src/atomic-crm/filters/useFilterChipBar.ts","../../src/atomic-crm/filters/FilterChipBar.tsx","../../src/atomic-crm/filters/filterConfigSchema.ts","../../src/atomic-crm/utils/secureStorage.ts","../../src/atomic-crm/filters/opportunityStagePreferences.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from \"react\";\nimport { PanelLeftClose, PanelLeft } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tooltip, TooltipTrigger, TooltipContent } from \"@/components/ui/tooltip\";\n\n/**\n * StandardListLayout - Unified layout for all resource list views\n *\n * Provides a standardized two-column layout with a collapsible filter sidebar\n * and main content area. This component enforces consistent spacing, semantic\n * HTML structure, and accessibility patterns across all resource list pages.\n *\n * @example\n * ```tsx\n * <StandardListLayout\n *   filterComponent={<ContactListFilter />}\n *   resource=\"contacts\"\n * >\n *   <Datagrid>...</Datagrid>\n * </StandardListLayout>\n * ```\n *\n * Design System Compliance:\n * - Uses `.filter-sidebar` and `.card-container` utility classes\n * - Semantic HTML: `<aside>` for filters, `<main>` for content\n * - ARIA labels for screen reader navigation\n * - Sticky positioning for filter sidebar on desktop (remains visible on scroll)\n * - Responsive gap spacing (24px) for comfortable visual separation\n * - Collapsible sidebar with localStorage persistence\n *\n * Responsive Behavior (Desktop-First):\n * - Base (mobile/tablet <1024px): Stacked vertical layout (flex-col), collapsed by default\n * - Desktop (≥1024px): Side-by-side two-column layout (lg:flex-row)\n * - Filter sidebar collapse state persisted to localStorage\n *\n * @param filterComponent - React node containing filter UI components\n * @param children - Main content area (typically a Datagrid or table)\n * @param resource - Resource name for ARIA labels (e.g., \"contacts\", \"opportunities\")\n */\n\nconst STORAGE_KEY = \"crm-filter-sidebar-collapsed\";\n\ninterface StandardListLayoutProps {\n  /** Filter sidebar content (e.g., SearchInput, FilterCategories) */\n  filterComponent: React.ReactNode;\n  /** Main content area (typically React Admin Datagrid) */\n  children: React.ReactNode;\n  /** Resource name for accessibility labels */\n  resource: string;\n}\n\nexport function StandardListLayout({\n  filterComponent,\n  children,\n  resource,\n}: StandardListLayoutProps) {\n  // Initialize collapsed state from localStorage, default to collapsed on tablet\n  const [isCollapsed, setIsCollapsed] = useState(() => {\n    if (typeof window === \"undefined\") return false;\n\n    const stored = localStorage.getItem(STORAGE_KEY);\n    if (stored !== null) {\n      return stored === \"true\";\n    }\n    // Default: collapsed on tablet (< 1024px), expanded on desktop\n    return window.innerWidth < 1024;\n  });\n\n  // Persist collapse state to localStorage\n  useEffect(() => {\n    localStorage.setItem(STORAGE_KEY, String(isCollapsed));\n  }, [isCollapsed]);\n\n  const toggleSidebar = useCallback(() => {\n    setIsCollapsed((prev) => !prev);\n  }, []);\n\n  return (\n    <div className=\"flex h-full min-h-0 flex-1 flex-col lg:flex-row gap-6\">\n      {/* Collapse toggle button */}\n      <div className=\"flex items-center gap-2 lg:hidden mb-2 shrink-0\">\n        <Tooltip>\n          <TooltipTrigger asChild>\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={toggleSidebar}\n              className=\"h-11 w-11\"\n              aria-label={isCollapsed ? \"Show filters\" : \"Hide filters\"}\n              aria-expanded={!isCollapsed}\n              aria-controls=\"filter-sidebar\"\n            >\n              {isCollapsed ? (\n                <PanelLeft className=\"size-5\" />\n              ) : (\n                <PanelLeftClose className=\"size-5\" />\n              )}\n            </Button>\n          </TooltipTrigger>\n          <TooltipContent side=\"right\">\n            {isCollapsed ? \"Show filters\" : \"Hide filters\"}\n          </TooltipContent>\n        </Tooltip>\n        {isCollapsed && <span className=\"text-sm text-muted-foreground\">Filters hidden</span>}\n      </div>\n\n      {/* Filter sidebar with collapse animation - sticky within scroll container */}\n      <aside\n        id=\"filter-sidebar\"\n        aria-label={`Filter ${resource}`}\n        className={`\n          filter-sidebar w-full lg:w-auto lg:sticky lg:top-0 lg:h-fit lg:self-start\n          transition-all duration-200 ease-out overflow-y-auto shrink-0\n          ${isCollapsed ? \"max-h-0 lg:max-h-none lg:w-0 lg:opacity-0 lg:invisible\" : \"max-h-[60vh] lg:max-h-[calc(100vh-6rem)] lg:opacity-100\"}\n        `}\n        aria-hidden={isCollapsed}\n      >\n        <div className=\"card-container p-2\">\n          {/* Desktop collapse toggle inside sidebar */}\n          <div className=\"hidden lg:flex items-center justify-between mb-2\">\n            <span className=\"text-sm font-medium text-muted-foreground\">Filters</span>\n            <Tooltip>\n              <TooltipTrigger asChild>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={toggleSidebar}\n                  className=\"h-11 w-11\"\n                  aria-label=\"Hide filters\"\n                >\n                  <PanelLeftClose className=\"size-5\" />\n                </Button>\n              </TooltipTrigger>\n              <TooltipContent side=\"right\">Hide filters</TooltipContent>\n            </Tooltip>\n          </div>\n          {filterComponent}\n        </div>\n      </aside>\n\n      {/* Desktop expand button when sidebar is collapsed */}\n      {isCollapsed && (\n        <div className=\"hidden lg:block shrink-0\">\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                onClick={toggleSidebar}\n                className=\"h-11 w-11 sticky top-0\"\n                aria-label=\"Show filters\"\n                aria-expanded={false}\n                aria-controls=\"filter-sidebar\"\n              >\n                <PanelLeft className=\"size-5\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent side=\"right\">Show filters</TooltipContent>\n          </Tooltip>\n        </div>\n      )}\n\n      <main\n        role=\"main\"\n        aria-label={`${resource} list`}\n        className=\"flex h-full min-h-0 min-w-0 flex-1 flex-col overflow-hidden\"\n      >\n        <div className=\"card-container flex h-full min-h-0 flex-1 flex-col overflow-hidden pb-2\">\n          {children}\n        </div>\n      </main>\n    </div>\n  );\n}\n","/**\n * FilterChip Component\n *\n * Individual filter chip component with remove functionality.\n * ENHANCED: 44px minimum touch targets for iPad accessibility.\n *\n * @module filters/FilterChip\n */\n\nimport React from \"react\";\nimport { X } from \"lucide-react\";\nimport { Button } from \"../../components/ui/button\";\nimport { cn } from \"@/lib/utils\";\n\ninterface FilterChipProps {\n  /** Display text for the chip */\n  label: string;\n  /** Callback when the chip's remove button is clicked */\n  onRemove: () => void;\n  /** Additional CSS classes */\n  className?: string;\n}\n\n/**\n * Individual filter chip component with remove functionality.\n *\n * Design decisions:\n * - 44px minimum height for touch accessibility (iPad requirement)\n * - Truncated label with max-width to prevent layout issues\n * - Semantic colors from Tailwind v4 design system\n * - ARIA label for screen reader accessibility\n *\n * @example\n * ```tsx\n * <FilterChip\n *   label=\"Active\"\n *   onRemove={() => removeFilter(\"status\", \"active\")}\n * />\n * ```\n */\nexport const FilterChip: React.FC<FilterChipProps> = ({ label, onRemove, className }) => {\n  const handleRemove = (e: React.MouseEvent) => {\n    e.stopPropagation();\n    onRemove();\n  };\n\n  return (\n    <div\n      className={cn(\n        \"inline-flex items-center gap-1.5 pl-3 pr-1 text-sm rounded-full\",\n        \"bg-muted hover:bg-muted/90 transition-colors\",\n        \"min-h-[2.75rem]\", // 44px touch target height\n        className\n      )}\n    >\n      <span className=\"truncate max-w-[150px]\">{label}</span>\n      <Button\n        variant=\"ghost\"\n        size=\"icon\"\n        className={cn(\n          \"rounded-full hover:bg-accent/50\",\n          \"h-11 w-11\", // 44px button for iPad touch target\n          \"focus:outline-none focus:ring-2 focus:ring-ring\"\n        )}\n        onClick={handleRemove}\n        aria-label={`Remove ${label} filter`}\n      >\n        <X className=\"size-4\" aria-hidden=\"true\" />\n      </Button>\n    </div>\n  );\n};\n","/**\n * Generic hook for fetching and caching resource display names\n *\n * This replaces the duplicated logic in useSalesNames, useOrganizationNames, useTagNames\n * with a single, type-safe implementation.\n *\n * @module filters/hooks/useResourceNamesBase\n * @template T - Resource type (must have id field)\n */\n\nimport { useEffect, useState, useCallback, useMemo } from \"react\";\nimport { useDataProvider } from \"ra-core\";\nimport type {\n  ResourceWithId,\n  FetchedResource,\n  DisplayNameExtractor,\n  ResourceNamesResult,\n} from \"../types/resourceTypes\";\n\n/**\n * Base hook for resource name lookups with full type safety\n *\n * @param resourceName - React Admin resource name (e.g., \"sales\", \"organizations\")\n * @param ids - Array of IDs to fetch names for\n * @param getDisplayName - Type-safe function to extract display name from resource\n * @param fallbackPrefix - Prefix for fallback names (e.g., \"Sales\" → \"Sales #123\")\n * @returns ResourceNamesResult with namesMap, getName function, and loading state\n *\n * @example\n * ```typescript\n * // Type-safe usage - compiler catches errors like s.firs_name\n * const result = useResourceNamesBase<Sales>(\n *   \"sales\",\n *   salesIds,\n *   (s) => `${s.first_name} ${s.last_name}`,\n *   \"Sales\"\n * );\n * ```\n */\nexport function useResourceNamesBase<T extends ResourceWithId>(\n  resourceName: string,\n  ids: string[] | undefined,\n  getDisplayName: DisplayNameExtractor<T>,\n  fallbackPrefix: string\n): ResourceNamesResult {\n  const dataProvider = useDataProvider();\n  const [namesMap, setNamesMap] = useState<Record<string, string>>({});\n  const [loading, setLoading] = useState(false);\n\n  // Create stable key for dependency array\n  const idsKey = useMemo(() => ids?.join(\",\") || \"\", [ids]);\n\n  useEffect(() => {\n    if (!ids || ids.length === 0) {\n      return;\n    }\n\n    const fetchNames = async () => {\n      // Only fetch IDs we don't already have cached\n      const idsToFetch = ids.filter((id) => !namesMap[id]);\n\n      if (idsToFetch.length === 0) {\n        return;\n      }\n\n      setLoading(true);\n      try {\n        // dataProvider.getMany returns records that always have id\n        const { data } = await dataProvider.getMany<FetchedResource<T>>(resourceName, {\n          ids: idsToFetch,\n        });\n\n        // Type-safe reduce - FetchedResource<T> is known, no `any` needed\n        const newMap = data.reduce<Record<string, string>>((acc, item) => {\n          acc[String(item.id)] = getDisplayName(item);\n          return acc;\n        }, {});\n\n        setNamesMap((prev) => ({ ...prev, ...newMap }));\n      } catch (error) {\n        console.error(`Failed to fetch ${resourceName} names:`, error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    fetchNames();\n  }, [idsKey, ids, namesMap, dataProvider, resourceName, getDisplayName]);\n\n  /**\n   * Get display name by ID with fallback\n   */\n  const getName = useCallback(\n    (id: string): string => {\n      return namesMap[id] || `${fallbackPrefix} #${id}`;\n    },\n    [namesMap, fallbackPrefix]\n  );\n\n  return {\n    namesMap,\n    getName,\n    loading,\n  };\n}\n","/**\n * Generic type utilities for type-safe resource name lookups\n *\n * This module provides type constraints that ensure:\n * 1. Resources have an `id` field (required or optional in schema)\n * 2. Display name extractors are correctly typed per resource\n * 3. The reduce callback receives typed data, not `any`\n *\n * @module filters/types/resourceTypes\n */\n\nimport type { Sales } from \"../../validation/sales\";\nimport type { Organization } from \"../../validation/organizations\";\nimport type { Tag } from \"../../validation/tags\";\n\n/**\n * Base constraint for any resource that can be looked up by ID\n *\n * Note: Zod schemas define `id` as optional (for creation scenarios),\n * but data returned from dataProvider.getMany() always has id.\n * We use optional here for schema compatibility.\n */\nexport interface ResourceWithId {\n  id?: string | number;\n}\n\n/**\n * Represents a resource as returned from the API (id is always present)\n * This is what dataProvider.getMany() actually returns\n */\nexport type FetchedResource<T extends ResourceWithId> = T & { id: string | number };\n\n/**\n * Generic function type for extracting display name from a resource\n * @template T - The resource type (must have an id field defined in schema)\n */\nexport type DisplayNameExtractor<T extends ResourceWithId> = (item: FetchedResource<T>) => string;\n\n/**\n * Return type for useResourceNames hooks\n * Consistent across all resource types\n */\nexport interface ResourceNamesResult {\n  /** Map of id -> display name */\n  namesMap: Record<string, string>;\n  /** Function to get display name by id with fallback */\n  getName: (id: string) => string;\n  /** Loading state */\n  loading: boolean;\n}\n\n/**\n * Pre-defined extractors for common resources\n * These are type-safe and provide compile-time checking\n *\n * Note: The `satisfies` keyword ensures type safety while allowing\n * TypeScript to infer the most specific function type.\n */\nexport const resourceExtractors = {\n  /**\n   * Extract display name from Sales resource\n   * Combines first_name and last_name with fallback\n   */\n  sales: ((s) =>\n    `${s.first_name ?? \"\"} ${s.last_name ?? \"\"}`.trim() ||\n    \"Unknown\") satisfies DisplayNameExtractor<Sales>,\n\n  /**\n   * Extract display name from Organization resource\n   */\n  organizations: ((o) => o.name) satisfies DisplayNameExtractor<Organization>,\n\n  /**\n   * Extract display name from Tag resource\n   */\n  tags: ((t) => t.name) satisfies DisplayNameExtractor<Tag>,\n} as const;\n\n/**\n * Type-safe resource name configuration\n * Maps resource names to their types and extractors\n */\nexport interface ResourceConfig {\n  sales: { type: Sales; extractor: typeof resourceExtractors.sales };\n  organizations: { type: Organization; extractor: typeof resourceExtractors.organizations };\n  tags: { type: Tag; extractor: typeof resourceExtractors.tags };\n}\n\n/**\n * Valid resource names for name lookup\n */\nexport type ResourceName = keyof ResourceConfig;\n","/**\n * Custom hook to fetch and cache organization names\n * Handles batch fetching for performance optimization\n *\n * REFACTORED: Now uses type-safe generic base hook\n * BACKWARD COMPATIBLE: Same API as before\n *\n * @module filters/useOrganizationNames\n */\n\nimport type { Organization } from \"../validation/organizations\";\nimport { useResourceNamesBase } from \"./hooks/useResourceNamesBase\";\nimport { resourceExtractors } from \"./types/resourceTypes\";\n\n/**\n * Fetch and cache organization names for display\n *\n * @param organizationIds - Array of organization IDs to look up\n * @returns Object with organizationMap, getOrganizationName function, and loading state\n *\n * @example\n * ```typescript\n * const { getOrganizationName, loading } = useOrganizationNames([\"1\", \"2\"]);\n * const name = getOrganizationName(\"1\"); // \"Acme Corp\" or \"Organization #1\"\n * ```\n */\nexport const useOrganizationNames = (organizationIds: string[] | undefined) => {\n  const { namesMap, getName, loading } = useResourceNamesBase<Organization>(\n    \"organizations\",\n    organizationIds,\n    resourceExtractors.organizations,\n    \"Organization\"\n  );\n\n  // Return with original property names for backward compatibility\n  return {\n    organizationMap: namesMap,\n    getOrganizationName: getName,\n    loading,\n  };\n};\n","/**\n * Custom hook to fetch and cache sales person names\n * Handles batch fetching for performance optimization\n *\n * REFACTORED: Now uses type-safe generic base hook\n * BACKWARD COMPATIBLE: Same API as before\n *\n * @module filters/useSalesNames\n */\n\nimport type { Sales } from \"../validation/sales\";\nimport { useResourceNamesBase } from \"./hooks/useResourceNamesBase\";\nimport { resourceExtractors } from \"./types/resourceTypes\";\n\n/**\n * Fetch and cache sales person names for display\n *\n * @param salesIds - Array of sales IDs to look up\n * @returns Object with salesMap, getSalesName function, and loading state\n *\n * @example\n * ```typescript\n * const { getSalesName, loading } = useSalesNames([\"1\", \"2\", \"3\"]);\n * const name = getSalesName(\"1\"); // \"John Smith\" or \"Sales #1\"\n * ```\n */\nexport const useSalesNames = (salesIds: string[] | undefined) => {\n  const { namesMap, getName, loading } = useResourceNamesBase<Sales>(\n    \"sales\",\n    salesIds,\n    resourceExtractors.sales,\n    \"Sales\"\n  );\n\n  // Return with original property names for backward compatibility\n  return {\n    salesMap: namesMap,\n    getSalesName: getName,\n    loading,\n  };\n};\n","/**\n * Custom hook to fetch and cache tag names\n * Handles batch fetching for performance optimization\n *\n * Note: Tags in opportunities table are stored as text[] (tag names),\n * not IDs. However, this hook will be needed for contacts which use\n * bigint[] (tag IDs). For opportunities, tag values ARE the display names.\n *\n * REFACTORED: Now uses type-safe generic base hook\n * BACKWARD COMPATIBLE: Same API as before\n *\n * @module filters/useTagNames\n */\n\nimport type { Tag } from \"../validation/tags\";\nimport { useResourceNamesBase } from \"./hooks/useResourceNamesBase\";\nimport { resourceExtractors } from \"./types/resourceTypes\";\n\n/**\n * Fetch and cache tag names for display\n *\n * @param tagIds - Array of tag IDs to look up\n * @returns Object with tagMap, getTagName function, and loading state\n *\n * @example\n * ```typescript\n * const { getTagName, loading } = useTagNames([\"1\", \"2\", \"3\"]);\n * const name = getTagName(\"1\"); // \"Important\" or \"Tag #1\"\n * ```\n */\nexport const useTagNames = (tagIds: string[] | undefined) => {\n  const { namesMap, getName, loading } = useResourceNamesBase<Tag>(\n    \"tags\",\n    tagIds,\n    resourceExtractors.tags,\n    \"Tag\"\n  );\n\n  // Return with original property names for backward compatibility\n  return {\n    tagMap: namesMap,\n    getTagName: getName,\n    loading,\n  };\n};\n","/**\n * Custom hook to fetch and cache segment (playbook) names\n *\n * Follows the same pattern as useSalesNames, useOrganizationNames, useTagNames\n * for consistency across the filter chip bar.\n *\n * OPTIMIZATION: Playbook categories have fixed UUIDs, so we use synchronous\n * static lookup first, avoiding async fetch and ugly fallback display.\n *\n * @module filters/useSegmentNames\n */\n\nimport { useCallback, useMemo } from \"react\";\nimport type { Segment } from \"../validation/segments\";\nimport { PLAYBOOK_CATEGORY_NAMES_BY_ID } from \"../validation/segments\";\nimport { useResourceNamesBase } from \"./hooks/useResourceNamesBase\";\n\n/**\n * Display name extractor for Segment resources\n * Segments have a `name` field representing the Playbook category\n */\nconst segmentExtractor = (segment: Segment & { id: string | number }) => segment.name;\n\n/**\n * Fetch and cache segment names for display in FilterChipBar\n *\n * Uses synchronous static lookup for known playbook categories (instant display),\n * only falling back to async fetch for unknown segment types.\n *\n * @param segmentIds - Array of segment UUIDs to look up\n * @returns Object with segmentMap, getSegmentName function, and loading state\n *\n * @example\n * ```typescript\n * const { getSegmentName, loading } = useSegmentNames([\"uuid-1\", \"uuid-2\"]);\n * const name = getSegmentName(\"uuid-1\"); // \"Major Broadline\" (instant, no fetch!)\n * ```\n */\nexport const useSegmentNames = (segmentIds: string[] | undefined) => {\n  // Filter out known playbook IDs - no need to fetch these from database\n  const unknownIds = useMemo(\n    () => segmentIds?.filter((id) => !PLAYBOOK_CATEGORY_NAMES_BY_ID[id]),\n    [segmentIds]\n  );\n\n  // Only fetch unknown segments (operator segments, etc.)\n  const { namesMap, loading } = useResourceNamesBase<Segment>(\n    \"segments\",\n    unknownIds,\n    segmentExtractor,\n    \"Playbook\"\n  );\n\n  // Check static map first (instant!), then fall back to async-fetched names\n  const getSegmentName = useCallback(\n    (id: string): string => {\n      // Static lookup for known playbook categories - no loading, no fallback\n      const staticName = PLAYBOOK_CATEGORY_NAMES_BY_ID[id];\n      if (staticName) return staticName;\n\n      // Fall back to async-fetched name for unknown segments\n      return namesMap[id] || `Playbook #${id}`;\n    },\n    [namesMap]\n  );\n\n  // Merge static names with dynamically fetched ones\n  const segmentMap = useMemo(\n    () => ({ ...PLAYBOOK_CATEGORY_NAMES_BY_ID, ...namesMap }),\n    [namesMap]\n  );\n\n  return {\n    segmentMap,\n    getSegmentName,\n    loading,\n  };\n};\n","/**\n * Custom hook to fetch and cache product category names\n *\n * Categories come from the distinct_product_categories database view.\n * Follows the same pattern as other name hooks for consistency.\n *\n * @module filters/useCategoryNames\n */\n\nimport type { Category } from \"../validation/categories\";\nimport { useResourceNamesBase } from \"./hooks/useResourceNamesBase\";\n\n/**\n * Display name extractor for Category resources\n * Categories have a `name` field from the distinct_product_categories view\n */\nconst categoryExtractor = (category: Category & { id: string | number }) => category.name;\n\n/**\n * Fetch and cache category names for display in FilterChipBar\n *\n * @param categoryIds - Array of category IDs to look up\n * @returns Object with categoryMap, getCategoryName function, and loading state\n *\n * @example\n * ```typescript\n * const { getCategoryName, loading } = useCategoryNames([\"frozen\", \"dairy\"]);\n * const name = getCategoryName(\"frozen\"); // \"Frozen Foods\" or \"Category #frozen\"\n * ```\n */\nexport const useCategoryNames = (categoryIds: string[] | undefined) => {\n  const { namesMap, getName, loading } = useResourceNamesBase<Category>(\n    \"distinct_product_categories\",\n    categoryIds,\n    categoryExtractor,\n    \"Category\"\n  );\n\n  // Return with semantic property names for clarity\n  return {\n    categoryMap: namesMap,\n    getCategoryName: getName,\n    loading,\n  };\n};\n","/**\n * useFilterChipBar Hook\n *\n * Core hook that transforms React Admin filter state into displayable chips.\n * Handles reference resolution, date formatting, and grouped filter removal.\n *\n * @module filters/useFilterChipBar\n */\n\nimport { useCallback, useMemo } from \"react\";\nimport { useListContext } from \"react-admin\";\nimport type { ChipFilterConfig, FilterChoice } from \"./filterConfigSchema\";\nimport { useOrganizationNames } from \"./useOrganizationNames\";\nimport { useSalesNames } from \"./useSalesNames\";\nimport { useTagNames } from \"./useTagNames\";\nimport { useSegmentNames } from \"./useSegmentNames\";\nimport { useCategoryNames } from \"./useCategoryNames\";\n\n/**\n * Data structure for a single filter chip\n */\nexport interface ChipData {\n  /** Filter key (e.g., \"status\", \"organization_id\", or removalGroup for combined chips) */\n  key: string;\n  /** Filter value or removalGroup name for combined chips */\n  value: string | number;\n  /** Human-readable label for the chip */\n  label: string;\n  /** Category name for grouping (e.g., \"Status\", \"Organization\") */\n  category: string;\n}\n\n/**\n * Return type for useFilterChipBar hook\n */\nexport interface UseFilterChipBarReturn {\n  /** Array of chip data to render */\n  chips: ChipData[];\n  /** Remove a specific filter (handles grouped filters via removalGroup) */\n  removeFilter: (key: string, value?: string | number) => void;\n  /** Clear all user-applied filters (preserves system filters) */\n  clearAllFilters: () => void;\n  /** Whether any user-applied filters are active */\n  hasActiveFilters: boolean;\n  /** Count of active filter chips */\n  activeCount: number;\n}\n\n/**\n * System filters that should never show as chips.\n * Includes soft-delete variants used by various lists.\n *\n * NOTE: 'q' (search) is NOT excluded - we show search chips for user clarity\n */\nconst SYSTEM_FILTERS = [\"deleted_at\", \"deleted_at@is\"];\n\n/**\n * Transform React Admin filter state into displayable chips.\n *\n * DESIGN DECISIONS:\n * 1. Search chips: Shown with format `Search: \"term\"` for clarity\n * 2. Identity labels: Show full name (not \"Me\") - consistent UX, simpler code\n * 3. Date ranges: Combined into single chip using removalGroup\n *\n * @param filterConfig - Array of filter configurations defining how to display each filter\n * @param context - Optional context for dynamic choices (e.g., ConfigurationContext)\n * @returns UseFilterChipBarReturn with chips array and filter management functions\n *\n * @example\n * ```tsx\n * const { chips, removeFilter, clearAllFilters } = useFilterChipBar(\n *   ORGANIZATION_FILTER_CONFIG\n * );\n * ```\n */\nexport function useFilterChipBar(\n  filterConfig: ChipFilterConfig[],\n  context?: unknown\n): UseFilterChipBarReturn {\n  const { filterValues, setFilters, displayedFilters } = useListContext();\n\n  // Fail-fast: context must exist\n  if (!filterValues || !setFilters) {\n    throw new Error(\n      \"useFilterChipBar must be used within a React Admin List context. \" +\n        \"Ensure FilterChipBar is rendered inside a <List> component.\"\n    );\n  }\n\n  // Extract reference IDs for lazy loading names\n  const referenceIds = useMemo(() => {\n    const ids: {\n      organizations: string[];\n      sales: string[];\n      tags: string[];\n      segments: string[];\n      categories: string[];\n    } = {\n      organizations: [],\n      sales: [],\n      tags: [],\n      segments: [],\n      categories: [],\n    };\n\n    filterConfig.forEach((config) => {\n      const value = filterValues[config.key];\n      if (!value) return;\n\n      const values = Array.isArray(value) ? value : [value];\n\n      if (config.reference === \"organizations\" || config.key === \"organization_id\") {\n        ids.organizations.push(...values.map(String));\n      } else if (config.reference === \"sales\" || config.key === \"sales_id\") {\n        ids.sales.push(...values.map(String));\n      } else if (config.reference === \"tags\" || config.key === \"tags\") {\n        ids.tags.push(...values.map(String));\n      } else if (config.reference === \"segments\" || config.key === \"segment_id\") {\n        ids.segments.push(...values.map(String));\n      } else if (config.reference === \"categories\" || config.key === \"category\") {\n        ids.categories.push(...values.map(String));\n      }\n    });\n\n    return ids;\n  }, [filterValues, filterConfig]);\n\n  // Lazy-load reference names\n  const { getOrganizationName } = useOrganizationNames(referenceIds.organizations);\n  const { getSalesName } = useSalesNames(referenceIds.sales);\n  const { getTagName } = useTagNames(referenceIds.tags);\n  const { getSegmentName } = useSegmentNames(referenceIds.segments);\n  const { getCategoryName } = useCategoryNames(referenceIds.categories);\n\n  // Build removal groups map from config\n  const removalGroups = useMemo(() => {\n    const groups = new Map<string, string[]>();\n    filterConfig.forEach((config) => {\n      if (config.removalGroup) {\n        const existing = groups.get(config.removalGroup) || [];\n        groups.set(config.removalGroup, [...existing, config.key]);\n      }\n    });\n    return groups;\n  }, [filterConfig]);\n\n  // Helper: resolve choices (supports both static arrays and callbacks)\n  const resolveChoices = useCallback(\n    (config: ChipFilterConfig): FilterChoice[] | undefined => {\n      if (!config.choices) return undefined;\n      // If choices is a function, call it with context (e.g., ConfigurationContext)\n      if (typeof config.choices === \"function\") {\n        return config.choices(context);\n      }\n      return config.choices;\n    },\n    [context]\n  );\n\n  // Transform filterValues into chip data\n  // Combines date range chips using removalGroup\n  const chips = useMemo(() => {\n    const result: ChipData[] = [];\n    const processedGroups = new Set<string>(); // Track rendered removalGroups\n\n    Object.entries(filterValues).forEach(([key, value]) => {\n      // Skip system filters (but NOT 'q' - we want search chips)\n      if (SYSTEM_FILTERS.includes(key) || value === undefined || value === null) {\n        return;\n      }\n\n      const config = filterConfig.find((c) => c.key === key);\n      const category = config?.label ?? key;\n\n      // COMBINED DATE RANGE CHIPS: If this filter has a removalGroup, combine with others\n      if (config?.removalGroup) {\n        // Skip if we already rendered this group\n        if (processedGroups.has(config.removalGroup)) return;\n        processedGroups.add(config.removalGroup);\n\n        // Find all configs in this removalGroup\n        const groupConfigs = filterConfig.filter((c) => c.removalGroup === config.removalGroup);\n        const groupLabels: string[] = [];\n\n        groupConfigs.forEach((gc) => {\n          const gValue = filterValues[gc.key];\n          if (gValue !== undefined && gValue !== null) {\n            const formatted = gc.formatLabel ? gc.formatLabel(gValue) : String(gValue);\n            groupLabels.push(formatted);\n          }\n        });\n\n        if (groupLabels.length > 0) {\n          // Combined label: \"Jan 1 – Jan 31\" or just \"Jan 1\" if only one endpoint\n          const combinedLabel = groupLabels.join(\" – \");\n          // Use removalGroup as key so removal clears all\n          result.push({\n            key: config.removalGroup,\n            value: config.removalGroup, // Special value for grouped removal\n            label: combinedLabel,\n            // Clean up category label (remove After/Before/etc.)\n            category: config.label.replace(/(After|Before|@gte|@lte)/gi, \"\").trim() || \"Date\",\n          });\n        }\n        return; // Don't process individual filter\n      }\n\n      const values = Array.isArray(value) ? value : [value];\n\n      values.forEach((v) => {\n        let label: string;\n\n        // Special handling for search filter (q)\n        // Include \"Search: \" prefix since FilterChip only renders label, not category\n        if (key === \"q\") {\n          label = `Search: \"${String(v)}\"`;\n          result.push({ key, value: v as string | number, label, category: \"Search\" });\n          return; // Skip other label logic\n        }\n\n        if (config?.formatLabel) {\n          label = config.formatLabel(v);\n        } else if (config?.choices) {\n          // Resolve callback choices before calling .find()\n          const resolvedChoices = resolveChoices(config);\n          const choice = resolvedChoices?.find((c) => c.id === v);\n          label = choice?.name ?? String(v);\n        } else if (config?.reference === \"organizations\" || key === \"organization_id\") {\n          label = getOrganizationName(String(v));\n        } else if (config?.reference === \"sales\" || key === \"sales_id\") {\n          // NOTE: Shows full name, not \"Me\" even when value matches current user.\n          // This is intentional - consistent with other reference lookups.\n          label = getSalesName(String(v));\n        } else if (config?.reference === \"tags\" || key === \"tags\") {\n          label = getTagName(String(v));\n        } else if (config?.reference === \"segments\" || key === \"segment_id\") {\n          label = getSegmentName(String(v));\n        } else if (config?.reference === \"categories\" || key === \"category\") {\n          label = getCategoryName(String(v));\n        } else {\n          label = String(v);\n        }\n\n        result.push({ key, value: v as string | number, label, category });\n      });\n    });\n\n    return result;\n  }, [\n    filterValues,\n    filterConfig,\n    resolveChoices,\n    getOrganizationName,\n    getSalesName,\n    getTagName,\n    getSegmentName,\n    getCategoryName,\n  ]);\n\n  const removeFilter = useCallback(\n    (key: string, value?: string | number) => {\n      // Find the config for this key to check for removal groups\n      const config = filterConfig.find((c) => c.key === key);\n\n      // Check if key IS a removalGroup name (for combined chips)\n      // Combined date range chips use removalGroup as their key\n      let keysToRemove: string[];\n      if (removalGroups.has(key)) {\n        // Key is a removalGroup - remove all filters in that group\n        keysToRemove = removalGroups.get(key) || [key];\n      } else if (config?.removalGroup) {\n        // Key is an individual filter with a removalGroup\n        keysToRemove = removalGroups.get(config.removalGroup) || [key];\n      } else {\n        // Regular filter, just remove this key\n        keysToRemove = [key];\n      }\n\n      const currentValue = filterValues[key];\n\n      if (Array.isArray(currentValue) && value !== undefined && keysToRemove.length === 1) {\n        // Single key, array value - remove just that value\n        const newArray = currentValue.filter((v) => v !== value);\n        setFilters(\n          { ...filterValues, [key]: newArray.length ? newArray : undefined },\n          displayedFilters\n        );\n      } else {\n        // Remove all keys in the group\n        const newFilters = { ...filterValues };\n        keysToRemove.forEach((k) => {\n          delete newFilters[k];\n        });\n        setFilters(newFilters, displayedFilters);\n      }\n    },\n    [filterValues, setFilters, displayedFilters, filterConfig, removalGroups]\n  );\n\n  const clearAllFilters = useCallback(() => {\n    // Preserve system filters when clearing\n    const preserved = Object.fromEntries(\n      Object.entries(filterValues).filter(([key]) => SYSTEM_FILTERS.includes(key))\n    );\n    setFilters(preserved, displayedFilters);\n  }, [filterValues, setFilters, displayedFilters]);\n\n  const activeCount = chips.length;\n  const hasActiveFilters = activeCount > 0;\n\n  return { chips, removeFilter, clearAllFilters, hasActiveFilters, activeCount };\n}\n","/**\n * FilterChipBar Component\n *\n * Horizontal bar displaying active filters as removable chips.\n * Placed ABOVE the datagrid for maximum visibility.\n *\n * @module filters/FilterChipBar\n */\n\nimport { useCallback, useRef } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { cn } from \"@/lib/utils\";\nimport type { ChipFilterConfig } from \"./filterConfigSchema\";\nimport { useFilterChipBar } from \"./useFilterChipBar\";\nimport { FilterChip } from \"./FilterChip\";\n\ninterface FilterChipBarProps {\n  /** Filter configuration defining how to display each filter type */\n  filterConfig: ChipFilterConfig[];\n  /** Optional context for dynamic choices (e.g., ConfigurationContext) */\n  context?: unknown;\n  /** Additional CSS classes */\n  className?: string;\n}\n\n/**\n * Horizontal bar displaying active filters as removable chips.\n *\n * Features:\n * - Renders above datagrid for visibility\n * - Shows \"Clear all\" when 2+ filters active\n * - Keyboard navigation between chips\n * - ARIA roles for accessibility\n * - 44px touch targets for iPad\n *\n * @example\n * ```tsx\n * <StandardListLayout filterComponent={<MyFilter />}>\n *   <FilterChipBar filterConfig={MY_FILTER_CONFIG} />\n *   <PremiumDatagrid>...</PremiumDatagrid>\n * </StandardListLayout>\n * ```\n */\nexport function FilterChipBar({ filterConfig, context, className }: FilterChipBarProps) {\n  const chipBarRef = useRef<HTMLDivElement>(null);\n\n  // Fail-fast: config required\n  if (!filterConfig || filterConfig.length === 0) {\n    throw new Error(\n      \"FilterChipBar requires a non-empty filterConfig. \" +\n        \"Check that the feature has defined its filter configuration.\"\n    );\n  }\n\n  const { chips, removeFilter, clearAllFilters, hasActiveFilters, activeCount } = useFilterChipBar(\n    filterConfig,\n    context\n  );\n\n  /**\n   * Keyboard navigation handler for chip bar\n   * Allows arrow key navigation between chips\n   */\n  const handleKeyDown = useCallback((e: React.KeyboardEvent) => {\n    const buttons = chipBarRef.current?.querySelectorAll('button[aria-label^=\"Remove\"]');\n    if (!buttons?.length) return;\n\n    const currentIndex = Array.from(buttons).findIndex((btn) => btn === document.activeElement);\n\n    switch (e.key) {\n      case \"ArrowRight\":\n        e.preventDefault();\n        (buttons[(currentIndex + 1) % buttons.length] as HTMLElement).focus();\n        break;\n      case \"ArrowLeft\":\n        e.preventDefault();\n        (buttons[currentIndex <= 0 ? buttons.length - 1 : currentIndex - 1] as HTMLElement).focus();\n        break;\n      case \"Home\":\n        e.preventDefault();\n        (buttons[0] as HTMLElement).focus();\n        break;\n      case \"End\":\n        e.preventDefault();\n        (buttons[buttons.length - 1] as HTMLElement).focus();\n        break;\n    }\n  }, []);\n\n  // Don't render if no active filters\n  if (!hasActiveFilters) {\n    return null;\n  }\n\n  return (\n    <div\n      ref={chipBarRef}\n      role=\"toolbar\"\n      aria-label=\"Active filters\"\n      aria-orientation=\"horizontal\"\n      onKeyDown={handleKeyDown}\n      className={cn(\n        \"flex items-center gap-2 px-4 py-2 bg-muted/50 border-b overflow-x-auto\",\n        className\n      )}\n    >\n      <span id=\"filter-chip-bar-label\" className=\"text-sm text-muted-foreground whitespace-nowrap\">\n        Active filters:\n      </span>\n      <div\n        role=\"list\"\n        aria-labelledby=\"filter-chip-bar-label\"\n        className=\"flex items-center gap-1.5 flex-wrap\"\n      >\n        {chips.map((chip) => (\n          <div key={`${chip.key}-${chip.value}`} role=\"listitem\">\n            <FilterChip label={chip.label} onRemove={() => removeFilter(chip.key, chip.value)} />\n          </div>\n        ))}\n      </div>\n      {activeCount >= 2 && (\n        <Button\n          variant=\"ghost\"\n          size=\"sm\"\n          onClick={clearAllFilters}\n          className=\"ml-auto whitespace-nowrap text-muted-foreground hover:text-foreground\"\n          aria-label={`Clear all ${activeCount} filters`}\n        >\n          Clear all\n        </Button>\n      )}\n    </div>\n  );\n}\n","/**\n * Filter Configuration Schema\n *\n * Zod schema for validating filter configurations at initialization time (fail-fast).\n * Used by FilterChipBar to transform filter state into displayable chips.\n *\n * @module filters/filterConfigSchema\n */\n\nimport { z } from \"zod\";\n\n/**\n * Schema for individual filter choice options\n */\nexport const filterChoiceSchema = z.object({\n  id: z.union([z.string(), z.number()]),\n  name: z.string().max(100),\n});\n\n/**\n * Type for filter choices - can be static array or callback for dynamic choices\n * Callback receives context (e.g., ConfigurationContext values) at runtime\n */\nexport type FilterChoice = z.infer<typeof filterChoiceSchema>;\nexport type ChoicesOrCallback = FilterChoice[] | ((context: unknown) => FilterChoice[]);\n\n/**\n * Zod 4 custom schema for validating callback functions.\n * In Zod 4, z.function() is no longer a schema - it's a \"function factory\".\n * We use z.custom() to validate that a value is a function returning FilterChoice[].\n *\n * @see https://zod.dev/v4/changelog#zfunction\n */\nconst choicesCallbackSchema = z.custom<(context: unknown) => FilterChoice[]>(\n  (val) => typeof val === \"function\",\n  { message: \"Expected a function returning FilterChoice[]\" }\n);\n\n/**\n * Zod 4 custom schema for validating formatLabel callback functions.\n */\nconst formatLabelCallbackSchema = z.custom<(value: unknown) => string>(\n  (val) => typeof val === \"function\",\n  { message: \"Expected a function returning string\" }\n);\n\n/**\n * Schema for a single filter configuration entry\n *\n * NOTE: ChipFilterConfig is named to avoid collision with existing FilterConfig in types.ts\n */\nexport const chipFilterConfigSchema = z.object({\n  /** Filter key matching React Admin filterValues (e.g., \"organization_type\", \"created_at@gte\") */\n  key: z.string().min(1).max(100),\n  /** Human-readable label for the chip category (e.g., \"Type\", \"Created After\") */\n  label: z.string().min(1).max(50),\n  /**\n   * Filter type - expanded to include all existing filter types in codebase:\n   * - select: Single value selection\n   * - multiselect: Multiple value selection\n   * - reference: Reference to another resource (uses name hooks)\n   * - date-range: Date filter (typically paired with @gte/@lte)\n   * - search: Full-text search filter\n   * - toggle: Boolean toggle\n   * - boolean: Boolean filter with custom labels\n   */\n  type: z.enum([\"select\", \"multiselect\", \"reference\", \"date-range\", \"search\", \"toggle\", \"boolean\"]),\n  /** Reference resource name for 'reference' type filters (e.g., \"organizations\", \"sales\") */\n  reference: z.string().optional(),\n  /**\n   * Choices for select/multiselect filters\n   * Can be static array OR callback function for dynamic choices (e.g., from ConfigurationContext)\n   */\n  choices: z.union([z.array(filterChoiceSchema), choicesCallbackSchema]).optional(),\n  /** Custom formatter function to transform filter value into chip label */\n  formatLabel: formatLabelCallbackSchema.optional(),\n  /**\n   * Group related filters for removal (e.g., date ranges)\n   * When one filter in a group is removed, all filters in that group are removed\n   * Example: \"last_seen_range\" groups \"last_seen@gte\" and \"last_seen@lte\"\n   */\n  removalGroup: z.string().optional(),\n});\n\n/**\n * Schema for array of filter configurations\n */\nexport const filterConfigSchema = z.array(chipFilterConfigSchema);\n\n/**\n * Type for a single filter configuration entry\n * Named ChipFilterConfig to avoid collision with existing FilterConfig in types.ts\n */\nexport type ChipFilterConfig = z.infer<typeof chipFilterConfigSchema>;\n\n/**\n * Validate filter config at module initialization (fail-fast).\n *\n * Call this when defining filter configs to catch errors at startup:\n * ```typescript\n * export const MY_FILTER_CONFIG = validateFilterConfig([\n *   { key: \"status\", label: \"Status\", type: \"select\", choices: STATUS_CHOICES },\n * ]);\n * ```\n *\n * @param config - Array of filter configuration objects\n * @returns Validated and typed filter configuration array\n * @throws {ZodError} if config is malformed\n */\nexport function validateFilterConfig(config: unknown): ChipFilterConfig[] {\n  return filterConfigSchema.parse(config);\n}\n","/**\n * Secure storage utilities\n * Prefers sessionStorage (cleared on tab close) over localStorage\n *\n * Phase 1 Security Remediation - HIGH Priority\n *\n * Security Rationale:\n * - localStorage persists across browser sessions (privacy risk on shared devices)\n * - sessionStorage is cleared when browser tab closes (more secure)\n * - Filter preferences don't need to persist forever\n * - Reduces attack surface for XSS (session-only exposure)\n *\n * @module secureStorage\n */\n\nexport type StorageType = \"session\" | \"local\";\n\nexport interface StorageOptions {\n  /**\n   * Preferred storage type\n   * - 'session': Cleared when browser tab closes (more secure, recommended)\n   * - 'local': Persists across sessions (convenience over security)\n   */\n  type?: StorageType;\n\n  /**\n   * Encrypt data before storing (future enhancement)\n   * Currently not implemented, but structure supports it\n   */\n  encrypt?: boolean;\n}\n\n/**\n * Get item from storage\n * Tries sessionStorage first (more secure), falls back to localStorage for migration\n *\n * @param key - Storage key\n * @param options - Storage options (defaults to sessionStorage)\n * @returns Parsed value or null if not found\n *\n * @example\n * const stages = getStorageItem<string[]>('filter.opportunity_stages');\n * // Returns: ['new_lead', 'initial_outreach'] or null\n */\nexport function getStorageItem<T = any>(key: string, options: StorageOptions = {}): T | null {\n  const storageType = options.type || \"session\";\n\n  try {\n    // Try preferred storage type first\n    const storage = storageType === \"session\" ? sessionStorage : localStorage;\n    const item = storage.getItem(key);\n\n    if (item) {\n      return JSON.parse(item) as T;\n    }\n\n    // Fallback to alternate storage if not found (migration path)\n    const fallbackStorage = storageType === \"session\" ? localStorage : sessionStorage;\n    const fallbackItem = fallbackStorage.getItem(key);\n\n    if (fallbackItem) {\n      // Migrate to preferred storage\n      const parsed = JSON.parse(fallbackItem) as T;\n      setStorageItem(key, parsed, options);\n\n      // Clean up old storage\n      fallbackStorage.removeItem(key);\n\n      return parsed;\n    }\n  } catch (e) {\n    console.error(`[Storage] Error reading key \"${key}\":`, e);\n  }\n\n  return null;\n}\n\n/**\n * Set item in storage\n *\n * @param key - Storage key\n * @param value - Value to store (will be JSON.stringify'd)\n * @param options - Storage options (defaults to sessionStorage)\n * @returns true if successful, false otherwise\n *\n * @example\n * setStorageItem('filter.opportunity_stages', ['new_lead', 'initial_outreach']);\n * // Stores in sessionStorage, cleared on tab close\n */\nexport function setStorageItem<T = any>(\n  key: string,\n  value: T,\n  options: StorageOptions = {}\n): boolean {\n  const storageType = options.type || \"session\";\n\n  try {\n    const storage = storageType === \"session\" ? sessionStorage : localStorage;\n    storage.setItem(key, JSON.stringify(value));\n    return true;\n  } catch (e) {\n    console.error(`[Storage] Error writing key \"${key}\":`, e);\n\n    // Try fallback storage if preferred fails (quota exceeded, etc.)\n    try {\n      const fallbackStorage = storageType === \"session\" ? localStorage : sessionStorage;\n      fallbackStorage.setItem(key, JSON.stringify(value));\n      console.warn(`[Storage] Used fallback storage for key \"${key}\"`);\n      return true;\n    } catch (e2) {\n      console.error(`[Storage] Fallback storage also failed:`, e2);\n      return false;\n    }\n  }\n}\n\n/**\n * Remove item from both storage types\n * Ensures complete cleanup regardless of where data was stored\n *\n * @param key - Storage key to remove\n *\n * @example\n * removeStorageItem('filter.opportunity_stages');\n * // Removes from both sessionStorage and localStorage\n */\nexport function removeStorageItem(key: string): void {\n  try {\n    sessionStorage.removeItem(key);\n    localStorage.removeItem(key);\n  } catch (e) {\n    console.error(`[Storage] Error removing key \"${key}\":`, e);\n  }\n}\n\n/**\n * Clear all items with a given prefix\n * Useful for logging out or clearing feature-specific data\n *\n * @param prefix - Key prefix to match (e.g., 'filter.' clears all filter data)\n *\n * @example\n * clearStorageByPrefix('filter.');\n * // Clears: filter.opportunity_stages, filter.precedence, etc.\n */\nexport function clearStorageByPrefix(prefix: string): void {\n  const clearFromStorage = (storage: Storage) => {\n    const keysToRemove: string[] = [];\n\n    for (let i = 0; i < storage.length; i++) {\n      const key = storage.key(i);\n      if (key && key.startsWith(prefix)) {\n        keysToRemove.push(key);\n      }\n    }\n\n    keysToRemove.forEach((key) => storage.removeItem(key));\n  };\n\n  try {\n    clearFromStorage(sessionStorage);\n    clearFromStorage(localStorage);\n  } catch (e) {\n    console.error(`[Storage] Error clearing prefix \"${prefix}\":`, e);\n  }\n}\n\n/**\n * Get all keys matching a prefix\n * Useful for debugging or data export\n *\n * @param prefix - Key prefix to match\n * @returns Array of matching keys from both storage types\n *\n * @example\n * const filterKeys = getKeysByPrefix('filter.');\n * // Returns: ['filter.opportunity_stages', 'filter.precedence']\n */\nexport function getKeysByPrefix(prefix: string): string[] {\n  const keys: Set<string> = new Set();\n\n  const collectKeys = (storage: Storage) => {\n    for (let i = 0; i < storage.length; i++) {\n      const key = storage.key(i);\n      if (key && key.startsWith(prefix)) {\n        keys.add(key);\n      }\n    }\n  };\n\n  try {\n    collectKeys(sessionStorage);\n    collectKeys(localStorage);\n  } catch (e) {\n    console.error(`[Storage] Error getting keys for prefix \"${prefix}\":`, e);\n  }\n\n  return Array.from(keys);\n}\n","import { OPPORTUNITY_STAGE_CHOICES } from \"../opportunities/constants/stageConstants\";\nimport { getStorageItem, setStorageItem } from \"../utils/secureStorage\";\n\n/**\n * Storage key for opportunity stage preferences\n * Phase 1 Security Remediation: Now uses sessionStorage instead of localStorage\n * (cleared on tab close for better privacy)\n */\nconst STORAGE_KEY = \"filter.opportunity_stages\";\n\n/**\n * Default visible stages - excludes closed stages by default\n * Users typically want to focus on active opportunities\n */\nconst DEFAULT_VISIBLE_STAGES = OPPORTUNITY_STAGE_CHOICES.filter(\n  (c) => ![\"closed_won\", \"closed_lost\"].includes(c.id)\n).map((c) => c.id);\n\n/**\n * Get stored stage preferences from sessionStorage\n * Falls back to default visible stages if no preferences are stored\n *\n * Phase 1 Security Remediation: Uses sessionStorage (cleared on tab close)\n *\n * @returns Array of stage IDs that should be visible in the filter\n */\nexport const getStoredStagePreferences = (): string[] => {\n  try {\n    // SECURITY: Use sessionStorage instead of localStorage\n    const stored = getStorageItem<string[]>(STORAGE_KEY, { type: \"session\" });\n    if (!stored) return DEFAULT_VISIBLE_STAGES;\n\n    // Handle corrupted data (null, non-array values)\n    if (!Array.isArray(stored)) {\n      return DEFAULT_VISIBLE_STAGES;\n    }\n    return stored;\n  } catch {\n    return DEFAULT_VISIBLE_STAGES;\n  }\n};\n\n/**\n * Save stage preferences to sessionStorage\n * Only saves if selectedStages is a non-empty array\n *\n * Phase 1 Security Remediation: Uses sessionStorage (cleared on tab close)\n *\n * @param selectedStages - Array of stage IDs that are currently selected\n */\nexport const saveStagePreferences = (selectedStages: string[]): void => {\n  if (selectedStages.length === 0) return; // Don't save empty array\n\n  try {\n    // SECURITY: Use sessionStorage instead of localStorage\n    setStorageItem(STORAGE_KEY, selectedStages, { type: \"session\" });\n  } catch (error) {\n    console.warn(\"Failed to save stage preferences:\", error);\n  }\n};\n\n/**\n * Get default visible stages (system default)\n * Used when no user preferences exist and no URL parameters are provided\n *\n * @returns Array of default visible stage IDs\n */\nexport const getDefaultVisibleStages = (): string[] => {\n  return DEFAULT_VISIBLE_STAGES;\n};\n\n/**\n * Get initial stage filter value with precedence logic\n * Priority: URL parameters > localStorage > defaults\n *\n * @returns Array of stage IDs to filter by, or undefined if URL has explicit value\n */\nexport const getInitialStageFilter = (): string[] | undefined => {\n  // 1. Check URL parameters (highest priority)\n  const urlParams = new URLSearchParams(window.location.search);\n  const urlFilter = urlParams.get(\"filter\");\n  if (urlFilter) {\n    try {\n      const parsed = JSON.parse(urlFilter);\n      if (parsed.stage) {\n        return Array.isArray(parsed.stage) ? parsed.stage : [parsed.stage];\n      }\n    } catch {\n      // Invalid JSON in URL, continue to fallback\n    }\n  }\n\n  // 2. Check localStorage preferences\n  return getStoredStagePreferences();\n};\n"],"names":["STORAGE_KEY","StandardListLayout","filterComponent","children","resource","isCollapsed","setIsCollapsed","useState","window","stored","localStorage","getItem","innerWidth","useEffect","setItem","String","toggleSidebar","useCallback","prev","jsxs","className","Tooltip","jsx","TooltipTrigger","asChild","Button","variant","size","onClick","PanelLeft","PanelLeftClose","TooltipContent","side","id","role","__name","FilterChip","label","onRemove","handleRemove","e","stopPropagation","cn","X","useResourceNamesBase","resourceName","ids","getDisplayName","fallbackPrefix","dataProvider","useDataProvider","namesMap","setNamesMap","loading","setLoading","idsKey","useMemo","join","length","async","idsToFetch","filter","data","getMany","newMap","reduce","acc","item","error","fetchNames","getName","resourceExtractors","sales","s","first_name","last_name","trim","organizations","o","name","tags","t","useOrganizationNames","organizationIds","organizationMap","getOrganizationName","useSalesNames","salesIds","salesMap","getSalesName","useTagNames","tagIds","tagMap","getTagName","segmentExtractor","segment","useSegmentNames","segmentIds","unknownIds","PLAYBOOK_CATEGORY_NAMES_BY_ID","getSegmentName","staticName","segmentMap","categoryExtractor","category","useCategoryNames","categoryIds","categoryMap","getCategoryName","SYSTEM_FILTERS","useFilterChipBar","filterConfig","context","filterValues","setFilters","displayedFilters","useListContext","Error","referenceIds","segments","categories","forEach","config","value","key","values","Array","isArray","reference","push","map","removalGroups","groups","Map","removalGroup","existing","get","set","resolveChoices","choices","chips","result","processedGroups","Set","Object","entries","includes","find","c","has","add","groupConfigs","groupLabels","gc","gValue","formatted","formatLabel","combinedLabel","replace","v","resolvedChoices","choice","removeFilter","keysToRemove","currentValue","newArray","newFilters","k","clearAllFilters","preserved","fromEntries","activeCount","hasActiveFilters","FilterChipBar","chipBarRef","useRef","handleKeyDown","buttons","current","querySelectorAll","currentIndex","from","findIndex","btn","document","activeElement","preventDefault","focus","ref","onKeyDown","chip","filterChoiceSchema","z.object","z.union","z.string","z.number","max","choicesCallbackSchema","z.custom","val","message","formatLabelCallbackSchema","chipFilterConfigSchema","min","type","z.enum","optional","z.array","filterConfigSchema","validateFilterConfig","parse","setStorageItem","options","storageType","sessionStorage","JSON","stringify","e2","OPPORTUNITY_STAGE_CHOICES","saveStagePreferences","selectedStages"],"mappings":"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"}