const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/PipelineDrillDownSheet-DbnBWeWk.js","js/chunk-ByJg_QQB.js","js/chunk-1NZFT-6z.js","js/chunk-JxeXaC9i.js","assets/index-BoLku8RR.js","js/chunk-DwAffUXc.js","js/chunk-knA4lag3.js","js/chunk-Tyyhsnez.js","js/chunk-Bc6KM1xM.js","js/chunk-XoqkUGE_.js","js/chunk-CRKBdUTG.js","assets/index-CNAHjYtZ.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,s=(s,a)=>e(s,"name",{value:a,configurable:!0});import{a9 as a,d as t,S as n,a4 as r,aZ as i,Z as l,$ as c,B as o,a0 as m,L as d,_ as u,V as x,W as h,X as p}from"../assets/index-BoLku8RR.js";import{U as j,j as g}from"./chunk-ByJg_QQB.js";import{r as N}from"./chunk-1NZFT-6z.js";import{b as f,e as b,T as v,a as k,c as w,d as y}from"./chunk-D_rprtX5.js";import{C as S}from"./chunk-Dn-NAOCt.js";import{k as C,aV as P,aW as F,O as _,aK as W,aX as T,aY as A,aU as D,aN as M}from"./chunk-Bc6KM1xM.js";import"./chunk-DwAffUXc.js";import"./chunk-knA4lag3.js";import"./chunk-Tyyhsnez.js";import"./chunk-JxeXaC9i.js";import"./chunk-XoqkUGE_.js";import"./chunk-CRKBdUTG.js";const I=[];function L(e){const{salesId:s,loading:t}=a(),n=N.useMemo(()=>{const a={};return e?.myPrincipalsOnly&&s&&(a.sales_id=s),a},[e?.myPrincipalsOnly,s]),r=!(t||e?.myPrincipalsOnly&&!s),{data:i=[],isPending:l,error:c}=j("principal_pipeline_summary",{filter:n,sort:{field:"active_this_week",order:"DESC"},pagination:{page:1,perPage:100}},{enabled:r,staleTime:3e5});return{data:N.useMemo(()=>e?.myPrincipalsOnly&&!s?I:i.map(e=>({id:e.principal_id,name:e.principal_name,totalPipeline:e.total_pipeline,activeThisWeek:e.active_this_week,activeLastWeek:e.active_last_week,momentum:e.momentum,nextAction:e.next_action_summary})),[i,s,e?.myPrincipalsOnly]),loading:l,error:c?new Error(String(c)):null}}function V({data:e}){const[s,a]=N.useState("name"),[t,n]=N.useState("ascending"),[r,i]=N.useState(""),[l,c]=N.useState(new Set),o=N.useCallback(e=>{c(s=>{const a=new Set(s);return a.has(e)?a.delete(e):a.add(e),a})},[]),m=N.useCallback(e=>{s===e?n(e=>"ascending"===e?"descending":"ascending"):(a(e),n("name"===e?"ascending":"descending"))},[s]),d=N.useMemo(()=>{if(!e||0===e.length)return e;let s=e;if(r.trim()){const e=r.toLowerCase().trim();s=s.filter(s=>s.name.toLowerCase().includes(e))}return l.size>0&&(s=s.filter(e=>l.has(e.momentum))),s},[e,r,l]),u=N.useMemo(()=>d&&0!==d.length?[...d].sort((e,a)=>{let n=0;switch(s){case"name":n=e.name.localeCompare(a.name);break;case"totalPipeline":n=e.totalPipeline-a.totalPipeline;break;case"activeThisWeek":n=e.activeThisWeek-a.activeThisWeek;break;case"activeLastWeek":n=e.activeLastWeek-a.activeLastWeek;break;case"momentum":{const s={increasing:3,steady:2,decreasing:1,stale:0};n=s[e.momentum]-s[a.momentum];break}}return"descending"===t?-n:n}):d,[d,s,t]),x=N.useCallback(e=>s===e?t:"none",[s,t]);return{sortField:s,sortDirection:t,searchQuery:r,momentumFilters:l,setSearchQuery:i,handleSort:m,toggleMomentumFilter:o,sortedData:u,getAriaSortValue:x}}function O({momentum:e}){switch(e){case"increasing":return g.jsx(_,{className:"h-4 w-4 text-success"});case"decreasing":return g.jsx(F,{className:"h-4 w-4 text-warning"});case"steady":return g.jsx(P,{className:"h-4 w-4 text-muted-foreground"});case"stale":return g.jsx(C,{className:"h-4 w-4 text-destructive"})}}function $(e){switch(e){case"increasing":return"bg-success";case"steady":return"bg-muted-foreground/50";case"decreasing":return"bg-warning";case"stale":return"bg-destructive"}}function z({row:e,onRowClick:a}){const n=s(s=>{"Enter"!==s.key&&" "!==s.key||(s.preventDefault(),a(e))},"handleKeyDown");return g.jsxs(f,{className:"table-row-premium cursor-pointer relative",onClick:s(()=>a(e),"onClick"),onKeyDown:n,tabIndex:0,role:"button","aria-label":`View opportunities for ${e.name}. Pipeline momentum: ${e.momentum}`,children:[g.jsxs(b,{className:"font-medium relative",children:[g.jsx("div",{className:`absolute left-0 top-0 bottom-0 w-1 ${$(e.momentum)}`,"aria-hidden":"true"}),g.jsx("span",{className:"pl-2",children:e.name})]}),g.jsx(b,{className:"text-right",children:g.jsx("div",{className:"font-semibold",children:e.totalPipeline})}),g.jsx(b,{className:"text-center",children:e.activeThisWeek>0?g.jsx(t,{variant:"success",children:e.activeThisWeek}):g.jsx("span",{className:"text-muted-foreground",children:"-"})}),g.jsx(b,{className:"text-center hidden lg:table-cell",children:e.activeLastWeek>0?g.jsx(t,{variant:"secondary",children:e.activeLastWeek}):g.jsx("span",{className:"text-muted-foreground",children:"-"})}),g.jsx(b,{children:g.jsxs("div",{className:"flex items-center gap-1",children:[g.jsx(O,{momentum:e.momentum}),g.jsx("span",{className:"text-sm capitalize",children:e.momentum})]})}),g.jsx(b,{className:"max-w-[200px] lg:max-w-[280px]",children:e.nextAction?g.jsx("span",{className:"text-sm text-foreground block truncate",title:e.nextAction,children:e.nextAction}):g.jsx("span",{className:"text-sm text-muted-foreground italic",children:"No action scheduled"})})]})}s(L,"usePrincipalPipeline"),s(V,"usePipelineTableState"),s(O,"MomentumIcon"),s($,"getDecayIndicatorColor"),s(z,"PipelineTableRow");const E=N.lazy(()=>u(()=>import("./PipelineDrillDownSheet-DbnBWeWk.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])).then(e=>({default:e.PipelineDrillDownSheet})));function Q(){const[e,a]=N.useState(!1),[t,l]=N.useState(null),{data:c,loading:o,error:m}=L({myPrincipalsOnly:e}),{searchQuery:d,setSearchQuery:u,momentumFilters:x,toggleMomentumFilter:h,handleSort:p,sortedData:j,sortField:b,sortDirection:S,getAriaSortValue:C}=V({data:c}),P=N.useCallback(e=>b!==e?g.jsx(W,{className:"ml-1 h-4 w-4 opacity-50"}):"ascending"===S?g.jsx(T,{className:"ml-1 h-4 w-4"}):g.jsx(A,{className:"ml-1 h-4 w-4"}),[b,S]),F=N.useCallback(e=>{l({id:e.id,name:e.name})},[]),_=N.useCallback(()=>{l(null)},[]);return o?g.jsxs("div",{className:"flex flex-col p-4",children:[g.jsx("div",{className:"border-b border-border pb-3",children:g.jsxs("div",{className:"flex items-start justify-between",children:[g.jsxs("div",{children:[g.jsx(n,{className:"mb-2 h-6 w-48"}),g.jsx(n,{className:"h-4 w-80"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(n,{className:"h-9 w-48"}),g.jsx(n,{className:"h-5 w-10"}),g.jsx(n,{className:"h-4 w-28"}),g.jsx(n,{className:"h-9 w-20"})]})]})}),g.jsxs("div",{className:"pt-2",children:[g.jsxs("div",{className:"flex gap-4 px-2 py-3 border-b border-border",children:[g.jsx(n,{className:"h-4 w-32"}),g.jsx(n,{className:"h-4 w-16 ml-auto"}),g.jsx(n,{className:"h-4 w-20"}),g.jsx(n,{className:"h-4 w-20 hidden lg:block"}),g.jsx(n,{className:"h-4 w-24"}),g.jsx(n,{className:"h-4 w-32"})]}),g.jsx("div",{className:"space-y-1 pt-1",children:[1,2,3,4,5].map(e=>g.jsxs("div",{className:"flex items-center gap-4 px-2 py-3 border-b border-border/50",children:[g.jsx(n,{className:"h-4 w-28"}),g.jsx(n,{className:"h-5 w-8 ml-auto"}),g.jsx(n,{className:"h-5 w-8"}),g.jsx(n,{className:"h-5 w-8 hidden lg:block"}),g.jsx(n,{className:"h-4 w-20"}),g.jsx(n,{className:"h-4 w-36"})]},e))})]})]}):m?g.jsx("div",{className:"flex h-full items-center justify-center",children:g.jsxs("div",{className:"text-center",children:[g.jsx("p",{className:"text-destructive",children:"Failed to load pipeline data"}),g.jsx("p",{className:"text-sm text-muted-foreground",children:m.message})]})}):g.jsxs("div",{className:"flex flex-col p-4","data-tutorial":"dashboard-pipeline-table",children:[g.jsx("div",{className:"border-b border-border pb-3",children:g.jsxs("div",{className:"flex items-start justify-between",children:[g.jsxs("div",{children:[g.jsx("h2",{className:"text-lg font-semibold",children:"Pipeline by Principal"}),g.jsx("p",{className:"text-sm text-muted-foreground",children:"Track opportunity momentum across your customer accounts"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsxs("div",{className:"relative",children:[g.jsx(D,{className:"absolute left-2.5 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),g.jsx(r,{placeholder:"Search principals...",value:d,onChange:s(e=>u(e.target.value),"onChange"),className:"h-9 w-48 pl-8"})]}),g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(i,{id:"my-principals",checked:e,onCheckedChange:a}),g.jsx("label",{htmlFor:"my-principals",className:"text-sm",children:"My Principals Only"})]}),g.jsx(K,{momentumFilters:x,toggleMomentumFilter:h})]})]})}),g.jsx("div",{className:"pt-2",children:0===j?.length?g.jsx(B,{searchQuery:d}):g.jsxs(v,{children:[g.jsx(k,{className:"sticky top-0 bg-background",children:g.jsxs(f,{children:[g.jsx(R,{field:"name",label:"Principal",currentSortField:b,onSort:p,getAriaSortValue:C,renderSortIcon:P}),g.jsx(R,{field:"totalPipeline",label:"Pipeline",currentSortField:b,onSort:p,getAriaSortValue:C,renderSortIcon:P,align:"right"}),g.jsx(R,{field:"activeThisWeek",label:"This Week",tooltip:"Activities logged Mon–Sun of current week",currentSortField:b,onSort:p,getAriaSortValue:C,renderSortIcon:P,align:"center"}),g.jsx(R,{field:"activeLastWeek",label:"Last Week",tooltip:"Activities logged Mon–Sun of previous week",currentSortField:b,onSort:p,getAriaSortValue:C,renderSortIcon:P,align:"center",className:"hidden lg:table-cell"}),g.jsx(R,{field:"momentum",label:"Momentum",tooltip:"Based on activity trend over 14 days",currentSortField:b,onSort:p,getAriaSortValue:C,renderSortIcon:P}),g.jsx(w,{className:"max-w-[200px] lg:max-w-[280px]",children:"Next Action"})]})}),g.jsx(y,{children:j?.map(e=>g.jsx(z,{row:e,onRowClick:F},e.id))})]})}),null!==t&&g.jsx(N.Suspense,{fallback:null,children:g.jsx(E,{principalId:t.id,principalName:t.name,isOpen:!0,onClose:_})})]})}function R({field:e,label:a,tooltip:t,onSort:n,getAriaSortValue:r,renderSortIcon:i,align:l="left",className:c=""}){const o="center"===l?"text-center":"right"===l?"text-right":"",m="center"===l?"justify-center":"right"===l?"justify-end":"",d=t?g.jsxs(x,{children:[g.jsx(h,{asChild:!0,children:g.jsx("span",{className:"border-b border-dotted border-muted-foreground/50",children:a})}),g.jsx(p,{side:"top",className:"max-w-xs",children:g.jsx("p",{children:t})})]}):a;return g.jsx(w,{className:`cursor-pointer select-none hover:bg-muted/50 ${o} ${c}`,onClick:s(()=>n(e),"onClick"),"aria-sort":r(e),children:g.jsxs("div",{className:`flex items-center ${m}`,children:[d,i(e)]})})}function K({momentumFilters:e,toggleMomentumFilter:a}){return g.jsxs(l,{children:[g.jsx(c,{asChild:!0,children:g.jsxs(o,{variant:"outline",size:"sm",children:[g.jsx(M,{className:"mr-2 h-4 w-4"}),"Filters",e.size>0&&g.jsx(t,{variant:"secondary",className:"ml-1 h-5 px-1.5",children:e.size})]})}),g.jsx(m,{align:"end",className:"w-64",children:g.jsxs("div",{className:"p-2",children:[g.jsx("p",{className:"mb-2 text-sm font-medium",children:"Filter by Momentum"}),g.jsx("div",{className:"space-y-2",children:["increasing","steady","decreasing","stale"].map(t=>g.jsxs("div",{className:"flex items-center gap-2",children:[g.jsx(S,{id:`momentum-${t}`,checked:e.has(t),onCheckedChange:s(()=>a(t),"onCheckedChange")}),g.jsx(d,{htmlFor:`momentum-${t}`,className:"text-sm capitalize",children:t})]},t))})]})})]})}function B({searchQuery:e}){return g.jsx("div",{className:"flex h-full items-center justify-center py-12",children:g.jsxs("div",{className:"text-center",children:[g.jsx("p",{className:"text-muted-foreground",children:e?"No matching principals found":"No principals found"}),g.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:e?`Try adjusting your search term "${e}"`:"Create opportunities linked to organizations to see them here"})]})})}s(Q,"PrincipalPipelineTable"),s(R,"SortableTableHead"),s(K,"MomentumFilterDropdown"),s(B,"EmptyState");export{Q as PrincipalPipelineTable,Q as default};
