{"version":3,"mappings":"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","names":["EMPTY_PIPELINE","usePrincipalPipeline","filters","salesId","loading","salesIdLoading","useCurrentSale","queryFilter","useMemo","filter","myPrincipalsOnly","sales_id","enabled","data","rawSummary","isPending","error","queryError","useGetList","sort","field","order","pagination","page","perPage","staleTime","map","row","id","principal_id","name","principal_name","totalPipeline","total_pipeline","activeThisWeek","active_this_week","activeLastWeek","active_last_week","momentum","nextAction","next_action_summary","Error","String","usePipelineTableState","sortField","setSortField","useState","sortDirection","setSortDirection","searchQuery","setSearchQuery","momentumFilters","setMomentumFilters","Set","toggleMomentumFilter","useCallback","prev","next","has","delete","add","handleSort","filteredData","length","result","trim","query","toLowerCase","includes","size","sortedData","a","b","comparison","localeCompare","momentumOrder","increasing","steady","decreasing","stale","getAriaSortValue","MomentumIcon","jsx","TrendingUp","className","TrendingDown","Minus","AlertCircle","getDecayIndicatorColor","PipelineTableRow","onRowClick","handleKeyDown","e","key","preventDefault","jsxs","TableRow","onClick","__name","onKeyDown","tabIndex","role","children","TableCell","Badge","variant","title","PipelineDrillDownSheet","lazy","__vitePreload","import","__VITE_PRELOAD__","then","m","default","PrincipalPipelineTable","setMyPrincipalsOnly","selectedPrincipal","setSelectedPrincipal","renderSortIcon","ArrowUpDown","ArrowUp","ArrowDown","handleRowClick","handleCloseSheet","Skeleton","i","message","Search","Input","placeholder","value","onChange","target","Switch","checked","onCheckedChange","htmlFor","MomentumFilterDropdown","EmptyState","Table","TableHeader","SortableTableHead","label","currentSortField","onSort","align","tooltip","TableHead","TableBody","Suspense","fallback","principalId","principalName","isOpen","onClose","alignClass","justifyClass","labelContent","Tooltip","TooltipTrigger","asChild","TooltipContent","side","DropdownMenu","DropdownMenuTrigger","Button","Filter","DropdownMenuContent","Checkbox","Label"],"ignoreList":[],"sources":["../../src/atomic-crm/dashboard/v3/hooks/usePrincipalPipeline.ts","../../src/atomic-crm/dashboard/v3/hooks/usePipelineTableState.ts","../../src/atomic-crm/dashboard/v3/components/PipelineTableRow.tsx","../../src/atomic-crm/dashboard/v3/components/PrincipalPipelineTable.tsx"],"sourcesContent":["import { useMemo } from \"react\";\nimport { useGetList } from \"react-admin\";\nimport { useCurrentSale } from \"./useCurrentSale\";\nimport type { PrincipalPipelineRow, PipelineSummaryRow } from \"../types\";\n\n// Stable empty array to avoid new reference creation on each render\nconst EMPTY_PIPELINE: PrincipalPipelineRow[] = [];\n\nexport function usePrincipalPipeline(filters?: { myPrincipalsOnly?: boolean }) {\n  const { salesId, loading: salesIdLoading } = useCurrentSale();\n\n  // Build query filter\n  const queryFilter = useMemo(() => {\n    const filter: Record<string, unknown> = {};\n    if (filters?.myPrincipalsOnly && salesId) {\n      filter.sales_id = salesId;\n\n      // Debug logging for B1 filtering investigation\n      if (import.meta.env.DEV) {\n        console.log(\"[usePrincipalPipeline] Filtering by sales_id:\", salesId);\n      }\n    }\n    return filter;\n  }, [filters?.myPrincipalsOnly, salesId]);\n\n  // Determine if query should be enabled\n  // Wait for salesId to load if \"my principals only\" filter is active\n  // If \"my principals only\" but no salesId, disable query (show empty)\n  const enabled = !salesIdLoading && (!filters?.myPrincipalsOnly || !!salesId);\n\n  // Fetch principal pipeline summary with React Admin's useGetList\n  const {\n    data: rawSummary = [],\n    isPending: loading,\n    error: queryError,\n  } = useGetList<PipelineSummaryRow>(\n    \"principal_pipeline_summary\",\n    {\n      filter: queryFilter,\n      sort: { field: \"active_this_week\", order: \"DESC\" },\n      pagination: { page: 1, perPage: 100 },\n    },\n    {\n      enabled,\n      staleTime: 5 * 60 * 1000, // Cache for 5 minutes\n    }\n  );\n\n  // Transform data to PrincipalPipelineRow format\n  const data = useMemo(() => {\n    // If \"my principals only\" but no salesId, show empty\n    if (filters?.myPrincipalsOnly && !salesId) {\n      return EMPTY_PIPELINE;\n    }\n\n    // Debug logging for B1 filtering investigation\n    if (import.meta.env.DEV && filters?.myPrincipalsOnly) {\n      console.log(\"[usePrincipalPipeline] Filter results:\", {\n        salesId,\n        resultCount: rawSummary.length,\n        firstFewSalesIds: rawSummary.slice(0, 5).map((r) => r.sales_id),\n      });\n    }\n\n    return rawSummary.map((row) => ({\n      id: row.principal_id,\n      name: row.principal_name,\n      totalPipeline: row.total_pipeline,\n      activeThisWeek: row.active_this_week,\n      activeLastWeek: row.active_last_week,\n      momentum: row.momentum as PrincipalPipelineRow[\"momentum\"],\n      nextAction: row.next_action_summary,\n    }));\n  }, [rawSummary, salesId, filters?.myPrincipalsOnly]);\n\n  // Convert error to Error type for consistent interface\n  const error = queryError ? new Error(String(queryError)) : null;\n\n  return { data, loading, error };\n}\n","import { useState, useCallback, useMemo } from \"react\";\nimport type { PrincipalPipelineRow, Momentum } from \"../types\";\n\nexport type SortField = \"name\" | \"totalPipeline\" | \"activeThisWeek\" | \"activeLastWeek\" | \"momentum\";\nexport type SortDirection = \"ascending\" | \"descending\" | \"none\";\n\ninterface UsePipelineTableStateOptions {\n  data: PrincipalPipelineRow[] | undefined;\n}\n\n/**\n * Hook for managing PrincipalPipelineTable state\n *\n * Handles:\n * - Search filtering\n * - Momentum filtering\n * - Sorting by column\n * - ARIA sort attributes\n */\nexport function usePipelineTableState({ data }: UsePipelineTableStateOptions) {\n  const [sortField, setSortField] = useState<SortField>(\"name\");\n  const [sortDirection, setSortDirection] = useState<SortDirection>(\"ascending\");\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [momentumFilters, setMomentumFilters] = useState<Set<Momentum>>(new Set());\n\n  // Handle momentum filter toggle\n  const toggleMomentumFilter = useCallback((momentum: Momentum) => {\n    setMomentumFilters((prev) => {\n      const next = new Set(prev);\n      if (next.has(momentum)) {\n        next.delete(momentum);\n      } else {\n        next.add(momentum);\n      }\n      return next;\n    });\n  }, []);\n\n  // Handle column header click for sorting\n  const handleSort = useCallback(\n    (field: SortField) => {\n      if (sortField === field) {\n        // Toggle direction: ascending -> descending -> ascending\n        setSortDirection((prev) => (prev === \"ascending\" ? \"descending\" : \"ascending\"));\n      } else {\n        // New field: start with ascending for name, descending for numeric fields\n        setSortField(field);\n        setSortDirection(field === \"name\" ? \"ascending\" : \"descending\");\n      }\n    },\n    [sortField]\n  );\n\n  // Filter data based on search query and momentum filters\n  const filteredData = useMemo(() => {\n    if (!data || data.length === 0) return data;\n\n    let result = data;\n\n    // Apply search filter\n    if (searchQuery.trim()) {\n      const query = searchQuery.toLowerCase().trim();\n      result = result.filter((row) => row.name.toLowerCase().includes(query));\n    }\n\n    // Apply momentum filter (if any filters selected)\n    if (momentumFilters.size > 0) {\n      result = result.filter((row) => momentumFilters.has(row.momentum));\n    }\n\n    return result;\n  }, [data, searchQuery, momentumFilters]);\n\n  // Sort data based on current sort state\n  const sortedData = useMemo(() => {\n    if (!filteredData || filteredData.length === 0) return filteredData;\n\n    return [...filteredData].sort((a, b) => {\n      let comparison = 0;\n\n      switch (sortField) {\n        case \"name\":\n          comparison = a.name.localeCompare(b.name);\n          break;\n        case \"totalPipeline\":\n          comparison = a.totalPipeline - b.totalPipeline;\n          break;\n        case \"activeThisWeek\":\n          comparison = a.activeThisWeek - b.activeThisWeek;\n          break;\n        case \"activeLastWeek\":\n          comparison = a.activeLastWeek - b.activeLastWeek;\n          break;\n        case \"momentum\": {\n          const momentumOrder = { increasing: 3, steady: 2, decreasing: 1, stale: 0 };\n          comparison = momentumOrder[a.momentum] - momentumOrder[b.momentum];\n          break;\n        }\n      }\n\n      return sortDirection === \"descending\" ? -comparison : comparison;\n    });\n  }, [filteredData, sortField, sortDirection]);\n\n  // Get aria-sort value for a column\n  const getAriaSortValue = useCallback(\n    (field: SortField): \"ascending\" | \"descending\" | \"none\" => {\n      if (sortField === field) return sortDirection;\n      return \"none\";\n    },\n    [sortField, sortDirection]\n  );\n\n  return {\n    // State\n    sortField,\n    sortDirection,\n    searchQuery,\n    momentumFilters,\n\n    // Setters\n    setSearchQuery,\n\n    // Actions\n    handleSort,\n    toggleMomentumFilter,\n\n    // Derived data\n    sortedData,\n    getAriaSortValue,\n  };\n}\n","import { TableCell, TableRow } from \"@/components/ui/table\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { TrendingUp, TrendingDown, Minus, AlertCircle } from \"lucide-react\";\nimport type { PrincipalPipelineRow, Momentum } from \"../types\";\n\ninterface PipelineTableRowProps {\n  row: PrincipalPipelineRow;\n  onRowClick: (row: PrincipalPipelineRow) => void;\n}\n\n/**\n * Renders the momentum indicator icon based on pipeline health state.\n *\n * Icon mapping (from healthiest to most critical):\n * - increasing: green up arrow - actively engaged, growing pipeline\n * - steady: gray minus - stable but not growing\n * - decreasing: amber down arrow - attention needed\n * - stale: red alert - critical, needs immediate action\n */\nfunction MomentumIcon({ momentum }: { momentum: Momentum }) {\n  switch (momentum) {\n    case \"increasing\":\n      return <TrendingUp className=\"h-4 w-4 text-success\" />;\n    case \"decreasing\":\n      return <TrendingDown className=\"h-4 w-4 text-warning\" />;\n    case \"steady\":\n      return <Minus className=\"h-4 w-4 text-muted-foreground\" />;\n    case \"stale\":\n      return <AlertCircle className=\"h-4 w-4 text-destructive\" />;\n  }\n}\n\n/**\n * Returns the semantic background color class for the decay indicator bar.\n * Maps momentum state to visual urgency using design system tokens.\n */\nfunction getDecayIndicatorColor(momentum: Momentum): string {\n  switch (momentum) {\n    case \"increasing\":\n      return \"bg-success\";\n    case \"steady\":\n      return \"bg-muted-foreground/50\";\n    case \"decreasing\":\n      return \"bg-warning\";\n    case \"stale\":\n      return \"bg-destructive\";\n  }\n}\n\n/**\n * PipelineTableRow - Single row in the Principal Pipeline Table\n *\n * Displays principal pipeline metrics with:\n * - Leading edge decay indicator bar (4px colored bar showing health)\n * - Pipeline count and activity badges\n * - Momentum icon with label\n * - Next action preview\n *\n * Accessibility: Fully keyboard navigable (Enter/Space to activate)\n */\nexport function PipelineTableRow({ row, onRowClick }: PipelineTableRowProps) {\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" || e.key === \" \") {\n      e.preventDefault();\n      onRowClick(row);\n    }\n  };\n\n  return (\n    <TableRow\n      className=\"table-row-premium cursor-pointer relative\"\n      onClick={() => onRowClick(row)}\n      onKeyDown={handleKeyDown}\n      tabIndex={0}\n      role=\"button\"\n      aria-label={`View opportunities for ${row.name}. Pipeline momentum: ${row.momentum}`}\n    >\n      {/* Principal name with decay indicator */}\n      <TableCell className=\"font-medium relative\">\n        <div\n          className={`absolute left-0 top-0 bottom-0 w-1 ${getDecayIndicatorColor(row.momentum)}`}\n          aria-hidden=\"true\"\n        />\n        <span className=\"pl-2\">{row.name}</span>\n      </TableCell>\n\n      {/* Pipeline count */}\n      <TableCell className=\"text-right\">\n        <div className=\"font-semibold\">{row.totalPipeline}</div>\n      </TableCell>\n\n      {/* This week activity */}\n      <TableCell className=\"text-center\">\n        {row.activeThisWeek > 0 ? (\n          <Badge variant=\"success\">{row.activeThisWeek}</Badge>\n        ) : (\n          <span className=\"text-muted-foreground\">-</span>\n        )}\n      </TableCell>\n\n      {/* Last week activity - hidden on mobile to save space */}\n      <TableCell className=\"text-center hidden lg:table-cell\">\n        {row.activeLastWeek > 0 ? (\n          <Badge variant=\"secondary\">{row.activeLastWeek}</Badge>\n        ) : (\n          <span className=\"text-muted-foreground\">-</span>\n        )}\n      </TableCell>\n\n      {/* Momentum indicator */}\n      <TableCell>\n        <div className=\"flex items-center gap-1\">\n          <MomentumIcon momentum={row.momentum} />\n          <span className=\"text-sm capitalize\">{row.momentum}</span>\n        </div>\n      </TableCell>\n\n      {/* Next action - truncate with tooltip for long text */}\n      <TableCell className=\"max-w-[200px] lg:max-w-[280px]\">\n        {row.nextAction ? (\n          <span className=\"text-sm text-foreground block truncate\" title={row.nextAction}>\n            {row.nextAction}\n          </span>\n        ) : (\n          <span className=\"text-sm text-muted-foreground italic\">No action scheduled</span>\n        )}\n      </TableCell>\n    </TableRow>\n  );\n}\n","import { useState, useCallback, lazy, Suspense } from \"react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Table, TableBody, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Filter, ArrowUpDown, ArrowUp, ArrowDown, Search } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport type { PrincipalPipelineRow, Momentum } from \"../types\";\nimport { usePrincipalPipeline } from \"../hooks/usePrincipalPipeline\";\nimport { usePipelineTableState, type SortField } from \"../hooks/usePipelineTableState\";\nimport { PipelineTableRow } from \"./PipelineTableRow\";\n\n// Lazy load PipelineDrillDownSheet - saves ~3-5KB from main dashboard chunk\nconst PipelineDrillDownSheet = lazy(() =>\n  import(\"./PipelineDrillDownSheet\").then((m) => ({ default: m.PipelineDrillDownSheet }))\n);\n\n/**\n * PrincipalPipelineTable - Aggregated pipeline view by principal/manufacturer\n *\n * Displays opportunity pipeline metrics with:\n * - Sortable columns (name, pipeline count, weekly activity, momentum)\n * - Search filtering by principal name\n * - Momentum filter dropdown\n * - \"My Principals Only\" toggle\n * - Click-through to drill-down sheet\n *\n * Architecture:\n * - State management extracted to usePipelineTableState hook\n * - Row rendering extracted to PipelineTableRow component\n * - Drill-down sheet lazy-loaded for performance\n */\nexport function PrincipalPipelineTable() {\n  const [myPrincipalsOnly, setMyPrincipalsOnly] = useState(false);\n  const [selectedPrincipal, setSelectedPrincipal] = useState<{ id: number; name: string } | null>(\n    null\n  );\n\n  const { data, loading, error } = usePrincipalPipeline({ myPrincipalsOnly });\n\n  // Use extracted state management hook\n  const {\n    searchQuery,\n    setSearchQuery,\n    momentumFilters,\n    toggleMomentumFilter,\n    handleSort,\n    sortedData,\n    sortField,\n    sortDirection,\n    getAriaSortValue,\n  } = usePipelineTableState({ data });\n\n  // Render sort indicator for column headers\n  const renderSortIcon = useCallback(\n    (field: SortField) => {\n      if (sortField !== field) return <ArrowUpDown className=\"ml-1 h-4 w-4 opacity-50\" />;\n      if (sortDirection === \"ascending\") return <ArrowUp className=\"ml-1 h-4 w-4\" />;\n      return <ArrowDown className=\"ml-1 h-4 w-4\" />;\n    },\n    [sortField, sortDirection]\n  );\n\n  const handleRowClick = useCallback((row: PrincipalPipelineRow) => {\n    setSelectedPrincipal({ id: row.id, name: row.name });\n  }, []);\n\n  const handleCloseSheet = useCallback(() => {\n    setSelectedPrincipal(null);\n  }, []);\n\n  // Loading state - matches production layout structure\n  if (loading) {\n    return (\n      <div className=\"flex flex-col p-4\">\n        {/* Header skeleton matching production header */}\n        <div className=\"border-b border-border pb-3\">\n          <div className=\"flex items-start justify-between\">\n            <div>\n              <Skeleton className=\"mb-2 h-6 w-48\" />\n              <Skeleton className=\"h-4 w-80\" />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Skeleton className=\"h-9 w-48\" />\n              <Skeleton className=\"h-5 w-10\" />\n              <Skeleton className=\"h-4 w-28\" />\n              <Skeleton className=\"h-9 w-20\" />\n            </div>\n          </div>\n        </div>\n        {/* Table skeleton with header and rows */}\n        <div className=\"pt-2\">\n          {/* Table header */}\n          <div className=\"flex gap-4 px-2 py-3 border-b border-border\">\n            <Skeleton className=\"h-4 w-32\" />\n            <Skeleton className=\"h-4 w-16 ml-auto\" />\n            <Skeleton className=\"h-4 w-20\" />\n            <Skeleton className=\"h-4 w-20 hidden lg:block\" />\n            <Skeleton className=\"h-4 w-24\" />\n            <Skeleton className=\"h-4 w-32\" />\n          </div>\n          {/* Table rows */}\n          <div className=\"space-y-1 pt-1\">\n            {[1, 2, 3, 4, 5].map((i) => (\n              <div key={i} className=\"flex items-center gap-4 px-2 py-3 border-b border-border/50\">\n                <Skeleton className=\"h-4 w-28\" />\n                <Skeleton className=\"h-5 w-8 ml-auto\" />\n                <Skeleton className=\"h-5 w-8\" />\n                <Skeleton className=\"h-5 w-8 hidden lg:block\" />\n                <Skeleton className=\"h-4 w-20\" />\n                <Skeleton className=\"h-4 w-36\" />\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (error) {\n    return (\n      <div className=\"flex h-full items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-destructive\">Failed to load pipeline data</p>\n          <p className=\"text-sm text-muted-foreground\">{error.message}</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col p-4\" data-tutorial=\"dashboard-pipeline-table\">\n      {/* Header with title and filters */}\n      <div className=\"border-b border-border pb-3\">\n        <div className=\"flex items-start justify-between\">\n          <div>\n            <h2 className=\"text-lg font-semibold\">Pipeline by Principal</h2>\n            <p className=\"text-sm text-muted-foreground\">\n              Track opportunity momentum across your customer accounts\n            </p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {/* Search input */}\n            <div className=\"relative\">\n              <Search className=\"absolute left-2.5 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground\" />\n              <Input\n                placeholder=\"Search principals...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"h-9 w-48 pl-8\"\n              />\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Switch\n                id=\"my-principals\"\n                checked={myPrincipalsOnly}\n                onCheckedChange={setMyPrincipalsOnly}\n              />\n              <label htmlFor=\"my-principals\" className=\"text-sm\">\n                My Principals Only\n              </label>\n            </div>\n            <MomentumFilterDropdown\n              momentumFilters={momentumFilters}\n              toggleMomentumFilter={toggleMomentumFilter}\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Table - parent TabsContent handles scroll */}\n      <div className=\"pt-2\">\n        {sortedData?.length === 0 ? (\n          <EmptyState searchQuery={searchQuery} />\n        ) : (\n          <Table>\n            <TableHeader className=\"sticky top-0 bg-background\">\n              <TableRow>\n                <SortableTableHead\n                  field=\"name\"\n                  label=\"Principal\"\n                  currentSortField={sortField}\n                  onSort={handleSort}\n                  getAriaSortValue={getAriaSortValue}\n                  renderSortIcon={renderSortIcon}\n                />\n                <SortableTableHead\n                  field=\"totalPipeline\"\n                  label=\"Pipeline\"\n                  currentSortField={sortField}\n                  onSort={handleSort}\n                  getAriaSortValue={getAriaSortValue}\n                  renderSortIcon={renderSortIcon}\n                  align=\"right\"\n                />\n                <SortableTableHead\n                  field=\"activeThisWeek\"\n                  label=\"This Week\"\n                  tooltip=\"Activities logged Mon–Sun of current week\"\n                  currentSortField={sortField}\n                  onSort={handleSort}\n                  getAriaSortValue={getAriaSortValue}\n                  renderSortIcon={renderSortIcon}\n                  align=\"center\"\n                />\n                <SortableTableHead\n                  field=\"activeLastWeek\"\n                  label=\"Last Week\"\n                  tooltip=\"Activities logged Mon–Sun of previous week\"\n                  currentSortField={sortField}\n                  onSort={handleSort}\n                  getAriaSortValue={getAriaSortValue}\n                  renderSortIcon={renderSortIcon}\n                  align=\"center\"\n                  className=\"hidden lg:table-cell\"\n                />\n                <SortableTableHead\n                  field=\"momentum\"\n                  label=\"Momentum\"\n                  tooltip=\"Based on activity trend over 14 days\"\n                  currentSortField={sortField}\n                  onSort={handleSort}\n                  getAriaSortValue={getAriaSortValue}\n                  renderSortIcon={renderSortIcon}\n                />\n                <TableHead className=\"max-w-[200px] lg:max-w-[280px]\">Next Action</TableHead>\n              </TableRow>\n            </TableHeader>\n            <TableBody>\n              {sortedData?.map((row) => (\n                <PipelineTableRow key={row.id} row={row} onRowClick={handleRowClick} />\n              ))}\n            </TableBody>\n          </Table>\n        )}\n      </div>\n\n      {/* Drill-Down Sheet - lazy loaded */}\n      {selectedPrincipal !== null && (\n        <Suspense fallback={null}>\n          <PipelineDrillDownSheet\n            principalId={selectedPrincipal.id}\n            principalName={selectedPrincipal.name}\n            isOpen={true}\n            onClose={handleCloseSheet}\n          />\n        </Suspense>\n      )}\n    </div>\n  );\n}\n\n// ============================================================================\n// Sub-components (internal to this file, not exported)\n// ============================================================================\n\ninterface SortableTableHeadProps {\n  field: SortField;\n  label: string;\n  tooltip?: string;\n  currentSortField: SortField;\n  onSort: (field: SortField) => void;\n  getAriaSortValue: (field: SortField) => \"ascending\" | \"descending\" | \"none\";\n  renderSortIcon: (field: SortField) => React.ReactNode;\n  align?: \"left\" | \"center\" | \"right\";\n  className?: string;\n}\n\nfunction SortableTableHead({\n  field,\n  label,\n  tooltip,\n  onSort,\n  getAriaSortValue,\n  renderSortIcon,\n  align = \"left\",\n  className = \"\",\n}: SortableTableHeadProps) {\n  const alignClass = align === \"center\" ? \"text-center\" : align === \"right\" ? \"text-right\" : \"\";\n  const justifyClass =\n    align === \"center\" ? \"justify-center\" : align === \"right\" ? \"justify-end\" : \"\";\n\n  const labelContent = tooltip ? (\n    <Tooltip>\n      <TooltipTrigger asChild>\n        <span className=\"border-b border-dotted border-muted-foreground/50\">{label}</span>\n      </TooltipTrigger>\n      <TooltipContent side=\"top\" className=\"max-w-xs\">\n        <p>{tooltip}</p>\n      </TooltipContent>\n    </Tooltip>\n  ) : (\n    label\n  );\n\n  return (\n    <TableHead\n      className={`cursor-pointer select-none hover:bg-muted/50 ${alignClass} ${className}`}\n      onClick={() => onSort(field)}\n      aria-sort={getAriaSortValue(field)}\n    >\n      <div className={`flex items-center ${justifyClass}`}>\n        {labelContent}\n        {renderSortIcon(field)}\n      </div>\n    </TableHead>\n  );\n}\n\ninterface MomentumFilterDropdownProps {\n  momentumFilters: Set<Momentum>;\n  toggleMomentumFilter: (momentum: Momentum) => void;\n}\n\nfunction MomentumFilterDropdown({\n  momentumFilters,\n  toggleMomentumFilter,\n}: MomentumFilterDropdownProps) {\n  return (\n    <DropdownMenu>\n      <DropdownMenuTrigger asChild>\n        <Button variant=\"outline\" size=\"sm\">\n          <Filter className=\"mr-2 h-4 w-4\" />\n          Filters\n          {momentumFilters.size > 0 && (\n            <Badge variant=\"secondary\" className=\"ml-1 h-5 px-1.5\">\n              {momentumFilters.size}\n            </Badge>\n          )}\n        </Button>\n      </DropdownMenuTrigger>\n      <DropdownMenuContent align=\"end\" className=\"w-64\">\n        <div className=\"p-2\">\n          <p className=\"mb-2 text-sm font-medium\">Filter by Momentum</p>\n          <div className=\"space-y-2\">\n            {([\"increasing\", \"steady\", \"decreasing\", \"stale\"] as const).map((momentum) => (\n              <div key={momentum} className=\"flex items-center gap-2\">\n                <Checkbox\n                  id={`momentum-${momentum}`}\n                  checked={momentumFilters.has(momentum)}\n                  onCheckedChange={() => toggleMomentumFilter(momentum)}\n                />\n                <Label htmlFor={`momentum-${momentum}`} className=\"text-sm capitalize\">\n                  {momentum}\n                </Label>\n              </div>\n            ))}\n          </div>\n        </div>\n      </DropdownMenuContent>\n    </DropdownMenu>\n  );\n}\n\ninterface EmptyStateProps {\n  searchQuery: string;\n}\n\nfunction EmptyState({ searchQuery }: EmptyStateProps) {\n  return (\n    <div className=\"flex h-full items-center justify-center py-12\">\n      <div className=\"text-center\">\n        <p className=\"text-muted-foreground\">\n          {searchQuery ? \"No matching principals found\" : \"No principals found\"}\n        </p>\n        <p className=\"mt-1 text-sm text-muted-foreground\">\n          {searchQuery\n            ? `Try adjusting your search term \"${searchQuery}\"`\n            : \"Create opportunities linked to organizations to see them here\"}\n        </p>\n      </div>\n    </div>\n  );\n}\n\n// Default export for lazy loading\nexport default PrincipalPipelineTable;\n"],"file":"PrincipalPipelineTable-DQmPjpI2.js"}