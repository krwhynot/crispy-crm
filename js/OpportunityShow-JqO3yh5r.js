var e=Object.defineProperty,s=(s,a)=>e(s,"name",{value:a,configurable:!0});import{aT as a,j as r,ay as t,bo as i,bp as n,az as c,c as o,u as l,aa as d,e as x,aL as p}from"./chunk-DWisBx5Y.js";import{h as u,R as m,O as h,ap as j,e as f,f as g,a as v,d as N,B as w,at as _,g as k}from"../assets/index-BMLg8LT4.js";import{R as b}from"./chunk--io5iQ_d.js";import{R as y}from"./chunk-D5BivTro.js";import{T as z,a as C,b as O,c as S}from"./chunk-CQf6o72Z.js";import{N as D,a as A}from"./chunk-D_g-0s-9.js";import{L as E,e as P,s as B}from"./chunk-CPNr-gD1.js";import{f as F}from"./chunk-CL0ACbxq.js";import{E as L}from"./chunk-DKgfbnVd.js";import{ae as T,af as U}from"./chunk-BePsjq0D.js";import{b as $,t as R}from"./chunk-DOHniRee.js";import"./chunk-DAbVPE3R.js";import"./chunk-CLB8yy76.js";import"./chunk-8CWr9u5d.js";import"./chunk-DBZxM7AY.js";import"./chunk-Caaz7sLq.js";import"./chunk-D3G-UbTO.js";import"./chunk-ll1YpLU1.js";import"./chunk-DlK383r0.js";const I=s(()=>{const{data:e,error:s,isPending:t}=a();return t||s?r.jsx("div",{className:"h-8"}):r.jsx("div",{className:"flex flex-row flex-wrap gap-4 mt-4",children:e.map(e=>r.jsxs("div",{className:"flex flex-row gap-4 items-center",children:[r.jsx(u,{record:e}),r.jsxs("div",{className:"flex flex-col",children:[r.jsxs(E,{to:`/contacts/${e.id}/show`,className:"text-sm hover:underline",children:[e.first_name," ",e.last_name]}),r.jsxs("span",{className:"text-xs text-muted-foreground",children:[e.title,e.title&&e.company_name&&" at ",e.company_name]})]})]},e.id))})},"ContactList"),V=s(({mode:e="show",ArchiveButton:s,UnarchiveButton:a})=>{const i=t();return i?r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsx(m,{source:"customer_organization_id",reference:"organizations",link:"show",children:r.jsx(h,{})}),r.jsx("h2",{className:"text-2xl font-semibold",children:i.name})]}),r.jsx("div",{className:"flex gap-2",children:"show"===e?r.jsx(r.Fragment,{children:i.deleted_at?r.jsxs(r.Fragment,{children:[a&&r.jsx(a,{record:i}),r.jsx(j,{})]}):r.jsxs(r.Fragment,{children:[s&&r.jsx(s,{record:i}),r.jsx(L,{})]})}):r.jsxs(r.Fragment,{children:[s&&r.jsx(s,{record:i}),r.jsx(f,{}),r.jsx(g,{})]})})]}):null},"OpportunityHeader"),q=s(()=>r.jsx(i,{children:r.jsx(G,{})}),"OpportunityShow"),G=s(()=>{const{record:e,isPending:a}=n(),t=P(),i=B("/opportunities/:id/show/:tab"),c=i?.params?.tab||"details",o=s(s=>{s!==c&&t("details"!==s?`/opportunities/${e?.id}/show/${s}`:`/opportunities/${e?.id}/show`)},"handleTabChange");return a||!e?null:r.jsxs("div",{className:"mt-2",children:[e.deleted_at?r.jsx(H,{}):null,r.jsx(v,{children:r.jsxs(N,{className:"pt-6",children:[r.jsx(V,{mode:"show",ArchiveButton:J,UnarchiveButton:K}),r.jsxs(z,{defaultValue:c,onValueChange:o,children:[r.jsxs(C,{className:"grid w-full grid-cols-2",children:[r.jsx(O,{value:"details",children:"Details"}),r.jsx(O,{value:"notes",children:"Notes & Activity"})]}),r.jsxs(S,{value:"details",className:"pt-4",children:[r.jsxs("div",{className:"flex gap-8 mb-4",children:[r.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[r.jsx("span",{className:"text-xs text-muted-foreground tracking-wide uppercase",children:"Expected closing date"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm",children:R(new Date(e.estimated_close_date))?$(new Date(e.estimated_close_date),"PP"):"Invalid date"}),new Date(e.estimated_close_date)<new Date?r.jsx(w,{variant:"destructive",children:"Past"}):null]})]}),r.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[r.jsx("span",{className:"text-xs text-muted-foreground tracking-wide uppercase",children:"Stage"}),r.jsx("span",{className:"text-sm",children:F([{value:"lead",label:"Lead"},{value:"qualified",label:"Qualified"},{value:"needs_analysis",label:"Needs Analysis"},{value:"proposal",label:"Proposal"},{value:"negotiation",label:"Negotiation"},{value:"closed_won",label:"Closed Won"},{value:"closed_lost",label:"Closed Lost"},{value:"nurturing",label:"Nurturing"}],e.stage)})]}),r.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[r.jsx("span",{className:"text-xs text-muted-foreground tracking-wide uppercase",children:"Priority"}),r.jsx(w,{variant:"critical"===e.priority?"destructive":"high"===e.priority?"default":"medium"===e.priority?"secondary":"outline",children:e.priority})]})]}),(e.opportunity_owner_id||e.account_manager_id||e.lead_source)&&r.jsxs("div",{className:"flex gap-8 mb-4",children:[e.opportunity_owner_id&&r.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[r.jsx("span",{className:"text-xs text-muted-foreground tracking-wide uppercase",children:"Opportunity Owner"}),r.jsx(m,{source:"opportunity_owner_id",reference:"sales",link:!1})]}),e.account_manager_id&&r.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[r.jsx("span",{className:"text-xs text-muted-foreground tracking-wide uppercase",children:"Account Manager"}),r.jsx(m,{source:"account_manager_id",reference:"sales",link:!1})]}),e.lead_source&&r.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[r.jsx("span",{className:"text-xs text-muted-foreground tracking-wide uppercase",children:"Lead Source"}),r.jsx("span",{className:"text-sm",children:e.lead_source.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())})]})]}),r.jsxs("div",{className:"flex gap-8 mb-4",children:[r.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[r.jsx("span",{className:"text-xs text-muted-foreground tracking-wide uppercase",children:"Customer Organization"}),r.jsx(m,{source:"customer_organization_id",reference:"organizations",link:"show"})]}),e.principal_organization_id&&r.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[r.jsx("span",{className:"text-xs text-muted-foreground tracking-wide uppercase",children:"Principal Organization"}),r.jsx(m,{source:"principal_organization_id",reference:"organizations",link:"show"})]}),e.distributor_organization_id&&r.jsxs("div",{className:"flex flex-col min-w-[150px]",children:[r.jsx("span",{className:"text-xs text-muted-foreground tracking-wide uppercase",children:"Distributor Organization"}),r.jsx(m,{source:"distributor_organization_id",reference:"organizations",link:"show"})]})]}),!!e.contact_ids?.length&&r.jsx("div",{className:"mb-4",children:r.jsxs("div",{className:"flex flex-col",children:[r.jsx("span",{className:"text-xs text-muted-foreground tracking-wide uppercase mb-2",children:"Contacts"}),r.jsx(b,{source:"contact_ids",reference:"contacts_summary",children:r.jsx(I,{})})]})}),e.description&&r.jsxs("div",{className:"mb-4 whitespace-pre-line",children:[r.jsx("span",{className:"text-xs text-muted-foreground tracking-wide uppercase mb-2 block",children:"Description"}),r.jsx("p",{className:"text-sm leading-6",children:e.description})]})]}),r.jsx(S,{value:"notes",className:"pt-4",children:r.jsx(y,{target:"opportunity_id",reference:"opportunityNotes",sort:{field:"created_at",order:"DESC"},empty:r.jsx(A,{reference:"opportunities"}),children:r.jsx(D,{reference:"opportunities"})})})]})]})})]})},"OpportunityShowContent"),H=s(()=>r.jsx("div",{className:"bg-orange-500 px-6 py-4",children:r.jsx("h3",{className:"text-lg font-bold text-white",children:"Archived Opportunity"})}),"ArchivedTitle"),J=s(({record:e})=>{const[a]=p(),t=o(),i=l(),n=d(),c=s(()=>{a("opportunities",{id:e.id,data:{deleted_at:(new Date).toISOString()},previousData:e},{onSuccess:s(()=>{t("list","opportunities"),i("Opportunity archived",{type:"info",undoable:!1}),n()},"onSuccess"),onError:s(()=>{i("Error: opportunity not archived",{type:"error"})},"onError")})},"handleClick");return r.jsxs(k,{onClick:c,size:"sm",variant:"outline",className:"flex items-center gap-2 h-9",children:[r.jsx(U,{className:"w-4 h-4"}),"Archive"]})},"ArchiveButton"),K=s(({record:e})=>{const a=c(),t=o(),i=l(),n=d(),p=new _(a),{mutate:u}=x({mutationFn:s(()=>p.unarchiveOpportunity(e),"mutationFn"),onSuccess:s(()=>{t("list","opportunities"),i("Opportunity unarchived",{type:"info",undoable:!1}),n()},"onSuccess"),onError:s(()=>{i("Error: opportunity not unarchived",{type:"error"})},"onError")}),m=s(()=>{u()},"handleClick");return r.jsxs(k,{onClick:m,size:"sm",variant:"outline",className:"flex items-center gap-2 h-9",children:[r.jsx(T,{className:"w-4 h-4"}),"Send back to the board"]})},"UnarchiveButton");export{q as OpportunityShow,q as default};
