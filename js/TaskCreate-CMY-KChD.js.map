{"version":3,"file":"TaskCreate-CMY-KChD.js","sources":["../../src/atomic-crm/tasks/TaskCreate.tsx"],"sourcesContent":["import { CreateBase, Form, useGetIdentity, useNotify, useRedirect } from \"ra-core\";\nimport { useFormContext, useFormState } from \"react-hook-form\";\nimport { useCallback } from \"react\";\nimport { TextInput } from \"@/components/admin/text-input\";\nimport { SelectInput } from \"@/components/admin/select-input\";\nimport { ReferenceInput } from \"@/components/admin/reference-input\";\nimport { AutocompleteInput } from \"@/components/admin/autocomplete-input\";\nimport { SaveButton } from \"@/components/admin/form\";\nimport { FormErrorSummary } from \"@/components/admin/FormErrorSummary\";\nimport { Button } from \"@/components/ui/button\";\nimport { useConfigurationContext } from \"../root/ConfigurationContext\";\nimport { contactOptionText } from \"../contacts/ContactOption\";\nimport { getTaskDefaultValues } from \"../validation/task\";\n\n/**\n * TaskCreate Component\n *\n * Full-page create form following unified design system:\n * - bg-muted page background\n * - Centered card with create-form-card styling\n * - Sticky footer with Cancel, Save & Close, Save & Add Another\n * - Dirty state confirmation on cancel\n *\n * Pre-fills: today's due date, current user, medium priority\n */\nexport default function TaskCreate() {\n  const { data: identity } = useGetIdentity();\n  const { taskTypes } = useConfigurationContext();\n  const notify = useNotify();\n  const redirect = useRedirect();\n\n  const defaultValues = {\n    ...getTaskDefaultValues(),\n    sales_id: identity?.id,\n  };\n\n  return (\n    <CreateBase redirect=\"list\">\n      <div className=\"bg-muted px-6 py-6\">\n        <div className=\"max-w-4xl mx-auto create-form-card\">\n          <Form defaultValues={defaultValues}>\n            <TaskFormContent notify={notify} redirect={redirect} taskTypes={taskTypes} />\n          </Form>\n        </div>\n      </div>\n    </CreateBase>\n  );\n}\n\nconst TaskFormContent = ({\n  notify,\n  redirect,\n  taskTypes,\n}: {\n  notify: ReturnType<typeof useNotify>;\n  redirect: ReturnType<typeof useRedirect>;\n  taskTypes: string[];\n}) => {\n  const { errors } = useFormState();\n\n  return (\n    <>\n      <FormErrorSummary errors={errors} />\n      <div className=\"space-y-6\">\n        <div data-tutorial=\"task-title\">\n          <TextInput\n            source=\"title\"\n            label=\"Task Title\"\n            isRequired\n            helperText=\"What needs to be done?\"\n          />\n        </div>\n\n        <TextInput\n          source=\"description\"\n          label=\"Description\"\n          multiline\n          rows={2}\n          helperText=\"Optional details\"\n        />\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div data-tutorial=\"task-due-date\">\n            <TextInput\n              source=\"due_date\"\n              label=\"Due Date\"\n              type=\"date\"\n              isRequired\n              helperText=\"When is this due?\"\n            />\n          </div>\n\n          <SelectInput\n            source=\"type\"\n            label=\"Type\"\n            choices={taskTypes.map((type) => ({ id: type, name: type }))}\n            helperText=\"Category of task\"\n          />\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <SelectInput\n            source=\"priority\"\n            label=\"Priority\"\n            choices={[\n              { id: \"low\", name: \"Low\" },\n              { id: \"medium\", name: \"Medium\" },\n              { id: \"high\", name: \"High\" },\n              { id: \"critical\", name: \"Critical\" },\n            ]}\n            helperText=\"How urgent?\"\n          />\n\n          <ReferenceInput source=\"opportunity_id\" reference=\"opportunities\">\n            <AutocompleteInput\n              label=\"Opportunity\"\n              optionText=\"title\"\n              helperText=\"Link to opportunity (optional)\"\n            />\n          </ReferenceInput>\n        </div>\n\n        <ReferenceInput source=\"contact_id\" reference=\"contacts_summary\">\n          <AutocompleteInput\n            label=\"Contact\"\n            optionText={contactOptionText}\n            helperText=\"Link to contact (optional)\"\n          />\n        </ReferenceInput>\n      </div>\n\n      <TaskCreateFooter notify={notify} redirect={redirect} />\n    </>\n  );\n};\n\nconst TaskCreateFooter = ({\n  notify,\n  redirect,\n}: {\n  notify: ReturnType<typeof useNotify>;\n  redirect: ReturnType<typeof useRedirect>;\n}) => {\n  const { reset } = useFormContext();\n  const { isDirty } = useFormState();\n\n  const handleCancel = useCallback(() => {\n    if (isDirty) {\n      const confirmed = window.confirm(\"You have unsaved changes. Are you sure you want to leave?\");\n      if (!confirmed) return;\n    }\n    redirect(\"/tasks\");\n  }, [isDirty, redirect]);\n\n  const handleError = useCallback(\n    (error: Error) => {\n      notify(error.message || \"Failed to create task\", { type: \"error\" });\n    },\n    [notify]\n  );\n\n  return (\n    <div className=\"sticky bottom-12 bg-card border-t border-border p-4 flex justify-between mt-6\">\n      <Button variant=\"outline\" onClick={handleCancel}>\n        Cancel\n      </Button>\n      <div className=\"flex gap-2\">\n        <SaveButton\n          type=\"button\"\n          label=\"Save & Close\"\n          data-tutorial=\"task-save-btn\"\n          mutationOptions={{\n            onSuccess: () => {\n              notify(\"Task created successfully\", { type: \"success\" });\n              redirect(\"/tasks\");\n            },\n            onError: handleError,\n          }}\n        />\n        <SaveButton\n          type=\"button\"\n          label=\"Save & Add Another\"\n          mutationOptions={{\n            onSuccess: () => {\n              notify(\"Task created successfully\", { type: \"success\" });\n              reset();\n            },\n            onError: handleError,\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n"],"names":["TaskCreate","data","identity","useGetIdentity","taskTypes","useConfigurationContext","notify","useNotify","redirect","useRedirect","defaultValues","getTaskDefaultValues","sales_id","id","jsx","CreateBase","children","className","Form","TaskFormContent","__name","errors","useFormState","jsxs","Fragment","FormErrorSummary","TextInput","source","label","isRequired","helperText","multiline","rows","type","SelectInput","choices","map","name","ReferenceInput","reference","AutocompleteInput","optionText","contactOptionText","TaskCreateFooter","reset","useFormContext","isDirty","handleCancel","useCallback","window","confirm","handleError","error","message","Button","variant","onClick","SaveButton","mutationOptions","onSuccess","onError"],"mappings":"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"}