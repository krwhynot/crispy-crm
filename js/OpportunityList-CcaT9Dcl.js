var e=Object.defineProperty,t=(t,a)=>e(t,"name",{value:a,configurable:!0});import{j as a,c as r,Z as s,aB as n,aT as i,E as o,az as l,a1 as c,aI as d,ak as u,al as m,bH as p,a8 as h,$ as g}from"./chunk-DWisBx5Y.js";import{r as x,d as f,t as y,L as v}from"./chunk-CPNr-gD1.js";import{j,a as b,d as N,R as w,T as _,B as S,g as k,J as C,K as A,N as O,C as F,i as z,k as T,a1 as V,a2 as $,a3 as P,a4 as E,ah as I,ai as M,aa as L,v as D,aj as R,_ as H,S as B,y as J,L as K,ak as q,al as U,am as X,c as Y,an as Z,E as G}from"../assets/index-BMLg8LT4.js";import{a2 as Q,a3 as W,a4 as ee,a5 as te,a6 as ae,a7 as re,a8 as se}from"./chunk-CLB8yy76.js";import{u as ne}from"./chunk-DZFSGdBf.js";import{OpportunityCreate as ie}from"./OpportunityCreate-C7Pc1LWM.js";import{g as oe,a as le,b as ce,O as de,c as ue,d as me}from"./chunk-DlK383r0.js";import{n as pe,X as he}from"./chunk-BePsjq0D.js";import{A as ge}from"./chunk-DzHhiDUS.js";import"./chunk-DAbVPE3R.js";import"./chunk-DOHniRee.js";import"./chunk-8CWr9u5d.js";import"./chunk-DBZxM7AY.js";import"./chunk-DJlpmdvB.js";import"./chunk-CL328sMP.js";function xe({...e}){return a.jsx(Q,{"data-slot":"accordion",...e})}function fe({className:e,...t}){return a.jsx(W,{"data-slot":"accordion-item",className:j("border-b last:border-b-0",e),...t})}function ye({className:e,children:t,...r}){return a.jsx(ee,{className:"flex",children:a.jsxs(te,{"data-slot":"accordion-trigger",className:j("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",e),...r,children:[t,a.jsx(pe,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function ve({className:e,children:t,...r}){return a.jsx(ae,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...r,children:a.jsx("div",{className:j("pt-0 pb-4",e),children:t})})}t(xe,"Accordion"),t(fe,"AccordionItem"),t(ye,"AccordionTrigger"),t(ve,"AccordionContent");const je=t(({opportunity:e})=>e?a.jsx(be,{opportunity:e}):null,"OpportunityCard"),be=t(({opportunity:e})=>{const s=r(),n=t(()=>{s(`/opportunities/${e.id}/show`,void 0,void 0,void 0,{_scrollToTop:!1})},"handleClick"),i=t(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),n())},"handleKeyDown"),o=t(e=>{switch(e){case"critical":return"destructive";case"high":return"default";case"medium":return"secondary";default:return"outline"}},"getPriorityVariant");return a.jsx("div",{className:"cursor-pointer group rounded-lg",onClick:n,onKeyDown:i,role:"button",tabIndex:0,children:a.jsx(b,{className:"p-3 transition-[box-shadow,border-color,transform] duration-150 shadow-[var(--shadow-card-2)] group-hover:shadow-[var(--shadow-card-2-hover)] motion-safe:group-hover:-translate-y-0.5 motion-safe:group-hover:scale-[1.01] group-hover:border-[var(--primary)] group-focus-visible:shadow-[var(--shadow-card-2-hover)] motion-safe:group-focus-visible:-translate-y-0.5 motion-safe:group-focus-visible:scale-[1.01] group-focus-visible:border-[var(--primary)] group-focus-visible:outline-none group-focus-visible:ring-2 group-focus-visible:ring-ring group-focus-visible:ring-offset-2 group-active:scale-[0.98] touch-manipulation border border-[var(--input)]",children:a.jsxs(N,{className:"flex flex-col gap-2",children:[a.jsx("p",{className:"text-sm font-semibold line-clamp-2 break-words leading-snug",title:e.name,"aria-label":e.name,children:e.name}),a.jsx(w,{source:"customer_organization_id",record:e,reference:"organizations",link:!1,children:a.jsx(_,{source:"name",className:"text-xs text-muted-foreground line-clamp-1"})}),e.principal_organization_id&&a.jsx(w,{source:"principal_organization_id",record:e,reference:"organizations",link:!1,children:a.jsx(_,{source:"name",className:"text-xs text-muted-foreground line-clamp-1"})}),a.jsx(S,{variant:o(e.priority),className:"text-xs px-2 py-0.5 capitalize w-fit",children:e.priority})]})})})},"OpportunityCardContent"),Ne=t(()=>{const{identity:e}=s(),{data:r,total:i,isPending:o}=n("opportunities",{pagination:{page:1,perPage:1e3},sort:{field:"deleted_at",order:"DESC"},filter:{"deleted_at@not.is":null}}),[l,c]=x.useState(!1);if(x.useEffect(()=>{o||0!==i||c(!1)},[o,i]),x.useEffect(()=>{c(!1)},[r]),!e||o||!i||!r)return null;const d=r.reduce((e,t)=>{const a=new Date(t.deleted_at).toDateString();return e[a]||(e[a]=[]),e[a].push(t),e},{});return a.jsxs("div",{className:"w-full flex flex-row items-center justify-center",children:[a.jsx(k,{variant:"ghost",onClick:t(()=>c(!0),"onClick"),className:"my-4",children:"View archived opportunities"}),a.jsx(C,{open:l,onOpenChange:t(()=>c(!1),"onOpenChange"),children:a.jsxs(A,{className:"lg:max-w-4xl overflow-y-auto max-h-9/10 top-1/20 translate-y-0",children:[a.jsx(O,{children:"Archived Opportunities"}),a.jsx("div",{className:"flex flex-col gap-8",children:Object.entries(d).map(([e,t])=>a.jsxs("div",{className:"flex flex-col gap-4",children:[a.jsx("h4",{className:"font-bold",children:we(e)}),a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8",children:t.map(e=>a.jsx("div",{children:a.jsx(be,{opportunity:e})},e.id))})]},e))})]})})]})},"OpportunityArchivedList");function we(e){const t=new Date(e);t.setHours(0,0,0,0);const a=new Date;a.setHours(0,0,0,0);const r=t.getTime()-a.getTime(),s=Math.round(r/864e5);if(Math.abs(s)>7)return new Intl.DateTimeFormat(void 0,{day:"numeric",month:"long"}).format(t);return _e(new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}).format(s,"day"))}function _e(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Se({className:e,value:t,...r}){return a.jsx(re,{"data-slot":"progress",className:j("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",e),...r,children:a.jsx(se,{"data-slot":"progress-indicator",className:"bg-primary h-full w-full flex-1 transition-all",style:{transform:`translateX(-${100-(t||0)}%)`}})})}t(we,"getRelativeTimeString"),t(_e,"ucFirst"),t(Se,"Progress");const ke=t(({children:e})=>{const t=f(),r=y("/opportunities/create",t.pathname),s=ne(),{data:i,isPending:o}=n("contacts",{pagination:{page:1,perPage:1}});return o?a.jsx(Se,{value:50}):a.jsxs("div",{className:"flex flex-col justify-center items-center gap-12",style:{height:`calc(100dvh - ${s}px)`},children:[a.jsx("img",{src:"./img/empty.svg",alt:"No opportunities found"}),i&&i.length>0?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex flex-col items-center gap-0",children:[a.jsx("h3",{className:"text-lg font-bold",children:"No opportunities found"}),a.jsx("p",{className:"text-sm text-center text-muted-foreground mb-4",children:"It seems your opportunity list is empty."})]}),a.jsx("div",{className:"flex space-x-8",children:a.jsx(F,{label:"Create opportunity"})}),a.jsx(ie,{open:!!r}),e]}):a.jsxs("div",{className:"flex flex-col items-center gap-0",children:[a.jsx("h3",{className:"text-lg font-bold",children:"No opportunities found"}),a.jsxs("p",{className:"text-sm text-center text-muted-foreground mb-4",children:["It seems your contact list is empty.",a.jsx("br",{}),a.jsx(v,{to:"/contacts/create",className:"hover:underline",children:"Add your first contact"})," ","before creating an opportunity."]})]})]})},"OpportunityEmpty"),Ce=t(({stage:e,opportunities:t})=>{const r={1:{rest:"shadow-[var(--shadow-card-1)]",hover:"hover:shadow-[var(--shadow-card-1-hover)]"},2:{rest:"shadow-[var(--shadow-card-2)]",hover:"hover:shadow-[var(--shadow-card-2-hover)]"},3:{rest:"shadow-[var(--shadow-card-3)]",hover:"hover:shadow-[var(--shadow-card-3-hover)]"}}[oe(e)];return a.jsxs("div",{className:`flex-1 pb-8 min-w-[240px] max-w-[280px] bg-card border border-[var(--border)] rounded-2xl shadow-[var(--shadow-col-inner)] ${r.rest} ${r.hover} transition-[box-shadow,border-color] duration-200 ease-in-out px-3`,children:[a.jsx("div",{className:"flex flex-col items-center",children:a.jsxs("h3",{className:"px-3 py-2 text-sm font-bold uppercase tracking-wider bg-accent shadow-[inset_0_-1px_0_var(--border)] w-full text-center",style:{borderBottom:`2px solid ${ce(e)}`},children:[le(e),a.jsxs("span",{className:"text-[11px] text-muted-foreground ml-1 font-normal",children:["(",t.length,")"]})]})}),a.jsx("div",{className:"flex flex-col rounded-2xl mt-2 gap-2 pb-3",children:t.map(e=>a.jsx(je,{opportunity:e},e.id))})]})},"OpportunityColumn"),Ae=t((e,t)=>{const a=t||de.map(e=>({value:e.value,label:e.label}));if(!a.length)return{};const r=e.reduce((e,t)=>(e[t.stage]&&e[t.stage].push(t),e),a.reduce((e,t)=>({...e,[t.value]:[]}),{}));return a.forEach(e=>{r[e.value]&&(r[e.value]=r[e.value].sort((e,t)=>e.index-t.index))}),r},"getOpportunitiesByStage"),Oe=t(()=>{const e=ue,{data:t,isPending:r,filterValues:s}=i(),n=s?.stage&&Array.isArray(s.stage)&&s.stage.length>0?e.filter(e=>s.stage.includes(e.value)):e,[l,c]=x.useState(Ae([],e));return x.useEffect(()=>{if(t){const a=Ae(t,e);o(a,l)||c(a)}},[t]),r?null:a.jsx("div",{className:"flex gap-4 overflow-x-auto p-6 bg-muted rounded-3xl border border-[var(--border)] shadow-inner",children:n.map(e=>a.jsx(Ce,{stage:e.value,opportunities:l[e.value]},e.value))})},"OpportunityListContent"),Fe=t(({label:e,onRemove:r})=>{const s=t(e=>{e.stopPropagation(),r()},"handleRemove");return a.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs rounded-md bg-muted hover:bg-muted/80 transition-colors",children:[a.jsx("span",{className:"truncate max-w-[200px]",children:e}),a.jsx(k,{variant:"ghost",size:"icon",className:"h-3 w-3 p-0 hover:bg-transparent",onClick:s,"aria-label":`Remove ${e} filter`,children:a.jsx(he,{className:"h-2.5 w-2.5"})})]})},"FilterChip"),ze=t(e=>{const a=l(),[r,s]=x.useState({}),[n,i]=x.useState(!1);x.useEffect(()=>{if(!e||0===e.length)return;t(async()=>{const t=e.filter(e=>!r[e]);if(0!==t.length){i(!0);try{const{data:e}=await a.getMany("organizations",{ids:t}),r=e.reduce((e,t)=>(e[String(t.id)]=t.name,e),{});s(e=>({...e,...r}))}catch(n){}finally{i(!1)}}},"fetchOrganizationNames")()},[e?.join(",")]);return{organizationMap:r,getOrganizationName:t(e=>r[e]||`Organization #${e}`,"getOrganizationName"),loading:n}},"useOrganizationNames"),Te=t(e=>{const a=l(),[r,s]=x.useState({}),[n,i]=x.useState(!1);x.useEffect(()=>{if(!e||0===e.length)return;t(async()=>{const t=e.filter(e=>!r[e]);if(0!==t.length){i(!0);try{const{data:e}=await a.getMany("sales",{ids:t}),r=e.reduce((e,t)=>(e[String(t.id)]=`${t.first_name} ${t.last_name}`,e),{});s(e=>({...e,...r}))}catch(n){}finally{i(!1)}}},"fetchSalesNames")()},[e?.join(",")]);return{salesMap:r,getSalesName:t(e=>r[e]||`Sales #${e}`,"getSalesName"),loading:n}},"useSalesNames"),Ve=t(e=>{const a=l(),[r,s]=x.useState({}),[n,i]=x.useState(!1);x.useEffect(()=>{if(!e||0===e.length)return;t(async()=>{const t=e.filter(e=>!r[e]);if(0!==t.length){i(!0);try{const{data:e}=await a.getMany("tags",{ids:t}),r=e.reduce((e,t)=>(e[String(t.id)]=t.name,e),{});s(e=>({...e,...r}))}catch(n){}finally{i(!1)}}},"fetchTagNames")()},[e?.join(",")]);return{tagMap:r,getTagName:t(e=>r[e]||`Tag #${e}`,"getTagName"),loading:n}},"useTagNames"),$e=[{id:"low",name:"Low"},{id:"medium",name:"Medium"},{id:"high",name:"High"},{id:"critical",name:"Critical"}],Pe="stage",Ee="priority",Ie="tags",Me="customer_organization_id",Le="opportunity_owner_id",De=t(e=>{const t=me.find(t=>t.id===e);return t?.name||e},"formatStageLabel"),Re=t(e=>{const t=$e.find(t=>t.id===e);return t?.name||e},"formatPriorityLabel"),He=t((e,t,a,r,s)=>{switch(e){case Pe:return De(String(t));case Ee:return Re(String(t));case Ie:return s?s(String(t)):String(t);case Me:return a?a(String(t)):`Organization #${t}`;case Le:return r?r(String(t)):`Sales #${t}`;default:return"boolean"==typeof t?t?"Yes":"No":null==t?"None":String(t)}},"formatFilterLabel"),Be=t(e=>!e.includes("@")&&!["deleted_at","sales_id","q"].includes(e),"shouldDisplayFilter"),Je=t(e=>{const t=[];for(const[a,r]of Object.entries(e))Be(a)&&(Array.isArray(r)?r.forEach(e=>{t.push({key:a,value:e})}):null!=r&&""!==r&&t.push({key:a,value:r}));return t},"flattenFilterValues"),Ke=t(()=>{const{filterValues:e,setFilters:a}=i(),r=t((t,r)=>{const s=e?.[t];Array.isArray(s)?s.includes(r)||a({...e,[t]:[...s,r]}):a(void 0!==s?{...e,[t]:[s,r]}:{...e,[t]:r})},"addFilterValue"),s=t((t,r)=>{const s=e?.[t];if(Array.isArray(s)){const n=s.filter(e=>e!==r);if(0===n.length){const{[t]:r,...s}=e;a(s)}else a({...e,[t]:n})}else{const{[t]:r,...s}=e;a(s)}},"removeFilterValue"),n=t((t,a)=>{const n=e?.[t];Array.isArray(n)?n.includes(a)?s(t,a):r(t,a):n===a?s(t,a):r(t,a)},"toggleFilterValue"),o=t(t=>{if(!e?.[t])return;const{[t]:r,...s}=e;a(s)},"clearFilter"),l=t(()=>{a({})},"clearAllFilters"),c=t(t=>{const a=e?.[t];return Array.isArray(a)?a.length>0:null!=a&&""!==a},"isFilterActive"),d=x.useMemo(()=>e?Object.entries(e).filter(([e,t])=>!e.includes("@")&&"deleted_at"!==e&&(Array.isArray(t)?t.length>0:null!=t&&""!==t)).length:0,[e]);return{filterValues:e||{},addFilterValue:r,removeFilterValue:s,toggleFilterValue:n,clearFilter:o,clearAllFilters:l,isFilterActive:c,activeFilterCount:d}},"useFilterManagement"),qe=t(({className:e})=>{const{filterValues:r,removeFilterValue:s}=Ke(),n=r?.customer_organization_id?Array.isArray(r.customer_organization_id)?r.customer_organization_id.map(String):[String(r.customer_organization_id)]:void 0,i=r?.opportunity_owner_id?Array.isArray(r.opportunity_owner_id)?r.opportunity_owner_id.map(String):[String(r.opportunity_owner_id)]:void 0,o=r?.tags?Array.isArray(r.tags)?r.tags.map(String):[String(r.tags)]:void 0,{getOrganizationName:l}=ze(n),{getSalesName:c}=Te(i),{getTagName:d}=Ve(o),u=Je(r||{});return 0===u.length?null:a.jsx("div",{className:j("w-full",e),children:a.jsx(xe,{type:"single",collapsible:!0,defaultValue:"filters",children:a.jsxs(fe,{value:"filters",className:"border-b",children:[a.jsx(ye,{className:"py-2 hover:no-underline",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-sm font-medium",children:"Active Filters"}),a.jsxs("span",{className:"text-xs text-muted-foreground",children:["(",u.length," filter",1!==u.length?"s":"",")"]})]})}),a.jsx(ve,{className:"pb-3",children:a.jsx("div",{className:"flex flex-wrap gap-2",children:u.map((e,r)=>{const n=He(e.key,e.value,l,c,d);return a.jsx(Fe,{label:n,onRemove:t(()=>s(e.key,e.value),"onRemove")},`${e.key}-${e.value}-${r}`)})})})]})})})},"FilterChipsPanel"),Ue=t(e=>{const{choices:r,resource:s,source:n,optionText:i,optionValue:o,translateChoice:l,defaultValue:p=[],label:h,helperText:g,validate:f,disabled:y,emptyText:v="Select items",...b}=e,N=c(),{allChoices:w,source:_}=d({choices:r,resource:s,source:n}),{field:C,fieldState:{error:A}}=u({defaultValue:p,resource:s,source:_,validate:f,...b}),O=x.useCallback((e,t)=>{const a=C.value||[],r=t?[...a,e]:a.filter(t=>t!==e);C.onChange(r)},[C]),F=x.useCallback(e=>{e.stopPropagation(),C.onChange([])},[C]),R=C.value?.length||0,H=R>0?`${v} (${R} selected)`:v;return a.jsxs(z,{children:[!1!==h&&a.jsx(T,{htmlFor:C.name,children:a.jsx(m,{label:h,source:_,resource:s})}),a.jsxs(V,{children:[a.jsx($,{asChild:!0,children:a.jsxs(k,{variant:"outline",className:j("w-full justify-between",R>0&&!y&&"border-primary text-primary"),disabled:y,children:[a.jsx("span",{children:H}),R>0&&a.jsx(S,{variant:"secondary",className:"ml-2",children:R})]})}),a.jsxs(P,{className:"w-56",children:[R>0&&a.jsxs(a.Fragment,{children:[a.jsxs(E,{onClick:F,children:[a.jsx(he,{className:"mr-2 h-4 w-4"}),"Clear all"]}),a.jsx(I,{})]}),w?.map(e=>{const r=e[o??"id"],s=e[i??"name"],n=C.value?.includes(r)||!1;return a.jsx(M,{checked:n,onCheckedChange:t(e=>O(r,e),"onCheckedChange"),children:l?N(s,{_:s}):s},r)})]})]}),a.jsx(L,{helperText:g}),A&&a.jsx(D,{children:A.message})]})},"MultiSelectInput"),Xe=t(e=>{const{filterValues:r,displayedFilters:n,setFilters:i}=p(),{identity:o}=s(),l=t(()=>{const e={...r};void 0!==r.opportunity_owner_id?delete e.opportunity_owner_id:e.opportunity_owner_id=o&&o?.id,i(e,n)},"handleChange");return a.jsx("div",{className:"mt-auto pb-2.25",children:a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(R,{id:"only-mine",checked:void 0!==r.opportunity_owner_id,onCheckedChange:l}),a.jsx(H,{htmlFor:"only-mine",children:"Only opportunities I manage"})]})})},"OnlyMineInput"),Ye="filter.opportunity_stages",Ze=me.filter(e=>!["closed_won","closed_lost"].includes(e.id)).map(e=>e.id),Ge=t(()=>{try{const e=localStorage.getItem(Ye);return e?JSON.parse(e):Ze}catch{return Ze}},"getStoredStagePreferences"),Qe=t(e=>{if(0!==e.length)try{localStorage.setItem(Ye,JSON.stringify(e))}catch(t){}},"saveStagePreferences"),We=t(()=>{const e=new URLSearchParams(window.location.search).get("filter");if(e)try{const t=JSON.parse(e);if(t.stage)return Array.isArray(t.stage)?t.stage:[t.stage]}catch{}return Ge()},"getInitialStageFilter"),et=t(()=>[a.jsx(B,{source:"q",alwaysOn:!0}),a.jsx(J,{source:"customer_organization_id",reference:"organizations",children:a.jsx(ge,{label:!1,placeholder:"Customer Organization"})}),a.jsx(Ue,{source:"priority",emptyText:"Priority",choices:[{id:"low",name:"Low"},{id:"medium",name:"Medium"},{id:"high",name:"High"},{id:"critical",name:"Critical"}]}),a.jsx(Ue,{source:"stage",emptyText:"Stage",choices:me,defaultValue:We()}),a.jsx(Xe,{source:"opportunity_owner_id",alwaysOn:!0})],"useOpportunityFilters"),tt=t(()=>{const{identity:e}=s(),t=h()("opportunities",2);if(!e)return null;const r=et();return a.jsxs(K,{perPage:100,filter:{"deleted_at@is":null},title:!1,sort:{field:"index",order:"DESC"},filters:r,actions:a.jsx(rt,{}),pagination:null,children:[a.jsxs(q,{children:[a.jsx(U,{children:a.jsx(v,{to:"/",children:a.jsx(g,{i18nKey:"ra.page.dashboard",children:"Home"})})}),a.jsx(X,{children:t})]}),a.jsx(qe,{className:"mb-4"}),a.jsx(at,{})]})},"OpportunityList"),at=t(()=>{const{data:e,isPending:t,filterValues:r}=i(),s=r&&Object.keys(r).length>0;return x.useEffect(()=>{r?.stage&&Array.isArray(r.stage)&&Qe(r.stage)},[r?.stage]),t?null:e?.length||s?a.jsxs("div",{className:"w-full",children:[a.jsx(Oe,{}),a.jsx(Ne,{})]}):a.jsx(a.Fragment,{children:a.jsx(ke,{children:a.jsx(Ne,{})})})},"OpportunityLayout"),rt=t(()=>a.jsxs(Y,{children:[a.jsx(Z,{}),a.jsx(G,{}),a.jsx(F,{label:"New Opportunity"})]}),"OpportunityActions");export{tt as default};
