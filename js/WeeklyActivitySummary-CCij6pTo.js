var e=Object.defineProperty,t=(t,s)=>e(t,"name",{value:s,configurable:!0});import{i as s,u as a,U as r,j as i,am as n,an as l}from"./chunk-ByJg_QQB.js";import{r as c}from"./chunk-1NZFT-6z.js";import{R as o}from"./chunk-MaXPr535.js";import{C as d,a as m,b as p,c as x,d as h}from"../assets/index-BoLku8RR.js";import{s as g}from"./chunk-BnJ5ohE_.js";import{d as u,w as j,s as y}from"./chunk-DwAffUXc.js";import"./chunk-JxeXaC9i.js";import"./chunk-Bc6KM1xM.js";import"./chunk-knA4lag3.js";import"./chunk-Tyyhsnez.js";import"./chunk-XoqkUGE_.js";import"./chunk-CRKBdUTG.js";function f(){const{data:e}=s(),p=a(),[x,h]=c.useState(()=>({start:u(y(new Date,{weekStartsOn:1}),"yyyy-MM-dd"),end:u(j(new Date,{weekStartsOn:1}),"yyyy-MM-dd")})),{data:f,isPending:v}=r("activities",{pagination:{page:1,perPage:1e4},filter:{"activity_date@gte":x.start,"activity_date@lte":x.end},sort:{field:"activity_date",order:"DESC"}}),b=c.useMemo(()=>Array.from(new Set((f||[]).map(e=>e.created_by).filter(Boolean))),[f]),{data:k}=r("sales",{pagination:{page:1,perPage:1e3},filter:{id:b}}),_=c.useMemo(()=>Array.from(new Set((f||[]).map(e=>e.organization_id).filter(Boolean))),[f]),{data:w}=r("organizations",{pagination:{page:1,perPage:1e3},filter:{id:_}}),M=c.useMemo(()=>new Map((k||[]).map(e=>[e.id,e])),[k]),A=c.useMemo(()=>new Map((w||[]).map(e=>[e.id,e])),[w]),E=c.useMemo(()=>{if(!f)return[];const e=new Map;return f.forEach(t=>{if(!t.created_by)return;const s=M.get(t.created_by);if(!s)return;e.has(t.created_by)||e.set(t.created_by,{rep:s,principals:new Map});const a=e.get(t.created_by),r=t.organization_id||0;if(!a.principals.has(r)){const e=r?A.get(r):null;a.principals.set(r,{org:e||{id:0,name:"No Principal"},calls:0,emails:0,meetings:0,notes:0,total:0})}const i=a.principals.get(r);"call"===t.type?i.calls++:"email"===t.type?i.emails++:"meeting"===t.type?i.meetings++:i.notes++,i.total++}),Array.from(e.values())},[f,M,A]),S=t(()=>{const e=[];E.forEach(t=>{t.principals.forEach(s=>{e.push({rep_name:g(`${t.rep.first_name} ${t.rep.last_name}`),principal_name:g(s.org.name),calls:s.calls,emails:s.emails,meetings:s.meetings,notes:s.notes,total:s.total})})}),n(e,(e,t)=>{e?p("Export failed. Please try again.",{type:"error"}):(l(t,`weekly-activity-${x.start}-to-${x.end}`),p("Report exported successfully",{type:"success"}))})},"handleExport");if(v||!e)return i.jsx(o,{title:"Weekly Activity Summary",children:i.jsx("p",{className:"text-muted-foreground",children:"Loading activities..."})});const C=f?.length||0;return i.jsx(o,{title:"Weekly Activity Summary",onExport:S,actions:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"date",value:x.start,onChange:t(e=>h({...x,start:e.target.value}),"onChange"),className:"px-3 py-2 border rounded text-sm"}),i.jsx("span",{className:"text-muted-foreground",children:"to"}),i.jsx("input",{type:"date",value:x.end,onChange:t(e=>h({...x,end:e.target.value}),"onChange"),className:"px-3 py-2 border rounded text-sm"})]}),children:i.jsxs("div",{className:"space-y-section",children:[i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-content",children:[i.jsx(d,{children:i.jsxs(m,{className:"p-4",children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Activities"}),i.jsx("p",{className:"text-2xl font-bold",children:C})]})}),i.jsx(d,{children:i.jsxs(m,{className:"p-4",children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Reps"}),i.jsx("p",{className:"text-2xl font-bold",children:E.length})]})}),i.jsx(d,{children:i.jsxs(m,{className:"p-4",children:[i.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg per Rep"}),i.jsx("p",{className:"text-2xl font-bold",children:E.length>0?Math.round(C/E.length):0})]})})]}),0===E.length?i.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No activities found for this date range"}):i.jsx("div",{className:"space-y-6",children:E.map(e=>i.jsx(N,{repGroup:e},e.rep.id))})]})})}function N({repGroup:e}){const t=Array.from(e.principals.values()).reduce((e,t)=>e+t.total,0),s=Array.from(e.principals.values()).sort((e,t)=>t.total-e.total);return i.jsxs(d,{children:[i.jsx(p,{children:i.jsxs(x,{className:"flex items-center justify-between",children:[i.jsxs("span",{children:[e.rep.first_name," ",e.rep.last_name]}),i.jsxs(h,{children:[t," activities"]})]})}),i.jsx(m,{children:i.jsxs("table",{className:"w-full",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"border-b text-sm text-muted-foreground",children:[i.jsx("th",{className:"text-left py-2",children:"Principal"}),i.jsx("th",{className:"text-right py-2",children:"Calls"}),i.jsx("th",{className:"text-right py-2",children:"Emails"}),i.jsx("th",{className:"text-right py-2",children:"Meetings"}),i.jsx("th",{className:"text-right py-2",children:"Notes"}),i.jsx("th",{className:"text-right py-2",children:"Total"})]})}),i.jsx("tbody",{children:s.map((e,t)=>i.jsxs("tr",{className:"border-b "+(e.total<3?"bg-warning/10":""),children:[i.jsxs("td",{className:"py-2 flex items-center gap-2",children:[e.org.name,e.total<3&&i.jsx(h,{variant:"outline",className:"text-xs",children:"⚠️ Low Activity"})]}),i.jsx("td",{className:"text-right",children:e.calls}),i.jsx("td",{className:"text-right",children:e.emails}),i.jsx("td",{className:"text-right",children:e.meetings}),i.jsx("td",{className:"text-right",children:e.notes}),i.jsx("td",{className:"text-right font-semibold",children:e.total})]},e.org.id||t))})]})})]})}t(f,"WeeklyActivitySummary"),t(N,"RepActivityCard");export{f as default};
