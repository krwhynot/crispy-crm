{"version":3,"mappings":"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","names":["useTaskCount","salesId","loading","salesLoading","useCurrentSale","total","isLoading","useGetList","pagination","page","perPage","filter","sales_id","completed","enabled","staleTime","pendingCount","__name","PrincipalPipelineTable","lazy","__vitePreload","import","__VITE_PRELOAD__","TasksKanbanPanel","MyPerformanceWidget","ActivityFeedPanel","TabSkeleton","jsxs","className","children","jsx","Skeleton","DashboardTabPanel","Card","Tabs","defaultValue","TabsList","TabsTrigger","value","LayoutGrid","CheckSquare","Badge","variant","TrendingUp","Users","CardContent","TabsContent","forceMount","Suspense","fallback","QuickLogForm","then","m","default","DRAFT_STORAGE_KEY","QuickLogFormSkeleton","loadDraft","window","stored","localStorage","getItem","draft","JSON","parse","Date","now","savedAt","removeItem","formData","saveDraft","notes","contactId","organizationId","opportunityId","setItem","stringify","clearDraft","LogActivityFAB","onRefresh","isOpen","setIsOpen","useState","hasDraft","setHasDraft","fabRef","useRef","debounceRef","useEffect","handleComplete","useCallback","setTimeout","current","focus","handleDraftChange","clearTimeout","handleOpenChange","open","initialDraft","Sheet","onOpenChange","SheetTrigger","asChild","Button","ref","size","cn","PencilLine","SheetContent","side","SheetHeader","SheetTitle","id","SheetDescription","onComplete","onDraftChange","QUICK_ACTIONS","label","icon","MessageCircle","activityType","ariaLabel","Package","Phone","FileText","CheckCircle2","customAction","MobileQuickActionBar","onCompleteTask","isSheetOpen","setIsSheetOpen","selectedAction","setSelectedAction","handleActionClick","action","Fragment","role","map","Icon","onClick","toLowerCase","useMyTasks","dataProvider","useDataProvider","data","rawTasks","error","fetchError","refetch","_refetch","sort","field","order","meta","expand","serverTasks","useMemo","today","startOfDay","tomorrow","addDays","nextWeek","task","dueDate","parseDateSafely","due_date","dueDateStart","status","isBefore","isSameDay","subject","title","priority","taskType","call","email","meeting","demo","proposal","other","type","relatedTo","opportunity_id","contact_id","organization_id","name","opportunity","contact","organization","description","optimisticUpdates","setOptimisticUpdates","Map","tasks","get","deleted","tasksRef","completeTask","async","taskId","find","t","prev","next","set","update","completed_at","toISOString","previousData","delete","err","calculateStatus","snoozeTask","newDueDate","endOfDay","newStatus","deleteTask","viewTask","location","href","updateTaskDueDate","updateTaskLocally","updates","existing","rollbackTask","_previousState","TASK_TYPE_ICONS","Call","Email","Mail","Meeting","Repeat","Demo","Calendar","Proposal","Other","MoreHorizontal","PRIORITY_VARIANTS","critical","high","medium","low","TaskItemCard","isCompleting","isOverdue","priorityConfig","disabled","Clock","format","TaskListSkeleton","i","TaskCompleteSheet","notify","useNotify","completingId","setCompletingId","actionableTasks","a","b","statusOrder","overdue","upcoming","later","statusDiff","priorityOrder","length","overdueCount","message","KPI_CONFIG","openOpportunities","Briefcase","formatValue","toLocaleString","navigateTo","overdueTasks","AlertCircle","destructiveWhenPositive","activitiesThisWeek","Activity","staleDeals","AlertTriangle","warningWhenPositive","KPICard","dataTutorial","navigate","useNavigate","config","isDestructive","isWarning","handleClick","handleKeyDown","e","key","preventDefault","onKeyDown","tabIndex","DEFAULT_METRICS","openOpportunitiesCount","overdueTasksCount","staleDealsCount","useKPIMetrics","metrics","setMetrics","setLoading","setError","refetchTrigger","setRefetchTrigger","prevSalesIdRef","abortController","AbortController","isMounted","signal","aborted","weekStart","startOfWeek","weekStartsOn","weekEnd","endOfWeek","staleThresholdDate","subDays","openCountResult","staleOpportunitiesResult","tasksResult","activitiesResult","Promise","allSettled","getList","opp","isOpportunityStale","stage","last_activity_date","fetchMetrics","abort","KPISummaryRow","DASHBOARD_TUTORIAL_STEPS","popover","element","align","DashboardTutorial","driverRef","isActive","setIsActive","destroy","startTutorial","driver","showProgress","animate","smoothScroll","allowClose","overlayOpacity","popoverClass","nextBtnText","prevBtnText","doneBtnText","steps","onDestroyStarted","drive","Tooltip","TooltipTrigger","HelpCircle","TooltipContent","PrincipalDashboardV3","refreshKey","setRefreshKey","isTaskSheetOpen","setIsTaskSheetOpen","handleRefresh","handleCompleteTask"],"ignoreList":[],"sources":["../../src/atomic-crm/dashboard/v3/hooks/useTaskCount.ts","../../src/atomic-crm/dashboard/v3/components/DashboardTabPanel.tsx","../../src/atomic-crm/dashboard/v3/components/LogActivityFAB.tsx","../../src/atomic-crm/dashboard/v3/components/MobileQuickActionBar.tsx","../../src/atomic-crm/dashboard/v3/hooks/useMyTasks.ts","../../src/atomic-crm/dashboard/v3/components/TaskCompleteSheet.tsx","../../src/atomic-crm/dashboard/v3/components/KPICard.tsx","../../src/atomic-crm/dashboard/v3/hooks/useKPIMetrics.ts","../../src/atomic-crm/dashboard/v3/components/KPISummaryRow.tsx","../../src/atomic-crm/dashboard/v3/dashboardTutorialSteps.ts","../../src/atomic-crm/dashboard/v3/DashboardTutorial.tsx","../../src/atomic-crm/dashboard/v3/PrincipalDashboardV3.tsx"],"sourcesContent":["import { useGetList } from \"react-admin\";\nimport { useCurrentSale } from \"./useCurrentSale\";\n\ninterface UseTaskCountResult {\n  pendingCount: number;\n  isLoading: boolean;\n}\n\n/**\n * Returns count of pending tasks for badge display.\n * Uses server-side pagination (perPage: 1) for efficient counting.\n *\n * Note: Uses useCurrentSale() internally for salesId, matching\n * the pattern used by useMyTasks and other dashboard hooks.\n */\nexport function useTaskCount(): UseTaskCountResult {\n  const { salesId, loading: salesLoading } = useCurrentSale();\n\n  const { total, isLoading } = useGetList(\n    \"tasks\",\n    {\n      pagination: { page: 1, perPage: 1 },\n      filter: {\n        sales_id: salesId,\n        completed: false,\n        \"deleted_at@is\": null,\n      },\n    },\n    {\n      enabled: !salesLoading && !!salesId,\n      staleTime: 30_000, // 30 seconds\n    }\n  );\n\n  return {\n    pendingCount: total ?? 0,\n    isLoading: isLoading || salesLoading,\n  };\n}\n","\"use client\";\n\nimport { Suspense, lazy } from \"react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useTaskCount } from \"../hooks/useTaskCount\";\nimport { LayoutGrid, CheckSquare, TrendingUp, Users } from \"lucide-react\";\n\n// Lazy load tab content for performance\nconst PrincipalPipelineTable = lazy(() => import(\"./PrincipalPipelineTable\"));\nconst TasksKanbanPanel = lazy(() => import(\"./TasksKanbanPanel\"));\nconst MyPerformanceWidget = lazy(() => import(\"./MyPerformanceWidget\"));\nconst ActivityFeedPanel = lazy(() => import(\"./ActivityFeedPanel\"));\n\nfunction TabSkeleton() {\n  return (\n    <div className=\"space-y-4 p-4\">\n      <Skeleton className=\"h-8 w-1/3\" />\n      <Skeleton className=\"h-32 w-full\" />\n      <Skeleton className=\"h-32 w-full\" />\n    </div>\n  );\n}\n\n/**\n * DashboardTabPanel - Tabbed interface for all dashboard sections\n *\n * Replaces vertically stacked layout with tabs to eliminate scrolling\n * and improve focus on iPad devices.\n *\n * Four tabs:\n * - Pipeline (default) - Principal pipeline table with drill-down\n * - My Tasks - Kanban board with pending task count badge\n * - Performance - Personal performance metrics\n * - Team Activity - Recent activities across the team\n *\n * Features:\n * - forceMount preserves component state when switching tabs\n * - Lazy loading reduces initial bundle size\n * - 44px touch targets for iPad accessibility\n * - Semantic colors only (Tailwind v4)\n */\nexport function DashboardTabPanel() {\n  const { pendingCount, isLoading } = useTaskCount();\n\n  return (\n    <Card className=\"flex min-h-0 flex-1 flex-col gap-0 overflow-hidden\">\n      <Tabs defaultValue=\"pipeline\" className=\"flex min-h-0 flex-1 flex-col gap-0\">\n        <div className=\"shrink-0 border-b border-border px-4 py-3\">\n          <TabsList className=\"h-11 w-full justify-start gap-2 bg-transparent p-0\" data-tutorial=\"dashboard-tabs\">\n            {/* Pipeline Tab - 44px touch target */}\n            <TabsTrigger\n              value=\"pipeline\"\n              className=\"h-11 min-w-[120px] gap-2 rounded-t-lg rounded-b-none border-b-2 border-transparent px-4 data-[state=active]:border-primary data-[state=active]:bg-transparent\"\n              data-tutorial=\"dashboard-tab-pipeline\"\n            >\n              <LayoutGrid className=\"h-4 w-4\" />\n              <span>Pipeline</span>\n            </TabsTrigger>\n\n            {/* My Tasks Tab */}\n            <TabsTrigger\n              value=\"tasks\"\n              className=\"h-11 min-w-[120px] gap-2 rounded-t-lg rounded-b-none border-b-2 border-transparent px-4 data-[state=active]:border-primary data-[state=active]:bg-transparent\"\n              data-tutorial=\"dashboard-tab-tasks\"\n            >\n              <CheckSquare className=\"h-4 w-4\" />\n              <span>My Tasks</span>\n              {!isLoading && pendingCount > 0 && (\n                <Badge variant=\"secondary\" className=\"ml-1 h-5 min-w-[20px] px-1.5 text-xs\">\n                  {pendingCount}\n                </Badge>\n              )}\n            </TabsTrigger>\n\n            {/* Performance Tab */}\n            <TabsTrigger\n              value=\"performance\"\n              className=\"h-11 min-w-[120px] gap-2 rounded-t-lg rounded-b-none border-b-2 border-transparent px-4 data-[state=active]:border-primary data-[state=active]:bg-transparent\"\n              data-tutorial=\"dashboard-tab-performance\"\n            >\n              <TrendingUp className=\"h-4 w-4\" />\n              <span>Performance</span>\n            </TabsTrigger>\n\n            {/* Team Activity Tab */}\n            <TabsTrigger\n              value=\"activity\"\n              className=\"h-11 min-w-[120px] gap-2 rounded-t-lg rounded-b-none border-b-2 border-transparent px-4 data-[state=active]:border-primary data-[state=active]:bg-transparent\"\n              data-tutorial=\"dashboard-tab-activity\"\n            >\n              <Users className=\"h-4 w-4\" />\n              <span>Team Activity</span>\n            </TabsTrigger>\n          </TabsList>\n        </div>\n\n        <CardContent className=\"relative min-h-0 flex-1 p-0\">\n          {/* Pipeline Tab Content - forceMount preserves filter state */}\n          <TabsContent\n            value=\"pipeline\"\n            className=\"absolute inset-0 m-0 overflow-auto focus-visible:ring-0\"\n            forceMount\n          >\n            <Suspense fallback={<TabSkeleton />}>\n              <PrincipalPipelineTable />\n            </Suspense>\n          </TabsContent>\n\n          {/* Tasks Tab Content - forceMount preserves kanban state */}\n          <TabsContent\n            value=\"tasks\"\n            className=\"absolute inset-0 m-0 overflow-auto focus-visible:ring-0\"\n            forceMount\n          >\n            <Suspense fallback={<TabSkeleton />}>\n              <TasksKanbanPanel />\n            </Suspense>\n          </TabsContent>\n\n          {/* Performance Tab Content - forceMount prevents refetch */}\n          <TabsContent\n            value=\"performance\"\n            className=\"absolute inset-0 m-0 overflow-auto focus-visible:ring-0\"\n            forceMount\n          >\n            <Suspense fallback={<TabSkeleton />}>\n              <MyPerformanceWidget />\n            </Suspense>\n          </TabsContent>\n\n          {/* Team Activity Tab Content - forceMount preserves scroll */}\n          <TabsContent\n            value=\"activity\"\n            className=\"absolute inset-0 m-0 overflow-auto focus-visible:ring-0\"\n            forceMount\n          >\n            <Suspense fallback={<TabSkeleton />}>\n              <ActivityFeedPanel />\n            </Suspense>\n          </TabsContent>\n        </CardContent>\n      </Tabs>\n    </Card>\n  );\n}\n\nexport default DashboardTabPanel;\n","import { useState, useEffect, useCallback, lazy, Suspense, useRef } from \"react\";\nimport { PencilLine } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n  SheetTrigger,\n} from \"@/components/ui/sheet\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { cn } from \"@/lib/utils\";\nimport type { ActivityLogInput } from \"@/atomic-crm/validation/activities\";\n\n// Lazy load QuickLogForm - saves ~15-20KB from main dashboard chunk\nconst QuickLogForm = lazy(() =>\n  import(\"./QuickLogForm\").then((m) => ({ default: m.QuickLogForm }))\n);\n\n// Storage key for draft persistence\nconst DRAFT_STORAGE_KEY = \"principal-dashboard-log-activity-draft\";\n\n// Debounce delay for saving drafts (ms)\nconst DRAFT_SAVE_DEBOUNCE_MS = 500;\n\n// Draft expires after 24 hours\nconst DRAFT_EXPIRY_MS = 24 * 60 * 60 * 1000;\n\n/**\n * Draft state stored in localStorage\n * Includes timestamp for expiry logic\n */\ninterface ActivityDraft {\n  formData: Partial<ActivityLogInput>;\n  savedAt: number;\n}\n\ninterface LogActivityFABProps {\n  /** Callback to refresh dashboard data after activity is logged */\n  onRefresh?: () => void;\n}\n\n/**\n * Skeleton fallback shown while QuickLogForm lazy loads\n * Matches the form structure for smooth loading transition\n */\nfunction QuickLogFormSkeleton() {\n  return (\n    <div className=\"space-y-4\" data-testid=\"quick-log-form-skeleton\">\n      {/* Activity Type section */}\n      <div className=\"space-y-3\">\n        <Skeleton className=\"h-4 w-24\" />\n        <div className=\"space-y-2\">\n          <Skeleton className=\"h-4 w-20\" />\n          <Skeleton className=\"h-11 w-full\" />\n        </div>\n        <div className=\"space-y-2\">\n          <Skeleton className=\"h-4 w-16\" />\n          <Skeleton className=\"h-11 w-full\" />\n        </div>\n      </div>\n\n      {/* Who was involved section */}\n      <div className=\"space-y-3\">\n        <Skeleton className=\"h-4 w-32\" />\n        <div className=\"space-y-2\">\n          <Skeleton className=\"h-4 w-16\" />\n          <Skeleton className=\"h-11 w-full\" />\n        </div>\n        <div className=\"space-y-2\">\n          <Skeleton className=\"h-4 w-24\" />\n          <Skeleton className=\"h-11 w-full\" />\n        </div>\n      </div>\n\n      {/* Notes section */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-12\" />\n        <Skeleton className=\"h-24 w-full\" />\n      </div>\n\n      {/* Action buttons */}\n      <div className=\"flex justify-between pt-4\">\n        <Skeleton className=\"h-10 w-20\" />\n        <div className=\"flex gap-2\">\n          <Skeleton className=\"h-11 w-28\" />\n          <Skeleton className=\"h-11 w-24\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n\n/**\n * Load draft from localStorage with expiry check\n */\nfunction loadDraft(): Partial<ActivityLogInput> | null {\n  if (typeof window === \"undefined\") return null;\n\n  try {\n    const stored = localStorage.getItem(DRAFT_STORAGE_KEY);\n    if (!stored) return null;\n\n    const draft: ActivityDraft = JSON.parse(stored);\n\n    // Check if draft has expired\n    if (Date.now() - draft.savedAt > DRAFT_EXPIRY_MS) {\n      localStorage.removeItem(DRAFT_STORAGE_KEY);\n      return null;\n    }\n\n    return draft.formData;\n  } catch {\n    // Invalid JSON or structure, clear it\n    localStorage.removeItem(DRAFT_STORAGE_KEY);\n    return null;\n  }\n}\n\n/**\n * Save draft to localStorage with timestamp\n */\nfunction saveDraft(formData: Partial<ActivityLogInput>): void {\n  if (typeof window === \"undefined\") return;\n\n  // Don't save empty drafts\n  const hasContent =\n    formData.notes || formData.contactId || formData.organizationId || formData.opportunityId;\n\n  if (!hasContent) {\n    localStorage.removeItem(DRAFT_STORAGE_KEY);\n    return;\n  }\n\n  const draft: ActivityDraft = {\n    formData,\n    savedAt: Date.now(),\n  };\n\n  localStorage.setItem(DRAFT_STORAGE_KEY, JSON.stringify(draft));\n}\n\n/**\n * Clear draft from localStorage\n */\nfunction clearDraft(): void {\n  if (typeof window === \"undefined\") return;\n  localStorage.removeItem(DRAFT_STORAGE_KEY);\n}\n\n/**\n * LogActivityFAB - Floating Action Button for logging activities\n *\n * Features:\n * - 56px circular FAB (spacious CTA per design tokens)\n * - Sheet slide-over with QuickLogForm\n * - localStorage draft persistence with 500ms debounce\n * - Warning badge when draft exists\n * - Full WCAG accessibility (aria-expanded, focus management)\n */\nexport function LogActivityFAB({ onRefresh }: LogActivityFABProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [hasDraft, setHasDraft] = useState(false);\n  const fabRef = useRef<HTMLButtonElement>(null);\n  const debounceRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  // Check for existing draft on mount\n  useEffect(() => {\n    const draft = loadDraft();\n    setHasDraft(draft !== null);\n  }, []);\n\n  // Handle form completion (successful save)\n  const handleComplete = useCallback(() => {\n    clearDraft();\n    setHasDraft(false);\n    setIsOpen(false);\n\n    // Return focus to FAB for accessibility\n    // Small delay to allow Sheet close animation\n    setTimeout(() => {\n      fabRef.current?.focus();\n    }, 100);\n  }, []);\n\n  // Handle form data changes for draft persistence\n  const handleDraftChange = useCallback((formData: Partial<ActivityLogInput>) => {\n    // Debounce saves to avoid excessive localStorage writes\n    if (debounceRef.current) {\n      clearTimeout(debounceRef.current);\n    }\n\n    debounceRef.current = setTimeout(() => {\n      saveDraft(formData);\n      setHasDraft(true);\n    }, DRAFT_SAVE_DEBOUNCE_MS);\n  }, []);\n\n  // Handle sheet open/close\n  const handleOpenChange = useCallback((open: boolean) => {\n    setIsOpen(open);\n\n    // If closing without saving, draft remains (already persisted via debounce)\n    // If opening, we'll load the draft in QuickLogForm via initialDraft prop\n  }, []);\n\n  // Clear pending debounce on unmount\n  useEffect(() => {\n    return () => {\n      if (debounceRef.current) {\n        clearTimeout(debounceRef.current);\n      }\n    };\n  }, []);\n\n  // Get initial draft for form\n  const initialDraft = isOpen ? loadDraft() : null;\n\n  return (\n    <Sheet open={isOpen} onOpenChange={handleOpenChange}>\n      <SheetTrigger asChild>\n        <Button\n          ref={fabRef}\n          size=\"icon\"\n          className={cn(\n            // Size: 56px (h-14 w-14) - Spacious CTA per design tokens\n            \"fixed bottom-6 right-6 z-50 h-14 w-14\",\n            // Hidden on mobile - MobileQuickActionBar handles mobile actions\n            \"hidden lg:flex\",\n            // Shape: Circular FAB\n            \"rounded-full\",\n            // Elevation: High (floating element)\n            \"shadow-lg hover:shadow-xl\",\n            // Transitions\n            \"transition-all duration-200\",\n            // Colors: Primary brand (semantic utility)\n            \"bg-primary text-primary-foreground hover:bg-primary/90\",\n            // Focus ring for accessibility\n            \"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n          )}\n          aria-label={hasDraft ? \"Log Activity (draft saved)\" : \"Log Activity\"}\n          aria-expanded={isOpen}\n          aria-haspopup=\"dialog\"\n          data-tutorial=\"dashboard-log-activity\"\n        >\n          <PencilLine className=\"h-6 w-6\" />\n\n          {/* Draft Badge - Warning color indicates unsaved work */}\n          {hasDraft && (\n            <span\n              className={cn(\n                \"absolute -right-1 -top-1\",\n                \"h-4 w-4 rounded-full\",\n                \"bg-warning ring-2 ring-background\",\n                // Pulse animation to draw attention\n                \"animate-pulse\"\n              )}\n              aria-hidden=\"true\"\n            />\n          )}\n        </Button>\n      </SheetTrigger>\n\n      <SheetContent\n        side=\"right\"\n        className=\"flex w-full flex-col sm:max-w-[420px]\"\n        aria-labelledby=\"log-activity-title\"\n        aria-describedby=\"log-activity-description\"\n      >\n        <SheetHeader className=\"border-b border-border pb-4\">\n          <SheetTitle id=\"log-activity-title\">Log Activity</SheetTitle>\n          <SheetDescription id=\"log-activity-description\">\n            Quick capture for calls, meetings, and notes\n          </SheetDescription>\n        </SheetHeader>\n\n        <div className=\"flex-1 overflow-y-auto py-4\">\n          <Suspense fallback={<QuickLogFormSkeleton />}>\n            <QuickLogForm\n              onComplete={handleComplete}\n              onRefresh={onRefresh}\n              initialDraft={initialDraft}\n              onDraftChange={handleDraftChange}\n            />\n          </Suspense>\n        </div>\n      </SheetContent>\n    </Sheet>\n  );\n}\n","import { useState, useCallback, lazy, Suspense } from \"react\";\nimport { MessageCircle, Package, Phone, Users, FileText, CheckCircle2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { cn } from \"@/lib/utils\";\nimport type { ActivityLogInput } from \"@/atomic-crm/validation/activities\";\n\n// Lazy load QuickLogForm - saves ~15-20KB from main dashboard chunk\nconst QuickLogForm = lazy(() =>\n  import(\"./QuickLogForm\").then((m) => ({ default: m.QuickLogForm }))\n);\n\n/**\n * Quick action button configuration\n * Maps to activity types from PRD v1.18\n */\ninterface QuickAction {\n  id: string;\n  label: string;\n  icon: typeof MessageCircle;\n  /** Activity type to pre-fill in QuickLogForm */\n  activityType?: \"Check-in\" | \"Sample\" | \"Call\" | \"Meeting\" | \"Note\";\n  /** Custom action handler (for non-activity actions like Complete Task) */\n  customAction?: boolean;\n  /** Aria label for accessibility */\n  ariaLabel: string;\n}\n\nconst QUICK_ACTIONS: QuickAction[] = [\n  {\n    id: \"check-in\",\n    label: \"Check-In\",\n    icon: MessageCircle,\n    activityType: \"Check-in\",\n    ariaLabel: \"Log a check-in activity\",\n  },\n  {\n    id: \"sample\",\n    label: \"Sample\",\n    icon: Package,\n    activityType: \"Sample\",\n    ariaLabel: \"Log a sample delivery or request\",\n  },\n  {\n    id: \"call\",\n    label: \"Call\",\n    icon: Phone,\n    activityType: \"Call\",\n    ariaLabel: \"Log a phone call\",\n  },\n  {\n    id: \"meeting\",\n    label: \"Meeting\",\n    icon: Users,\n    activityType: \"Meeting\",\n    ariaLabel: \"Log a meeting\",\n  },\n  {\n    id: \"note\",\n    label: \"Note\",\n    icon: FileText,\n    activityType: \"Note\",\n    ariaLabel: \"Add a quick note\",\n  },\n  {\n    id: \"complete-task\",\n    label: \"Complete\",\n    icon: CheckCircle2,\n    customAction: true,\n    ariaLabel: \"Mark a task as complete\",\n  },\n];\n\n/**\n * Skeleton fallback shown while QuickLogForm lazy loads\n * Matches the form structure for smooth loading transition\n */\nfunction QuickLogFormSkeleton() {\n  return (\n    <div className=\"space-y-4\" data-testid=\"quick-log-form-skeleton\">\n      {/* Activity Type section */}\n      <div className=\"space-y-3\">\n        <Skeleton className=\"h-4 w-24\" />\n        <div className=\"space-y-2\">\n          <Skeleton className=\"h-4 w-20\" />\n          <Skeleton className=\"h-11 w-full\" />\n        </div>\n        <div className=\"space-y-2\">\n          <Skeleton className=\"h-4 w-16\" />\n          <Skeleton className=\"h-11 w-full\" />\n        </div>\n      </div>\n\n      {/* Who was involved section */}\n      <div className=\"space-y-3\">\n        <Skeleton className=\"h-4 w-32\" />\n        <div className=\"space-y-2\">\n          <Skeleton className=\"h-4 w-16\" />\n          <Skeleton className=\"h-11 w-full\" />\n        </div>\n        <div className=\"space-y-2\">\n          <Skeleton className=\"h-4 w-24\" />\n          <Skeleton className=\"h-11 w-full\" />\n        </div>\n      </div>\n\n      {/* Notes section */}\n      <div className=\"space-y-2\">\n        <Skeleton className=\"h-4 w-12\" />\n        <Skeleton className=\"h-24 w-full\" />\n      </div>\n\n      {/* Action buttons */}\n      <div className=\"flex justify-between pt-4\">\n        <Skeleton className=\"h-10 w-20\" />\n        <div className=\"flex gap-2\">\n          <Skeleton className=\"h-11 w-28\" />\n          <Skeleton className=\"h-11 w-24\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n\ninterface MobileQuickActionBarProps {\n  /** Callback to refresh dashboard data after activity is logged */\n  onRefresh?: () => void;\n  /** Callback for custom actions like \"Complete Task\" */\n  onCompleteTask?: () => void;\n  /** Optional className for styling customization */\n  className?: string;\n}\n\n/**\n * MobileQuickActionBar - Bottom-positioned quick action bar for mobile\n *\n * Features:\n * - 6 quick action buttons (Check-In, Sample, Call, Meeting, Note, Complete Task)\n * - 44px minimum touch targets (WCAG AA compliant)\n * - Hidden on desktop (lg: breakpoint), visible on mobile/tablet\n * - Pre-fills activity type in QuickLogForm for faster logging\n * - Sticky bottom positioning with safe area insets for notched devices\n *\n * Layout:\n * - Fixed to bottom of viewport on mobile (< 1024px)\n * - Evenly distributed buttons with labels\n * - Semi-transparent backdrop blur for content visibility\n */\nexport function MobileQuickActionBar({\n  onRefresh,\n  onCompleteTask,\n  className,\n}: MobileQuickActionBarProps) {\n  const [isSheetOpen, setIsSheetOpen] = useState(false);\n  const [selectedAction, setSelectedAction] = useState<QuickAction | null>(null);\n\n  // Handle quick action button click\n  const handleActionClick = useCallback(\n    (action: QuickAction) => {\n      if (action.customAction) {\n        // Handle custom actions (e.g., Complete Task)\n        onCompleteTask?.();\n        return;\n      }\n\n      // Open sheet with pre-filled activity type\n      setSelectedAction(action);\n      setIsSheetOpen(true);\n    },\n    [onCompleteTask]\n  );\n\n  // Handle form completion (successful save)\n  const handleComplete = useCallback(() => {\n    setIsSheetOpen(false);\n    setSelectedAction(null);\n    onRefresh?.();\n  }, [onRefresh]);\n\n  // Handle sheet close\n  const handleOpenChange = useCallback((open: boolean) => {\n    setIsSheetOpen(open);\n    if (!open) {\n      setSelectedAction(null);\n    }\n  }, []);\n\n  // Prepare initial draft with pre-filled activity type\n  const initialDraft: Partial<ActivityLogInput> | null = selectedAction?.activityType\n    ? { activityType: selectedAction.activityType }\n    : null;\n\n  return (\n    <>\n      {/* Quick Action Bar - Mobile only (hidden on lg: and up) */}\n      <nav\n        className={cn(\n          // Positioning: Fixed to bottom, full width\n          \"fixed bottom-0 left-0 right-0 z-40\",\n          // Hidden on desktop (lg: 1024px+), visible on mobile/tablet\n          \"lg:hidden\",\n          // Background: Semi-transparent with backdrop blur\n          \"bg-background/95 backdrop-blur-sm\",\n          // Border and shadow for elevation\n          \"border-t border-border shadow-lg\",\n          // Safe area insets for notched devices (iPhone X+)\n          \"pb-[env(safe-area-inset-bottom)]\",\n          className\n        )}\n        aria-label=\"Quick actions\"\n        role=\"navigation\"\n      >\n        <div className=\"flex items-center justify-around px-2 py-2\">\n          {QUICK_ACTIONS.map((action) => {\n            const Icon = action.icon;\n            return (\n              <Button\n                key={action.id}\n                variant=\"ghost\"\n                className={cn(\n                  // Touch target: 44px minimum (h-11 w-11 = 44x44px)\n                  \"flex h-14 min-w-[56px] flex-col items-center justify-center gap-1\",\n                  // Padding for touch comfort\n                  \"px-2 py-1\",\n                  // Text styling\n                  \"text-muted-foreground\",\n                  // Hover/active states\n                  \"hover:bg-accent hover:text-accent-foreground\",\n                  \"active:bg-accent/80\",\n                  // Focus ring for accessibility\n                  \"focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\"\n                )}\n                onClick={() => handleActionClick(action)}\n                aria-label={action.ariaLabel}\n              >\n                <Icon className=\"h-5 w-5\" aria-hidden=\"true\" />\n                <span className=\"text-xs font-medium leading-none\">{action.label}</span>\n              </Button>\n            );\n          })}\n        </div>\n      </nav>\n\n      {/* Activity Log Sheet - Opens when action selected */}\n      <Sheet open={isSheetOpen} onOpenChange={handleOpenChange}>\n        <SheetContent\n          side=\"bottom\"\n          className=\"flex max-h-[90vh] flex-col rounded-t-xl\"\n          aria-labelledby=\"quick-action-title\"\n          aria-describedby=\"quick-action-description\"\n        >\n          <SheetHeader className=\"border-b border-border pb-4\">\n            <SheetTitle id=\"quick-action-title\">\n              {selectedAction ? `Log ${selectedAction.label}` : \"Log Activity\"}\n            </SheetTitle>\n            <SheetDescription id=\"quick-action-description\">\n              {selectedAction?.activityType === \"Sample\"\n                ? \"Record sample delivery, receipt, or feedback\"\n                : `Quick capture for ${selectedAction?.label.toLowerCase() || \"activities\"}`}\n            </SheetDescription>\n          </SheetHeader>\n\n          <div className=\"flex-1 overflow-y-auto py-4\">\n            <Suspense fallback={<QuickLogFormSkeleton />}>\n              <QuickLogForm\n                onComplete={handleComplete}\n                onRefresh={onRefresh}\n                initialDraft={initialDraft}\n              />\n            </Suspense>\n          </div>\n        </SheetContent>\n      </Sheet>\n\n      {/* Spacer to prevent content from being hidden behind fixed bar */}\n      <div className=\"h-20 lg:hidden\" aria-hidden=\"true\" role=\"presentation\" />\n    </>\n  );\n}\n","import { useState, useMemo, useCallback, useRef, useEffect } from \"react\";\nimport { useGetList, useDataProvider } from \"react-admin\";\nimport { isSameDay, isBefore, startOfDay, addDays, endOfDay } from \"date-fns\";\nimport { useCurrentSale } from \"./useCurrentSale\";\nimport type { TaskItem, TaskStatus, TaskApiResponse } from \"../types\";\nimport { parseDateSafely } from \"@/lib/date-utils\";\n\n/**\n * useMyTasks - Hook for managing current user's tasks\n *\n * PERFORMANCE OPTIMIZATIONS (Kanban Audit):\n * 1. useGetList with staleTime caching - prevents unnecessary refetches\n * 2. Optimistic updates with rollback for all operations (complete, snooze, delete)\n * 3. Uses cached salesId from CurrentSaleProvider context\n */\nexport function useMyTasks() {\n  const dataProvider = useDataProvider();\n  const { salesId, loading: salesLoading } = useCurrentSale();\n\n  // Fetch tasks from server using React Admin's useGetList\n  const {\n    data: rawTasks = [],\n    isLoading: loading,\n    error: fetchError,\n    refetch: _refetch,\n  } = useGetList<TaskApiResponse>(\n    \"tasks\",\n    {\n      filter: {\n        sales_id: salesId,\n        completed: false,\n        \"deleted_at@is\": null,\n      },\n      sort: { field: \"due_date\", order: \"ASC\" },\n      pagination: { page: 1, perPage: 100 },\n      meta: {\n        expand: [\"opportunity\", \"contact\", \"organization\"],\n      },\n    },\n    {\n      enabled: !salesLoading && !!salesId,\n      staleTime: 5 * 60 * 1000,\n    }\n  );\n\n  // Transform server data to TaskItem format\n  const serverTasks = useMemo(() => {\n    const now = new Date();\n    const today = startOfDay(now);\n    const tomorrow = addDays(today, 1);\n    const nextWeek = addDays(today, 7);\n\n    return rawTasks.map((task: TaskApiResponse) => {\n      const dueDate = parseDateSafely(task.due_date) ?? new Date();\n      const dueDateStart = startOfDay(dueDate);\n\n      // Determine status using date-fns for proper timezone handling\n      let status: TaskItem[\"status\"];\n      if (isBefore(dueDateStart, today)) {\n        status = \"overdue\";\n      } else if (isSameDay(dueDateStart, today)) {\n        status = \"today\";\n      } else if (isSameDay(dueDateStart, tomorrow)) {\n        status = \"tomorrow\";\n      } else if (isBefore(dueDateStart, nextWeek)) {\n        status = \"upcoming\";\n      } else {\n        status = \"later\";\n      }\n\n      // Map task type with proper handling (aligned with task_type enum)\n      const taskTypeMap: Record<string, TaskItem[\"taskType\"]> = {\n        call: \"Call\",\n        email: \"Email\",\n        meeting: \"Meeting\",\n        \"follow-up\": \"Follow-up\",\n        demo: \"Demo\",\n        proposal: \"Proposal\",\n        other: \"Other\",\n      };\n\n      return {\n        id: task.id,\n        subject: task.title || \"Untitled Task\",\n        dueDate,\n        priority: (task.priority || \"medium\") as TaskItem[\"priority\"],\n        taskType: taskTypeMap[task.type?.toLowerCase()] || \"Other\",\n        relatedTo: {\n          type: task.opportunity_id\n            ? \"opportunity\"\n            : task.contact_id\n              ? \"contact\"\n              : task.organization_id\n                ? \"organization\"\n                : \"personal\",\n          name:\n            task.opportunity?.name ||\n            task.contact?.name ||\n            task.organization?.name ||\n            \"Personal Task\",\n          id: task.opportunity_id || task.contact_id || task.organization_id || 0,\n        },\n        status,\n        notes: task.description,\n      };\n    });\n  }, [rawTasks]);\n\n  // Local optimistic state for immediate UI updates\n  const [optimisticUpdates, setOptimisticUpdates] = useState<\n    Map<number, Partial<TaskItem> & { deleted?: boolean }>\n  >(new Map());\n\n  // Merge server data with optimistic updates\n  const tasks = useMemo(() => {\n    return serverTasks\n      .map((task) => ({\n        ...task,\n        ...(optimisticUpdates.get(task.id) || {}),\n      }))\n      .filter((task) => !optimisticUpdates.get(task.id)?.deleted);\n  }, [serverTasks, optimisticUpdates]);\n\n  // Ref to track tasks for callbacks without causing recreations\n  const tasksRef = useRef<TaskItem[]>(tasks);\n  useEffect(() => {\n    tasksRef.current = tasks;\n  }, [tasks]);\n\n  // Error state (from fetch error)\n  const error = fetchError ? (fetchError as Error) : null;\n\n  /**\n   * Complete a task\n   * OPTIMISTIC UPDATE (Kanban Audit): Uses optimistic UI with rollback\n   * Previously waited for API response before updating UI\n   */\n  const completeTask = useCallback(\n    async (taskId: number) => {\n      const task = tasksRef.current.find((t) => t.id === taskId);\n      if (!task) return;\n\n      // Optimistic UI update - mark as deleted immediately\n      setOptimisticUpdates((prev) => {\n        const next = new Map(prev);\n        next.set(taskId, { deleted: true });\n        return next;\n      });\n\n      try {\n        await dataProvider.update(\"tasks\", {\n          id: taskId,\n          data: { completed: true, completed_at: new Date().toISOString() },\n          previousData: task,\n        });\n\n        // Clear optimistic update on success (task stays hidden as it's now completed on server)\n        setOptimisticUpdates((prev) => {\n          const next = new Map(prev);\n          next.delete(taskId);\n          return next;\n        });\n      } catch (err) {\n        console.error(\"Failed to complete task:\", err);\n        // Rollback optimistic update on failure\n        setOptimisticUpdates((prev) => {\n          const next = new Map(prev);\n          next.delete(taskId);\n          return next;\n        });\n        throw err;\n      }\n    },\n    [dataProvider]\n  );\n\n  /**\n   * Calculate task status based on due date relative to today\n   */\n  const calculateStatus = useCallback((dueDate: Date): TaskStatus => {\n    const now = new Date();\n    const today = startOfDay(now);\n    const tomorrow = addDays(today, 1);\n    const nextWeek = addDays(today, 7);\n    const dueDateStart = startOfDay(dueDate);\n\n    if (isBefore(dueDateStart, today)) {\n      return \"overdue\";\n    } else if (isSameDay(dueDateStart, today)) {\n      return \"today\";\n    } else if (isSameDay(dueDateStart, tomorrow)) {\n      return \"tomorrow\";\n    } else if (isBefore(dueDateStart, nextWeek)) {\n      return \"upcoming\";\n    } else {\n      return \"later\";\n    }\n  }, []);\n\n  /**\n   * Snooze a task by 1 day (to end of following day)\n   * Uses optimistic UI update for immediate feedback\n   * Uses tasksRef pattern to avoid callback recreation on task changes\n   */\n  const snoozeTask = useCallback(\n    async (taskId: number) => {\n      const task = tasksRef.current.find((t) => t.id === taskId);\n      if (!task) return;\n\n      // Calculate new due date: end of the following day (timezone-aware)\n      const newDueDate = endOfDay(addDays(task.dueDate, 1));\n      const newStatus = calculateStatus(newDueDate);\n\n      // Optimistic UI update - immediately move task to new bucket\n      setOptimisticUpdates((prev) => {\n        const next = new Map(prev);\n        next.set(taskId, { dueDate: newDueDate, status: newStatus });\n        return next;\n      });\n\n      try {\n        await dataProvider.update(\"tasks\", {\n          id: taskId,\n          data: { due_date: newDueDate.toISOString() },\n          previousData: task,\n        });\n\n        // Clear optimistic update on success\n        setOptimisticUpdates((prev) => {\n          const next = new Map(prev);\n          next.delete(taskId);\n          return next;\n        });\n      } catch (err) {\n        console.error(\"Failed to snooze task:\", err);\n        // Rollback optimistic update on failure\n        setOptimisticUpdates((prev) => {\n          const next = new Map(prev);\n          next.delete(taskId);\n          return next;\n        });\n        throw err;\n      }\n    },\n    [dataProvider, calculateStatus]\n  );\n\n  /**\n   * Delete a task\n   * Uses optimistic UI update for immediate feedback\n   * Uses tasksRef pattern to avoid callback recreation on task changes\n   */\n  const deleteTask = useCallback(\n    async (taskId: number) => {\n      const task = tasksRef.current.find((t) => t.id === taskId);\n      if (!task) return;\n\n      // Optimistic UI update - mark as deleted immediately\n      setOptimisticUpdates((prev) => {\n        const next = new Map(prev);\n        next.set(taskId, { deleted: true });\n        return next;\n      });\n\n      try {\n        await dataProvider.delete(\"tasks\", {\n          id: taskId,\n          previousData: task,\n        });\n\n        // Clear optimistic update on success\n        setOptimisticUpdates((prev) => {\n          const next = new Map(prev);\n          next.delete(taskId);\n          return next;\n        });\n      } catch (err) {\n        console.error(\"Failed to delete task:\", err);\n        // Rollback optimistic update on failure\n        setOptimisticUpdates((prev) => {\n          const next = new Map(prev);\n          next.delete(taskId);\n          return next;\n        });\n        throw err;\n      }\n    },\n    [dataProvider]\n  );\n\n  /**\n   * View task - navigates to task details\n   * This is a callback that panels can use to open task details\n   */\n  const viewTask = useCallback((taskId: number) => {\n    // Navigate to task show page (or could trigger a slide-over)\n    // For now, this is a placeholder that panels can override\n    window.location.href = `/#/tasks/${taskId}/show`;\n  }, []);\n\n  /**\n   * Update task due date (for Kanban drag-drop)\n   * Uses optimistic UI update for immediate feedback\n   * Uses tasksRef pattern to avoid callback recreation on task changes\n   *\n   * @param taskId - The task ID to update\n   * @param newDueDate - The new due date\n   * @returns Promise that resolves when update completes\n   */\n  const updateTaskDueDate = useCallback(\n    async (taskId: number, newDueDate: Date) => {\n      const task = tasksRef.current.find((t) => t.id === taskId);\n      if (!task) return;\n\n      const newStatus = calculateStatus(newDueDate);\n\n      // Optimistic UI update - immediately move task to new column\n      setOptimisticUpdates((prev) => {\n        const next = new Map(prev);\n        next.set(taskId, { dueDate: newDueDate, status: newStatus });\n        return next;\n      });\n\n      try {\n        await dataProvider.update(\"tasks\", {\n          id: taskId,\n          data: { due_date: newDueDate.toISOString() },\n          previousData: task,\n        });\n\n        // Clear optimistic update on success\n        setOptimisticUpdates((prev) => {\n          const next = new Map(prev);\n          next.delete(taskId);\n          return next;\n        });\n      } catch (err) {\n        console.error(\"Failed to update task due date:\", err);\n        // Rollback optimistic update on failure\n        setOptimisticUpdates((prev) => {\n          const next = new Map(prev);\n          next.delete(taskId);\n          return next;\n        });\n        throw err;\n      }\n    },\n    [dataProvider, calculateStatus]\n  );\n\n  /**\n   * Optimistic update for local state (used by Kanban for instant feedback)\n   * Called before API request, allows immediate column move\n   */\n  const updateTaskLocally = useCallback((taskId: number, updates: Partial<TaskItem>) => {\n    setOptimisticUpdates((prev) => {\n      const next = new Map(prev);\n      const existing = next.get(taskId) || {};\n      next.set(taskId, { ...existing, ...updates });\n      return next;\n    });\n  }, []);\n\n  /**\n   * Rollback a task to previous state (for failed API calls)\n   */\n  const rollbackTask = useCallback((taskId: number, _previousState: TaskItem) => {\n    setOptimisticUpdates((prev) => {\n      const next = new Map(prev);\n      next.delete(taskId);\n      return next;\n    });\n  }, []);\n\n  return {\n    tasks,\n    loading,\n    error,\n    completeTask,\n    snoozeTask,\n    deleteTask,\n    viewTask,\n    updateTaskDueDate,\n    updateTaskLocally,\n    rollbackTask,\n    calculateStatus,\n  };\n}\n","import { useState, useCallback } from \"react\";\nimport { useNotify } from \"react-admin\";\nimport { format } from \"date-fns\";\nimport {\n  CheckCircle2,\n  Clock,\n  Phone,\n  Mail,\n  Users,\n  Calendar,\n  Repeat,\n  FileText,\n  MoreHorizontal,\n} from \"lucide-react\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { cn } from \"@/lib/utils\";\nimport { useMyTasks } from \"../hooks/useMyTasks\";\nimport type { TaskItem } from \"../types\";\n\n/**\n * Icon mapping for task types\n * Follows PRD v1.18 task_type enum\n */\nconst TASK_TYPE_ICONS: Record<string, typeof Phone> = {\n  Call: Phone,\n  Email: Mail,\n  Meeting: Users,\n  \"Follow-up\": Repeat,\n  Demo: Calendar,\n  Proposal: FileText,\n  Other: MoreHorizontal,\n};\n\n/**\n * Priority badge variants\n * Uses semantic color tokens\n */\nconst PRIORITY_VARIANTS: Record<string, { className: string; label: string }> = {\n  critical: { className: \"bg-destructive text-destructive-foreground\", label: \"Critical\" },\n  high: { className: \"bg-warning text-warning-foreground\", label: \"High\" },\n  medium: { className: \"bg-primary/20 text-primary\", label: \"Medium\" },\n  low: { className: \"bg-muted text-muted-foreground\", label: \"Low\" },\n};\n\ninterface TaskItemCardProps {\n  task: TaskItem;\n  onComplete: (taskId: number) => Promise<void>;\n  isCompleting: boolean;\n}\n\n/**\n * Individual task card with complete action\n * 44px minimum touch target for accessibility\n */\nfunction TaskItemCard({ task, onComplete, isCompleting }: TaskItemCardProps) {\n  const Icon = TASK_TYPE_ICONS[task.taskType] || MoreHorizontal;\n  const isOverdue = task.status === \"overdue\";\n  const priorityConfig = PRIORITY_VARIANTS[task.priority] || PRIORITY_VARIANTS.medium;\n\n  return (\n    <div\n      className={cn(\n        \"flex items-center gap-3 rounded-lg border p-3\",\n        \"transition-colors duration-150\",\n        isOverdue ? \"border-destructive/50 bg-destructive/5\" : \"border-border bg-card\",\n        isCompleting && \"opacity-50\"\n      )}\n    >\n      {/* Complete button - 44px touch target */}\n      <Button\n        variant=\"ghost\"\n        size=\"icon\"\n        className={cn(\n          \"h-11 w-11 shrink-0 rounded-full\",\n          \"text-muted-foreground hover:text-success\",\n          \"hover:bg-success/10\",\n          \"focus-visible:ring-2 focus-visible:ring-ring\"\n        )}\n        onClick={() => onComplete(task.id)}\n        disabled={isCompleting}\n        aria-label={`Mark \"${task.subject}\" as complete`}\n      >\n        <CheckCircle2 className=\"h-6 w-6\" />\n      </Button>\n\n      {/* Task info */}\n      <div className=\"min-w-0 flex-1\">\n        <div className=\"flex items-center gap-2\">\n          <Icon className=\"h-4 w-4 shrink-0 text-muted-foreground\" aria-hidden=\"true\" />\n          <span className=\"truncate font-medium text-foreground\">{task.subject}</span>\n        </div>\n\n        <div className=\"mt-1 flex flex-wrap items-center gap-2 text-xs text-muted-foreground\">\n          {/* Due date */}\n          <span className={cn(\"flex items-center gap-1\", isOverdue && \"text-destructive\")}>\n            <Clock className=\"h-3 w-3\" aria-hidden=\"true\" />\n            {format(task.dueDate, \"MMM d\")}\n          </span>\n\n          {/* Related entity */}\n          {task.relatedTo?.name && <span className=\"truncate\"> {task.relatedTo.name}</span>}\n        </div>\n      </div>\n\n      {/* Priority badge */}\n      <Badge variant=\"secondary\" className={cn(\"shrink-0 text-xs\", priorityConfig.className)}>\n        {priorityConfig.label}\n      </Badge>\n    </div>\n  );\n}\n\n/**\n * Loading skeleton for task list\n */\nfunction TaskListSkeleton() {\n  return (\n    <div className=\"space-y-3\" data-testid=\"task-list-skeleton\">\n      {[1, 2, 3].map((i) => (\n        <div key={i} className=\"flex items-center gap-3 rounded-lg border border-border p-3\">\n          <Skeleton className=\"h-11 w-11 rounded-full\" />\n          <div className=\"flex-1 space-y-2\">\n            <Skeleton className=\"h-4 w-3/4\" />\n            <Skeleton className=\"h-3 w-1/2\" />\n          </div>\n          <Skeleton className=\"h-5 w-16\" />\n        </div>\n      ))}\n    </div>\n  );\n}\n\ninterface TaskCompleteSheetProps {\n  /** Whether the sheet is open */\n  open: boolean;\n  /** Callback when sheet open state changes */\n  onOpenChange: (open: boolean) => void;\n  /** Callback to refresh dashboard data after completion */\n  onRefresh?: () => void;\n}\n\n/**\n * TaskCompleteSheet - Quick task completion from mobile action bar\n *\n * Features:\n * - Shows incomplete tasks grouped by urgency (Overdue  Today  This Week)\n * - One-tap completion with optimistic UI update\n * - 44px minimum touch targets (WCAG AA compliant)\n * - Semantic colors only (no hex codes)\n *\n * Layout:\n * - Bottom sheet slide-up on mobile\n * - Shows priority tasks first (overdue, then by priority)\n */\nexport function TaskCompleteSheet({ open, onOpenChange, onRefresh }: TaskCompleteSheetProps) {\n  const { tasks, loading, error, completeTask } = useMyTasks();\n  const notify = useNotify();\n  const [completingId, setCompletingId] = useState<number | null>(null);\n\n  // Sort tasks: overdue first, then by priority within status\n  const sortedTasks = [...tasks].sort((a, b) => {\n    // Status priority: overdue > today > tomorrow > upcoming > later\n    const statusOrder: Record<string, number> = {\n      overdue: 0,\n      today: 1,\n      tomorrow: 2,\n      upcoming: 3,\n      later: 4,\n    };\n\n    const statusDiff = statusOrder[a.status] - statusOrder[b.status];\n    if (statusDiff !== 0) return statusDiff;\n\n    // Within same status, sort by priority\n    const priorityOrder: Record<string, number> = {\n      critical: 0,\n      high: 1,\n      medium: 2,\n      low: 3,\n    };\n\n    return priorityOrder[a.priority] - priorityOrder[b.priority];\n  });\n\n  // Filter to only show actionable tasks (not \"later\")\n  const actionableTasks = sortedTasks.filter((t) => t.status !== \"later\");\n\n  const handleComplete = useCallback(\n    async (taskId: number) => {\n      setCompletingId(taskId);\n      try {\n        await completeTask(taskId);\n        notify(\"Task completed!\", { type: \"success\" });\n\n        // Refresh dashboard data\n        onRefresh?.();\n\n        // Close sheet if no more tasks\n        if (actionableTasks.length <= 1) {\n          onOpenChange(false);\n        }\n      } catch {\n        notify(\"Failed to complete task\", { type: \"error\" });\n      } finally {\n        setCompletingId(null);\n      }\n    },\n    [completeTask, notify, onRefresh, actionableTasks.length, onOpenChange]\n  );\n\n  // Group tasks by status for display\n  const overdueCount = actionableTasks.filter((t) => t.status === \"overdue\").length;\n\n  return (\n    <Sheet open={open} onOpenChange={onOpenChange}>\n      <SheetContent\n        side=\"bottom\"\n        className=\"flex max-h-[80vh] flex-col rounded-t-xl\"\n        aria-labelledby=\"complete-task-title\"\n        aria-describedby=\"complete-task-description\"\n      >\n        <SheetHeader className=\"border-b border-border pb-4\">\n          <div className=\"flex items-center justify-between\">\n            <SheetTitle id=\"complete-task-title\" className=\"flex items-center gap-2\">\n              <CheckCircle2 className=\"h-5 w-5 text-success\" aria-hidden=\"true\" />\n              Complete Task\n            </SheetTitle>\n            {overdueCount > 0 && (\n              <Badge variant=\"destructive\" className=\"text-xs\">\n                {overdueCount} overdue\n              </Badge>\n            )}\n          </div>\n          <SheetDescription id=\"complete-task-description\">\n            Tap the checkmark to mark a task as complete\n          </SheetDescription>\n        </SheetHeader>\n\n        <div className=\"flex-1 overflow-y-auto py-4\">\n          {loading ? (\n            <TaskListSkeleton />\n          ) : error ? (\n            <div className=\"flex h-32 items-center justify-center\">\n              <div className=\"text-center\">\n                <p className=\"text-destructive\">Failed to load tasks</p>\n                <p className=\"text-sm text-muted-foreground\">{error.message}</p>\n              </div>\n            </div>\n          ) : actionableTasks.length === 0 ? (\n            <div className=\"flex h-32 items-center justify-center\">\n              <div className=\"text-center\">\n                <CheckCircle2 className=\"mx-auto h-12 w-12 text-success/50\" />\n                <p className=\"mt-2 font-medium text-foreground\">All caught up!</p>\n                <p className=\"text-sm text-muted-foreground\">No pending tasks to complete</p>\n              </div>\n            </div>\n          ) : (\n            <div className=\"space-y-3\">\n              {actionableTasks.map((task) => (\n                <TaskItemCard\n                  key={task.id}\n                  task={task}\n                  onComplete={handleComplete}\n                  isCompleting={completingId === task.id}\n                />\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Footer with task count */}\n        {!loading && actionableTasks.length > 0 && (\n          <div className=\"border-t border-border pt-4\">\n            <p className=\"text-center text-sm text-muted-foreground\">\n              {actionableTasks.length} task{actionableTasks.length !== 1 ? \"s\" : \"\"} remaining\n            </p>\n          </div>\n        )}\n      </SheetContent>\n    </Sheet>\n  );\n}\n","import { useNavigate } from \"react-router-dom\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { cn } from \"@/lib/utils\";\nimport { AlertCircle, Activity, Briefcase, AlertTriangle, type LucideIcon } from \"lucide-react\";\n\n/**\n * KPI Metric Type for dashboard summary cards (PRD v1.9)\n *\n * Order matches PRD Section 9.2.1:\n * 1. Open Opportunities - count (not $ value per Decision #5)\n * 2. Overdue Tasks - red when > 0\n * 3. Activities This Week - count\n * 4. Stale Deals - amber when > 0 (per-stage thresholds)\n */\nexport type KPIMetricType =\n  | \"openOpportunities\"\n  | \"overdueTasks\"\n  | \"activitiesThisWeek\"\n  | \"staleDeals\";\n\ninterface KPICardProps {\n  /** Metric type determines icon, label, and navigation target */\n  type: KPIMetricType;\n  /** The metric value to display */\n  value: number;\n  /** Whether the card is in loading state */\n  loading?: boolean;\n  /** Custom class names */\n  className?: string;\n  /** Tutorial step identifier */\n  \"data-tutorial\"?: string;\n}\n\n/**\n * Configuration for each KPI metric type (PRD v1.9 Section 9.2.1)\n */\nconst KPI_CONFIG: Record<\n  KPIMetricType,\n  {\n    icon: LucideIcon;\n    label: string;\n    formatValue: (value: number) => string;\n    navigateTo: string;\n    /** Whether to show destructive (red) styling when value > 0 */\n    destructiveWhenPositive?: boolean;\n    /** Whether to show warning (amber) styling when value > 0 */\n    warningWhenPositive?: boolean;\n  }\n> = {\n  // KPI #1: Open Opportunities count (not $ value per Decision #5)\n  openOpportunities: {\n    icon: Briefcase,\n    label: \"Open Opportunities\",\n    formatValue: (value) => value.toLocaleString(),\n    navigateTo:\n      \"/opportunities?filter=%7B%22stage%40not_in%22%3A%5B%22closed_won%22%2C%22closed_lost%22%5D%7D\",\n  },\n  // KPI #2: Overdue Tasks with red styling when > 0\n  overdueTasks: {\n    icon: AlertCircle,\n    label: \"Overdue Tasks\",\n    formatValue: (value) => value.toLocaleString(),\n    navigateTo: \"/tasks?filter=%7B%22completed%22%3Afalse%2C%22due_date%40lt%22%3A%22today%22%7D\",\n    destructiveWhenPositive: true,\n  },\n  // KPI #3: Activities This Week - Navigate to Reports for weekly analysis\n  activitiesThisWeek: {\n    icon: Activity,\n    label: \"Activities This Week\",\n    formatValue: (value) => value.toLocaleString(),\n    navigateTo: \"/reports\",\n  },\n  // KPI #4: Stale Deals with amber/warning styling when > 0\n  staleDeals: {\n    icon: AlertTriangle,\n    label: \"Stale Deals\",\n    formatValue: (value) => value.toLocaleString(),\n    navigateTo: \"/opportunities?filter=%7B%22stale%22%3Atrue%7D\",\n    warningWhenPositive: true,\n  },\n};\n\n/**\n * KPICard - Dashboard metric summary card with navigation\n *\n * Features:\n * - Click navigates to filtered list view\n * - Loading skeleton while fetching\n * - Red accent for overdue tasks (when count > 0)\n * - 48px minimum touch target\n * - Semantic button for accessibility\n *\n * Layout:\n * - Desktop: Part of 4-column grid\n * - Mobile: Part of 2x2 grid\n */\nexport function KPICard({\n  type,\n  value,\n  loading = false,\n  className,\n  \"data-tutorial\": dataTutorial\n}: KPICardProps) {\n  const navigate = useNavigate();\n  const config = KPI_CONFIG[type];\n  const Icon = config.icon;\n\n  const isDestructive = config.destructiveWhenPositive && value > 0;\n  const isWarning = config.warningWhenPositive && value > 0;\n\n  const handleClick = () => {\n    navigate(config.navigateTo);\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" || e.key === \" \") {\n      e.preventDefault();\n      handleClick();\n    }\n  };\n\n  if (loading) {\n    return (\n      <Card\n        className={cn(\"p-3 lg:p-4\", className)}\n        aria-busy=\"true\"\n        aria-label={`Loading ${config.label}`}\n        data-tutorial={dataTutorial}\n      >\n        <CardContent className=\"p-0\">\n          <div className=\"flex items-center gap-3\">\n            <Skeleton className=\"h-10 w-10 rounded-lg shrink-0\" />\n            <div className=\"flex-1 space-y-2\">\n              <Skeleton className=\"h-3 w-20\" />\n              <Skeleton className=\"h-6 w-16\" />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card\n      className={cn(\n        // Base card styling\n        \"cursor-pointer transition-all duration-150\",\n        // Hover: subtle lift (inherits from Card component)\n        // Padding: compact on mobile, standard on desktop\n        \"p-3 lg:p-4\",\n        // Focus ring for accessibility\n        \"focus-within:ring-2 focus-within:ring-primary focus-within:ring-offset-2\",\n        className\n      )}\n      onClick={handleClick}\n      onKeyDown={handleKeyDown}\n      role=\"button\"\n      tabIndex={0}\n      aria-label={`${config.label}: ${config.formatValue(value)}. Click to view details.`}\n      data-tutorial={dataTutorial}\n    >\n      <CardContent className=\"p-0\">\n        <div className=\"flex items-center gap-3\">\n          {/* Icon container - 44px minimum touch target (WCAG 2.1 AA) */}\n          <div\n            className={cn(\n              \"flex h-11 w-11 lg:h-12 lg:w-12 items-center justify-center rounded-lg shrink-0\",\n              isDestructive\n                ? \"bg-destructive/10 text-destructive\"\n                : isWarning\n                  ? \"bg-warning/10 text-warning\"\n                  : \"bg-primary/10 text-primary\"\n            )}\n          >\n            <Icon className=\"h-5 w-5 lg:h-6 lg:w-6\" aria-hidden=\"true\" />\n          </div>\n\n          {/* Text content */}\n          <div className=\"flex-1 min-w-0\">\n            {/* Label */}\n            <p className=\"text-xs lg:text-sm text-muted-foreground truncate\">{config.label}</p>\n            {/* Value */}\n            <p\n              className={cn(\n                \"text-lg lg:text-xl font-semibold truncate\",\n                isDestructive ? \"text-destructive\" : isWarning ? \"text-warning\" : \"text-foreground\"\n              )}\n            >\n              {config.formatValue(value)}\n            </p>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","import { useState, useEffect, useRef } from \"react\";\nimport { useDataProvider } from \"react-admin\";\nimport { startOfWeek, endOfWeek, startOfDay, subDays } from \"date-fns\";\nimport { useCurrentSale } from \"./useCurrentSale\";\nimport {\n  STAGE_STALE_THRESHOLDS,\n  isOpportunityStale,\n} from \"@/atomic-crm/utils/stalenessCalculation\";\n\n// Re-export for backward compatibility\nexport { STAGE_STALE_THRESHOLDS };\n\n/**\n * KPI Metrics for Dashboard Summary Header (PRD v1.9)\n *\n * PERFORMANCE OPTIMIZATION (KPI Query Audit):\n * 1. Uses server-side `total` from pagination for simple counts\n * 2. Only fetches full data when client-side calculation needed (stale deals)\n * 3. AbortController prevents state updates on unmounted components\n * 4. Uses cached salesId from CurrentSaleProvider context\n *\n * Fetches aggregated metrics in parallel for:\n * 1. Open Opportunities - count of non-closed opportunities (not $ value per Decision #5)\n * 2. Overdue Tasks - count of incomplete tasks past due date\n * 3. Activities This Week - count of activities in current week\n * 4. Stale Deals - count of deals exceeding per-stage thresholds (PRD Section 6.3)\n *\n * Per-Stage Stale Thresholds (days without activity):\n * - new_lead: 7 days\n * - initial_outreach: 14 days\n * - sample_visit_offered: 14 days\n * - feedback_logged: 21 days\n * - demo_scheduled: 14 days\n * - closed_won/closed_lost: N/A (excluded)\n *\n * Design decisions:\n * - Uses Promise.allSettled for resilient parallel fetching\n * - Individual metric errors don't fail entire dashboard\n * - Optimistic empty state while loading\n * - Staleness calculation extracted to shared utility for reuse\n */\n\nexport interface KPIMetrics {\n  openOpportunitiesCount: number;\n  overdueTasksCount: number;\n  activitiesThisWeek: number;\n  staleDealsCount: number;\n}\n\ninterface UseKPIMetricsReturn {\n  metrics: KPIMetrics;\n  loading: boolean;\n  error: Error | null;\n  refetch: () => void;\n}\n\n// Stable default metrics to avoid new reference on each render\nconst DEFAULT_METRICS: KPIMetrics = {\n  openOpportunitiesCount: 0,\n  overdueTasksCount: 0,\n  activitiesThisWeek: 0,\n  staleDealsCount: 0,\n};\n\nexport function useKPIMetrics(): UseKPIMetricsReturn {\n  const dataProvider = useDataProvider();\n  const { salesId, loading: salesLoading } = useCurrentSale();\n  const [metrics, setMetrics] = useState<KPIMetrics>(DEFAULT_METRICS);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<Error | null>(null);\n  const [refetchTrigger, setRefetchTrigger] = useState(0);\n\n  // Track previous salesId to avoid unnecessary fetches\n  const prevSalesIdRef = useRef<number | null>(null);\n\n  useEffect(() => {\n    // AbortController for cleanup - prevents state updates on unmounted component\n    const abortController = new AbortController();\n    let isMounted = true;\n\n    const fetchMetrics = async () => {\n      // Wait for sales data to load\n      if (salesLoading) {\n        return;\n      }\n\n      if (!salesId) {\n        // No user - show empty metrics\n        if (prevSalesIdRef.current !== null && isMounted) {\n          setMetrics(DEFAULT_METRICS);\n          prevSalesIdRef.current = null;\n        }\n        if (isMounted) setLoading(false);\n        return;\n      }\n\n      prevSalesIdRef.current = salesId;\n\n      try {\n        if (isMounted) {\n          setLoading(true);\n          setError(null);\n        }\n\n        // Check if aborted before making requests\n        if (abortController.signal.aborted) return;\n\n        const today = startOfDay(new Date());\n        const weekStart = startOfWeek(today, { weekStartsOn: 1 }); // Monday\n        const weekEnd = endOfWeek(today, { weekStartsOn: 1 }); // Sunday\n\n        // OPTIMIZATION: Use server-side total for simple counts\n        // Only fetch full data for stale deals which requires client-side calculation\n        // Maximum stale threshold is 21 days, so we only need opportunities with\n        // last_activity_date older than 21 days ago (potential stale candidates)\n        const staleThresholdDate = subDays(today, 21);\n\n        // Fetch all metrics in parallel using Promise.allSettled\n        // This ensures partial failures don't break the entire dashboard\n        const [openCountResult, staleOpportunitiesResult, tasksResult, activitiesResult] =\n          await Promise.allSettled([\n            // 1. Open opportunities COUNT ONLY (server-side total)\n            // OPTIMIZATION: perPage: 1 uses server-side count, avoiding full data transfer\n            dataProvider.getList(\"opportunities\", {\n              filter: {\n                \"stage@not_in\": [\"closed_won\", \"closed_lost\"],\n              },\n              sort: { field: \"id\", order: \"ASC\" },\n              pagination: { page: 1, perPage: 1 }, // Server-side count only\n            }),\n\n            // 2. Potentially stale opportunities (for client-side staleness calculation)\n            // OPTIMIZATION: Only fetch opportunities that MIGHT be stale (no activity in 21+ days)\n            // This reduces data transfer from ~1000 rows to ~50-100 rows typically\n            dataProvider.getList(\"opportunities\", {\n              filter: {\n                \"stage@not_in\": [\"closed_won\", \"closed_lost\"],\n                \"last_activity_date@lt\": staleThresholdDate.toISOString(),\n              },\n              sort: { field: \"id\", order: \"ASC\" },\n              pagination: { page: 1, perPage: 500 }, // Only stale candidates\n            }),\n\n            // 3. Overdue tasks COUNT ONLY (server-side total)\n            dataProvider.getList(\"tasks\", {\n              filter: {\n                sales_id: salesId,\n                completed: false,\n                \"due_date@lt\": today.toISOString(),\n              },\n              sort: { field: \"id\", order: \"ASC\" },\n              pagination: { page: 1, perPage: 1 }, // Server-side count only\n            }),\n\n            // 4. Activities this week COUNT ONLY (server-side total)\n            dataProvider.getList(\"activities\", {\n              filter: {\n                \"activity_date@gte\": weekStart.toISOString(),\n                \"activity_date@lte\": weekEnd.toISOString(),\n              },\n              sort: { field: \"id\", order: \"ASC\" },\n              pagination: { page: 1, perPage: 1 }, // Server-side count only\n            }),\n          ]);\n\n        // Check if aborted before processing results\n        if (abortController.signal.aborted || !isMounted) return;\n\n        // Process results, using 0 for failed requests\n        let openOpportunitiesCount = 0;\n        let staleDealsCount = 0;\n        let overdueTasksCount = 0;\n        let activitiesThisWeek = 0;\n\n        // Use server-side total for open opportunities count\n        if (openCountResult.status === \"fulfilled\") {\n          openOpportunitiesCount = openCountResult.value.total || 0;\n        } else {\n          console.error(\"Failed to fetch open opportunities count:\", openCountResult.reason);\n        }\n\n        // Calculate stale deals from potentially stale candidates\n        if (staleOpportunitiesResult.status === \"fulfilled\") {\n          const potentiallyStale = staleOpportunitiesResult.value.data;\n          // Apply per-stage threshold logic to filter actual stale deals\n          staleDealsCount = potentiallyStale.filter(\n            (opp: { stage: string; last_activity_date?: string | null }) =>\n              isOpportunityStale(opp.stage, opp.last_activity_date ?? null, today)\n          ).length;\n        } else {\n          console.error(\"Failed to fetch stale opportunities:\", staleOpportunitiesResult.reason);\n        }\n\n        if (tasksResult.status === \"fulfilled\") {\n          overdueTasksCount = tasksResult.value.total || 0;\n        } else {\n          console.error(\"Failed to fetch tasks:\", tasksResult.reason);\n        }\n\n        if (activitiesResult.status === \"fulfilled\") {\n          activitiesThisWeek = activitiesResult.value.total || 0;\n        } else {\n          console.error(\"Failed to fetch activities:\", activitiesResult.reason);\n        }\n\n        if (isMounted) {\n          setMetrics({\n            openOpportunitiesCount,\n            overdueTasksCount,\n            activitiesThisWeek,\n            staleDealsCount,\n          });\n        }\n      } catch (err) {\n        // Don't log or set error if aborted\n        if (abortController.signal.aborted) return;\n        console.error(\"Failed to fetch KPI metrics:\", err);\n        if (isMounted) setError(err as Error);\n      } finally {\n        if (isMounted) setLoading(false);\n      }\n    };\n\n    fetchMetrics();\n\n    // Cleanup function - abort and mark unmounted\n    return () => {\n      isMounted = false;\n      abortController.abort();\n    };\n  }, [dataProvider, salesId, salesLoading, refetchTrigger]);\n\n  const refetch = () => {\n    setRefetchTrigger((prev) => prev + 1);\n  };\n\n  return { metrics, loading, error, refetch };\n}\n","import { KPICard } from \"./KPICard\";\nimport { useKPIMetrics } from \"../hooks/useKPIMetrics\";\n\n/**\n * KPISummaryRow - Dashboard KPI metrics header row (PRD v1.9 Section 9.2.1)\n *\n * Displays four key metrics in a horizontal row above the main dashboard grid:\n * 1. Open Opportunities - count (not $ value per Decision #5)\n * 2. Overdue Tasks - count (red accent if > 0)\n * 3. Activities This Week - count\n * 4. Stale Deals - count (amber/warning if > 0, per-stage thresholds)\n *\n * Layout (desktop-first):\n * - Desktop (1024px): 4-column horizontal row\n * - Tablet/Mobile (<1024px): 2x2 grid\n *\n * Behavior:\n * - Click on any metric  navigate to filtered list view\n * - Loading skeleton while fetching\n * - Uses useKPIMetrics hook for single aggregated query\n */\nexport function KPISummaryRow() {\n  const { metrics, loading } = useKPIMetrics();\n\n  return (\n    <section\n      aria-label=\"Key Performance Indicators\"\n      className=\"grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4\"\n      data-tutorial=\"dashboard-kpi-row\"\n    >\n      {/* KPI #1: Open Opportunities (count, not $ value) */}\n      <KPICard\n        type=\"openOpportunities\"\n        value={metrics.openOpportunitiesCount}\n        loading={loading}\n        data-tutorial=\"dashboard-kpi-open-opportunities\"\n      />\n\n      {/* KPI #2: Overdue Tasks (red accent when > 0) */}\n      <KPICard\n        type=\"overdueTasks\"\n        value={metrics.overdueTasksCount}\n        loading={loading}\n        data-tutorial=\"dashboard-kpi-overdue-tasks\"\n      />\n\n      {/* KPI #3: Activities This Week */}\n      <KPICard\n        type=\"activitiesThisWeek\"\n        value={metrics.activitiesThisWeek}\n        loading={loading}\n        data-tutorial=\"dashboard-kpi-activities\"\n      />\n\n      {/* KPI #4: Stale Deals (amber/warning when > 0) */}\n      <KPICard\n        type=\"staleDeals\"\n        value={metrics.staleDealsCount}\n        loading={loading}\n        data-tutorial=\"dashboard-kpi-stale-deals\"\n      />\n    </section>\n  );\n}\n","import type { DriveStep } from \"driver.js\";\n\n/**\n * Dashboard tutorial steps covering:\n * 1. KPI Summary Row (4 metric cards)\n * 2. Pipeline Tab (Principal pipeline table, drill-down)\n * 3. My Tasks Tab (Kanban board, snooze, complete)\n * 4. Performance Tab (My performance widget)\n * 5. Team Activity Tab (Activity feed)\n * 6. Quick Actions (Log Activity FAB)\n *\n * Uses Driver.js DriveStep format with data-tutorial selectors\n */\nexport const DASHBOARD_TUTORIAL_STEPS: DriveStep[] = [\n  // Welcome/Intro step (no element target)\n  {\n    popover: {\n      title: \"Welcome to Your Dashboard\",\n      description:\n        \"This is your command center for tracking sales performance. Let's walk through each section so you can make the most of it.\",\n    },\n  },\n\n  // === KPI Summary Row ===\n  {\n    element: '[data-tutorial=\"dashboard-kpi-row\"]',\n    popover: {\n      title: \"Key Metrics at a Glance\",\n      description:\n        \"These four cards show your most important metrics: Open Opportunities, Overdue Tasks, Activities This Week, and Stale Deals. Click any card to see the filtered list.\",\n      side: \"bottom\",\n      align: \"center\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"dashboard-kpi-open-opportunities\"]',\n    popover: {\n      title: \"Open Opportunities\",\n      description:\n        \"The total count of active deals in your pipeline. Click to view all opportunities that aren't closed yet.\",\n      side: \"bottom\",\n      align: \"start\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"dashboard-kpi-overdue-tasks\"]',\n    popover: {\n      title: \"Overdue Tasks\",\n      description:\n        \"Tasks past their due date show in red. Zero overdue tasks means you're on top of your follow-ups!\",\n      side: \"bottom\",\n      align: \"center\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"dashboard-kpi-activities\"]',\n    popover: {\n      title: \"Activities This Week\",\n      description:\n        \"Track your engagement. Aim for 10+ activities per week per principal to keep deals moving.\",\n      side: \"bottom\",\n      align: \"center\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"dashboard-kpi-stale-deals\"]',\n    popover: {\n      title: \"Stale Deals\",\n      description:\n        \"Deals without recent activity show in amber. These need attention to prevent them from going cold.\",\n      side: \"bottom\",\n      align: \"end\",\n    },\n  },\n\n  // === Tab Navigation ===\n  {\n    element: '[data-tutorial=\"dashboard-tabs\"]',\n    popover: {\n      title: \"Dashboard Sections\",\n      description:\n        \"Switch between Pipeline, Tasks, Performance, and Team Activity. Each tab gives you a different view of your sales data.\",\n      side: \"bottom\",\n      align: \"start\",\n    },\n  },\n\n  // === Pipeline Tab ===\n  {\n    element: '[data-tutorial=\"dashboard-tab-pipeline\"]',\n    popover: {\n      title: \"Pipeline Tab\",\n      description:\n        \"Your default view. See opportunity momentum across all principals at a glance.\",\n      side: \"bottom\",\n      align: \"start\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"dashboard-pipeline-table\"]',\n    popover: {\n      title: \"Pipeline by Principal\",\n      description:\n        \"Each row shows a principal with their pipeline count, weekly activity, and momentum indicator. Click any row to drill down into specific opportunities.\",\n      side: \"top\",\n      align: \"center\",\n    },\n  },\n\n  // === My Tasks Tab ===\n  {\n    element: '[data-tutorial=\"dashboard-tab-tasks\"]',\n    popover: {\n      title: \"My Tasks Tab\",\n      description:\n        \"Your personal task manager. The badge shows how many pending tasks need attention.\",\n      side: \"bottom\",\n      align: \"center\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"dashboard-tasks-kanban\"]',\n    popover: {\n      title: \"Task Kanban Board\",\n      description:\n        \"Tasks are organized by urgency: Overdue (red), Today, and This Week. Drag tasks between columns to reschedule them.\",\n      side: \"top\",\n      align: \"center\",\n    },\n  },\n\n  // === Performance Tab ===\n  {\n    element: '[data-tutorial=\"dashboard-tab-performance\"]',\n    popover: {\n      title: \"Performance Tab\",\n      description:\n        \"Track your personal performance metrics and compare week-over-week progress.\",\n      side: \"bottom\",\n      align: \"center\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"dashboard-performance-widget\"]',\n    popover: {\n      title: \"My Performance\",\n      description:\n        \"See your activities logged, deals moved, tasks completed, and open opportunities. Green arrows mean you're improving!\",\n      side: \"top\",\n      align: \"center\",\n    },\n  },\n\n  // === Team Activity Tab ===\n  {\n    element: '[data-tutorial=\"dashboard-tab-activity\"]',\n    popover: {\n      title: \"Team Activity Tab\",\n      description:\n        \"See what your teammates are working on. Great for staying in sync and learning from each other.\",\n      side: \"bottom\",\n      align: \"end\",\n    },\n  },\n  {\n    element: '[data-tutorial=\"dashboard-activity-feed\"]',\n    popover: {\n      title: \"Activity Feed\",\n      description:\n        \"Recent activities across the team, showing who did what and when. Click 'View All' for the complete history.\",\n      side: \"top\",\n      align: \"center\",\n    },\n  },\n\n  // === Quick Actions ===\n  {\n    element: '[data-tutorial=\"dashboard-log-activity\"]',\n    popover: {\n      title: \"Log Activity (FAB)\",\n      description:\n        \"The floating action button in the bottom-right corner. Click it to quickly log calls, emails, or meetings without leaving the dashboard.\",\n      side: \"left\",\n      align: \"center\",\n    },\n  },\n\n  // Outro step (no element target)\n  {\n    popover: {\n      title: \"You're Ready!\",\n      description:\n        \"That's the dashboard tour! Remember: check your KPIs daily, keep tasks current, and log activities regularly. Happy selling!\",\n    },\n  },\n];\n","import { useRef, useCallback, useState, useEffect } from \"react\";\nimport { HelpCircle } from \"lucide-react\";\nimport { driver, type Driver } from \"driver.js\";\nimport \"driver.js/dist/driver.css\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport { DASHBOARD_TUTORIAL_STEPS } from \"./dashboardTutorialSteps\";\n\n/**\n * Standalone floating tutorial button for the Principal Dashboard.\n *\n * Features:\n * - Fixed bottom-left position (44x44px touch target)\n * - Click-only trigger (no auto-start)\n * - No TutorialProvider context dependency\n * - No progress persistence\n * - Covers all dashboard sections via Driver.js tour\n *\n * Follows the same pattern as ContactFormTutorial.tsx\n */\nexport function DashboardTutorial() {\n  const driverRef = useRef<Driver | null>(null);\n  const [isActive, setIsActive] = useState(false);\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (driverRef.current) {\n        driverRef.current.destroy();\n        driverRef.current = null;\n      }\n    };\n  }, []);\n\n  const startTutorial = useCallback(() => {\n    // Destroy any existing instance\n    if (driverRef.current) {\n      driverRef.current.destroy();\n      driverRef.current = null;\n    }\n\n    setIsActive(true);\n\n    // Create new Driver.js instance\n    driverRef.current = driver({\n      showProgress: true,\n      animate: true,\n      smoothScroll: true,\n      allowClose: true,\n      overlayOpacity: 0.75,\n      popoverClass: \"tutorial-popover\",\n      nextBtnText: \"Next \",\n      prevBtnText: \" Back\",\n      doneBtnText: \"Done \",\n      steps: DASHBOARD_TUTORIAL_STEPS,\n      onDestroyStarted: () => {\n        // Cleanup on close\n        setIsActive(false);\n        driverRef.current?.destroy();\n        driverRef.current = null;\n      },\n    });\n\n    driverRef.current.drive();\n  }, []);\n\n  // Hide button while tutorial is active\n  if (isActive) {\n    return null;\n  }\n\n  return (\n    <div className=\"fixed bottom-4 left-4 z-50\">\n      <Tooltip>\n        <TooltipTrigger asChild>\n          <Button\n            variant=\"default\"\n            size=\"icon\"\n            onClick={startTutorial}\n            className=\"h-11 w-11 rounded-full shadow-lg bg-primary text-primary-foreground hover:scale-105 transition-transform\"\n            aria-label=\"Start dashboard tutorial\"\n          >\n            <HelpCircle className=\"h-5 w-5\" />\n          </Button>\n        </TooltipTrigger>\n        <TooltipContent side=\"right\">\n          <p>Learn about the dashboard</p>\n        </TooltipContent>\n      </Tooltip>\n    </div>\n  );\n}\n","import { useState, useCallback } from \"react\";\nimport { DashboardTabPanel } from \"./components/DashboardTabPanel\";\nimport { LogActivityFAB } from \"./components/LogActivityFAB\";\nimport { MobileQuickActionBar } from \"./components/MobileQuickActionBar\";\nimport { TaskCompleteSheet } from \"./components/TaskCompleteSheet\";\nimport { KPISummaryRow } from \"./components/KPISummaryRow\";\nimport { DashboardTutorial } from \"./DashboardTutorial\";\n\n/**\n * PrincipalDashboardV3 - Vertically stacked dashboard with Log Activity FAB\n *\n * Layout (all sections stack vertically):\n * - KPI Summary Row (4-column on desktop, 2x2 on mobile)\n * - Pipeline Table (full width)\n * - Tasks Kanban Board (full width)\n * - Performance + Activity Feed (2-column on desktop, stacked on mobile)\n *\n * Features:\n * - Pure vertical stacking for maximum data visibility\n * - FAB opens Sheet slide-over for activity logging\n * - Draft persistence in localStorage\n * - Team activity feed showing recent activities with avatars\n */\nexport function PrincipalDashboardV3() {\n  // Refresh key to force data components to re-mount and re-fetch\n  const [refreshKey, setRefreshKey] = useState(0);\n  // Task completion sheet state (for mobile quick action bar)\n  const [isTaskSheetOpen, setIsTaskSheetOpen] = useState(false);\n\n  // Memoized to prevent child re-renders when passed as prop\n  const handleRefresh = useCallback(() => {\n    // Increment refresh key to force data components to re-mount and re-fetch\n    setRefreshKey((prev) => prev + 1);\n  }, []);\n\n  // Open task completion sheet (from mobile quick action bar)\n  const handleCompleteTask = useCallback(() => {\n    setIsTaskSheetOpen(true);\n  }, []);\n\n  // iPad-optimized height calculation:\n  // - Layout header: ~56px (py-3 + h-8 logo)\n  // - Layout main padding: 80px (pt-4 + pb-16)\n  // - Using dvh for Safari dynamic viewport (handles address bar)\n  // - Total chrome: ~136px, using 140px for safety margin\n  return (\n    <div className=\"flex h-[calc(100dvh-140px)] flex-col overflow-hidden\">\n      {/* Main Content - fills calculated height, no internal header (Layout provides one) */}\n      <main className=\"relative flex min-h-0 flex-1 flex-col gap-3\">\n        {/* KPI Summary Row - compact, shrinks to content */}\n        <div className=\"shrink-0\">\n          <KPISummaryRow key={`kpi-${refreshKey}`} />\n        </div>\n\n        {/* Tabbed interface - fills ALL remaining height */}\n        <DashboardTabPanel key={`tabs-${refreshKey}`} />\n\n        {/* FAB - Fixed position, opens Log Activity Sheet (desktop only) */}\n        <LogActivityFAB onRefresh={handleRefresh} />\n\n        {/* Mobile Quick Action Bar - Bottom-positioned (mobile/tablet only) */}\n        <MobileQuickActionBar onRefresh={handleRefresh} onCompleteTask={handleCompleteTask} />\n\n        {/* Task Completion Sheet - Opens from mobile quick action bar */}\n        <TaskCompleteSheet\n          open={isTaskSheetOpen}\n          onOpenChange={setIsTaskSheetOpen}\n          onRefresh={handleRefresh}\n        />\n\n        {/* Dashboard Tutorial Button - Fixed bottom-left */}\n        <DashboardTutorial />\n      </main>\n    </div>\n  );\n}\n"],"file":"chunk-BOz4rw7K.js"}