var e=Object.defineProperty,s=(s,t)=>e(s,"name",{value:t,configurable:!0});import{j as t,aj as a,ay as n,Z as r,aM as i,an as l,aL as c,u as o,aT as d,bL as h,bv as u}from"./chunk-DWisBx5Y.js";import{r as m}from"./chunk-CPNr-gD1.js";import{x,g as j,au as p,j as f,f as N,h as g,R as v,O as y,D as b,ad as k,ae as w,af as S,ag as C,av as _,a7 as D}from"../assets/index-BMLg8LT4.js";import{S as M}from"./chunk-D3G-UbTO.js";import{ag as E,a6 as z,ah as A,v as L,d as T}from"./chunk-BePsjq0D.js";import{u as I}from"./chunk-DAbVPE3R.js";import{F as O,a as P}from"./chunk-ll1YpLU1.js";const F=s(()=>{const[e,a]=m.useState(!1),{setValue:n}=I();return t.jsxs("div",{className:"space-y-2",children:[t.jsx(x,{source:"text",label:!1,multiline:!0,helperText:!1,placeholder:"Add a note"}),!e&&t.jsxs("div",{className:"flex justify-end items-center gap-2",children:[t.jsx(j,{variant:"link",size:"sm",onClick:s(()=>{a(!e),n("date",p())},"onClick"),className:"text-sm text-muted-foreground underline hover:no-underline p-0 h-auto cursor-pointer",children:"Show options"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:"(change date/time or attach files)"})]}),t.jsxs("div",{className:f("space-y-3 mt-3 overflow-hidden transition-transform ease-in-out duration-300 origin-top",e?"scale-y-100":"scale-y-0 max-h-0 h-0"),children:[t.jsx(x,{source:"date",label:"Date & Time",helperText:!1,type:"datetime-local",className:"text-primary"}),t.jsx(O,{source:"attachments",multiple:!0,children:t.jsx(P,{source:"src",title:"title",target:"_blank"})})]})]})},"NoteInputs"),U={contacts:"contact_id",opportunities:"opportunity_id"},V=s(({reference:e})=>{const s=a(),c=n(),{identity:o}=r();return c&&o?t.jsx(i,{resource:s,redirect:!1,children:t.jsx(l,{children:t.jsxs("div",{className:"space-y-3",children:[t.jsx(F,{}),t.jsx(B,{reference:e,record:c})]})})}):null},"NoteCreate"),B=s(({reference:e,record:a})=>{const[n]=c(),i=o(),{identity:l}=r(),{reset:h}=I(),{refetch:u}=d();if(!a||!l)return null;const m={text:null,date:null,attachments:null},x=s(()=>{h(m,{keepValues:!1}),u(),"contacts"===e&&n(e,{id:a&&a.id,data:{last_seen:(new Date).toISOString()},previousData:a}),i("Note added")},"handleSuccess");return t.jsx("div",{className:"flex justify-end",children:t.jsx(N,{type:"button",label:"Add this note",transform:s(s=>({...s,[U[e]]:a.id,sales_id:l.id,date:s.date||p()}),"transform"),mutationOptions:{onSuccess:x},children:"Add this note"})})},"NoteCreateButton"),J=s(({note:e})=>{if(!e.attachments||0===e.attachments.length)return null;const a=e.attachments.filter(e=>R(e.type)),n=e.attachments.filter(e=>!R(e.type));return t.jsxs("div",{className:"flex flex-col",children:[a.length>0&&t.jsx("div",{className:"grid grid-cols-4 gap-8",children:a.map((e,a)=>t.jsx("div",{children:t.jsx("img",{src:e.src,alt:e.title,className:"w-[200px] h-[100px] object-cover cursor-pointer object-left border border-border",onClick:s(()=>window.open(e.src,"_blank"),"onClick")})},a))}),n.length>0&&n.map((e,s)=>t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(E,{className:"w-4 h-4"}),t.jsx("a",{href:e.src,target:"_blank",rel:"noopener noreferrer",className:"underline hover:no-underline",children:e.title})]},s))]})},"NoteAttachments"),R=s(e=>!!e&&e.startsWith("image/"),"isImageMimeType"),W=s(({showStatus:e,note:n})=>{const[r,i]=m.useState(!1),[d,x]=m.useState(!1),p=a(),f=o(),[N,{isPending:D}]=c(),[E]=h(p,{id:n.id,previousData:n},{mutationMode:"undoable",onSuccess:s(()=>{f("Note deleted",{type:"info",undoable:!0})},"onSuccess")}),I=s(()=>{E()},"handleDelete"),O=s(()=>{x(!d)},"handleEnterEditMode"),P=s(()=>{x(!1),i(!1)},"handleCancelEdit"),U=s(e=>{N(p,{id:n.id,data:e,previousData:n},{onSuccess:s(()=>{x(!1),i(!1)},"onSuccess")})},"handleNoteUpdate");return t.jsxs("div",{onMouseEnter:s(()=>i(!0),"onMouseEnter"),onMouseLeave:s(()=>i(!1),"onMouseLeave"),children:[t.jsxs("div",{className:"flex items-center space-x-4 w-full",children:["contactNotes"===p?t.jsx(g,{width:20,height:20}):"opportunityNotes"===p?t.jsx(v,{source:"opportunity_id",reference:"opportunities",record:n,link:!1,children:t.jsx(v,{source:"customer_organization_id",reference:"organizations",link:"show",children:t.jsx(y,{width:20,height:20})})}):null,t.jsxs("div",{className:"inline-flex h-full items-center text-sm text-muted-foreground",children:[t.jsx(v,{record:n,resource:p,source:"sales_id",reference:"sales",link:!1,children:t.jsx(u,{render:s(e=>t.jsx(b,{sale:e}),"render")})})," ","added a note"," ",e&&n.status&&t.jsx(M,{className:"ml-2",status:n.status})]}),t.jsxs("span",{className:""+(r?"visible":"invisible"),children:[t.jsx(k,{children:t.jsxs(w,{children:[t.jsx(S,{asChild:!0,children:t.jsx(j,{variant:"ghost",size:"sm",onClick:O,className:"p-1 h-auto cursor-pointer",children:t.jsx(z,{className:"w-4 h-4"})})}),t.jsx(C,{children:t.jsx("p",{children:"Edit note"})})]})}),t.jsx(k,{children:t.jsxs(w,{children:[t.jsx(S,{asChild:!0,children:t.jsx(j,{variant:"ghost",size:"sm",onClick:I,className:"p-1 h-auto cursor-pointer",children:t.jsx(A,{className:"w-4 h-4"})})}),t.jsx(C,{children:t.jsx("p",{children:"Delete note"})})]})})]}),t.jsx("div",{className:"flex-1"}),t.jsx("span",{className:"text-sm text-muted-foreground",children:t.jsx(_,{date:n.created_at})})]}),d?t.jsxs(l,{onSubmit:U,record:n,children:[t.jsx(F,{showStatus:e}),t.jsxs("div",{className:"flex justify-end mt-4 space-x-4",children:[t.jsxs(j,{variant:"ghost",onClick:P,type:"button",className:"cursor-pointer",children:[t.jsx(L,{className:"w-4 h-4"}),"Cancel"]}),t.jsxs(j,{type:"submit",disabled:D,className:"flex items-center gap-2 cursor-pointer",children:[t.jsx(T,{className:"w-4 h-4"}),"Update note"]})]})]}):t.jsxs("div",{className:"pt-2 [&_p:empty]:min-h-[0.75em]",children:[n.text?.split("\n").map((e,s)=>t.jsx("p",{className:"text-sm leading-6 m-0",children:e},s)),n.attachments&&t.jsx(J,{note:n})]})]})},"Note"),Z=s(({reference:e,showStatus:s})=>{const{data:a,error:n,isPending:r}=d();return r||n?null:t.jsxs("div",{className:"mt-4",children:[t.jsx(V,{reference:e,showStatus:s}),a&&t.jsx("div",{className:"mt-4 space-y-4",children:a.map((e,n)=>t.jsxs(m.Fragment,{children:[t.jsx(W,{note:e,isLast:n===a.length-1,showStatus:s},n),n<a.length-1&&t.jsx(D,{})]},n))})]})},"NotesIterator");export{Z as N,V as a};
