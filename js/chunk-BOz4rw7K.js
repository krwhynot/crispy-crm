const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/PrincipalPipelineTable-DQmPjpI2.js","assets/index-BoLku8RR.js","js/chunk-ByJg_QQB.js","js/chunk-1NZFT-6z.js","js/chunk-JxeXaC9i.js","js/chunk-DwAffUXc.js","js/chunk-knA4lag3.js","js/chunk-Tyyhsnez.js","js/chunk-Bc6KM1xM.js","js/chunk-XoqkUGE_.js","js/chunk-CRKBdUTG.js","assets/index-CNAHjYtZ.css","js/chunk-D_rprtX5.js","js/chunk-Dn-NAOCt.js","js/TasksKanbanPanel-dzEXbzZx.js","js/chunk-B5Y5c6gs.js","js/MyPerformanceWidget-DK3Aq0_m.js","js/ActivityFeedPanel-D8L8DWFU.js","js/QuickLogForm-D1QZHiz6.js","js/chunk-Cw2QhEKy.js","js/chunk-CMQLDEz_.js","js/chunk-C_u3nriX.js"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,a=(a,t)=>e(a,"name",{value:t,configurable:!0});import{U as t,j as s,P as i,u as r}from"./chunk-ByJg_QQB.js";import{r as l,e as o}from"./chunk-1NZFT-6z.js";import{a9 as n,C as c,d,a as u,_ as p,S as m,aa as h,ab as x,B as g,s as f,ac as b,ad as v,ae as j,af as y,q as k,ag as w,a7 as N,V as T,W as C,X as S}from"../assets/index-BoLku8RR.js";import{T as _,a as D,b as L,c as P}from"./chunk-B5Y5c6gs.js";import{am as O,an as A,O as M,U as I,ao as R,ap as z,o as E,ad as V,aa as W,ag as F,aq as B,a8 as q,ar as Q,z as K,ah as $,T as Y,J as G,k as J,a6 as U,af as H}from"./chunk-Bc6KM1xM.js";import{n as X,o as Z,t as ee,u as ae,v as te,d as se,s as ie,w as re,x as le}from"./chunk-DwAffUXc.js";function oe(){const{salesId:e,loading:a}=n(),{total:s,isLoading:i}=t("tasks",{pagination:{page:1,perPage:1},filter:{sales_id:e,completed:!1,"deleted_at@is":null}},{enabled:!a&&!!e,staleTime:3e4});return{pendingCount:s??0,isLoading:i||a}}a(oe,"useTaskCount");const ne=l.lazy(()=>p(()=>import("./PrincipalPipelineTable-DQmPjpI2.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]))),ce=l.lazy(()=>p(()=>import("./TasksKanbanPanel-dzEXbzZx.js"),__vite__mapDeps([14,2,3,4,9,1,5,6,7,8,10,11,13,15]))),de=l.lazy(()=>p(()=>import("./MyPerformanceWidget-DK3Aq0_m.js"),__vite__mapDeps([16,2,3,4,1,5,6,7,8,9,10,11]))),ue=l.lazy(()=>p(()=>import("./ActivityFeedPanel-D8L8DWFU.js"),__vite__mapDeps([17,2,3,4,1,5,6,7,8,9,10,11])));function pe(){return s.jsxs("div",{className:"space-y-4 p-4",children:[s.jsx(m,{className:"h-8 w-1/3"}),s.jsx(m,{className:"h-32 w-full"}),s.jsx(m,{className:"h-32 w-full"})]})}function me(){const{pendingCount:e,isLoading:a}=oe();return s.jsx(c,{className:"flex min-h-0 flex-1 flex-col gap-0 overflow-hidden",children:s.jsxs(_,{defaultValue:"pipeline",className:"flex min-h-0 flex-1 flex-col gap-0",children:[s.jsx("div",{className:"shrink-0 border-b border-border px-4 py-3",children:s.jsxs(D,{className:"h-11 w-full justify-start gap-2 bg-transparent p-0","data-tutorial":"dashboard-tabs",children:[s.jsxs(L,{value:"pipeline",className:"h-11 min-w-[120px] gap-2 rounded-t-lg rounded-b-none border-b-2 border-transparent px-4 data-[state=active]:border-primary data-[state=active]:bg-transparent","data-tutorial":"dashboard-tab-pipeline",children:[s.jsx(O,{className:"h-4 w-4"}),s.jsx("span",{children:"Pipeline"})]}),s.jsxs(L,{value:"tasks",className:"h-11 min-w-[120px] gap-2 rounded-t-lg rounded-b-none border-b-2 border-transparent px-4 data-[state=active]:border-primary data-[state=active]:bg-transparent","data-tutorial":"dashboard-tab-tasks",children:[s.jsx(A,{className:"h-4 w-4"}),s.jsx("span",{children:"My Tasks"}),!a&&e>0&&s.jsx(d,{variant:"secondary",className:"ml-1 h-5 min-w-[20px] px-1.5 text-xs",children:e})]}),s.jsxs(L,{value:"performance",className:"h-11 min-w-[120px] gap-2 rounded-t-lg rounded-b-none border-b-2 border-transparent px-4 data-[state=active]:border-primary data-[state=active]:bg-transparent","data-tutorial":"dashboard-tab-performance",children:[s.jsx(M,{className:"h-4 w-4"}),s.jsx("span",{children:"Performance"})]}),s.jsxs(L,{value:"activity",className:"h-11 min-w-[120px] gap-2 rounded-t-lg rounded-b-none border-b-2 border-transparent px-4 data-[state=active]:border-primary data-[state=active]:bg-transparent","data-tutorial":"dashboard-tab-activity",children:[s.jsx(I,{className:"h-4 w-4"}),s.jsx("span",{children:"Team Activity"})]})]})}),s.jsxs(u,{className:"relative min-h-0 flex-1 p-0",children:[s.jsx(P,{value:"pipeline",className:"absolute inset-0 m-0 overflow-auto focus-visible:ring-0",forceMount:!0,children:s.jsx(l.Suspense,{fallback:s.jsx(pe,{}),children:s.jsx(ne,{})})}),s.jsx(P,{value:"tasks",className:"absolute inset-0 m-0 overflow-auto focus-visible:ring-0",forceMount:!0,children:s.jsx(l.Suspense,{fallback:s.jsx(pe,{}),children:s.jsx(ce,{})})}),s.jsx(P,{value:"performance",className:"absolute inset-0 m-0 overflow-auto focus-visible:ring-0",forceMount:!0,children:s.jsx(l.Suspense,{fallback:s.jsx(pe,{}),children:s.jsx(de,{})})}),s.jsx(P,{value:"activity",className:"absolute inset-0 m-0 overflow-auto focus-visible:ring-0",forceMount:!0,children:s.jsx(l.Suspense,{fallback:s.jsx(pe,{}),children:s.jsx(ue,{})})})]})]})})}a(pe,"TabSkeleton"),a(me,"DashboardTabPanel");const he=l.lazy(()=>p(()=>import("./QuickLogForm-D1QZHiz6.js"),__vite__mapDeps([18,2,3,4,19,1,5,6,7,8,9,10,11,20,21])).then(e=>({default:e.QuickLogForm}))),xe="principal-dashboard-log-activity-draft";function ge(){return s.jsxs("div",{className:"space-y-4","data-testid":"quick-log-form-skeleton",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx(m,{className:"h-4 w-24"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{className:"h-4 w-20"}),s.jsx(m,{className:"h-11 w-full"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{className:"h-4 w-16"}),s.jsx(m,{className:"h-11 w-full"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(m,{className:"h-4 w-32"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{className:"h-4 w-16"}),s.jsx(m,{className:"h-11 w-full"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{className:"h-4 w-24"}),s.jsx(m,{className:"h-11 w-full"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{className:"h-4 w-12"}),s.jsx(m,{className:"h-24 w-full"})]}),s.jsxs("div",{className:"flex justify-between pt-4",children:[s.jsx(m,{className:"h-10 w-20"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(m,{className:"h-11 w-28"}),s.jsx(m,{className:"h-11 w-24"})]})]})]})}function fe(){if("undefined"==typeof window)return null;try{const e=localStorage.getItem(xe);if(!e)return null;const a=JSON.parse(e);return Date.now()-a.savedAt>864e5?(localStorage.removeItem(xe),null):a.formData}catch{return localStorage.removeItem(xe),null}}function be(e){if("undefined"==typeof window)return;if(!(e.notes||e.contactId||e.organizationId||e.opportunityId))return void localStorage.removeItem(xe);const a={formData:e,savedAt:Date.now()};localStorage.setItem(xe,JSON.stringify(a))}function ve(){"undefined"!=typeof window&&localStorage.removeItem(xe)}function je({onRefresh:e}){const[a,t]=l.useState(!1),[i,r]=l.useState(!1),o=l.useRef(null),n=l.useRef(null);l.useEffect(()=>{const e=fe();r(null!==e)},[]);const c=l.useCallback(()=>{ve(),r(!1),t(!1),setTimeout(()=>{o.current?.focus()},100)},[]),d=l.useCallback(e=>{n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{be(e),r(!0)},500)},[]),u=l.useCallback(e=>{t(e)},[]);l.useEffect(()=>()=>{n.current&&clearTimeout(n.current)},[]);const p=a?fe():null;return s.jsxs(h,{open:a,onOpenChange:u,children:[s.jsx(x,{asChild:!0,children:s.jsxs(g,{ref:o,size:"icon",className:f("fixed bottom-6 right-6 z-50 h-14 w-14","hidden lg:flex","rounded-full","shadow-lg hover:shadow-xl","transition-all duration-200","bg-primary text-primary-foreground hover:bg-primary/90","focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"),"aria-label":i?"Log Activity (draft saved)":"Log Activity","aria-expanded":a,"aria-haspopup":"dialog","data-tutorial":"dashboard-log-activity",children:[s.jsx(R,{className:"h-6 w-6"}),i&&s.jsx("span",{className:f("absolute -right-1 -top-1","h-4 w-4 rounded-full","bg-warning ring-2 ring-background","animate-pulse"),"aria-hidden":"true"})]})}),s.jsxs(b,{side:"right",className:"flex w-full flex-col sm:max-w-[420px]","aria-labelledby":"log-activity-title","aria-describedby":"log-activity-description",children:[s.jsxs(v,{className:"border-b border-border pb-4",children:[s.jsx(j,{id:"log-activity-title",children:"Log Activity"}),s.jsx(y,{id:"log-activity-description",children:"Quick capture for calls, meetings, and notes"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto py-4",children:s.jsx(l.Suspense,{fallback:s.jsx(ge,{}),children:s.jsx(he,{onComplete:c,onRefresh:e,initialDraft:p,onDraftChange:d})})})]})]})}a(ge,"QuickLogFormSkeleton$1"),a(fe,"loadDraft"),a(be,"saveDraft"),a(ve,"clearDraft"),a(je,"LogActivityFAB");const ye=l.lazy(()=>p(()=>import("./QuickLogForm-D1QZHiz6.js"),__vite__mapDeps([18,2,3,4,19,1,5,6,7,8,9,10,11,20,21])).then(e=>({default:e.QuickLogForm}))),ke=[{id:"check-in",label:"Check-In",icon:z,activityType:"Check-in",ariaLabel:"Log a check-in activity"},{id:"sample",label:"Sample",icon:E,activityType:"Sample",ariaLabel:"Log a sample delivery or request"},{id:"call",label:"Call",icon:V,activityType:"Call",ariaLabel:"Log a phone call"},{id:"meeting",label:"Meeting",icon:I,activityType:"Meeting",ariaLabel:"Log a meeting"},{id:"note",label:"Note",icon:W,activityType:"Note",ariaLabel:"Add a quick note"},{id:"complete-task",label:"Complete",icon:F,customAction:!0,ariaLabel:"Mark a task as complete"}];function we(){return s.jsxs("div",{className:"space-y-4","data-testid":"quick-log-form-skeleton",children:[s.jsxs("div",{className:"space-y-3",children:[s.jsx(m,{className:"h-4 w-24"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{className:"h-4 w-20"}),s.jsx(m,{className:"h-11 w-full"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{className:"h-4 w-16"}),s.jsx(m,{className:"h-11 w-full"})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(m,{className:"h-4 w-32"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{className:"h-4 w-16"}),s.jsx(m,{className:"h-11 w-full"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{className:"h-4 w-24"}),s.jsx(m,{className:"h-11 w-full"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(m,{className:"h-4 w-12"}),s.jsx(m,{className:"h-24 w-full"})]}),s.jsxs("div",{className:"flex justify-between pt-4",children:[s.jsx(m,{className:"h-10 w-20"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(m,{className:"h-11 w-28"}),s.jsx(m,{className:"h-11 w-24"})]})]})]})}function Ne({onRefresh:e,onCompleteTask:t,className:i}){const[r,o]=l.useState(!1),[n,c]=l.useState(null),d=l.useCallback(e=>{e.customAction?t?.():(c(e),o(!0))},[t]),u=l.useCallback(()=>{o(!1),c(null),e?.()},[e]),p=l.useCallback(e=>{o(e),e||c(null)},[]),m=n?.activityType?{activityType:n.activityType}:null;return s.jsxs(s.Fragment,{children:[s.jsx("nav",{className:f("fixed bottom-0 left-0 right-0 z-40","lg:hidden","bg-background/95 backdrop-blur-sm","border-t border-border shadow-lg","pb-[env(safe-area-inset-bottom)]",i),"aria-label":"Quick actions",role:"navigation",children:s.jsx("div",{className:"flex items-center justify-around px-2 py-2",children:ke.map(e=>{const t=e.icon;return s.jsxs(g,{variant:"ghost",className:f("flex h-14 min-w-[56px] flex-col items-center justify-center gap-1","px-2 py-1","text-muted-foreground","hover:bg-accent hover:text-accent-foreground","active:bg-accent/80","focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"),onClick:a(()=>d(e),"onClick"),"aria-label":e.ariaLabel,children:[s.jsx(t,{className:"h-5 w-5","aria-hidden":"true"}),s.jsx("span",{className:"text-xs font-medium leading-none",children:e.label})]},e.id)})})}),s.jsx(h,{open:r,onOpenChange:p,children:s.jsxs(b,{side:"bottom",className:"flex max-h-[90vh] flex-col rounded-t-xl","aria-labelledby":"quick-action-title","aria-describedby":"quick-action-description",children:[s.jsxs(v,{className:"border-b border-border pb-4",children:[s.jsx(j,{id:"quick-action-title",children:n?`Log ${n.label}`:"Log Activity"}),s.jsx(y,{id:"quick-action-description",children:"Sample"===n?.activityType?"Record sample delivery, receipt, or feedback":`Quick capture for ${n?.label.toLowerCase()||"activities"}`})]}),s.jsx("div",{className:"flex-1 overflow-y-auto py-4",children:s.jsx(l.Suspense,{fallback:s.jsx(we,{}),children:s.jsx(ye,{onComplete:u,onRefresh:e,initialDraft:m})})})]})}),s.jsx("div",{className:"h-20 lg:hidden","aria-hidden":"true",role:"presentation"})]})}function Te(){const e=i(),{salesId:a,loading:s}=n(),{data:r=[],isLoading:o,error:c,refetch:d}=t("tasks",{filter:{sales_id:a,completed:!1,"deleted_at@is":null},sort:{field:"due_date",order:"ASC"},pagination:{page:1,perPage:100},meta:{expand:["opportunity","contact","organization"]}},{enabled:!s&&!!a,staleTime:3e5}),u=l.useMemo(()=>{const e=X(new Date),a=Z(e,1),t=Z(e,7);return r.map(s=>{const i=k(s.due_date)??new Date,r=X(i);let l;l=ee(r,e)?"overdue":ae(r,e)?"today":ae(r,a)?"tomorrow":ee(r,t)?"upcoming":"later";return{id:s.id,subject:s.title||"Untitled Task",dueDate:i,priority:s.priority||"medium",taskType:{call:"Call",email:"Email",meeting:"Meeting","follow-up":"Follow-up",demo:"Demo",proposal:"Proposal",other:"Other"}[s.type?.toLowerCase()]||"Other",relatedTo:{type:s.opportunity_id?"opportunity":s.contact_id?"contact":s.organization_id?"organization":"personal",name:s.opportunity?.name||s.contact?.name||s.organization?.name||"Personal Task",id:s.opportunity_id||s.contact_id||s.organization_id||0},status:l,notes:s.description}})},[r]),[p,m]=l.useState(new Map),h=l.useMemo(()=>u.map(e=>({...e,...p.get(e.id)||{}})).filter(e=>!p.get(e.id)?.deleted),[u,p]),x=l.useRef(h);l.useEffect(()=>{x.current=h},[h]);const g=c||null,f=l.useCallback(async a=>{const t=x.current.find(e=>e.id===a);if(t){m(e=>{const t=new Map(e);return t.set(a,{deleted:!0}),t});try{await e.update("tasks",{id:a,data:{completed:!0,completed_at:(new Date).toISOString()},previousData:t}),m(e=>{const t=new Map(e);return t.delete(a),t})}catch(s){throw m(e=>{const t=new Map(e);return t.delete(a),t}),s}}},[e]),b=l.useCallback(e=>{const a=X(new Date),t=Z(a,1),s=Z(a,7),i=X(e);return ee(i,a)?"overdue":ae(i,a)?"today":ae(i,t)?"tomorrow":ee(i,s)?"upcoming":"later"},[]),v=l.useCallback(async a=>{const t=x.current.find(e=>e.id===a);if(!t)return;const s=te(Z(t.dueDate,1)),i=b(s);m(e=>{const t=new Map(e);return t.set(a,{dueDate:s,status:i}),t});try{await e.update("tasks",{id:a,data:{due_date:s.toISOString()},previousData:t}),m(e=>{const t=new Map(e);return t.delete(a),t})}catch(r){throw m(e=>{const t=new Map(e);return t.delete(a),t}),r}},[e,b]),j=l.useCallback(async a=>{const t=x.current.find(e=>e.id===a);if(t){m(e=>{const t=new Map(e);return t.set(a,{deleted:!0}),t});try{await e.delete("tasks",{id:a,previousData:t}),m(e=>{const t=new Map(e);return t.delete(a),t})}catch(s){throw m(e=>{const t=new Map(e);return t.delete(a),t}),s}}},[e]),y=l.useCallback(e=>{window.location.href=`/#/tasks/${e}/show`},[]),w=l.useCallback(async(a,t)=>{const s=x.current.find(e=>e.id===a);if(!s)return;const i=b(t);m(e=>{const s=new Map(e);return s.set(a,{dueDate:t,status:i}),s});try{await e.update("tasks",{id:a,data:{due_date:t.toISOString()},previousData:s}),m(e=>{const t=new Map(e);return t.delete(a),t})}catch(r){throw m(e=>{const t=new Map(e);return t.delete(a),t}),r}},[e,b]),N=l.useCallback((e,a)=>{m(t=>{const s=new Map(t),i=s.get(e)||{};return s.set(e,{...i,...a}),s})},[]),T=l.useCallback((e,a)=>{m(a=>{const t=new Map(a);return t.delete(e),t})},[]);return{tasks:h,loading:o,error:g,completeTask:f,snoozeTask:v,deleteTask:j,viewTask:y,updateTaskDueDate:w,updateTaskLocally:N,rollbackTask:T,calculateStatus:b}}a(we,"QuickLogFormSkeleton"),a(Ne,"MobileQuickActionBar"),a(Te,"useMyTasks");const Ce={Call:V,Email:K,Meeting:I,"Follow-up":Q,Demo:q,Proposal:W,Other:B},Se={critical:{className:"bg-destructive text-destructive-foreground",label:"Critical"},high:{className:"bg-warning text-warning-foreground",label:"High"},medium:{className:"bg-primary/20 text-primary",label:"Medium"},low:{className:"bg-muted text-muted-foreground",label:"Low"}};function _e({task:e,onComplete:t,isCompleting:i}){const r=Ce[e.taskType]||B,l="overdue"===e.status,o=Se[e.priority]||Se.medium;return s.jsxs("div",{className:f("flex items-center gap-3 rounded-lg border p-3","transition-colors duration-150",l?"border-destructive/50 bg-destructive/5":"border-border bg-card",i&&"opacity-50"),children:[s.jsx(g,{variant:"ghost",size:"icon",className:f("h-11 w-11 shrink-0 rounded-full","text-muted-foreground hover:text-success","hover:bg-success/10","focus-visible:ring-2 focus-visible:ring-ring"),onClick:a(()=>t(e.id),"onClick"),disabled:i,"aria-label":`Mark "${e.subject}" as complete`,children:s.jsx(F,{className:"h-6 w-6"})}),s.jsxs("div",{className:"min-w-0 flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(r,{className:"h-4 w-4 shrink-0 text-muted-foreground","aria-hidden":"true"}),s.jsx("span",{className:"truncate font-medium text-foreground",children:e.subject})]}),s.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[s.jsxs("span",{className:f("flex items-center gap-1",l&&"text-destructive"),children:[s.jsx($,{className:"h-3 w-3","aria-hidden":"true"}),se(e.dueDate,"MMM d")]}),e.relatedTo?.name&&s.jsxs("span",{className:"truncate",children:["• ",e.relatedTo.name]})]})]}),s.jsx(d,{variant:"secondary",className:f("shrink-0 text-xs",o.className),children:o.label})]})}function De(){return s.jsx("div",{className:"space-y-3","data-testid":"task-list-skeleton",children:[1,2,3].map(e=>s.jsxs("div",{className:"flex items-center gap-3 rounded-lg border border-border p-3",children:[s.jsx(m,{className:"h-11 w-11 rounded-full"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx(m,{className:"h-4 w-3/4"}),s.jsx(m,{className:"h-3 w-1/2"})]}),s.jsx(m,{className:"h-5 w-16"})]},e))})}function Le({open:e,onOpenChange:a,onRefresh:t}){const{tasks:i,loading:o,error:n,completeTask:c}=Te(),u=r(),[p,m]=l.useState(null),x=[...i].sort((e,a)=>{const t={overdue:0,today:1,tomorrow:2,upcoming:3,later:4},s=t[e.status]-t[a.status];if(0!==s)return s;const i={critical:0,high:1,medium:2,low:3};return i[e.priority]-i[a.priority]}).filter(e=>"later"!==e.status),g=l.useCallback(async e=>{m(e);try{await c(e),u("Task completed!",{type:"success"}),t?.(),x.length<=1&&a(!1)}catch{u("Failed to complete task",{type:"error"})}finally{m(null)}},[c,u,t,x.length,a]),f=x.filter(e=>"overdue"===e.status).length;return s.jsx(h,{open:e,onOpenChange:a,children:s.jsxs(b,{side:"bottom",className:"flex max-h-[80vh] flex-col rounded-t-xl","aria-labelledby":"complete-task-title","aria-describedby":"complete-task-description",children:[s.jsxs(v,{className:"border-b border-border pb-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(j,{id:"complete-task-title",className:"flex items-center gap-2",children:[s.jsx(F,{className:"h-5 w-5 text-success","aria-hidden":"true"}),"Complete Task"]}),f>0&&s.jsxs(d,{variant:"destructive",className:"text-xs",children:[f," overdue"]})]}),s.jsx(y,{id:"complete-task-description",children:"Tap the checkmark to mark a task as complete"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto py-4",children:o?s.jsx(De,{}):n?s.jsx("div",{className:"flex h-32 items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-destructive",children:"Failed to load tasks"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:n.message})]})}):0===x.length?s.jsx("div",{className:"flex h-32 items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx(F,{className:"mx-auto h-12 w-12 text-success/50"}),s.jsx("p",{className:"mt-2 font-medium text-foreground",children:"All caught up!"}),s.jsx("p",{className:"text-sm text-muted-foreground",children:"No pending tasks to complete"})]})}):s.jsx("div",{className:"space-y-3",children:x.map(e=>s.jsx(_e,{task:e,onComplete:g,isCompleting:p===e.id},e.id))})}),!o&&x.length>0&&s.jsx("div",{className:"border-t border-border pt-4",children:s.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:[x.length," task",1!==x.length?"s":""," remaining"]})})]})})}a(_e,"TaskItemCard"),a(De,"TaskListSkeleton"),a(Le,"TaskCompleteSheet");const Pe={openOpportunities:{icon:U,label:"Open Opportunities",formatValue:a(e=>e.toLocaleString(),"formatValue"),navigateTo:"/opportunities?filter=%7B%22stage%40not_in%22%3A%5B%22closed_won%22%2C%22closed_lost%22%5D%7D"},overdueTasks:{icon:J,label:"Overdue Tasks",formatValue:a(e=>e.toLocaleString(),"formatValue"),navigateTo:"/tasks?filter=%7B%22completed%22%3Afalse%2C%22due_date%40lt%22%3A%22today%22%7D",destructiveWhenPositive:!0},activitiesThisWeek:{icon:G,label:"Activities This Week",formatValue:a(e=>e.toLocaleString(),"formatValue"),navigateTo:"/reports"},staleDeals:{icon:Y,label:"Stale Deals",formatValue:a(e=>e.toLocaleString(),"formatValue"),navigateTo:"/opportunities?filter=%7B%22stale%22%3Atrue%7D",warningWhenPositive:!0}};function Oe({type:e,value:t,loading:i=!1,className:r,"data-tutorial":l}){const n=o(),d=Pe[e],p=d.icon,h=d.destructiveWhenPositive&&t>0,x=d.warningWhenPositive&&t>0,g=a(()=>{n(d.navigateTo)},"handleClick"),b=a(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),g())},"handleKeyDown");return i?s.jsx(c,{className:f("p-3 lg:p-4",r),"aria-busy":"true","aria-label":`Loading ${d.label}`,"data-tutorial":l,children:s.jsx(u,{className:"p-0",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(m,{className:"h-10 w-10 rounded-lg shrink-0"}),s.jsxs("div",{className:"flex-1 space-y-2",children:[s.jsx(m,{className:"h-3 w-20"}),s.jsx(m,{className:"h-6 w-16"})]})]})})}):s.jsx(c,{className:f("cursor-pointer transition-all duration-150","p-3 lg:p-4","focus-within:ring-2 focus-within:ring-primary focus-within:ring-offset-2",r),onClick:g,onKeyDown:b,role:"button",tabIndex:0,"aria-label":`${d.label}: ${d.formatValue(t)}. Click to view details.`,"data-tutorial":l,children:s.jsx(u,{className:"p-0",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:f("flex h-11 w-11 lg:h-12 lg:w-12 items-center justify-center rounded-lg shrink-0",h?"bg-destructive/10 text-destructive":x?"bg-warning/10 text-warning":"bg-primary/10 text-primary"),children:s.jsx(p,{className:"h-5 w-5 lg:h-6 lg:w-6","aria-hidden":"true"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("p",{className:"text-xs lg:text-sm text-muted-foreground truncate",children:d.label}),s.jsx("p",{className:f("text-lg lg:text-xl font-semibold truncate",h?"text-destructive":x?"text-warning":"text-foreground"),children:d.formatValue(t)})]})]})})})}a(Oe,"KPICard");const Ae={openOpportunitiesCount:0,overdueTasksCount:0,activitiesThisWeek:0,staleDealsCount:0};function Me(){const e=i(),{salesId:t,loading:s}=n(),[r,o]=l.useState(Ae),[c,d]=l.useState(!0),[u,p]=l.useState(null),[m,h]=l.useState(0),x=l.useRef(null);l.useEffect(()=>{const i=new AbortController;let r=!0;return a(async()=>{if(!s){if(!t)return null!==x.current&&r&&(o(Ae),x.current=null),void(r&&d(!1));x.current=t;try{if(r&&(d(!0),p(null)),i.signal.aborted)return;const a=X(new Date),s=ie(a,{weekStartsOn:1}),l=re(a,{weekStartsOn:1}),n=le(a,21),[c,u,m,h]=await Promise.allSettled([e.getList("opportunities",{filter:{"stage@not_in":["closed_won","closed_lost"]},sort:{field:"id",order:"ASC"},pagination:{page:1,perPage:1}}),e.getList("opportunities",{filter:{"stage@not_in":["closed_won","closed_lost"],"last_activity_date@lt":n.toISOString()},sort:{field:"id",order:"ASC"},pagination:{page:1,perPage:500}}),e.getList("tasks",{filter:{sales_id:t,completed:!1,"due_date@lt":a.toISOString()},sort:{field:"id",order:"ASC"},pagination:{page:1,perPage:1}}),e.getList("activities",{filter:{"activity_date@gte":s.toISOString(),"activity_date@lte":l.toISOString()},sort:{field:"id",order:"ASC"},pagination:{page:1,perPage:1}})]);if(i.signal.aborted||!r)return;let x=0,g=0,f=0,b=0;if("fulfilled"===c.status&&(x=c.value.total||0),"fulfilled"===u.status){g=u.value.data.filter(e=>w(e.stage,e.last_activity_date??null,a)).length}"fulfilled"===m.status&&(f=m.value.total||0),"fulfilled"===h.status&&(b=h.value.total||0),r&&o({openOpportunitiesCount:x,overdueTasksCount:f,activitiesThisWeek:b,staleDealsCount:g})}catch(a){if(i.signal.aborted)return;r&&p(a)}finally{r&&d(!1)}}},"fetchMetrics")(),()=>{r=!1,i.abort()}},[e,t,s,m]);return{metrics:r,loading:c,error:u,refetch:a(()=>{h(e=>e+1)},"refetch")}}function Ie(){const{metrics:e,loading:a}=Me();return s.jsxs("section",{"aria-label":"Key Performance Indicators",className:"grid grid-cols-2 lg:grid-cols-4 gap-3 lg:gap-4","data-tutorial":"dashboard-kpi-row",children:[s.jsx(Oe,{type:"openOpportunities",value:e.openOpportunitiesCount,loading:a,"data-tutorial":"dashboard-kpi-open-opportunities"}),s.jsx(Oe,{type:"overdueTasks",value:e.overdueTasksCount,loading:a,"data-tutorial":"dashboard-kpi-overdue-tasks"}),s.jsx(Oe,{type:"activitiesThisWeek",value:e.activitiesThisWeek,loading:a,"data-tutorial":"dashboard-kpi-activities"}),s.jsx(Oe,{type:"staleDeals",value:e.staleDealsCount,loading:a,"data-tutorial":"dashboard-kpi-stale-deals"})]})}a(Me,"useKPIMetrics"),a(Ie,"KPISummaryRow");const Re=[{popover:{title:"Welcome to Your Dashboard",description:"This is your command center for tracking sales performance. Let's walk through each section so you can make the most of it."}},{element:'[data-tutorial="dashboard-kpi-row"]',popover:{title:"Key Metrics at a Glance",description:"These four cards show your most important metrics: Open Opportunities, Overdue Tasks, Activities This Week, and Stale Deals. Click any card to see the filtered list.",side:"bottom",align:"center"}},{element:'[data-tutorial="dashboard-kpi-open-opportunities"]',popover:{title:"Open Opportunities",description:"The total count of active deals in your pipeline. Click to view all opportunities that aren't closed yet.",side:"bottom",align:"start"}},{element:'[data-tutorial="dashboard-kpi-overdue-tasks"]',popover:{title:"Overdue Tasks",description:"Tasks past their due date show in red. Zero overdue tasks means you're on top of your follow-ups!",side:"bottom",align:"center"}},{element:'[data-tutorial="dashboard-kpi-activities"]',popover:{title:"Activities This Week",description:"Track your engagement. Aim for 10+ activities per week per principal to keep deals moving.",side:"bottom",align:"center"}},{element:'[data-tutorial="dashboard-kpi-stale-deals"]',popover:{title:"Stale Deals",description:"Deals without recent activity show in amber. These need attention to prevent them from going cold.",side:"bottom",align:"end"}},{element:'[data-tutorial="dashboard-tabs"]',popover:{title:"Dashboard Sections",description:"Switch between Pipeline, Tasks, Performance, and Team Activity. Each tab gives you a different view of your sales data.",side:"bottom",align:"start"}},{element:'[data-tutorial="dashboard-tab-pipeline"]',popover:{title:"Pipeline Tab",description:"Your default view. See opportunity momentum across all principals at a glance.",side:"bottom",align:"start"}},{element:'[data-tutorial="dashboard-pipeline-table"]',popover:{title:"Pipeline by Principal",description:"Each row shows a principal with their pipeline count, weekly activity, and momentum indicator. Click any row to drill down into specific opportunities.",side:"top",align:"center"}},{element:'[data-tutorial="dashboard-tab-tasks"]',popover:{title:"My Tasks Tab",description:"Your personal task manager. The badge shows how many pending tasks need attention.",side:"bottom",align:"center"}},{element:'[data-tutorial="dashboard-tasks-kanban"]',popover:{title:"Task Kanban Board",description:"Tasks are organized by urgency: Overdue (red), Today, and This Week. Drag tasks between columns to reschedule them.",side:"top",align:"center"}},{element:'[data-tutorial="dashboard-tab-performance"]',popover:{title:"Performance Tab",description:"Track your personal performance metrics and compare week-over-week progress.",side:"bottom",align:"center"}},{element:'[data-tutorial="dashboard-performance-widget"]',popover:{title:"My Performance",description:"See your activities logged, deals moved, tasks completed, and open opportunities. Green arrows mean you're improving!",side:"top",align:"center"}},{element:'[data-tutorial="dashboard-tab-activity"]',popover:{title:"Team Activity Tab",description:"See what your teammates are working on. Great for staying in sync and learning from each other.",side:"bottom",align:"end"}},{element:'[data-tutorial="dashboard-activity-feed"]',popover:{title:"Activity Feed",description:"Recent activities across the team, showing who did what and when. Click 'View All' for the complete history.",side:"top",align:"center"}},{element:'[data-tutorial="dashboard-log-activity"]',popover:{title:"Log Activity (FAB)",description:"The floating action button in the bottom-right corner. Click it to quickly log calls, emails, or meetings without leaving the dashboard.",side:"left",align:"center"}},{popover:{title:"You're Ready!",description:"That's the dashboard tour! Remember: check your KPIs daily, keep tasks current, and log activities regularly. Happy selling!"}}];function ze(){const e=l.useRef(null),[t,i]=l.useState(!1);l.useEffect(()=>()=>{e.current&&(e.current.destroy(),e.current=null)},[]);const r=l.useCallback(()=>{e.current&&(e.current.destroy(),e.current=null),i(!0),e.current=N({showProgress:!0,animate:!0,smoothScroll:!0,allowClose:!0,overlayOpacity:.75,popoverClass:"tutorial-popover",nextBtnText:"Next →",prevBtnText:"← Back",doneBtnText:"Done ✓",steps:Re,onDestroyStarted:a(()=>{i(!1),e.current?.destroy(),e.current=null},"onDestroyStarted")}),e.current.drive()},[]);return t?null:s.jsx("div",{className:"fixed bottom-4 left-4 z-50",children:s.jsxs(T,{children:[s.jsx(C,{asChild:!0,children:s.jsx(g,{variant:"default",size:"icon",onClick:r,className:"h-11 w-11 rounded-full shadow-lg bg-primary text-primary-foreground hover:scale-105 transition-transform","aria-label":"Start dashboard tutorial",children:s.jsx(H,{className:"h-5 w-5"})})}),s.jsx(S,{side:"right",children:s.jsx("p",{children:"Learn about the dashboard"})})]})})}function Ee(){const[e,a]=l.useState(0),[t,i]=l.useState(!1),r=l.useCallback(()=>{a(e=>e+1)},[]),o=l.useCallback(()=>{i(!0)},[]);return s.jsx("div",{className:"flex h-[calc(100dvh-140px)] flex-col overflow-hidden",children:s.jsxs("main",{className:"relative flex min-h-0 flex-1 flex-col gap-3",children:[s.jsx("div",{className:"shrink-0",children:s.jsx(Ie,{},`kpi-${e}`)}),s.jsx(me,{},`tabs-${e}`),s.jsx(je,{onRefresh:r}),s.jsx(Ne,{onRefresh:r,onCompleteTask:o}),s.jsx(Le,{open:t,onOpenChange:i,onRefresh:r}),s.jsx(ze,{})]})})}a(ze,"DashboardTutorial"),a(Ee,"PrincipalDashboardV3");const Ve=Object.freeze(Object.defineProperty({__proto__:null,PrincipalDashboardV3:Ee},Symbol.toStringTag,{value:"Module"}));export{Ve as P,Te as u};
