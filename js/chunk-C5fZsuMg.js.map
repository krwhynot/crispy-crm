{"version":3,"file":"chunk-C5fZsuMg.js","sources":["../../src/components/admin/select-input.tsx"],"sourcesContent":["import type { ComponentProps } from \"react\";\nimport { useCallback, useEffect, type ReactElement } from \"react\";\nimport type { InputProps } from \"ra-core\";\nimport {\n  FieldTitle,\n  useChoices,\n  useChoicesContext,\n  useGetRecordRepresentation,\n  useInput,\n  useTranslate,\n  type ChoicesProps,\n} from \"ra-core\";\nimport { X } from \"lucide-react\";\n\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { sanitizeInputRestProps } from \"@/lib/sanitizeInputRestProps\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { cn } from \"@/lib/utils\";\nimport type { SupportCreateSuggestionOptions } from \"@/hooks/useSupportCreateSuggestion\";\nimport { useSupportCreateSuggestion } from \"@/hooks/useSupportCreateSuggestion\";\nimport { FormField, FormLabel, FormError, FormControl } from \"@/components/admin/form\";\nimport { InputHelperText } from \"@/components/admin/input-helper-text\";\n\nexport const SelectInput = (props: SelectInputProps) => {\n  const {\n    choices: choicesProp,\n    isLoading: isLoadingProp,\n    isFetching: isFetchingProp,\n    isPending: isPendingProp,\n    resource: resourceProp,\n    source: sourceProp,\n\n    optionText,\n    optionValue,\n    disableValue = \"disabled\",\n    translateChoice,\n    createValue,\n    createHintValue,\n\n    alwaysOn,\n    defaultValue,\n    format,\n    label,\n    helperText,\n    name,\n    onBlur,\n    onChange,\n    parse,\n    validate,\n    readOnly,\n    disabled,\n\n    className,\n    emptyText = \"\",\n    emptyValue = \"\",\n    filter: _filter,\n    create,\n    createLabel,\n    onCreate,\n\n    ...rest\n  } = props;\n  const translate = useTranslate();\n\n  useEffect(() => {\n    if (emptyValue == null) {\n      throw new Error(\n        `emptyValue being set to null or undefined is not supported. Use parse to turn the empty string into null.`\n      );\n    }\n  }, [emptyValue]);\n\n  const {\n    allChoices,\n    isPending,\n    error: fetchError,\n    source,\n    resource,\n    isFromReference,\n  } = useChoicesContext({\n    choices: choicesProp,\n    isLoading: isLoadingProp,\n    isFetching: isFetchingProp,\n    isPending: isPendingProp,\n    resource: resourceProp,\n    source: sourceProp,\n  });\n\n  if (source === undefined) {\n    throw new Error(\n      `If you're not wrapping the SelectInput inside a ReferenceInput, you must provide the source prop`\n    );\n  }\n\n  if (!isPending && !fetchError && allChoices === undefined) {\n    throw new Error(\n      `If you're not wrapping the SelectInput inside a ReferenceInput, you must provide the choices prop`\n    );\n  }\n\n  const getRecordRepresentation = useGetRecordRepresentation(resource);\n  const { getChoiceText, getChoiceValue, getDisableValue } = useChoices({\n    optionText: optionText ?? (isFromReference ? getRecordRepresentation : undefined),\n    optionValue,\n    disableValue,\n    translateChoice: translateChoice ?? !isFromReference,\n    createValue,\n    createHintValue,\n  });\n  const { id, field, isRequired } = useInput({\n    alwaysOn,\n    defaultValue,\n    format,\n    label,\n    helperText,\n    name,\n    onBlur,\n    onChange,\n    parse,\n    resource,\n    source,\n    validate,\n    readOnly,\n    disabled,\n  });\n\n  const renderEmptyItemOption = useCallback(() => {\n    return typeof emptyText === \"string\"\n      ? emptyText === \"\"\n        ? \"â€ƒ\" // em space, forces the display of an empty line of normal height\n        : translate(emptyText, { _: emptyText })\n      : emptyText;\n  }, [emptyText, translate]);\n\n  const renderMenuItemOption = useCallback((choice: any) => getChoiceText(choice), [getChoiceText]);\n\n  const handleChange = useCallback(\n    async (value: string) => {\n      if (value === emptyValue) {\n        field.onChange(emptyValue);\n      } else {\n        // Find the choice by value and pass it to field.onChange\n        const choice = allChoices?.find((choice) => getChoiceValue(choice) === value);\n        field.onChange(choice ? getChoiceValue(choice) : value);\n      }\n    },\n    [field, getChoiceValue, emptyValue, allChoices]\n  );\n\n  const {\n    getCreateItem,\n    handleChange: handleChangeWithCreateSupport,\n    createElement,\n  } = useSupportCreateSuggestion({\n    create,\n    createLabel,\n    createValue,\n    createHintValue,\n    onCreate,\n    handleChange,\n    optionText,\n  });\n\n  if (isPending) {\n    return (\n      <FormField id={id} name={field.name} className={cn(\"w-full min-w-20\", className)}>\n        {label !== \"\" && label !== false && (\n          <FormLabel>\n            <FieldTitle\n              label={label}\n              source={source}\n              resource={resourceProp}\n              isRequired={isRequired}\n            />\n          </FormLabel>\n        )}\n        <div className=\"relative\">\n          <Skeleton className=\"w-full h-9\" />\n        </div>\n        <InputHelperText helperText={helperText} />\n        <FormError />\n      </FormField>\n    );\n  }\n\n  const createItem = create || onCreate ? getCreateItem() : null;\n  let finalChoices = fetchError ? [] : allChoices;\n  if (create || onCreate) {\n    finalChoices = [...finalChoices, createItem];\n  }\n\n  // Handle reset functionality\n  const handleReset = (e: React.MouseEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n    field.onChange(emptyValue);\n  };\n\n  return (\n    <>\n      <FormField\n        id={id}\n        name={field.name}\n        className={cn(\"w-full min-w-20\", className)}\n        {...sanitizeInputRestProps(rest)}\n      >\n        {label !== \"\" && label !== false && (\n          <FormLabel>\n            <FieldTitle\n              label={label}\n              source={source}\n              resource={resourceProp}\n              isRequired={isRequired}\n            />\n          </FormLabel>\n        )}\n        <FormControl>\n          <div className=\"relative\">\n            <Select\n              //FIXME https://github.com/radix-ui/primitives/issues/3135\n              // Setting a key based on the value fixes an issue where onValueChange\n              // was called with an empty string when the controlled value was changed.\n              // See: https://github.com/radix-ui/primitives/issues/3135#issuecomment-2916908248\n              key={`select:${field.value?.toString() ?? emptyValue}`}\n              value={field.value?.toString() || emptyValue}\n              onValueChange={handleChangeWithCreateSupport}\n            >\n              <SelectTrigger className={cn(\"w-full transition-all hover:bg-accent\")}>\n                <SelectValue placeholder={renderEmptyItemOption()} />\n\n                {field.value && field.value !== emptyValue ? (\n                  <div\n                    role=\"button\"\n                    className=\"p-0 ml-auto pointer-events-auto hover:bg-transparent text-muted-foreground opacity-50 hover:opacity-100\"\n                    onClick={handleReset}\n                    onKeyDown={(e) => {\n                      if (e.key === \"Enter\" || e.key === \" \") {\n                        e.preventDefault();\n                        handleReset(e as unknown as React.MouseEvent);\n                      }\n                    }}\n                    tabIndex={0}\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </div>\n                ) : null}\n              </SelectTrigger>\n              <SelectContent>\n                {finalChoices?.map((choice) => {\n                  if (!choice) return null;\n                  const value = getChoiceValue(choice);\n                  const isDisabled = getDisableValue(choice);\n\n                  return (\n                    <SelectItem key={value} value={value?.toString()} disabled={isDisabled}>\n                      {renderMenuItemOption(\n                        !!createItem && choice?.id === createItem.id ? createItem : choice\n                      )}\n                    </SelectItem>\n                  );\n                })}\n              </SelectContent>\n            </Select>\n          </div>\n        </FormControl>\n        <InputHelperText helperText={helperText} />\n      </FormField>\n      {createElement}\n    </>\n  );\n};\n\nexport type SelectInputProps = ChoicesProps &\n  // Source is optional as SelectInput can be used inside a ReferenceInput that already defines the source\n  Partial<InputProps> &\n  Omit<SupportCreateSuggestionOptions, \"handleChange\"> & {\n    emptyText?: string | ReactElement;\n\n    emptyValue?: any;\n    onChange?: (value: string) => void;\n  } & Omit<ComponentProps<typeof FormField>, \"id\" | \"name\" | \"children\">;\n"],"names":["SelectInput","props","choices","choicesProp","isLoading","isLoadingProp","isFetching","isFetchingProp","isPending","isPendingProp","resource","resourceProp","source","sourceProp","optionText","optionValue","disableValue","translateChoice","createValue","createHintValue","alwaysOn","defaultValue","format","label","helperText","name","onBlur","onChange","parse","validate","readOnly","disabled","className","emptyText","emptyValue","filter","_filter","create","createLabel","onCreate","rest","translate","useTranslate","useEffect","Error","allChoices","error","fetchError","isFromReference","useChoicesContext","getRecordRepresentation","useGetRecordRepresentation","getChoiceText","getChoiceValue","getDisableValue","useChoices","id","field","isRequired","useInput","renderEmptyItemOption","useCallback","_","renderMenuItemOption","choice","handleChange","async","value","find","getCreateItem","handleChangeWithCreateSupport","createElement","useSupportCreateSuggestion","jsxs","FormField","cn","children","jsx","FormLabel","FieldTitle","Skeleton","InputHelperText","FormError","createItem","finalChoices","handleReset","e","stopPropagation","Fragment","sanitizeInputRestProps","FormControl","Select","toString","onValueChange","SelectTrigger","SelectValue","placeholder","role","onClick","onKeyDown","key","preventDefault","tabIndex","X","SelectContent","map","isDisabled","SelectItem"],"mappings":"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"}